# MPI热力图页面计划

**创建时间：** 2026-02-01
**项目：** 矿压影响指标（MPI）系统
**目标页面：** 新增独立MPI热力图展示页（不影响现有页面）

---

## 目标

- 新增独立MPI热力图页面，支持多工作面坐标文件上传与快速切换。
- 渲染模式采用“后端高质量图像为主 + 前端Canvas回退”。
- 支持悬停取值、边界线与遮罩叠加。
- 保持MPI现有分级阈值与计算流程。
- 预留ODI渐变色盘对齐（后续补齐外部色盘常量）。
 - 已对齐ODI渐变色盘常量。

---

## 范围与不改动内容

**范围：**
- 前端新增页面与组件适配
- 后端新增/扩展MPI热力图图像输出与工作面解析
- 新增坐标文件解析规则（矩形+多边形）

**不改动：**
- 现有页面（导入、插值、矿压指数、报告等）
- 现有MPI核心算法与分级阈值

---

## 关键需求

1. **双模式渲染**
   - 默认：后端生成热力图图片
   - 回退：前端Canvas网格渲染

2. **多工作面上传与切换**
   - 支持上传工作面坐标文件
   - 每个工作面提供独立显示按钮
   - 不重叠假设成立，可单选显示

3. **边界 + 遮罩**
   - 同时显示边界线与遮罩填充
   - 与当前显示工作面绑定

4. **悬停取值**
   - 显示坐标与MPI值
   - 与图像/Canvas模式一致

5. **色带与分级**
   - 继续使用现有MPI分级阈值
   - 渐变色盘对齐ODI（待补齐）

---

## 工作面坐标文件规范（建议）

### A. 矩形（主格式）
- 每行一个工作面
- 字段：`name,xmin,xmax,ymin,ymax`

### B. 多边形（可选扩展）
- 每行一个工作面
- 字段：`name,points`
- `points` 为JSON数组：`[[x1,y1],[x2,y2],...]`

---

## 页面布局（通用美观方案）

- **左侧栏**：工作面列表（按钮/切换）+ 文件上传
- **右侧**：热力图主视图 + 悬停信息面板 + 图例
- **顶部**：渲染模式切换、显示设置（边界/遮罩）

---

## 技术方案概览

### 前端
- 新增独立页面：`MpiHeatmap`
- 复用MPI计算与插值API
- 统一数据模型支持双模式渲染
- 叠加边界/遮罩层与悬停信息

### 后端
- 新增MPI热力图图像输出接口
- 新增/扩展工作面坐标解析接口
- 支持矩形/多边形的掩膜与边界输出

---

## 里程碑

1. 页面结构与路由接入完成
2. 双模式渲染接通（图像/Canvas）
3. 工作面上传与切换完成
4. 边界+遮罩与悬停完成
5. ODI渐变色盘对齐（后续）

---

## 风险与待办

- **多边形掩膜精度**：需与图像渲染边界保持一致
- **图像与Canvas一致性**：需要统一坐标映射与色带

---

## 待补充

- 工作面坐标文件示例

---

## 验证结果（2026-02-01）

- ✅ CSV样例可解析为2个矩形工作面
- ✅ JSON样例可解析为1个矩形 + 1个多边形工作面
- ✅ 图像/Canvas坐标映射保持一致
- ✅ 工作面范围超界提示可用

**样例文件：**
- workfaces_example.csv
- workfaces_example.json
