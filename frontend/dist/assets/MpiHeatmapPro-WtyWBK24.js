var Ce=(H,N,W)=>new Promise((u,I)=>{var d=p=>{try{P(W.next(p))}catch(Z){I(Z)}},y=p=>{try{P(W.throw(p))}catch(Z){I(Z)}},P=p=>p.done?u(p.value):Promise.resolve(p.value).then(d,y);P((W=W.apply(H,N)).next())});import{bl as ot,c as V,r as at,a as Xe,b5 as Q,b8 as ee,b7 as n,bb as Y,bc as je,b9 as Je,bn as Be,ba as We,w as Ke,bf as cn,br as xe,bu as un,bo as _t,bi as Pe,bj as Ct,bh as dn,bx as vn,u as ie,b as A,by as mn,bz as hn,bA as fn,bs as Pt,bt as Le}from"./vendor-DlrH7ZQK.js";import{a as yn}from"./vue-router-u9NpsLKd.js";import{_ as Tt,a as gn}from"./index-DeI7uYOw.js";import{a as pn,n as xn,d as bn,o as Mn,g as wn,t as kn,r as _n}from"./api-C8NVcaPd.js";import"./network-T6nY3V_4.js";function Cn(H,N={}){const W={totalDistance:N.totalDistance||500,frameRate:N.frameRate||60,progressPerSecond:N.progressPerSecond||10,autoPlay:N.autoPlay||!1},u=at({isPlaying:W.autoPlay,progress:0,direction:0,playbackSpeed:1,lastFrameTime:0,animationId:null}),I=V(()=>u.progress/100*W.totalDistance),d=V(()=>W.totalDistance-I.value),y=V(()=>u.progress>=100),P=V(()=>(u.direction-90)*Math.PI/180),p=V(()=>{if(!H.value)return null;if(H.value.bounds)return H.value.bounds;if(H.value.points&&H.value.points.length>0){const k=H.value.points.map($=>$[0]),J=H.value.points.map($=>$[1]);return{min_x:Math.min(...k),max_x:Math.max(...k),min_y:Math.min(...J),max_y:Math.max(...J)}}return null}),Z=V(()=>p.value?{x:(p.value.min_x+p.value.max_x)/2,y:(p.value.min_y+p.value.max_y)/2}:null),re=V(()=>p.value?p.value.max_y-p.value.min_y:0),z=V(()=>{if(!Z.value||!p.value)return null;const k=P.value,$=(p.value.max_x-p.value.min_x)*(u.progress/100),ne=p.value.min_x+Math.cos(k)*$,de=Z.value.y+Math.sin(k)*$,ce=k+Math.PI/2,be=re.value/2;return{start:{x:ne-Math.cos(ce)*be,y:de-Math.sin(ce)*be},end:{x:ne+Math.cos(ce)*be,y:de+Math.sin(ce)*be},center:{x:ne,y:de},angle:ce,length:re.value}}),ye=V(()=>{if(!p.value||!z.value)return null;const k=P.value;p.value.min_x,p.value.max_y,p.value.min_x,p.value.min_y;const J=Z.value,$=p.value.min_x,L={x:J.x-Math.cos(k)*(J.x-$),y:J.y-Math.sin(k)*(J.x-$)},ne=k+Math.PI/2,de=re.value/2,ce={x:L.x-Math.cos(ne)*de,y:L.y-Math.sin(ne)*de},be={x:L.x+Math.cos(ne)*de,y:L.y+Math.sin(ne)*de};return[ce,be,z.value.end,z.value.start]}),te=V(()=>{if(!z.value)return null;const k=50;return k/z.value.length,{distance:k,frontLine:z.value}}),x=V(()=>z.value?{distance:30,frontLine:z.value}:null),R=()=>{y.value&&(u.progress=0),u.isPlaying=!0,u.lastFrameTime=performance.now(),B()},S=()=>{u.isPlaying=!1,u.animationId&&(cancelAnimationFrame(u.animationId),u.animationId=null)},v=()=>{u.isPlaying?S():R()},E=k=>{u.progress=Math.max(0,Math.min(100,k))},j=()=>{E(0)},r=()=>{E(100)},T=()=>{E(u.progress+2)},b=()=>{E(u.progress-2)},c=k=>{u.direction=k%360,u.direction<0&&(u.direction+=360)},f=k=>{u.playbackSpeed=Math.max(.1,Math.min(10,k))},B=()=>{if(!u.isPlaying)return;const k=performance.now(),J=k-u.lastFrameTime;u.lastFrameTime=k;const $=J/1e3*W.progressPerSecond*u.playbackSpeed,L=u.progress+$;L>=100?(u.progress=100,u.isPlaying=!1):(u.progress=L,u.animationId=requestAnimationFrame(B)),oe&&oe(u.progress)};let oe=null;const ge=k=>{oe=k};return ot(()=>{S()}),{state:u,isPlaying:V(()=>u.isPlaying),progress:V(()=>u.progress),direction:V(()=>u.direction),playbackSpeed:V(()=>u.playbackSpeed),frontLine:z,goafArea:ye,stressZone:te,reliefZone:x,currentDistance:I,remainingDistance:d,isComplete:y,play:R,pause:S,togglePlay:v,seek:E,skipToStart:j,skipToEnd:r,stepForward:T,stepBackward:b,setDirection:c,setPlaybackSpeed:f,onProgress:ge}}function St(H={}){const{maxParticles:N=200,particleLife:W=2e3,emitRate:u=2}=H,I=Xe([]),d=[];let y=null;const P=()=>{for(let r=0;r<N+50;r++)d.push(p())};function p(){return{x:0,y:0,vx:0,vy:0,type:"stress",life:0,maxLife:W,birth:0,size:2,colorHue:0,colorSat:80,colorLight:60,active:!1}}function Z(){for(let T=0;T<d.length;T++)if(!d[T].active)return d[T];const r=p();return d.push(r),r}function re(r,T,b,c,f,B="stress"){r.x=T,r.y=b,r.vx=c,r.vy=f,r.type=B,r.life=1,r.maxLife=W+Math.random()*500-250,r.birth=Date.now(),r.size=2+Math.random()*2,r.active=!0,B==="stress"?r.colorHue=Math.random()*30:r.colorHue=200+Math.random()*40}const z=(r,T,b=1)=>{let c=0;for(let B=0;B<d.length;B++)d[B].active&&c++;if(c>=N)return;const f=.3;for(let B=0;B<u;B++){const oe=Z(),ge=Math.random(),k=r[0].x+(r[1].x-r[0].x)*ge,J=r[0].y+(r[1].y-r[0].y)*ge,$=T.x*b+(Math.random()-.5)*f,L=T.y*b+(Math.random()-.5)*f;re(oe,k,J,$,L,"stress")}te()},ye=(r,T=.5)=>{let b=0;for(let c=0;c<d.length;c++)d[c].active&&b++;if(!(b>=N)){for(let c=0;c<Math.ceil(u/2);c++){const f=Z(),B=r.minX+Math.random()*(r.maxX-r.minX),oe=r.minY+Math.random()*(r.maxY-r.minY),ge=Math.random()*Math.PI*2,k=Math.cos(ge)*T,J=Math.sin(ge)*T;re(f,B,oe,k,J,"relief")}te()}};function te(){const r=[];for(let T=0;T<d.length;T++)d[T].active&&r.push(d[T]);I.value=r}const x=(r=.016)=>{const T=Date.now();for(let b=0;b<d.length;b++){const c=d[b];if(!c.active)continue;const f=T-c.birth;if(c.life=1-f/c.maxLife,c.life<=0){c.active=!1;continue}c.x+=c.vx*r,c.y+=c.vy*r,c.vx+=(Math.random()-.5)*.02,c.vy+=(Math.random()-.5)*.02,c.vx*=.99,c.vy*=.99}te()},R=r=>{const T=[],b=[];for(let c=0;c<I.value.length;c++){const f=I.value[c];f.type==="stress"?T.push(f):b.push(f)}for(let c=0;c<T.length;c++){const f=T[c],B=f.life*.6;r.fillStyle=`hsla(${f.colorHue}, ${f.colorSat}%, ${f.colorLight}%, ${B})`,r.beginPath(),r.arc(f.x,f.y,f.size*f.life,0,Math.PI*2),r.fill()}for(let c=0;c<b.length;c++){const f=b[c],B=f.life*.6;r.fillStyle=`hsla(${f.colorHue}, ${f.colorSat}%, ${f.colorLight}%, ${B})`,r.beginPath(),r.arc(f.x,f.y,f.size*f.life,0,Math.PI*2),r.fill()}},S=()=>{for(let r=0;r<d.length;r++)d[r].active=!1;I.value=[]},v=V(()=>I.value.length);P();const E=r=>{y&&cancelAnimationFrame(y);let T=performance.now();const b=()=>{const c=performance.now(),f=(c-T)/1e3;T=c,x(f),r(),y=requestAnimationFrame(b)};y=requestAnimationFrame(b)},j=()=>{y&&(cancelAnimationFrame(y),y=null)};return ot(()=>{j(),S()}),{particles:I,count:v,emitStressParticles:z,emitReliefParticles:ye,update:x,draw:R,clear:S,startAnimation:E,stopAnimation:j}}function Pn(H={}){const{maxRipples:N=10,rippleSpeed:W=50,rippleInterval:u=800}=H,I=Xe([]),d=[];let y=0;const P=()=>{for(let x=0;x<N+2;x++)d.push({x:0,y:0,radius:0,maxRadius:100,life:0,speed:W,width:2,active:!1})};function p(){for(let R=0;R<d.length;R++)if(!d[R].active)return d[R];const x={x:0,y:0,radius:0,maxRadius:100,life:0,speed:W,width:2,active:!1};return d.push(x),x}function Z(){const x=[];for(let R=0;R<d.length;R++)d[R].active&&x.push(d[R]);I.value=x}const re=(x,R)=>{const S=Date.now();if(S-y<u)return;let v=0;for(let j=0;j<d.length;j++)d[j].active&&v++;if(v>=N)return;const E=p();E.x=x,E.y=R,E.radius=0,E.maxRadius=100+Math.random()*50,E.life=1,E.speed=W+Math.random()*20,E.width=2+Math.random()*2,E.active=!0,y=S,Z()},z=(x=.016)=>{for(let R=0;R<d.length;R++){const S=d[R];S.active&&(S.radius+=S.speed*x,S.life=1-S.radius/S.maxRadius,S.life<=0&&(S.active=!1))}Z()},ye=x=>{for(let R=0;R<I.value.length;R++){const S=I.value[R];x.beginPath(),x.arc(S.x,S.y,S.radius,0,Math.PI*2),x.strokeStyle=`rgba(239, 68, 68, ${S.life*.5})`,x.lineWidth=S.width*S.life,x.stroke()}},te=()=>{for(let x=0;x<d.length;x++)d[x].active=!1;I.value=[]};return P(),{ripples:I,emit:re,update:z,draw:ye,clear:te}}const Sn={class:"direction-control"},Tn={class:"control-header"},Dn={class:"value-display"},Rn={class:"compass-container"},Ln={class:"compass-ring"},Fn={class:"compass-marks"},$n={class:"quick-select"},In=["onClick","title"],En={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},An=["d"],Bn={class:"fine-control"},Xn=["value"],Wn={__name:"DirectionControl",props:{direction:{type:Number,default:0}},emits:["update:direction"],setup(H){const N=H,W=[{angle:0,label:"E"},{angle:45,label:"NE"},{angle:90,label:"N"},{angle:135,label:"NW"},{angle:180,label:"W"},{angle:225,label:"SW"},{angle:270,label:"S"},{angle:315,label:"SE"}],u=[{value:0,label:"向东 (0°)",icon:"M5 12h14M12 5l7 7-7 7"},{value:90,label:"向北 (90°)",icon:"M12 19V5M5 12l7-7 7 7"},{value:180,label:"向西 (180°)",icon:"M19 12H5M12 19l-7-7 7-7"},{value:270,label:"向南 (270°)",icon:"M12 5v14M19 12l-7 7-7-7"}],I=d=>{const y=Math.abs(N.direction-d);return y<=10||y>=350};return(d,y)=>(Q(),ee("div",Sn,[n("div",Tn,[y[1]||(y[1]=n("span",{class:"label"},"推进方向",-1)),n("span",Dn,Y(H.direction)+"°",1)]),n("div",Rn,[n("div",Ln,[n("div",Fn,[(Q(),ee(je,null,Je(W,P=>n("span",{key:P.angle,class:We(["mark",{active:I(P.angle)}]),style:Be({transform:`rotate(${P.angle}deg) translateX(-50%)`})},[n("span",{class:"mark-label",style:Be({transform:`rotate(-${P.angle}deg)`})},Y(P.label),5)],6)),64))]),n("div",{class:"compass-arrow",style:Be({transform:`rotate(${H.direction}deg)`})},[...y[2]||(y[2]=[n("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M12 2L4.5 20L12 17L19.5 20L12 2Z"})],-1)])],4),n("div",{class:"compass-center",style:Be({transform:`rotate(${H.direction}deg)`})},[...y[3]||(y[3]=[n("div",{class:"direction-line"},null,-1)])],4)])]),n("div",$n,[(Q(),ee(je,null,Je(u,P=>n("button",{key:P.value,class:We(["quick-btn",{active:H.direction===P.value}]),onClick:p=>d.$emit("update:direction",P.value),title:P.label},[(Q(),ee("svg",En,[n("path",{d:P.icon},null,8,An)]))],10,In)),64))]),n("div",Bn,[n("input",{type:"range",value:H.direction,onInput:y[0]||(y[0]=P=>d.$emit("update:direction",Number(P.target.value))),min:"0",max:"360",step:"1",class:"direction-slider"},null,40,Xn),y[4]||(y[4]=n("div",{class:"slider-labels"},[n("span",null,"0°"),n("span",null,"180°"),n("span",null,"360°")],-1))])]))}},Yn=Tt(Wn,[["__scopeId","data-v-e9ee0388"]]),Vn={class:"mpi-pro-page"},Hn={class:"top-nav"},zn={class:"nav-left"},Gn=["value"],Nn={key:0,class:"mini-stats"},qn={class:"mini-stat"},Un={class:"mini-stat danger"},Kn={class:"nav-center"},jn={key:0,class:"control-panel-overlay"},Jn={class:"control-panel"},On={class:"control-section"},Zn={class:"control-grid"},Qn={class:"control-item"},es={class:"range-wrapper"},ts={class:"range-value"},ns={class:"control-section"},ss={class:"control-grid"},as={class:"layer-toggle"},os={class:"control-item"},ls=["disabled"],is={key:0,class:"geo-summary"},rs={class:"geo-row"},cs={class:"geo-row"},us={class:"geo-row"},ds={class:"geo-row"},vs={key:1,class:"geo-error"},ms={class:"control-section"},hs={class:"layer-toggles"},fs={class:"layer-toggle"},ys={class:"layer-toggle"},gs={class:"layer-toggle"},ps={class:"layer-toggle"},xs={class:"layer-toggle"},bs={class:"control-section"},Ms={key:0,class:"loading-overlay"},ws={class:"playback-bar"},ks={class:"playback-main"},_s={key:0,viewBox:"0 0 24 24",fill:"currentColor"},Cs={key:1,viewBox:"0 0 24 24",fill:"currentColor"},Ps={class:"progress-section"},Ss=["value"],Ts={class:"progress-info"},Ds={class:"speed-control"},Rs=["onClick"],Ls={key:0,class:"mini-dashboard"},Fs={class:"dash-item"},$s={class:"dash-value stress"},Is={class:"dash-item"},Es={class:"dash-value relief"},As={class:"dash-item"},Bs={class:"dash-value phase"},Xs={class:"dash-item"},Ws={class:"dash-value"},Ys={class:"tooltip-val"},Vs={class:"tooltip-xy"},Hs=50,zs={__name:"MpiHeatmapPro",setup(H){const N=A(!1),W=A([]),u=A(""),I=A(50),d=A({}),y=A(null),P=A([]),p=Xe([]),Z=Xe([]),re=A(!1),z=A(""),ye=A(!1),te=A(null),x=A(""),R=A(!1),S=A(0),v=Cn(y,{totalDistance:500,frameRate:60,progressPerSecond:10}),E=St({maxParticles:80,emitRate:1.5}),j=St({maxParticles:60,emitRate:1}),r=Pn({maxRipples:6,rippleSpeed:60,rippleInterval:600}),T=A(0),b=at({workfaces:!0,contours:!1,contourLabels:!1,boreholes:!0,grid:!0,gradedBands:!0}),c=A(null),f=A(null),B=A(null),oe=A(null),ge=A(null),k=A(null),J=A(!1),$=Xe(null),L=A(null),ne=A(null),de=A({x:0,y:0}),ce=gn(),be=yn(),Oe=new Map,Dt=new Map,Fe=["#22c55e","#84cc16","#eab308","#f97316","#ef4444","#7c2d12"],g=at({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),Rt=V(()=>!!$.value),Lt=V(()=>({left:`${de.value.x+15}px`,top:`${de.value.y+15}px`})),Ft=["#0e7490","#14b8a6","#facc15","#fb923c","#dc2626"],Ze=V(()=>{if(!d.value||!Number.isFinite(d.value.min)||!Number.isFinite(d.value.max))return[];const t=d.value.min,e=d.value.max;if(t===e)return[t];const s=(e-t)/5;return[t+s,t+s*2,t+s*3,t+s*4]}),lt=()=>{R.value=!R.value},$t=()=>{$.value=null,p.value=[],Z.value=[],L.value=null,d.value={},te.value=null,x.value="",Dt.clear(),v.seek(0),u.value&&Ye()},It=()=>{u.value&&Ye()};Ke(re,()=>{u.value&&Ye()});const Et=V(()=>{const t=v.progress.value;return t<15?0:t<30?1:t<70?2:t<90?3:4}),At=["初采","初压","推进","周压","收尾"],Bt=V(()=>{const t=v.progress.value,e=40+t*.3,s=20*Math.sin(t/100*Math.PI*4);return Math.min(100,Math.max(0,e+s))}),Xt=V(()=>{const t=v.progress.value;return Math.min(95,t*.8+10)}),Wt=()=>Ce(this,null,function*(){try{const{data:t}=yield pn();W.value=t.seams||[],W.value.length&&(u.value=W.value[0].name,yield Ye()),P.value.length===0&&L.value&&Yt()}catch(t){console.error(t),ce.add("加载煤层失败","error")}}),Yt=()=>{if(!L.value)return;const{min_x:t,max_x:e,min_y:s,max_y:a}=L.value,o=e-t,l=a-s,i={id:"demo-workface",name:"演示工作面",type:"polygon",bounds:{min_x:t+o*.1,max_x:t+o*.35,min_y:s+l*.3,max_y:s+l*.7},points:[[t+o*.1,s+l*.3],[t+o*.35,s+l*.3],[t+o*.35,s+l*.7],[t+o*.1,s+l*.7]]};P.value.push(i),y.value=i,ce.add("已创建演示工作面","success")},Vt=t=>Ce(this,null,function*(){if(!t)return null;if(Oe.has(t))return Oe.get(t);try{const{data:e}=yield _n(t);return Oe.set(t,e),e}catch(e){return null}}),Ht=t=>Ce(this,null,function*(){var s,a;const e=[];for(const o of t){const l=o.layers||[],i=l.find(w=>w.name===u.value),F=l.filter(w=>w.name!==u.value),D=[];for(const w of F){const h=yield Vt(w.name);D.push({thickness:w.thickness||0,name:w.name,density:h==null?void 0:h.density,elastic_modulus:h==null?void 0:h.elastic_modulus,compressive_strength:h==null?void 0:h.compressive_strength,tensile_strength:h==null?void 0:h.tensile_strength})}const M=(a=(s=o.seam_top_depth)!=null?s:o.total_overburden_thickness)!=null?a:0;e.push({x:o.x,y:o.y,borehole:o.name,thickness:(i==null?void 0:i.thickness)||0,burial_depth:M,strata:D})}return e}),it=(t=null)=>Ce(this,null,function*(){var s,a,o,l;x.value="";const e=t||Z.value;if(!re.value){x.value="请先启用 geology-aware 预估";return}if(!(e!=null&&e.length)){x.value="当前没有可用点位数据";return}ye.value=!0;try{z.value&&(yield wn(z.value));const{data:i}=yield kn({points:e,resolution:I.value,method:"idw",geomodel_job_id:z.value||null,include_baseline_grid:!0});te.value=i,$.value=(i==null?void 0:i.geology_aware_grid)||null,L.value=(i==null?void 0:i.bounds)||null,d.value=(i==null?void 0:i.geology_aware_statistics)||{};const F=(s=i==null?void 0:i.baseline_statistics)==null?void 0:s.mean,D=(a=i==null?void 0:i.geology_aware_statistics)==null?void 0:a.mean;Number.isFinite(F)&&Number.isFinite(D)?ce.add(`Geo-aware对照完成：${F.toFixed(1)} -> ${D.toFixed(1)}`,"success"):ce.add("Geo-aware对照完成","success"),tt(),requestAnimationFrame($e)}catch(i){x.value=((l=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:l.detail)||(i==null?void 0:i.message)||"地质约束计算失败",ce.add(x.value,"error")}finally{ye.value=!1}}),zt=()=>{const t={};u.value&&(t.seam=u.value),z.value&&(t.geomodel_job_id=z.value),be.push({name:"Interpolation",query:t})},Ye=()=>Ce(this,null,function*(){var t;if(u.value){N.value=!0,x.value="",te.value=null;try{const{data:e}=yield bn(u.value);if(!((t=e.boreholes)!=null&&t.length))throw new Error("无钻孔数据");p.value=e.boreholes;const s=yield Ht(e.boreholes);if(Z.value=s,re.value)yield it(s);else{const a=yield Mn(s,I.value,"idw",null,null);$.value=a.data.grid,L.value=a.data.bounds,d.value=a.data.statistics,tt(),requestAnimationFrame($e)}}catch(e){console.error(e),ce.add(e.message||"计算失败","error")}finally{N.value=!1}}}),Gt=(t,e,s)=>{if(!Number.isFinite(t))return[0,0,0,0];const a=s-e||1,l=Math.max(0,Math.min(1,(t-e)/a))*(Fe.length-1),i=Math.floor(l),F=l-i,D=h=>{const m=parseInt(h.slice(1),16);return[m>>16&255,m>>8&255,m&255]},M=D(Fe[Math.min(i,Fe.length-1)]),w=D(Fe[Math.min(i+1,Fe.length-1)]);return[Math.round(M[0]+(w[0]-M[0])*F),Math.round(M[1]+(w[1]-M[1])*F),Math.round(M[2]+(w[2]-M[2])*F),255]},Nt=(t,e,s)=>{if(!Number.isFinite(t)||e.length<4)return[0,0,0,0];let a=0;t<=e[0]?a=0:t<=e[1]?a=1:t<=e[2]?a=2:t<=e[3]?a=3:a=4;const o=s[Math.min(a,s.length-1)],l=parseInt(o.slice(1),16);return[l>>16&255,l>>8&255,l&255,255]},$e=()=>{$.value&&(Qe(f.value),Qe(B.value),Qe(oe.value),qt(),jt(),v.progress.value>0&&et(v.progress.value))},Qe=t=>{if(!t||!c.value)return;const e=c.value.getBoundingClientRect(),s=window.devicePixelRatio||1,a=Math.round(e.width),o=Math.round(e.height);t.style.width=`${a}px`,t.style.height=`${o}px`,t.width=Math.round(a*s),t.height=Math.round(o*s);const l=t.getContext("2d");l&&(l.setTransform(s,0,0,s,0,0),l.imageSmoothingEnabled=!1)},X=(t,e)=>{if(!L.value)return{x:0,y:0};const{min_x:s,max_y:a}=L.value,o=1,l=(t-s)*o,i=(a-e)*o;return{x:l*g.scale+g.x,y:i*g.scale+g.y}},Se=(t,e)=>{if(!L.value)return{x:0,y:0};const{min_x:s,max_y:a}=L.value,o=(t-g.x)/g.scale,l=(e-g.y)/g.scale;return{x:s+o,y:a-l}},qt=()=>{var U;const t=(U=f.value)==null?void 0:U.getContext("2d");if(!t||!$.value)return;const e=`${g.scale.toFixed(2)}-${g.x.toFixed(0)}-${g.y.toFixed(0)}`;if(J.value&&k.value&&k.value.key===e){t.clearRect(0,0,f.value.width,f.value.height),t.drawImage(k.value,0,0);return}t.clearRect(0,0,f.value.width,f.value.height);const s=$.value,a=s.length,o=s[0].length,{min_x:l,max_x:i,min_y:F,max_y:D}=L.value,M=(i-l)/o,w=(D-F)/a,h=d.value.min||0,m=d.value.max||100,K=Ze.value,O=f.value.width,ve=f.value.height,se=Se(0,0),ue=Se(O,ve),le=1,G=Math.max(0,Math.floor((se.x-l)/M)-le),ae=Math.min(o-1,Math.ceil((ue.x-l)/M)+le),C=Math.max(0,Math.floor((D-ue.y)/w)-le),_=Math.min(a-1,Math.ceil((D-se.y)/w)+le);for(let he=C;he<=_;he++)for(let we=G;we<=ae;we++){const De=s[he][we];if(De===null)continue;const Ee=l+we*M,Ae=D-he*w,fe=X(Ee,Ae),ke=X(Ee+M,Ae-w),Ve=ke.x-fe.x,Re=ke.y-fe.y;if(fe.x>O||ke.x<0||fe.y>ve||ke.y<0)continue;const me=b.gradedBands?Nt(De,K,Ft):Gt(De,h,m);t.fillStyle=`rgb(${me[0]},${me[1]},${me[2]})`,t.fillRect(Math.floor(fe.x),Math.floor(fe.y),Math.ceil(Ve)+1,Math.ceil(Re)+1)}const q=document.createElement("canvas");q.width=f.value.width,q.height=f.value.height,q.key=e,q.getContext("2d").drawImage(f.value,0,0),k.value=mn(q),J.value=!0},Ut=t=>{var ve;if(!$.value||!L.value||!d.value)return;const e=$.value,s=e.length,a=e[0].length,o=new Float64Array(s*a);for(let se=0;se<s;se++)for(let ue=0;ue<a;ue++)o[se*a+ue]=(ve=e[se][ue])!=null?ve:-9999;const l=d.value.min||0,i=d.value.max||100,F=Ze.value.length===4?Ze.value:hn(l,i,(i-l)/5),D=fn().size([a,s]).thresholds(F)(o);t.save(),t.lineWidth=2,t.strokeStyle="rgba(255, 255, 255, 0.75)";const{min_x:M,max_x:w,min_y:h,max_y:m}=L.value,K=(w-M)/a,O=(m-h)/s;D.forEach(se=>{t.beginPath(),se.coordinates.forEach(ue=>{ue.forEach(le=>{le.forEach((G,ae)=>{const C=G[0],_=G[1],q=M+C*K,U=m-_*O,he=X(q,U);ae===0?t.moveTo(he.x,he.y):t.lineTo(he.x,he.y)}),t.closePath()})}),t.stroke()}),b.contourLabels&&(t.fillStyle="rgba(255,255,255,0.8)",t.font="12px JetBrains Mono, monospace",t.textAlign="center",t.textBaseline="middle",D.forEach((se,ue)=>{if(ue%2!==0)return;const le=se.coordinates[0];if(!le||!le[0]||!le[0][0])return;const G=le[0][Math.floor(le[0].length/2)];if(!G)return;const ae=M+G[0]*K,C=m-G[1]*O,_=X(ae,C);t.fillText(se.value.toFixed(1),_.x,_.y)})),t.restore()},Kt=t=>{var e;if((e=p.value)!=null&&e.length){t.save(),t.font="11px JetBrains Mono, monospace",t.textAlign="center",t.textBaseline="middle";for(const s of p.value){const a=X(s.x,s.y),o=50;a.x<-o||a.x>oe.value.width+o||a.y<-o||a.y>oe.value.height+o||(t.beginPath(),t.arc(a.x,a.y,6,0,Math.PI*2),t.fillStyle="rgba(239, 68, 68, 0.9)",t.fill(),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(a.x-3,a.y),t.lineTo(a.x+3,a.y),t.moveTo(a.x,a.y-3),t.lineTo(a.x,a.y+3),t.strokeStyle="#fff",t.lineWidth=1.5,t.stroke(),t.fillStyle="rgba(30, 41, 59, 0.85)",t.fillRect(a.x-25,a.y+10,50,16),t.strokeStyle="rgba(148, 163, 184, 0.5)",t.lineWidth=1,t.strokeRect(a.x-25,a.y+10,50,16),t.fillStyle="#fff",t.fillText(s.name||"",a.x,a.y+18))}t.restore()}},jt=()=>{var e;const t=(e=oe.value)==null?void 0:e.getContext("2d");t&&(t.clearRect(0,0,oe.value.width,oe.value.height),b.grid&&Jt(t),b.contours&&Ut(t),b.boreholes&&Kt(t),b.workfaces&&P.value.forEach(s=>{if(t.beginPath(),s.type==="polygon"&&s.points)s.points.forEach((a,o)=>{const l=X(a[0],a[1]);o===0?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y)});else if(s.bounds){const a=X(s.bounds.min_x,s.bounds.max_y),o=X(s.bounds.max_x,s.bounds.max_y),l=X(s.bounds.max_x,s.bounds.min_y),i=X(s.bounds.min_x,s.bounds.min_y);t.moveTo(a.x,a.y),t.lineTo(o.x,o.y),t.lineTo(l.x,l.y),t.lineTo(i.x,i.y)}t.closePath(),t.strokeStyle=s===y.value?"#facc15":"#fff",t.lineWidth=s===y.value?3:2,t.stroke(),s===y.value&&(t.fillStyle="rgba(250, 204, 21, 0.1)",t.fill())}))},Jt=t=>{if(!L.value||!c.value)return;const e=c.value.getBoundingClientRect(),s=e.width,a=e.height,l=Math.max(20,Math.round(100/g.scale/10)*10);t.save(),t.strokeStyle="rgba(148, 163, 184, 0.15)",t.lineWidth=1;const i=Se(0,0),F=Se(s,a),D=Math.floor(Math.min(i.x,F.x)/l)*l,M=Math.ceil(Math.max(i.x,F.x)/l)*l,w=Math.floor(Math.min(i.y,F.y)/l)*l,h=Math.ceil(Math.max(i.y,F.y)/l)*l;for(let m=D;m<=M;m+=l){const K=X(m,w),O=X(m,h);t.beginPath(),t.moveTo(K.x,K.y),t.lineTo(O.x,O.y),t.stroke()}for(let m=w;m<=h;m+=l){const K=X(D,m),O=X(M,m);t.beginPath(),t.moveTo(K.x,K.y),t.lineTo(O.x,O.y),t.stroke()}t.restore()},et=t=>{var wt;const e=(wt=B.value)==null?void 0:wt.getContext("2d");if(!e||!y.value)return;e.clearRect(0,0,B.value.width,B.value.height);let s=y.value.bounds;if(!s&&y.value.points){const pe=y.value.points.map(Me=>Me[0]),_e=y.value.points.map(Me=>Me[1]);s={min_x:Math.min(...pe),max_x:Math.max(...pe),min_y:Math.min(..._e),max_y:Math.max(..._e)}}if(!s)return;const a=(S.value-90)*Math.PI/180,o=s.max_y-s.min_y,l=s.max_x-s.min_x,i=(s.min_x+s.max_x)/2,F=(s.min_y+s.max_y)/2,D=l*(t/100),M=i+Math.cos(a)*D,w=F+Math.sin(a)*D,h=a+Math.PI/2,m=o/2,K={x:M-Math.cos(h)*m,y:w-Math.sin(h)*m},O={x:M+Math.cos(h)*m,y:w+Math.sin(h)*m},ve=i-Math.cos(a)*(i-s.min_x),se=F-Math.sin(a)*(i-s.min_x),ue={x:ve-Math.cos(h)*m,y:se-Math.sin(h)*m},le={x:ve+Math.cos(h)*m,y:se+Math.sin(h)*m},G=X(ue.x,ue.y),ae=X(le.x,le.y),C=X(K.x,K.y),_=X(O.x,O.y),q=X(M,w);e.save();const U=e.createLinearGradient((G.x+ae.x)/2,(G.y+ae.y)/2,(C.x+_.x)/2,(C.y+_.y)/2);t<20?(U.addColorStop(0,"rgba(35, 35, 35, 0.9)"),U.addColorStop(1,"rgba(40, 40, 40, 0.85)")):t<40?(U.addColorStop(0,"rgba(40, 40, 40, 0.85)"),U.addColorStop(.5,"rgba(38, 38, 38, 0.82)"),U.addColorStop(1,"rgba(42, 42, 42, 0.8)")):t<60?(U.addColorStop(0,"rgba(45, 45, 45, 0.8)"),U.addColorStop(.5,"rgba(40, 40, 40, 0.78)"),U.addColorStop(1,"rgba(43, 43, 43, 0.75)")):t<80?(U.addColorStop(0,"rgba(48, 48, 48, 0.75)"),U.addColorStop(.5,"rgba(42, 42, 42, 0.73)"),U.addColorStop(1,"rgba(45, 45, 45, 0.7)")):(U.addColorStop(0,"rgba(50, 50, 50, 0.72)"),U.addColorStop(.5,"rgba(44, 44, 44, 0.7)"),U.addColorStop(1,"rgba(47, 47, 47, 0.68)")),e.fillStyle=U,e.beginPath(),e.moveTo(G.x,G.y),e.lineTo(ae.x,ae.y),e.lineTo(_.x,_.y),e.lineTo(C.x,C.y),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.03)",e.lineWidth=1;const he=20,we=Math.hypot(_.x-ae.x,_.y-ae.y);Math.hypot(_.x-C.x,_.y-C.y);for(let pe=0;pe<we;pe+=he){const _e=pe/we,Me=G.x+(C.x-G.x)*_e,kt=G.y+(C.y-G.y)*_e;e.beginPath(),e.moveTo(Me,kt),e.lineTo(Me+_.x-C.x,kt+_.y-C.y),e.stroke()}const De=l*.12,Ee=M+Math.cos(a)*De,Ae=w+Math.sin(a)*De,fe=o*.58,ke={x:Ee-Math.cos(h)*fe,y:Ae-Math.sin(h)*fe},Ve={x:Ee+Math.cos(h)*fe,y:Ae+Math.sin(h)*fe},Re=X(ke.x,ke.y),me=X(Ve.x,Ve.y),sn=Date.now()/800%2,an=Date.now()/1200%2,mt=.5+.2*Math.sin(sn*Math.PI),ht=.4+.15*Math.sin(an*Math.PI),He=e.createRadialGradient(q.x,q.y,0,q.x,q.y,Math.hypot(me.x-q.x,me.y-q.y)*1.5);He.addColorStop(0,`rgba(239, 68, 68, ${mt*.3})`),He.addColorStop(.5,`rgba(239, 68, 68, ${mt*.15})`),He.addColorStop(1,"rgba(239, 68, 68, 0)"),e.fillStyle=He,e.beginPath(),e.arc(q.x,q.y,Math.hypot(me.x-q.x,me.y-q.y)*1.5,0,Math.PI*2),e.fill();const ze=e.createLinearGradient((C.x+_.x)/2,(C.y+_.y)/2,(Re.x+me.x)/2,(Re.y+me.y)/2);ze.addColorStop(0,`rgba(220, 38, 38, ${ht*.7})`),ze.addColorStop(.5,`rgba(239, 68, 68, ${ht*.4})`),ze.addColorStop(1,"rgba(239, 68, 68, 0)"),e.fillStyle=ze,e.beginPath(),e.moveTo(C.x,C.y),e.lineTo(_.x,_.y),e.lineTo(me.x,me.y),e.lineTo(Re.x,Re.y),e.closePath(),e.fill();const ft=l*.1,yt=M-Math.cos(a)*ft,gt=w-Math.sin(a)*ft,Ge=o*.52,pt={x:yt-Math.cos(h)*Ge,y:gt-Math.sin(h)*Ge},xt={x:yt+Math.cos(h)*Ge,y:gt+Math.sin(h)*Ge},Ne=X(pt.x,pt.y),qe=X(xt.x,xt.y),on=Date.now()/2e3%2,bt=.4+.1*Math.sin(on*Math.PI),Ue=e.createLinearGradient((Ne.x+qe.x)/2,(Ne.y+qe.y)/2,(C.x+_.x)/2,(C.y+_.y)/2);if(Ue.addColorStop(0,`rgba(14, 116, 144, ${bt*.5})`),Ue.addColorStop(.7,`rgba(20, 184, 166, ${bt*.3})`),Ue.addColorStop(1,"rgba(14, 116, 144, 0)"),e.fillStyle=Ue,e.beginPath(),e.moveTo(Ne.x,Ne.y),e.lineTo(qe.x,qe.y),e.lineTo(C.x,C.y),e.lineTo(_.x,_.y),e.closePath(),e.fill(),(v.isPlaying.value||t>0)&&(r.update(.016),r.draw(e),v.isPlaying.value&&Math.random()<.02&&r.emit(q.x,q.y)),v.isPlaying.value&&t>0){const pe=Date.now();if(pe-T.value>Hs){const _e={x:Math.cos(a),y:Math.sin(a)};E.emitStressParticles([C,_],_e,2);const Me={minX:Math.min(G.x,ae.x,C.x,_.x),maxX:Math.max(G.x,ae.x,C.x,_.x),minY:Math.min(G.y,ae.y,C.y,_.y),maxY:Math.max(G.y,ae.y,C.y,_.y)};j.emitReliefParticles(Me,.5),T.value=pe}E.update(.016),E.draw(e),j.update(.016),j.draw(e)}else t>0&&(E.update(.016),j.update(.016),E.draw(e),j.draw(e));e.strokeStyle="#facc15",e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(C.x,C.y),e.lineTo(_.x,_.y),e.stroke(),e.strokeStyle="rgba(250, 204, 21, 0.4)",e.lineWidth=6,e.beginPath(),e.moveTo(C.x,C.y),e.lineTo(_.x,_.y),e.stroke(),e.restore(),e.save();const ln=(ve+M)/2,rn=(se+w)/2,Mt=X(ln,rn);e.translate(Mt.x,Mt.y),e.rotate(S.value*Math.PI/180),e.fillStyle="rgba(255, 255, 255, 0.8)",e.beginPath(),e.moveTo(-10,0),e.lineTo(6,-6),e.lineTo(6,6),e.closePath(),e.fill(),e.shadowColor="rgba(255, 255, 255, 0.5)",e.shadowBlur=8,e.fill(),e.restore()},tt=()=>{if(!L.value||!c.value)return;const{min_x:t,max_x:e,min_y:s,max_y:a}=L.value,o=e-t,l=a-s,i=c.value.getBoundingClientRect(),F=i.width,D=i.height,M=F/o,w=D/l,h=Math.min(M,w)*.9;g.scale=h;const m=(t+e)/2,K=(s+a)/2;g.x=F/2-(m-t)*h,g.y=D/2-(a-K)*h,Ie()},rt=t=>{c.value&&(g.isDragging=!0,g.lastX=t.clientX,g.lastY=t.clientY,g.startX=t.clientX,g.startY=t.clientY)},ct=t=>{if(!c.value)return;const e=c.value.getBoundingClientRect(),s=t.clientX-e.left,a=t.clientY-e.top;de.value={x:s,y:a};const o=Se(s,a);if($.value&&L.value){const{min_x:F,max_x:D,min_y:M,max_y:w}=L.value,h=$.value.length,m=$.value[0].length,K=Math.floor((o.x-F)/((D-F)/m)),O=Math.floor((w-o.y)/((w-M)/h));if(O>=0&&O<h&&K>=0&&K<m){const ve=$.value[O][K];ve!==null?ne.value={x:o.x,y:o.y,value:ve}:ne.value=null}else ne.value=null}if(!g.isDragging)return;const l=t.clientX-g.lastX,i=t.clientY-g.lastY;g.x+=l,g.y+=i,g.lastX=t.clientX,g.lastY=t.clientY,Ie()},ut=t=>{const e=Math.hypot(t.clientX-g.startX,t.clientY-g.startY);g.isDragging&&e<5&&Ot(t),g.isDragging=!1},Ot=t=>{if(!c.value)return;const e=c.value.getBoundingClientRect(),s=t.clientX-e.left,a=t.clientY-e.top,o=Se(s,a),l=P.value.find(i=>i.bounds?o.x>=i.bounds.min_x&&o.x<=i.bounds.max_x&&o.y>=i.bounds.min_y&&o.y<=i.bounds.max_y:!1);l&&(y.value=l,$e())},dt=t=>{t.preventDefault();const s=-t.deltaY*.001,a=g.scale*(1+s);g.scale=Math.max(.1,Math.min(50,a)),Ie()},Te=A(null);let nt=!1;const Ie=()=>{nt||(nt=!0,requestAnimationFrame(()=>{$e(),nt=!1}))};Ke(()=>v.progress.value,t=>{et(t)}),Ke(()=>v.isPlaying.value,t=>{t&&Zt()});let st=!1;Ke(()=>[g.scale,g.x,g.y],()=>{st||(st=!0,requestAnimationFrame(()=>{J.value=!1,st=!1}))},{flush:"sync"});const Zt=()=>{Te.value&&cancelAnimationFrame(Te.value);const t=()=>{v.isPlaying.value&&v.progress.value<100?(et(v.progress.value),Te.value=requestAnimationFrame(t)):v.progress.value>=100&&(v.isPlaying.value=!1)};Te.value=requestAnimationFrame(t)},vt=t=>{if(!(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.target.tagName==="SELECT"))switch(t.code){case"Space":t.preventDefault(),v.togglePlay();break;case"ArrowLeft":t.preventDefault(),t.shiftKey?v.skipToStart():v.stepBackward();break;case"ArrowRight":t.preventDefault(),t.shiftKey?v.skipToEnd():v.stepForward();break;case"ArrowUp":t.preventDefault(),v.setPlaybackSpeed(Math.min(5,v.playbackSpeed.value+.5));break;case"ArrowDown":t.preventDefault(),v.setPlaybackSpeed(Math.max(.5,v.playbackSpeed.value-.5));break;case"KeyR":t.preventDefault(),v.seek(0),E.clear(),j.clear(),r.clear();break;case"Digit1":t.preventDefault(),v.setPlaybackSpeed(1);break;case"Digit2":t.preventDefault(),v.setPlaybackSpeed(2);break;case"Digit5":t.preventDefault(),v.setPlaybackSpeed(5);break}};ot(()=>{const t=c.value;Te.value&&cancelAnimationFrame(Te.value),v.pause(),E.clear(),j.clear(),r.clear(),E.stopAnimation(),j.stopAnimation(),t&&(t.removeEventListener("mousedown",rt),t.removeEventListener("wheel",dt)),window.removeEventListener("mousemove",ct),window.removeEventListener("mouseup",ut),window.removeEventListener("keydown",vt)}),cn(()=>{Wt();const t=c.value;t&&(t.addEventListener("mousedown",rt),window.addEventListener("mousemove",ct),window.addEventListener("mouseup",ut),t.addEventListener("wheel",dt,{passive:!1}),window.addEventListener("keydown",vt))});const Qt=()=>{var t;return(t=ge.value)==null?void 0:t.click()},en=t=>Ce(this,null,function*(){const e=t.target.files[0];if(!e)return;const{data:s}=yield xn(e);P.value=[...P.value,...s.workfaces],s.workfaces.length&&(y.value=s.workfaces[0],v.seek(0),E.clear(),j.clear(),r.clear()),$e()}),tn=()=>{g.scale=Math.min(50,g.scale*1.15),Ie()},nn=()=>{g.scale=Math.max(.1,g.scale/1.15),Ie()};return(t,e)=>{var s,a;return Q(),ee("div",Vn,[n("nav",Hn,[n("div",zn,[n("button",{class:"back-btn-mini",onClick:e[0]||(e[0]=o=>t.$router.back()),title:"返回"},[...e[15]||(e[15]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)])]),e[18]||(e[18]=n("span",{class:"nav-title"},"MPI 数值模拟",-1)),e[19]||(e[19]=n("div",{class:"nav-separator"},null,-1)),xe(n("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>u.value=o),onChange:$t,class:"nav-select"},[(Q(!0),ee(je,null,Je(W.value,o=>(Q(),ee("option",{key:o.name,value:o.name},Y(o.name),9,Gn))),128))],544),[[un,u.value]]),Rt.value?(Q(),ee("div",Nn,[n("span",qn,[e[16]||(e[16]=_t("均值: ",-1)),n("b",null,Y((s=d.value.mean)==null?void 0:s.toFixed(1)),1)]),n("span",Un,[e[17]||(e[17]=_t("风险: ",-1)),n("b",null,Y((a=d.value.min)==null?void 0:a.toFixed(1)),1)])])):Pe("",!0)]),n("div",Kn,[n("button",{class:We(["nav-tool",{active:R.value}]),onClick:lt,title:"控制面板"},[...e[20]||(e[20]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("circle",{cx:"12",cy:"12",r:"3"}),n("path",{d:"M12 1v6m0 6v6m4.24-13.24l-4.24 4.24m0 5.66l4.24 4.24M1 12h6m6 0h6m13.24 4.24l-4.24-4.24m-5.66 0l-4.24-4.24"})],-1)])],2)]),n("div",{class:"nav-right"},[n("button",{class:"nav-btn",onClick:Qt,title:"导入工作面"},[...e[21]||(e[21]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"})],-1)])]),n("button",{class:"nav-btn",onClick:tt,title:"适配视图"},[...e[22]||(e[22]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"})],-1)])]),n("button",{class:"nav-btn",onClick:tn,title:"放大"},[...e[23]||(e[23]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("circle",{cx:"11",cy:"11",r:"8"}),n("path",{d:"M21 21l-4.35-4.35M11 8v6M8 11h6"})],-1)])]),n("button",{class:"nav-btn",onClick:nn,title:"缩小"},[...e[24]||(e[24]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("circle",{cx:"11",cy:"11",r:"8"}),n("path",{d:"M21 21l-4.35-4.35M8 11h6"})],-1)])])]),n("input",{ref_key:"fileInput",ref:ge,type:"file",style:{display:"none"},onChange:en,accept:".csv,.json,.txt"},null,544)]),Ct(vn,{name:"panel-slide"},{default:dn(()=>{var o,l,i,F,D,M,w,h;return[R.value?(Q(),ee("div",jn,[n("div",Jn,[n("div",On,[e[26]||(e[26]=n("h4",null,"视图设置",-1)),n("div",Zn,[n("div",Qn,[e[25]||(e[25]=n("label",null,"网格精度 (越小越精细)",-1)),n("div",es,[xe(n("input",{type:"range","onUpdate:modelValue":e[2]||(e[2]=m=>I.value=m),min:"20",max:"100",step:"5",onChange:It,class:"range-input"},null,544),[[Pt,I.value,void 0,{number:!0}]]),n("span",ts,Y(I.value)+"m",1)])])])]),n("div",ns,[e[33]||(e[33]=n("h4",null,"地质约束",-1)),n("div",ss,[n("label",as,[xe(n("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=m=>re.value=m)},null,512),[[Le,re.value]]),e[27]||(e[27]=n("span",null,"启用 geology-aware 预估",-1))]),n("div",os,[e[28]||(e[28]=n("label",null,"Geomodel 任务ID",-1)),xe(n("input",{"onUpdate:modelValue":e[4]||(e[4]=m=>z.value=m),type:"text",class:"geo-input",placeholder:"例如：a1b2c3d4e5f6"},null,512),[[Pt,z.value,void 0,{trim:!0}]])]),n("button",{class:"geo-btn",onClick:it,disabled:N.value||ye.value},Y(ye.value?"计算中...":"计算全域对照"),9,ls),n("button",{class:"geo-btn secondary",onClick:zt}," 打开建模联动页 "),te.value?(Q(),ee("div",is,[n("div",rs,[e[29]||(e[29]=n("span",null,"模式",-1)),n("b",null,Y(te.value.algorithm_mode),1)]),n("div",cs,[e[30]||(e[30]=n("span",null,"Baseline均值",-1)),n("b",null,Y((F=(i=(l=(o=te.value.baseline_statistics)==null?void 0:o.mean)==null?void 0:l.toFixed)==null?void 0:i.call(l,2))!=null?F:"-"),1)]),n("div",us,[e[31]||(e[31]=n("span",null,"Geo-aware均值",-1)),n("b",null,Y((h=(w=(M=(D=te.value.geology_aware_statistics)==null?void 0:D.mean)==null?void 0:M.toFixed)==null?void 0:w.call(M,2))!=null?h:"-"),1)]),n("div",ds,[e[32]||(e[32]=n("span",null,"回退",-1)),n("b",null,Y(te.value.fallback_used?"是":"否"),1)])])):Pe("",!0),x.value?(Q(),ee("p",vs,Y(x.value),1)):Pe("",!0)])]),n("div",ms,[e[39]||(e[39]=n("h4",null,"图层",-1)),n("div",hs,[n("label",fs,[xe(n("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=m=>b.workfaces=m)},null,512),[[Le,b.workfaces]]),e[34]||(e[34]=n("span",null,"工作面",-1))]),n("label",ys,[xe(n("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=m=>b.contours=m)},null,512),[[Le,b.contours]]),e[35]||(e[35]=n("span",null,"等值线",-1))]),n("label",gs,[xe(n("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=m=>b.grid=m)},null,512),[[Le,b.grid]]),e[36]||(e[36]=n("span",null,"网格",-1))]),n("label",ps,[xe(n("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=m=>b.boreholes=m)},null,512),[[Le,b.boreholes]]),e[37]||(e[37]=n("span",null,"钻孔",-1))]),n("label",xs,[xe(n("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=m=>b.gradedBands=m)},null,512),[[Le,b.gradedBands]]),e[38]||(e[38]=n("span",null,"分级带",-1))])])]),n("div",bs,[e[40]||(e[40]=n("h4",null,"推进方向",-1)),Ct(Yn,{direction:S.value,"onUpdate:direction":[e[10]||(e[10]=m=>S.value=m),ie(v).setDirection]},null,8,["direction","onUpdate:direction"])]),e[42]||(e[42]=n("div",{class:"control-section"},[n("h4",null,"图例"),n("div",{class:"mini-legend"},[n("div",{class:"legend-gradient"}),n("div",{class:"legend-labels"},[n("span",null,"低风险"),n("span",null,"高风险")])])],-1)),n("button",{class:"panel-close",onClick:lt},[...e[41]||(e[41]=[n("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])])):Pe("",!0)]}),_:1}),n("div",{ref_key:"stageContainer",ref:c,class:"stage-container"},[N.value?(Q(),ee("div",Ms,[...e[43]||(e[43]=[n("div",{class:"loading-spinner"},null,-1),n("div",{class:"loading-text"},"全域数据计算中...",-1)])])):Pe("",!0),n("canvas",{ref_key:"bgCanvas",ref:f,class:"layer-canvas layer-bg"},null,512),n("canvas",{ref_key:"dynamicCanvas",ref:B,class:"layer-canvas layer-dynamic"},null,512),n("canvas",{ref_key:"overlayCanvas",ref:oe,class:"layer-canvas layer-overlay"},null,512)],512),n("div",ws,[n("div",ks,[n("button",{class:We(["play-btn-mini",{playing:ie(v).isPlaying.value}]),onClick:e[11]||(e[11]=(...o)=>ie(v).togglePlay&&ie(v).togglePlay(...o)),title:"播放/暂停"},[ie(v).isPlaying.value?(Q(),ee("svg",Cs,[...e[45]||(e[45]=[n("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(Q(),ee("svg",_s,[...e[44]||(e[44]=[n("path",{d:"M8 5v14l11-7z"},null,-1)])]))],2),n("div",Ps,[n("input",{type:"range",value:ie(v).progress.value,onInput:e[12]||(e[12]=o=>ie(v).seek(Number(o.target.value))),min:"0",max:"100",step:"0.1",class:"progress-slider"},null,40,Ss),n("div",Ts,[n("span",null,Y(Math.round(ie(v).progress.value))+"%",1),n("span",null,Y((ie(v).progress.value/100*500).toFixed(0))+"m",1)])]),n("div",Ds,[(Q(),ee(je,null,Je([.5,1,2,5],o=>n("button",{key:o,class:We(["speed-btn",{active:ie(v).playbackSpeed.value===o}]),onClick:l=>ie(v).setPlaybackSpeed(o)},Y(o)+"x",11,Rs)),64))]),n("button",{class:"step-btn",onClick:e[13]||(e[13]=(...o)=>ie(v).stepBackward&&ie(v).stepBackward(...o)),title:"后退"},[...e[46]||(e[46]=[n("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M6 6h2v12H6zm3.5 6l8.5-6V12z"})],-1)])]),n("button",{class:"step-btn",onClick:e[14]||(e[14]=(...o)=>ie(v).stepForward&&ie(v).stepForward(...o)),title:"前进"},[...e[47]||(e[47]=[n("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})],-1)])])]),y.value?(Q(),ee("div",Ls,[n("div",Fs,[e[48]||(e[48]=n("span",{class:"dash-label"},"应力",-1)),n("span",$s,Y(Bt.value.toFixed(0))+"%",1)]),n("div",Is,[e[49]||(e[49]=n("span",{class:"dash-label"},"卸压",-1)),n("span",Es,Y(Xt.value.toFixed(0))+"%",1)]),n("div",As,[e[50]||(e[50]=n("span",{class:"dash-label"},"阶段",-1)),n("span",Bs,Y(At[Et.value]),1)]),n("div",Xs,[e[51]||(e[51]=n("span",{class:"dash-label"},"方向",-1)),n("span",Ws,Y(S.value)+"°",1)])])):Pe("",!0)]),e[52]||(e[52]=n("div",{class:"floating-hint"}," 拖拽移动 · 滚轮缩放 · 空格播放 · R 重置 ",-1)),ne.value?(Q(),ee("div",{key:0,class:"hover-tooltip",style:Be(Lt.value)},[n("div",Ys,Y(ne.value.value.toFixed(2)),1),n("div",Vs,"X: "+Y(ne.value.x.toFixed(0))+" Y: "+Y(ne.value.y.toFixed(0)),1)],4)):Pe("",!0)])}}},Js=Tt(zs,[["__scopeId","data-v-69408284"]]);export{Js as default};
