var Dn=Object.defineProperty,En=Object.defineProperties;var Bn=Object.getOwnPropertyDescriptors;var en=Object.getOwnPropertySymbols;var On=Object.prototype.hasOwnProperty,Un=Object.prototype.propertyIsEnumerable;var nn=Math.pow,tn=(b,q,x)=>q in b?Dn(b,q,{enumerable:!0,configurable:!0,writable:!0,value:x}):b[q]=x,Z=(b,q)=>{for(var x in q||(q={}))On.call(q,x)&&tn(b,x,q[x]);if(en)for(var x of en(q))Un.call(q,x)&&tn(b,x,q[x]);return b},X=(b,q)=>En(b,Bn(q));var Ce=(b,q,x)=>new Promise((Ae,v)=>{var ce=L=>{try{W(x.next(L))}catch(s){v(s)}},h=L=>{try{W(x.throw(L))}catch(s){v(s)}},W=L=>L.done?Ae(L.value):Promise.resolve(L.value).then(ce,h);W((x=x.apply(b,q)).next())});import{_ as Wt,u as Vn,b as Wn}from"./index-oBIkjPyK.js";import{r as Rt,bB as Hn,bC as jn,bA as Gn,bf as dn,n as Vt,w as Le,b4 as mn,b5 as ee,b8 as te,bn as mt,b as K,c as p,b7 as o,bb as y,bi as we,ba as nt,bj as $e,u as qn,br as De,bv as on,bc as Je,b9 as Ot,bo as Pe,bs as dt,bt as an,bm as ln,bh as sn,bx as rn,a as Yn}from"./vendor-CA5Q5CdR.js";import{a as Zn,u as Xn}from"./vue-router-D9BXaJFq.js";import{g as Jn,v as Kn,n as Qn}from"./api-CJun_zz_.js";import"./echarts-CG3_94Cz.js";import{i as eo}from"./echarts-Dy-VGqd_.js";import"./network-T6nY3V_4.js";function to(){const b=Rt({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),q=(L,s,f)=>{if(!f)return{x:0,y:0};const c=L-f.min_x,M=f.max_y-s;return{x:c*b.scale+b.x,y:M*b.scale+b.y}},x=(L,s,f)=>{if(!f||b.scale===0)return{x:0,y:0};const c=(L-b.x)/b.scale,M=(s-b.y)/b.scale;return{x:f.min_x+c,y:f.max_y-M}};return{viewport:b,worldToScreen:q,screenToWorld:x,fitToBounds:(L,s,f,c=56)=>{if(!L||!s||!f)return;const M=Math.max(L.max_x-L.min_x,1e-6),D=Math.max(L.max_y-L.min_y,1e-6),A=Math.min((s-c*2)/M,(f-c*2)/D),R=(L.min_x+L.max_x)/2,I=(L.min_y+L.max_y)/2;b.scale=Math.max(.01,A),b.x=s/2-(R-L.min_x)*b.scale,b.y=f/2-(L.max_y-I)*b.scale},startDrag:(L,s)=>{b.isDragging=!0,b.lastX=L,b.lastY=s},dragTo:(L,s)=>{b.isDragging&&(b.x+=L-b.lastX,b.y+=s-b.lastY,b.lastX=L,b.lastY=s)},endDrag:()=>{b.isDragging=!1},zoomAt:(L,s,f,c,M=.1,D=50)=>{if(!c)return;const A=Math.max(M,Math.min(D,b.scale*L));if(A===b.scale)return;const R=x(s,f,c);b.scale=A,b.x=s-(R.x-c.min_x)*b.scale,b.y=f-(c.max_y-R.y)*b.scale}}}const un={mpi:["#0e7490","#14b8a6","#facc15","#fb923c","#dc2626"],rsi:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],bri:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],asi:["#0e7490","#14b8a6","#84cc16","#f59e0b","#dc2626"]},Ut=b=>Math.max(0,Math.min(1,b)),no=b=>{const x=String(b||"").match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return x?{r:Number(x[1]),g:Number(x[2]),b:Number(x[3])}:null},oo=(b,q=.8)=>{const x=no(b);if(!x)return"#94a3b8";const Ae=Math.round(x.r*.299+x.g*.587+x.b*.114),v=Math.round(Ae*q+235*(1-q));return`rgb(${v},${v},${v})`},cn=b=>{var Ae,v;const q=Number((Ae=b==null?void 0:b.min)!=null?Ae:0),x=Number((v=b==null?void 0:b.max)!=null?v:100);return!Number.isFinite(q)||!Number.isFinite(x)||q===x?{min:0,max:100}:{min:q,max:x}};function ao(){const b=s=>un[s]||un.mpi,q=s=>`linear-gradient(90deg, ${b(s).join(",")})`,x=(s,f,c)=>{const{min:M,max:D}=cn(c),A=Ut((Number(f)-M)/(D-M));return Hn(b(s))(A)},Ae=(s,f,c,M,D,A,R={})=>{var $;const I=f.length,H=(($=f[0])==null?void 0:$.length)||0;if(I<2||H<2)return;const ae=new Array(I*H);let O=0;for(let E=0;E<I;E+=1)for(let ue=0;ue<H;ue+=1)ae[O]=Number(f[E][ue]||0),O+=1;const{min:j,max:de}=cn(D),me=Math.max(5,Number(R.contourLevels||9)),ne=jn(j,de,me).slice(1,-1);if(!ne.length)return;const pe=Gn().size([H,I]).thresholds(ne)(ae),xe=Math.max(c.max_x-c.min_x,1e-6),V=Math.max(c.max_y-c.min_y,1e-6);s.save(),s.strokeStyle=R.contourColor||"rgba(15,23,42,0.32)",s.lineWidth=M.scale>2?1.2:.9,s.globalAlpha=M.scale<.65?.45:.7;for(const E of pe)for(const ue of E.coordinates)for(const he of ue)if(!(!Array.isArray(he)||he.length<2)){s.beginPath();for(let ie=0;ie<he.length;ie+=1){const ke=he[ie],J=c.min_x+ke[0]/Math.max(H-1,1)*xe,Re=c.max_y-ke[1]/Math.max(I-1,1)*V,ve=A(J,Re,c);ie===0?s.moveTo(ve.x,ve.y):s.lineTo(ve.x,ve.y)}s.closePath(),s.stroke()}s.restore()};return{getLegendGradient:q,drawGrid:(s,f,c,M,D,A,R,I={})=>{var xe;if(!s||!Array.isArray(f)||f.length===0||!c)return;const H=f.length,ae=((xe=f[0])==null?void 0:xe.length)||0;if(!ae)return;const O=c.max_x-c.min_x,j=c.max_y-c.min_y,de=O/ae,me=j/H,ne=s.canvas.width,pe=s.canvas.height;for(let V=0;V<H;V+=1){const $=f[V],E=c.max_y-V*me;for(let ue=0;ue<ae;ue+=1){const he=c.min_x+ue*de,ie=R(he,E,c),ke=R(he+de,E-me,c),J=Math.min(ie.x,ke.x),Re=Math.min(ie.y,ke.y),ve=Math.abs(ke.x-ie.x)+.8,G=Math.abs(ke.y-ie.y)+.8;J>ne||J+ve<0||Re>pe||Re+G<0||(s.fillStyle=x(D,Number($[ue]||0),A),s.fillRect(J,Re,ve,G))}}if(I.showContours!==!1&&Ae(s,f,c,M,A,R,I),M.scale>3.2){s.strokeStyle="rgba(255,255,255,0.18)",s.lineWidth=1,s.beginPath();for(let V=0;V<=H;V+=1){const $=c.max_y-V*me,E=R(c.min_x,$,c),ue=R(c.max_x,$,c);s.moveTo(E.x,E.y),s.lineTo(ue.x,ue.y)}for(let V=0;V<=ae;V+=1){const $=c.min_x+V*de,E=R($,c.min_y,c),ue=R($,c.max_y,c);s.moveTo(E.x,E.y),s.lineTo(ue.x,ue.y)}s.stroke()}},drawBoreholes:(s,f,c,M,D,A,R="",I=null)=>{if(!s||!Array.isArray(f)||!D)return;const H=!!(I!=null&&I.active&&(I==null?void 0:I.indexSet)instanceof Set&&I.indexSet.size>0),ae=String((I==null?void 0:I.accent)||"#111827"),O=!!(I!=null&&I.animate),j=Number((I==null?void 0:I.pulseT)||0);for(let de=0;de<f.length;de+=1){const me=f[de],ne=A(me.x,me.y,D),pe=R&&R===me.borehole_name,xe=!H||I.indexSet.has(de),V=O&&H&&xe?(Math.sin(j*5+de*.35)+1)/2:0,$=pe?7.5:xe&&H?6.6:5.8;s.save();const E=x(c,me[c],M);s.globalAlpha=H&&!xe?.24:1,s.fillStyle=H&&!xe?oo(E,.84):E,s.strokeStyle=pe?"#111827":xe&&H?ae:"rgba(255,255,255,0.95)",s.lineWidth=pe?2.4:1.8,s.beginPath(),s.arc(ne.x,ne.y,$,0,Math.PI*2),s.fill(),s.stroke(),xe&&H&&!pe&&(s.globalAlpha=.95,s.strokeStyle=ae,s.lineWidth=2,s.beginPath(),s.arc(ne.x,ne.y,$+3.6,0,Math.PI*2),s.stroke(),O&&(s.globalAlpha=.35+V*.45,s.lineWidth=1.6+V*.9,s.beginPath(),s.arc(ne.x,ne.y,$+6+V*5.5,0,Math.PI*2),s.stroke())),s.restore()}},pickNearestBorehole:(s,f,c,M,D,A=14)=>{if(!Array.isArray(c)||!M)return null;let R=null,I=Number.POSITIVE_INFINITY;for(const H of c){const ae=D(H.x,H.y,M),O=Math.hypot(s-ae.x,f-ae.y);O<I&&(I=O,R=H)}return I<=A?R:null},sampleGridValue:(s,f,c,M)=>{var O;if(!Array.isArray(s)||s.length===0||!f)return null;const D=s.length,A=((O=s[0])==null?void 0:O.length)||0;if(!A)return null;const R=Ut((c-f.min_x)/Math.max(f.max_x-f.min_x,1e-6)),I=Ut((f.max_y-M)/Math.max(f.max_y-f.min_y,1e-6)),H=Math.max(0,Math.min(A-1,Math.floor(R*(A-1)))),ae=Math.max(0,Math.min(D-1,Math.floor(I*(D-1))));return Number(s[ae][H])},drawMiniHeatmap:(s,f,c,M)=>{var de;if(!s||!Array.isArray(f)||f.length===0)return;const D=window.devicePixelRatio||1,A=s.clientWidth||150,R=s.clientHeight||110;s.width=Math.round(A*D),s.height=Math.round(R*D);const I=s.getContext("2d");I.setTransform(D,0,0,D,0,0),I.clearRect(0,0,A,R);const H=f.length,ae=((de=f[0])==null?void 0:de.length)||0;if(!ae)return;const O=A/ae,j=R/H;for(let me=0;me<H;me+=1)for(let ne=0;ne<ae;ne+=1)I.fillStyle=x(c,Number(f[me][ne]||0),M),I.fillRect(ne*O,me*j,O+.4,j+.4);I.strokeStyle="rgba(255,255,255,0.35)",I.strokeRect(0,0,A,R)}}}const lo={__name:"ScienceChart",props:{option:{type:Object,required:!0},height:{type:[String,Number],default:320}},emits:["chart-click"],setup(b,{emit:q}){const x=b,Ae=q,v=K(null);let ce=null,h=null;const W=p(()=>typeof x.height=="number"?`${x.height}px`:x.height),L=()=>{ce&&ce.setOption(x.option||{},{notMerge:!0,lazyUpdate:!0,silent:!0})},s=()=>{ce&&ce.resize()},f=D=>{Ae("chart-click",D)},c=()=>{if(v.value){if(typeof ResizeObserver!="undefined"){h=new ResizeObserver(()=>{s()}),h.observe(v.value);return}window.addEventListener("resize",s)}},M=()=>{h?(h.disconnect(),h=null):window.removeEventListener("resize",s)};return dn(()=>Ce(this,null,function*(){yield Vt(),v.value&&(ce=eo(v.value,null,{renderer:"canvas"}),ce.on("click",f),L(),c())})),Le(()=>x.option,()=>{L()}),Le(()=>x.height,()=>Ce(this,null,function*(){yield Vt(),s()})),mn(()=>{M(),ce&&(ce.off("click",f),ce.dispose(),ce=null)}),(D,A)=>(ee(),te("div",{ref_key:"container",ref:v,class:"science-chart",style:mt({height:W.value})},null,4))}},Te=Wt(lo,[["__scopeId","data-v-40fa2a4e"]]),so={class:"science-gallery"},ro={class:"gallery-head"},io={class:"head-metrics"},uo={class:"metric-chip"},co={class:"metric-chip"},mo={key:0,class:"metric-chip"},po={key:1,class:"metric-chip"},vo={class:"figure-card"},fo={class:"caption meta"},yo={class:"figure-card"},ho={class:"caption meta"},bo={class:"figure-card"},go={class:"caption meta"},xo={class:"figure-card"},wo={class:"caption meta"},So={class:"figure-card"},_o={class:"caption meta"},ko={class:"figure-card"},Co={class:"caption meta"},Ao={class:"figure-card"},No={class:"caption meta"},Mo={class:"figure-card"},Io={class:"caption meta"},$o={class:"figure-card"},Ro={class:"caption meta"},Fo={class:"figure-card"},Po={class:"caption meta"},ge="'Times New Roman', 'Noto Serif SC', 'Source Han Serif SC', serif",To={__name:"ValidationScienceFigures",props:{result:{type:Object,default:null},evaluation:{type:Object,default:null}},emits:["matrix-select"],setup(b,{emit:q}){const x=b,Ae=q,v={blue:"#1d4ed8",cyan:"#0891b2",green:"#15803d",orange:"#d97706",red:"#b91c1c",purple:"#7c3aed",slate:"#475569"},ce={left:66,right:26,top:46,bottom:62},h=(e,n,l)=>Math.max(n,Math.min(l,e)),W=(e,n=0)=>{const l=Number(e);return Number.isFinite(l)?l:n},L=e=>`${(h(W(e,0),0,1)*100).toFixed(1)}%`,s=(e,n=3)=>Number(W(e,0).toFixed(n)),f=(e,n,l=0)=>n>0?e/n:l,c=(e,n=!0)=>({type:n?"value":"category",name:e,nameLocation:"middle",nameGap:38,nameTextStyle:{fontFamily:ge,fontSize:12,color:"#0f172a"},axisLabel:{fontFamily:ge,fontSize:11,color:"#0f172a"},axisLine:{lineStyle:{color:"#0f172a",width:1.15}},axisTick:{lineStyle:{color:"#334155",width:1}},splitLine:{show:!0,lineStyle:{color:"#e2e8f0",width:.8,type:"dashed"}}}),M={top:6,textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"}},D={right:8,top:6,itemSize:14,iconStyle:{borderColor:"#334155"},feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"框选缩放",back:"还原缩放"}},restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}},A=[{type:"inside",xAxisIndex:0,filterMode:"none",zoomOnMouseWheel:"ctrl",moveOnMouseMove:!0}],R=p(()=>{var e;return((e=x.result)==null?void 0:e.evaluation_inputs)||{}}),I=p(()=>{var n,l;const e=((n=R.value)==null?void 0:n.mode)||((l=R.value)==null?void 0:l.source)||"pseudo_threshold";return String(e)}),H=p(()=>{var e,n;return String(((e=R.value)==null?void 0:e.source)||((n=R.value)==null?void 0:n.sourceFile)||"")}),ae=p(()=>I.value==="real_label_stream"?"真实标签流":I.value==="pseudo_threshold"?"伪标签估计":"未知"),O=p(()=>{var d,k,F,B;const e=Array.isArray((d=R.value)==null?void 0:d.y_true)?R.value.y_true:Array.isArray((k=R.value)==null?void 0:k.yTrue)?R.value.yTrue:[],n=Array.isArray((F=R.value)==null?void 0:F.y_prob)?R.value.y_prob:Array.isArray((B=R.value)==null?void 0:B.yProb)?R.value.yProb:[],l=Math.min(e.length,n.length),u=[];for(let w=0;w<l;w+=1){const T=W(e[w],0)>=1?1:0,C=h(W(n[w],0),0,1);u.push({y:T,p:C})}return u}),j=p(()=>O.value.length),de=p(()=>O.value.filter(e=>e.y===1).length),me=p(()=>j.value-de.value),ne=p(()=>f(de.value,Math.max(j.value,1),0)),pe=p(()=>j.value>=6&&de.value>0&&me.value>0),xe=p(()=>{const e=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const n of O.value)e.push(Number(n.p.toFixed(3)));return Array.from(new Set(e.map(n=>h(n,0,1)))).sort((n,l)=>l-n)}),V=e=>{let n=0,l=0,u=0,d=0;for(const U of O.value){const oe=U.p>=e?1:0;U.y===1&&oe===1?n+=1:U.y===1&&oe===0?d+=1:U.y===0&&oe===1?l+=1:u+=1}const k=f(n,n+d,0),F=f(n,n+l,0),B=f(u,u+l,0),w=f(l,l+u,0),T=f(n+u,n+u+l+d,0),C=f(2*F*k,F+k,0);return{threshold:e,tp:n,fp:l,tn:u,fn:d,recall:k,precision:F,specificity:B,fpr:w,accuracy:T,f1:C}},$=p(()=>xe.value.map(e=>V(e))),E=p(()=>{if(!pe.value)return[[0,0],[.06,.28],[.15,.54],[.33,.75],[.56,.89],[1,1]];const e=$.value.map(n=>[n.fpr,n.recall]);return e.push([0,0],[1,1]),e.sort((n,l)=>n[0]-l[0]||n[1]-l[1]),e}),ue=p(()=>{if(!pe.value)return[[0,1],[.15,.9],[.35,.82],[.55,.73],[.75,.61],[1,.5]];const e=$.value.map(n=>[n.recall,n.precision]);return e.push([0,1],[1,ne.value]),e.sort((n,l)=>n[0]-l[0]||l[1]-n[1]),e}),he=e=>{let n=0;for(let l=1;l<e.length;l+=1){const[u,d]=e[l-1],[k,F]=e[l];n+=(k-u)*((d+F)/2)}return h(n,0,1)},ie=(e,n,l=0)=>{const u=e.filter(w=>Number.isFinite(w)).slice().sort((w,T)=>w-T);if(!u.length)return l;const d=h(n,0,1)*(u.length-1),k=Math.floor(d),F=Math.min(u.length-1,k+1),B=d-k;return u[k]*(1-B)+u[F]*B},ke=(e,n)=>{if(!Array.isArray(e)||e.length===0)return 0;if(e.length===1||n<=e[0][0])return h(W(e[0][1],0),0,1);for(let l=1;l<e.length;l+=1){const[u,d]=e[l-1],[k,F]=e[l];if(n<=k){if(Math.abs(k-u)<1e-12)return h(Math.max(d,F),0,1);const B=(n-u)/(k-u);return h(d+(F-d)*B,0,1)}}return h(W(e[e.length-1][1],0),0,1)},J=e=>{const n=e.length,l=e.reduce((T,C)=>T+(C.y>=1?1:0),0),u=n-l;if(n<2||l<=0||u<=0)return{roc:[[0,0],[1,1]],pr:[[0,1],[1,h(f(l,Math.max(n,1),0),0,1)]],auc:.5,prAuc:.5};const d=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const T of e)d.push(Number(T.p.toFixed(3)));const k=Array.from(new Set(d.map(T=>h(T,0,1)))).sort((T,C)=>C-T),F=[],B=[];for(const T of k){let C=0,U=0,oe=0,m=0;for(const le of e){const ze=le.p>=T?1:0;le.y===1&&ze===1?C+=1:le.y===1&&ze===0?m+=1:le.y===0&&ze===1?U+=1:oe+=1}const z=f(C,C+m,0),re=f(C,C+U,0),Q=f(U,U+oe,0);F.push([Q,z]),B.push([z,re])}F.push([0,0],[1,1]),F.sort((T,C)=>T[0]-C[0]||T[1]-C[1]);const w=h(f(l,n,0),0,1);return B.push([0,1],[1,w]),B.sort((T,C)=>T[0]-C[0]||C[1]-T[1]),{roc:F,pr:B,auc:he(F),prAuc:he(B)}},Re=p(()=>{let e=2166136261;for(let n=0;n<O.value.length;n+=1){const l=O.value[n],u=l.y>=1?1:0,d=Math.round(h(l.p,0,1)*1e3);e^=u*733+d*31+n*131>>>0,e=Math.imul(e,16777619)>>>0}return e||1315423911}),ve=p(()=>pe.value?j.value<=60?240:j.value<=180?180:120:0),G=p(()=>{if(!pe.value)return null;const e=O.value.length,n=ve.value;if(n<=0||e<6)return null;const l=Array.from({length:21},(m,z)=>z/20),u=l.map(()=>[]),d=l.map(()=>[]),k=[],F=[];let B=Re.value>>>0;const w=()=>{B+=1831565813;let m=B;return m=Math.imul(m^m>>>15,m|1),m^=m+Math.imul(m^m>>>7,m|61),((m^m>>>14)>>>0)/4294967296};for(let m=0;m<n;m+=1){const z=[];for(let Q=0;Q<e;Q+=1)z.push(O.value[Math.floor(w()*e)]);const re=J(z);k.push(re.auc),F.push(re.prAuc);for(let Q=0;Q<l.length;Q+=1){const le=l[Q];u[Q].push(ke(re.roc,le)),d[Q].push(ke(re.pr,le))}}const T=u.map(m=>ie(m,.025,0)),C=u.map(m=>ie(m,.975,1)),U=d.map(m=>ie(m,.025,0)),oe=d.map(m=>ie(m,.975,1));return{iterations:n,grid:l,rocLow:T,rocHigh:C,prLow:U,prHigh:oe,aucLow:h(ie(k,.025,Be.value),0,1),aucHigh:h(ie(k,.975,Be.value),0,1),prAucLow:h(ie(F,.025,He.value),0,1),prAucHigh:h(ie(F,.975,He.value),0,1)}}),Ke=p(()=>G.value?{low:G.value.grid.map((e,n)=>[e,G.value.rocLow[n]]),high:G.value.grid.map((e,n)=>[e,G.value.rocHigh[n]])}:{low:[],high:[]}),be=p(()=>G.value?G.value.grid.map((e,n)=>[e,Math.max(G.value.rocHigh[n]-G.value.rocLow[n],0)]):[]),ye=p(()=>G.value?{low:G.value.grid.map((e,n)=>[e,G.value.prLow[n]]),high:G.value.grid.map((e,n)=>[e,G.value.prHigh[n]])}:{low:[],high:[]}),Qe=p(()=>G.value?G.value.grid.map((e,n)=>[e,Math.max(G.value.prHigh[n]-G.value.prLow[n],0)]):[]),ot=p(()=>he(E.value)),at=p(()=>he(ue.value)),Ee=p(()=>pe.value?$.value.reduce((e,n)=>{const l=n.recall-n.fpr;return l>e.j?X(Z({},n),{j:l}):e},{threshold:.5,fpr:1,recall:0,j:-1}):{threshold:.5,fpr:.22,recall:.78,j:.56}),pt=p(()=>pe.value?$.value.reduce((e,n)=>n.f1>e.f1?n:e,$.value[0]||{threshold:.5,recall:0,precision:0,f1:0}):{threshold:.5,recall:.74,precision:.78,f1:.76}),lt=p(()=>{if(!O.value.length)return .25;const e=O.value.reduce((n,l)=>n+nn(l.p-l.y,2),0);return h(e/O.value.length,0,1)}),We=p(()=>{if(!pe.value)return{centers:[.1,.22,.34,.46,.58,.7,.82,.94],pred:[.11,.23,.36,.45,.57,.69,.8,.9],obs:[.14,.2,.31,.49,.55,.63,.78,.89],lower:[.04,.08,.19,.31,.39,.47,.63,.74],band:[.2,.24,.24,.18,.16,.16,.15,.15],count:[4,6,8,11,12,10,7,5],ece:.043};const e=8,n=Array.from({length:e+1},(m,z)=>z/e),l=Array.from({length:e},()=>0),u=Array.from({length:e},()=>0),d=Array.from({length:e},()=>0);for(const m of O.value){const z=Math.min(e-1,Math.floor(m.p*e));l[z]+=1,u[z]+=m.p,d[z]+=m.y}const k=[],F=[],B=[],w=[],T=[],C=[];for(let m=0;m<e;m+=1){if(l[m]<=0)continue;const z=u[m]/l[m],re=d[m]/l[m],Q=1.96*Math.sqrt(f(re*(1-re),l[m],0)),le=h(re-Q,0,1),ze=h(re+Q,0,1);k.push((n[m]+n[m+1])/2),F.push(z),B.push(re),w.push(le),T.push(ze-le),C.push(l[m])}const U=Math.max(O.value.length,1),oe=F.reduce((m,z,re)=>m+Math.abs(z-B[re])*C[re],0)/U;return{centers:k,pred:F,obs:B,lower:w,band:T,count:C,ece:oe}}),Be=p(()=>{var l,u,d;const e=W((l=x.evaluation)==null?void 0:l.auc,NaN);if(!Number.isNaN(e)&&e>0)return h(e,.5,1);const n=W((d=(u=x.result)==null?void 0:u.kpi)==null?void 0:d.auc,NaN);return!Number.isNaN(n)&&n>0?h(n,.5,1):h(ot.value,.5,1)}),He=p(()=>{var n;const e=W((n=x.evaluation)==null?void 0:n.pr_auc,NaN);return!Number.isNaN(e)&&e>0?h(e,.4,1):h(at.value,.4,1)}),Ft=p(()=>{var l,u,d;const e=W((l=x.evaluation)==null?void 0:l.brier,NaN);if(!Number.isNaN(e)&&e>=0)return h(e,0,1);const n=W((d=(u=x.result)==null?void 0:u.kpi)==null?void 0:d.brier_score,NaN);return!Number.isNaN(n)&&n>=0?h(n,0,1):h(lt.value,0,1)}),vt=p(()=>{var n;const e=W((n=x.evaluation)==null?void 0:n.ece,NaN);return!Number.isNaN(e)&&e>=0?h(e,0,1):h(We.value.ece,0,1)}),et=p(()=>{var l;const e=(l=x.evaluation)==null?void 0:l.confusion_matrix;if(e&&["tp","tn","fp","fn"].every(u=>Number.isFinite(Number(e[u]))))return{tp:Number(e.tp),tn:Number(e.tn),fp:Number(e.fp),fn:Number(e.fn)};const n=$.value.find(u=>Math.abs(u.threshold-.5)<1e-9);return n?{tp:n.tp,tn:n.tn,fp:n.fp,fn:n.fn}:{tp:13,tn:31,fp:6,fn:8}}),ft=p(()=>{const e=et.value,n=f(e.tp+e.tn,e.tp+e.tn+e.fp+e.fn,0),l=f(e.tp,e.tp+e.fp,0),u=f(e.tp,e.tp+e.fn,0),d=f(e.tn,e.tn+e.fp,0);return{accuracy:n,precision:l,recall:u,specificity:d}}),yt=p(()=>{var C,U,oe;const e=W((oe=(U=(C=x.result)==null?void 0:C.modules)==null?void 0:U.rsi)==null?void 0:oe.value,62),n=["伪顶","直接顶","老顶Ⅰ","老顶Ⅱ","关键层A","关键层B","关键层C","覆岩"],l=[0,-4,-2,1,3,4,2,1],u=n.map((m,z)=>h(e+l[z]*3+Math.sin(z*1.2)*2.2,24,96)),d=n.map((m,z)=>h(9-z*.7+(100-e)*.03,3,12)),k=u.map((m,z)=>h(m-d[z],0,100)),B=u.map((m,z)=>h(m+d[z],0,100)).map((m,z)=>s(m-k[z],4)),w=u.map(m=>h(102-m,4,90)),T=u.reduce((m,z,re,Q)=>z<Q[m]?re:m,0);return{layers:n,stability:u,lower:k,band:B,damage:w,minIdx:T}}),ht=p(()=>{var C,U,oe,m,z,re;const e=Array.from({length:12},(Q,le)=>`T${String(le+1).padStart(2,"0")}`),n=W((oe=(U=(C=x.result)==null?void 0:C.modules)==null?void 0:U.bri)==null?void 0:oe.event_count,20),l=W((re=(z=(m=x.result)==null?void 0:m.modules)==null?void 0:z.bri)==null?void 0:re.avg_magnitude,2.6),u=e.map((Q,le)=>Math.max(1,Math.round(n/e.length*(.8+.6*Math.sin((le+1)/1.7))))),d=u.map((Q,le)=>s(Q*(18+l*6)*(.85+.25*Math.cos((le+2)/2.3)))),k=d.map((Q,le)=>s((d[Math.max(0,le-1)]+d[le]+d[Math.min(d.length-1,le+1)])/3,2));let F=0;const B=d.reduce((Q,le)=>Q+le,0)||1,w=d.map(Q=>(F+=Q,s(F/B*100,2))),T=d.reduce((Q,le,ze,Nt)=>le>Nt[Q]?ze:Q,0);return{windows:e,energy:d,smooth:k,eventRate:u,cumulativeRisk:w,peakIdx:T}}),bt=p(()=>{var B,w,T;const e=W((T=(w=(B=x.result)==null?void 0:B.modules)==null?void 0:w.asi)==null?void 0:T.value,58),n=[2.5,3,3.5,4,5,6,7,8,9,10],l=n.map(C=>s(h(6.5+e*.06+10/Math.max(C,1),4,34),3)),u=n.map(C=>s(h(12+e*.16+18/Math.max(C-1.5,1),8,48),3)),d=n.map((C,U)=>s(h(f(u[U],l[U],1),1,4.5),3)),k=u.reduce((C,U,oe,m)=>U>m[C]?oe:C,0),F=n.find((C,U)=>d[U]<2)||n[n.length-1];return{dist:n,radial:l,tangential:u,kt:d,peakIdx:k,riskRadius:F}}),gt=p(()=>{var C,U,oe;const e=(oe=(U=(C=x.result)==null?void 0:C.figures)==null?void 0:U.fig5_dbn)==null?void 0:oe.posterior,n=[{t:"t-4",high_risk_prob:.31},{t:"t-3",high_risk_prob:.35},{t:"t-2",high_risk_prob:.42},{t:"t-1",high_risk_prob:.48},{t:"t",high_risk_prob:.56}],l=Array.isArray(e)&&e.length?e:n,u=l.map(m=>String(m.t)),d=l.map(m=>h(W(m.high_risk_prob,0),0,1)),k=h(.22-Math.sqrt(Math.max(j.value,1))/22,.06,.2),F=d.map(m=>h(m-k,0,1)),w=d.map(m=>h(m+k,0,1)).map((m,z)=>s(m-F[z],4)),T=d.filter(m=>m>=.6).length;return{labels:u,p:d,lower:F,band:w,alertCount:T}}),xt=p(()=>{var T,C,U,oe,m;const e=h(W((C=(T=x.result)==null?void 0:T.fusion)==null?void 0:C.mpi,52),0,100),n=h(W((m=(oe=(U=x.result)==null?void 0:U.fusion)==null?void 0:oe.baseline)==null?void 0:m.mpi,e-4.5),0,100),l=h(Be.value,.5,1),u=h(He.value,.4,1),d=h(Ft.value,0,1),k=["MPI","AUC×100","PR-AUC×100","(1-Brier)×100"],F=[s(e,2),s(l*100,2),s(u*100,2),s((1-d)*100,2)],B=[s(n,2),s(h((l-.05)*100,0,100),2),s(h((u-.06)*100,0,100),2),s(h((1-(d+.05))*100,0,100),2)],w=F.map((z,re)=>s(z-B[re],2));return{categories:k,newScores:F,baseScores:B,gain:w}}),wt=p(()=>{var C,U;const e=s(h(Be.value*100,45,99),2),n=((U=(C=x.result)==null?void 0:C.fusion)==null?void 0:U.dynamic_weights)||{rsi:.4,bri:.35,asi:.25},l=s(2.5+W(n.rsi,.4)*16,2),u=s(2.5+W(n.bri,.35)*16,2),d=s(2.5+W(n.asi,.25)*16,2),k=["全模型","去RSI","去BRI","去ASI"],F=[e,s(h(e-l,40,99),2),s(h(e-u,40,99),2),s(h(e-d,40,99),2)],B=[0,l,u,d],w=l+u+d||1,T=[0,s(l/w*100,1),s(u/w*100,1),s(d/w*100,1)];return{categories:k,score:F,drop:B,contribution:T}}),Oe=p(()=>{const e=yt.value,n=e.layers[e.minIdx],l=e.stability[e.minIdx];return`关键结论：最低稳定层位为 ${n}（${l.toFixed(1)}%），${l<60?"低于":"高于"}60%预警阈值。`}),Me=p(()=>{const e=ht.value;return`关键结论：峰值窗口 ${e.windows[e.peakIdx]}，能量 ${e.energy[e.peakIdx].toFixed(1)} a.u.，累计风险在后半段快速抬升。`}),st=p(()=>{const e=bt.value;return`关键结论：切向应力峰值出现在 r=${e.dist[e.peakIdx]} m，Kt>2 高风险圈带约在 r≤${e.riskRadius.toFixed(1)} m。`}),St=p(()=>{const e=gt.value;return`关键结论：最新后验概率 ${e.p[e.p.length-1].toFixed(3)}，达到0.6报警阈值的时间片数量为 ${e.alertCount}。`}),Pt=p(()=>{const e=xt.value,n=e.gain.reduce((l,u,d,k)=>u>k[l]?d:l,0);return`关键结论：最大增益指标为 ${e.categories[n]}（+${e.gain[n].toFixed(2)}）。`}),rt=p(()=>{const e=wt.value,n=e.drop.reduce((l,u,d,k)=>u>k[l]?d:l,0);return`关键结论：${e.categories[n]} 对整体性能贡献最大（移除后下降 ${e.drop[n].toFixed(2)} 分）。`}),_t=p(()=>`关键结论：ECE=${vt.value.toFixed(4)}，有效分箱 ${We.value.centers.length} 个。`),Tt=p(()=>{const e=Ee.value,n=G.value,l=n?`，95%CI=[${n.aucLow.toFixed(3)}, ${n.aucHigh.toFixed(3)}]`:"";return`关键结论：AUC=${Be.value.toFixed(3)}${l}，最优阈值≈${e.threshold.toFixed(3)}（TPR=${e.recall.toFixed(2)}, FPR=${e.fpr.toFixed(2)}）。`}),Lt=p(()=>{const e=pt.value,n=G.value,l=n?`，95%CI=[${n.prAucLow.toFixed(3)}, ${n.prAucHigh.toFixed(3)}]`:"";return`关键结论：PR-AUC=${He.value.toFixed(3)}${l}，最佳F1=${e.f1.toFixed(3)} 对应阈值≈${e.threshold.toFixed(3)}。`}),it=p(()=>{const e=ft.value;return`关键结论：Accuracy=${(e.accuracy*100).toFixed(1)}%，Precision=${(e.precision*100).toFixed(1)}%，Recall=${(e.recall*100).toFixed(1)}%。`}),je=e=>{var l;const n=String(((l=e==null?void 0:e.data)==null?void 0:l.label)||(e==null?void 0:e.name)||"").toUpperCase();(n==="TP"||n==="TN"||n==="FP"||n==="FN")&&Ae("matrix-select",n.toLowerCase())},Ge=p(()=>{const e=yt.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.orange,v.red],animationDuration:350,grid:ce,legend:M,toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("层位",!1)),{data:e.layers,nameGap:30}),yAxis:[X(Z({},c("稳定度 / 置信区间 (%)",!0)),{min:0,max:100}),X(Z({},c("损伤占比 (%)",!0)),{min:0,max:100})],series:[{name:"CI下界",type:"line",stack:"rsi_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"rsi_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.14)"}},{name:"稳定度",type:"line",data:e.stability,smooth:!0,symbolSize:7,lineStyle:{width:2.5,color:v.blue},itemStyle:{color:v.blue},markLine:{symbol:"none",label:{formatter:"预警阈值 60%",color:"#7f1d1d",fontFamily:ge,fontSize:10},lineStyle:{type:"dashed",color:"#b91c1c",width:1.2},data:[{yAxis:60}]},markPoint:{symbol:"circle",symbolSize:44,label:{color:"#111827",fontFamily:ge,fontSize:10,formatter:"最低层"},itemStyle:{color:"#fee2e2",borderColor:"#b91c1c",borderWidth:1.2},data:[{coord:[e.minIdx,e.stability[e.minIdx]]}]}},{name:"损伤占比",type:"bar",yAxisIndex:1,data:e.damage,barWidth:14,itemStyle:{color:v.orange,opacity:.75}}]}}),ut=p(()=>{const e=ht.value;return{color:[v.orange,v.cyan,v.red],animationDuration:350,grid:ce,legend:M,toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("时间窗",!1)),{data:e.windows,nameGap:30}),yAxis:[X(Z({},c("能量释放 / 平滑能量 (a.u.)",!0)),{min:0}),X(Z({},c("事件频次 / 累计风险 (%)",!0)),{min:0,max:110})],series:[{name:"能量释放",type:"bar",data:e.energy,barWidth:14,itemStyle:{color:v.orange,opacity:.82},markPoint:{symbol:"pin",symbolSize:34,data:[{name:"峰值",coord:[e.peakIdx,e.energy[e.peakIdx]]}],label:{formatter:"峰值",fontSize:10,color:"#111827"}}},{name:"平滑能量",type:"line",data:e.smooth,smooth:!0,symbolSize:5,lineStyle:{width:2,color:v.cyan}},{name:"事件频次",type:"line",yAxisIndex:1,data:e.eventRate,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.slate}},{name:"累计风险",type:"line",yAxisIndex:1,data:e.cumulativeRisk,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red}}]}}),zt=p(()=>{const e=bt.value;return{color:[v.blue,v.red,v.purple],animationDuration:350,grid:{left:64,right:54,top:46,bottom:62},legend:M,toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("径向距离 r (m)",!0)),{min:2,max:10}),yAxis:[X(Z({},c("应力 (MPa)",!0)),{min:0,max:50}),X(Z({},c("应力集中系数 Kt",!0)),{min:1,max:4.5,position:"right"})],series:[{name:"径向应力 σr",type:"line",data:e.dist.map((n,l)=>[n,e.radial[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.2,color:v.blue}},{name:"切向应力 σθ",type:"line",data:e.dist.map((n,l)=>[n,e.tangential[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.4,color:v.red},markPoint:{symbol:"circle",symbolSize:40,itemStyle:{color:"#fee2e2",borderColor:v.red,borderWidth:1.2},label:{formatter:"峰值",fontSize:10,color:"#111827"},data:[{coord:[e.dist[e.peakIdx],e.tangential[e.peakIdx]]}]}},{name:"Kt=σθ/σr",type:"line",yAxisIndex:1,data:e.dist.map((n,l)=>[n,e.kt[l]]),smooth:!0,symbolSize:5,lineStyle:{width:1.9,type:"dashed",color:v.purple},markLine:{symbol:"none",label:{formatter:"Kt=2",color:v.purple,fontFamily:ge,fontSize:10},lineStyle:{color:v.purple,width:1.1,type:"dashed"},data:[{yAxis:2}]}}]}}),Ue=p(()=>{const e=gt.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.red],animationDuration:350,grid:ce,legend:M,toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("时间片",!1)),{data:e.labels,nameGap:30}),yAxis:X(Z({},c("高风险后验概率",!0)),{min:0,max:1}),series:[{name:"CI下界",type:"line",stack:"dbn_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"dbn_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.18)"}},{name:"后验概率",type:"line",data:e.p,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red},markLine:{symbol:"none",lineStyle:{type:"dashed",width:1.15},data:[{yAxis:.3,name:"关注阈值",lineStyle:{color:v.orange}},{yAxis:.6,name:"报警阈值",lineStyle:{color:v.red}}]}}]}}),tt=p(()=>{const e=xt.value;return{color:[v.cyan,v.slate,v.red],animationDuration:350,grid:{left:74,right:54,top:46,bottom:66},legend:M,toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("指标",!1)),{data:e.categories,nameGap:30}),yAxis:[X(Z({},c("归一化分数",!0)),{min:0,max:100}),X(Z({},c("增益(新-基线)",!0)),{min:Math.min(...e.gain)-2,max:Math.max(...e.gain)+2,position:"right"})],series:[{name:"新算法",type:"bar",data:e.newScores,barWidth:14,itemStyle:{color:v.cyan}},{name:"基线算法",type:"bar",data:e.baseScores,barWidth:14,itemStyle:{color:v.slate,opacity:.85}},{name:"增益",type:"line",yAxisIndex:1,data:e.gain,symbol:"diamond",symbolSize:8,lineStyle:{width:2.2,color:v.red},label:{show:!0,position:"top",color:v.red,fontFamily:ge,fontSize:10,formatter:({value:n})=>`+${Number(n).toFixed(2)}`}}]}}),kt=p(()=>{const e=wt.value,n=e.drop.reduce((l,u,d,k)=>u>k[l]?d:l,0);return{color:[v.green,v.red,v.orange],animationDuration:350,grid:{left:66,right:52,top:46,bottom:64},legend:M,toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("模型版本",!1)),{data:e.categories,nameGap:30}),yAxis:[X(Z({},c("性能分数 (AUC×100)",!0)),{min:40,max:100}),X(Z({},c("下降分数 / 贡献(%)",!0)),{min:0,max:Math.max(...e.drop,...e.contribution)+8,position:"right"})],series:[{name:"性能分数",type:"bar",data:e.score,barWidth:16,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,formatter:({value:l})=>Number(l).toFixed(1)}},{name:"下降分数",type:"line",yAxisIndex:1,data:e.drop,symbolSize:8,lineStyle:{width:2,color:v.red},itemStyle:{color:v.red},markPoint:{symbol:"pin",symbolSize:34,data:[{coord:[n,e.drop[n]],name:"最大下降"}],label:{formatter:"最大下降",fontSize:10,color:"#111827"}}},{name:"贡献率(%)",type:"line",yAxisIndex:1,data:e.contribution,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.orange}}]}}),Ct=p(()=>{const e=We.value,n=Math.max(...e.count,1);return{color:[v.blue,"rgba(29,78,216,0.2)","#94a3b8",v.cyan],animationDuration:350,grid:{left:66,right:54,top:46,bottom:62},legend:M,toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("预测概率",!0)),{min:0,max:1,interval:.1}),yAxis:[X(Z({},c("真实频率",!0)),{min:0,max:1,interval:.1}),X(Z({},c("样本数",!0)),{min:0,max:n+2,position:"right"})],series:[{name:"理想校准线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.4,type:"dashed",color:"#94a3b8"}},{name:"CI下界",type:"line",stack:"cal_ci",data:e.centers.map((l,u)=>[l,e.lower[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"cal_ci",data:e.centers.map((l,u)=>[l,e.band[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.15)"}},{name:"校准曲线",type:"line",data:e.centers.map((l,u)=>[l,e.obs[u]]),smooth:!0,symbolSize:7,lineStyle:{width:2.4,color:v.blue},itemStyle:{color:v.blue}},{name:"分箱样本数",type:"bar",yAxisIndex:1,data:e.centers.map((l,u)=>[l,e.count[u]]),barWidth:18,itemStyle:{color:"#cbd5e1",opacity:.6}}],graphic:[{type:"text",right:26,top:18,style:{text:`ECE=${vt.value.toFixed(4)}`,font:`600 12px ${ge}`,fill:"#0f172a"}}]}}),Dt=p(()=>{const e=Ee.value,n=Ke.value,l=be.value,u=G.value,d=`ROC 曲线 (AUC=${Be.value.toFixed(3)})`,k=u?`AUC 95%CI [${u.aucLow.toFixed(3)}, ${u.aucHigh.toFixed(3)}]`:"AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.blue,v.red],animationDuration:350,grid:ce,legend:X(Z({},M),{data:["随机参考线",d,"最优阈值点"]}),toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("假阳性率 FPR",!0)),{min:0,max:1,interval:.1}),yAxis:X(Z({},c("真阳性率 TPR",!0)),{min:0,max:1,interval:.1}),series:[{name:"随机参考线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__roc_ci_low__",type:"line",stack:"roc_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__roc_ci_band__",type:"line",stack:"roc_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"ROC 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"ROC 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:d,type:"line",smooth:!0,data:E.value,symbolSize:5,lineStyle:{width:2.6,color:v.blue},areaStyle:{color:"rgba(29,78,216,0.12)"}},{name:"最优阈值点",type:"scatter",data:[[e.fpr,e.recall]],symbolSize:12,itemStyle:{color:v.red},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:v.red,formatter:`thr=${e.threshold.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:k,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),At=p(()=>{const n=[];for(let l=1;l<=99;l+=1){const u=l/100,d=2*u-.6;if(d<=0)continue;const k=h(.6*u/d,0,1);k>0&&k<=1&&n.push([u,k])}return n}),ct=p(()=>{const e=pt.value,n=ye.value,l=Qe.value,u=G.value,d=`PR 曲线 (PR-AUC=${He.value.toFixed(3)})`,k=u?`PR-AUC 95%CI [${u.prAucLow.toFixed(3)}, ${u.prAucHigh.toFixed(3)}]`:"PR-AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.orange,v.red,v.green],animationDuration:350,grid:ce,legend:X(Z({},M),{data:["基线(阳性占比)","F1=0.6 等值线",d,"最佳F1点"]}),toolbox:D,dataZoom:A,tooltip:{trigger:"axis"},xAxis:X(Z({},c("召回率 Recall",!0)),{min:0,max:1,interval:.1}),yAxis:X(Z({},c("精确率 Precision",!0)),{min:0,max:1,interval:.1}),series:[{name:"基线(阳性占比)",type:"line",data:[[0,ne.value],[1,ne.value]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__pr_ci_low__",type:"line",stack:"pr_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__pr_ci_band__",type:"line",stack:"pr_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"PR 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"PR 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"F1=0.6 等值线",type:"line",data:At.value,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:v.orange}},{name:d,type:"line",smooth:!0,data:ue.value,symbolSize:5,lineStyle:{width:2.6,color:v.red}},{name:"最佳F1点",type:"scatter",data:[[e.recall,e.precision]],symbolSize:12,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:v.green,formatter:`F1=${e.f1.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:k,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),qe=p(()=>{const e=et.value,n=Math.max(e.tp+e.tn+e.fp+e.fn,1),l=[{value:[0,0,e.tn,e.tn/n],label:"TN"},{value:[1,0,e.fp,e.fp/n],label:"FP"},{value:[0,1,e.fn,e.fn/n],label:"FN"},{value:[1,1,e.tp,e.tp/n],label:"TP"}],u=ft.value;return{animationDuration:350,grid:{left:76,right:120,top:38,bottom:66},toolbox:X(Z({},D),{feature:{restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}}),tooltip:{trigger:"item",formatter:({data:d})=>`${d.label}：${d.value[2]} (${(d.value[3]*100).toFixed(1)}%)`},xAxis:X(Z({},c("预测类别",!1)),{data:["低风险","高风险"],nameGap:34,splitLine:{show:!1}}),yAxis:X(Z({},c("真实类别",!1)),{data:["低风险","高风险"],nameGap:54,splitLine:{show:!1}}),visualMap:{min:0,max:Math.max(e.tp,e.tn,e.fp,e.fn,1),orient:"vertical",right:18,top:"middle",text:["高","低"],textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"},inRange:{color:["#ecfeff","#67e8f9","#0e7490"]}},series:[{name:"混淆矩阵",type:"heatmap",data:l,label:{show:!0,color:"#0f172a",fontFamily:ge,fontSize:11,formatter:({data:d})=>`${d.label}
${d.value[2]}
${(d.value[3]*100).toFixed(1)}%`},itemStyle:{borderWidth:1,borderColor:"#e2e8f0"}}],graphic:[{type:"group",right:10,bottom:8,children:[{type:"text",top:0,style:{text:`Acc ${(u.accuracy*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:16,style:{text:`Prec ${(u.precision*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:32,style:{text:`Rec ${(u.recall*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:48,style:{text:`Spec ${(u.specificity*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}}]}]}});return(e,n)=>(ee(),te("section",so,[o("header",ro,[n[0]||(n[0]=o("div",{class:"head-title"},[o("h4",null,"SCI 配图增强版（图2-图11）"),o("p",null,"统一采用期刊风格坐标系、阈值注记、置信区间和关键决策点标注。")],-1)),o("div",io,[o("span",uo,"样本 n="+y(j.value),1),o("span",co,"正样本占比 "+y(L(ne.value)),1),G.value?(ee(),te("span",mo,"Bootstrap "+y(G.value.iterations)+"次",1)):we("",!0),o("span",{class:nt(["metric-chip",{warn:I.value!=="real_label_stream"}])},"评估源 "+y(ae.value),3),H.value?(ee(),te("span",po,"标签文件 "+y(H.value),1)):we("",!0)])]),o("article",vo,[n[1]||(n[1]=o("h4",null,"图2 | RSI 机制剖面图（稳定度-损伤-置信带）",-1)),$e(Te,{option:Ge.value,height:336},null,8,["option"]),n[2]||(n[2]=o("p",{class:"caption"},"怎么看：稳定度实线越高越好，误差带越窄代表层位响应更稳定，损伤柱越低越好。",-1)),o("p",fo,y(Oe.value),1)]),o("article",yo,[n[3]||(n[3]=o("h4",null,"图3 | BRI 微震能量释放、事件频次与累计风险",-1)),$e(Te,{option:ut.value,height:336},null,8,["option"]),n[4]||(n[4]=o("p",{class:"caption"},"怎么看：能量柱与事件频次线共同识别冲击窗口，累计风险线反映风险积聚过程。",-1)),o("p",ho,y(Me.value),1)]),o("article",bo,[n[5]||(n[5]=o("h4",null,"图4 | ASI 径向/切向应力与应力集中系数 Kt",-1)),$e(Te,{option:zt.value,height:336},null,8,["option"]),n[6]||(n[6]=o("p",{class:"caption"},"怎么看：切向应力峰值与 Kt>2 区段对应高风险圈带，径向应力反映卸压后衰减。",-1)),o("p",go,y(st.value),1)]),o("article",xo,[n[7]||(n[7]=o("h4",null,"图5 | DBN 后验概率时序（95% CI + 预警阈值）",-1)),$e(Te,{option:Ue.value,height:336},null,8,["option"]),n[8]||(n[8]=o("p",{class:"caption"},"怎么看：后验概率曲线跨过 0.6 报警阈值时需触发强化巡检，CI 带越窄越可信。",-1)),o("p",wo,y(St.value),1)]),o("article",So,[n[9]||(n[9]=o("h4",null,"图6 | 新旧算法多指标对比（分数 + 增益）",-1)),$e(Te,{option:tt.value,height:336},null,8,["option"]),n[10]||(n[10]=o("p",{class:"caption"},"怎么看：柱形给出绝对分数，增益折线给出替代旧算法的实际收益幅度。",-1)),o("p",_o,y(Pt.value),1)]),o("article",ko,[n[11]||(n[11]=o("h4",null,"图7 | 消融实验（模块贡献与性能下降）",-1)),$e(Te,{option:kt.value,height:336},null,8,["option"]),n[12]||(n[12]=o("p",{class:"caption"},"怎么看：去除模块后的性能下降越大，说明该模块对总体性能贡献越关键。",-1)),o("p",Co,y(rt.value),1)]),o("article",Ao,[n[13]||(n[13]=o("h4",null,"图8 | 校准曲线（含样本直方图与置信区间）",-1)),$e(Te,{option:Ct.value,height:336},null,8,["option"]),n[14]||(n[14]=o("p",{class:"caption"},"怎么看：曲线贴近对角线且 ECE 越低，模型概率输出越可直接用于阈值决策。",-1)),o("p",No,y(_t.value),1)]),o("article",Mo,[n[15]||(n[15]=o("h4",null,"图9 | ROC 曲线（最优阈值点与 AUC）",-1)),$e(Te,{option:Dt.value,height:336},null,8,["option"]),n[16]||(n[16]=o("p",{class:"caption"},"怎么看：曲线越靠左上角越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，红点为 Youden 最优阈值。",-1)),o("p",Io,y(Tt.value),1)]),o("article",$o,[n[17]||(n[17]=o("h4",null,"图10 | PR 曲线（基线、F1 等值线与最优点）",-1)),$e(Te,{option:ct.value,height:336},null,8,["option"]),n[18]||(n[18]=o("p",{class:"caption"},"怎么看：PR 曲线整体越高越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，绿点为最佳F1运行点。",-1)),o("p",Ro,y(Lt.value),1)]),o("article",Fo,[n[19]||(n[19]=o("h4",null,"图11 | 混淆矩阵热图（计数 + 占比 + 诊断指标）",-1)),$e(Te,{option:qe.value,height:336,onChartClick:je},null,8,["option"]),n[20]||(n[20]=o("p",{class:"caption"},"怎么看：对角线高、非对角低为理想状态；右侧指标用于误报/漏报成本权衡。",-1)),o("p",Po,y(it.value),1)])]))}},Lo=Wt(To,[["__scopeId","data-v-f81ec0ce"]]),zo={class:"top-nav"},Do={class:"nav-left"},Eo={class:"seam-select"},Bo=["value"],Oo={key:0,class:"mini-stats"},Uo={class:"danger"},Vo={class:"nav-right"},Wo=["disabled"],Ho=["disabled"],jo={class:"metric-dashboard"},Go=["onClick"],qo={class:"head"},Yo={class:"value"},Zo={class:"meta"},Xo={class:"main-layout"},Jo={class:"main-canvas-card"},Ko={class:"canvas-head"},Qo={class:"canvas-controls"},ea={class:"check"},ta={class:"check"},na={key:0,class:"trust-banner"},oa={class:"trust-chip warn"},aa={key:0,class:"trust-chip hint"},la={key:1,class:"trust-chip link"},sa={key:2,class:"trust-meta"},ra={class:"trust-meta"},ia={key:0,class:"loading-mask"},ua={class:"legend-wrap"},ca={class:"legend-labels"},da={class:"thumb-list"},ma=["onClick","onMouseenter","onMousemove"],pa={class:"thumb-meta"},va={key:0,class:"floating-panel"},fa={class:"weight-row"},ya={class:"weight-row"},ha={class:"weight-row"},ba={key:0,class:"eval-drawer"},ga={class:"actions"},xa={key:0,class:"panel-empty"},wa={key:1,class:"panel-empty"},Sa={class:"eval-grid"},_a={class:"metric"},ka={class:"metric"},Ca={class:"metric"},Aa={class:"metric"},Na={class:"metric"},Ma={class:"eval-content"},Ia={class:"cm-card"},$a={class:"cm-grid"},Ra={class:"cm-cell"},Fa={class:"cm-cell warn"},Pa={class:"cm-cell warn"},Ta={class:"cm-cell"},La={class:"baseline-card"},za={viewBox:"0 0 560 170",class:"baseline-svg"},Da=["width"],Ea={x:"485",y:"26"},Ba=["width"],Oa={x:"485",y:"90"},Ua={key:0,class:"science-section"},Va={class:"data-note"},Wa={key:1,class:"export-note"},Ha={class:"risk"},ja={__name:"AlgorithmValidation",setup(b){const q=Xn(),x=Zn(),{workspaceState:Ae,setSelectedSeam:v,markStepDone:ce}=Vn(),h=[{key:"mpi",label:"MPI",desc:"综合指标"},{key:"rsi",label:"RSI",desc:"顶板稳定"},{key:"bri",label:"BRI",desc:"冲击风险"},{key:"asi",label:"ASI",desc:"支承应力"}],W={tp:{label:"TP 真阳性",color:"#15803d"},tn:{label:"TN 真阴性",color:"#0e7490"},fp:{label:"FP 假阳性",color:"#d97706"},fn:{label:"FN 假阴性",color:"#b91c1c"}},L=K(null),s=K(null),f=K(null),c=K(null),M=K(null),D=K([]),A=K(""),R=K(50),I=K(9),H=K("idw"),ae=K(!0),O=K(!1),j=K("mpi"),de=K(!1),me=K(!1),ne=K(!1),pe=K(!0),xe=K(!1),V=Rt({rsi:.4,bri:.35,asi:.25}),$=Yn(null),E=K(null),ue=K(!1),he=K(""),ie=K(!1),ke=K(""),J=K(null),Re=Rt({x:0,y:0}),ve=Rt({visible:!1,metric:"",x:0,y:0}),G=K("pseudo_threshold"),Ke=K(""),be=K("all"),ye=K(null),Qe=K(!1),ot={},at=new Map;let Ee=null;const pt=()=>Ce(this,null,function*(){if(Ee)return Ee;const a=yield Wn(()=>import("./jszip-CsMIhXuR.js").then(t=>t.j),[]);if(Ee=(a==null?void 0:a.default)||(a==null?void 0:a.JSZip)||window.JSZip||null,!Ee)throw new Error("JSZip 加载失败");return Ee}),{viewport:lt,worldToScreen:We,screenToWorld:Be,fitToBounds:He,startDrag:Ft,dragTo:vt,endDrag:et,zoomAt:ft}=to(),{getLegendGradient:yt,drawGrid:ht,drawBoreholes:bt,pickNearestBorehole:gt,sampleGridValue:xt,drawMiniHeatmap:wt}=ao(),Oe=p(()=>{const a=V.rsi+V.bri+V.asi||1;return{rsi:V.rsi/a,bri:V.bri/a,asi:V.asi/a}}),Me=p(()=>{var a,t,i;return!!((a=$.value)!=null&&a.grids&&((t=$.value)!=null&&t.statistics)&&((i=$.value)!=null&&i.boreholes))}),st=p(()=>{var a,t;return((t=(a=$.value)==null?void 0:a.statistics)==null?void 0:t[j.value])||{}}),St=p(()=>{const a=st.value,t=Number(a==null?void 0:a.min),i=Number(a==null?void 0:a.max);return!Number.isFinite(t)||!Number.isFinite(i)?0:Math.max(0,i-t)}),Pt=p(()=>Me.value&&O.value&&St.value<20),rt=p(()=>{var a,t,i;return Number(((i=(t=(a=$.value)==null?void 0:a.statistics)==null?void 0:t.mpi)==null?void 0:i.mean)||0)}),_t=p(()=>Math.max(0,rt.value-4.5)),Tt=p(()=>m(j.value)),Lt=p(()=>G.value==="real_label_stream"?"真实标签流":G.value==="pseudo_threshold"?"伪标签估计（阈值构造）":G.value==="none"?"无可评估样本":"未知来源"),it=p(()=>{var a,t;return O.value?{min:0,mean:50,max:100}:((t=(a=$.value)==null?void 0:a.statistics)==null?void 0:t[j.value])||{min:0,mean:0,max:0}}),je=p(()=>{var t,i,g,r;const a={};for(const S of h){const _=((i=(t=$.value)==null?void 0:t.statistics)==null?void 0:i[S.key])||{},N=(r=(g=$.value)==null?void 0:g.grids)==null?void 0:r[S.key];let P=0,se=0,fe=0,Y=Number.POSITIVE_INFINITY,_e=Number.NEGATIVE_INFINITY;if(Array.isArray(N))for(const Ye of N)for(const Ze of Ye||[]){const Ie=Number(Ze);Number.isFinite(Ie)&&(P+=1,se+=Ie,fe+=Ie*Ie,Ie<Y&&(Y=Ie),Ie>_e&&(_e=Ie))}const Ne=P?se/P:Number(_.mean||0),Fe=P?Math.max(fe/P-Ne*Ne,0):0;a[S.key]={min:Number.isFinite(Number(_.min))?Number(_.min):P?Y:0,max:Number.isFinite(Number(_.max))?Number(_.max):P?_e:0,mean:Ne,std:Math.sqrt(Fe)}}return a}),Ge=p(()=>je.value[ve.metric]||null),ut=p(()=>{var Y,_e,Ne,Fe,Ye,Ze,Ie,Xe;if(!Me.value)return null;const a=je.value,t=((Y=$.value)==null?void 0:Y.boreholes)||[],i=Ht(),g=Number(((_e=a.mpi)==null?void 0:_e.mean)||0),r=Math.max(0,g-4.5),S=r>0?(g-r)/r*100:0,_=t.length||1,N=m("mpi")/_,P=C(1-g/100,0,1),se=C(Number(((Ne=E.value)==null?void 0:Ne.auc)||.7)-.5,0,.45),fe=["t-4","t-3","t-2","t-1","t"].map(($t,Ve)=>({t:$t,high_risk_prob:C(P+(Ve-2)*.05+se*.2,.05,.95)}));return{modules:{rsi:{value:Number(((Fe=a.rsi)==null?void 0:Fe.mean)||0),input_layers:6},bri:{value:Number(((Ye=a.bri)==null?void 0:Ye.mean)||0),event_count:t.length,avg_magnitude:2.6},asi:{value:Number(((Ze=a.asi)==null?void 0:Ze.mean)||0),avg_friction_angle:31.2}},fusion:{mpi:g,baseline:{mpi:r},dynamic_weights:Oe.value},kpi:{mpi_mean:g,high_risk_ratio:N,auc:Number(((Ie=E.value)==null?void 0:Ie.auc)||.7),brier_score:Number(((Xe=E.value)==null?void 0:Xe.brier)||.24),improvement_vs_baseline_pct:S},figures:{fig5_dbn:{posterior:fe}},evaluation_inputs:i}}),zt=a=>{var t;return((t=W[String(a||"").toLowerCase()])==null?void 0:t.label)||"全部"},Ue=p(()=>{var _,N;const a=((_=$.value)==null?void 0:_.boreholes)||[],t=((N=ut.value)==null?void 0:N.evaluation_inputs)||{},i=Array.isArray(t.y_true)?t.y_true:Array.isArray(t.yTrue)?t.yTrue:[],g=Array.isArray(t.y_prob)?t.y_prob:Array.isArray(t.yProb)?t.yProb:[];if(!a.length||i.length!==a.length||g.length!==a.length)return{available:!1,roles:[],counts:{tp:0,tn:0,fp:0,fn:0}};const r=[],S={tp:0,tn:0,fp:0,fn:0};for(let P=0;P<a.length;P+=1){const se=Number(i[P])>=1?1:0,fe=Number(g[P])>=.5?1:0,Y=se===1?fe===1?"tp":"fn":fe===1?"fp":"tn";r.push(Y),S[Y]+=1}return{available:!0,roles:r,counts:S}}),tt=p(()=>Ue.value.available),kt=p(()=>{var t;if(be.value==="all")return 0;const a=String(be.value).toLowerCase();return Number(((t=Ue.value.counts)==null?void 0:t[a])||0)}),Ct=p(()=>{const a=String(be.value||"").toLowerCase();if(!Ue.value.available||!["tp","tn","fp","fn"].includes(a))return[];const t=[];for(let i=0;i<Ue.value.roles.length;i+=1)Ue.value.roles[i]===a&&t.push(i);return t}),Dt=p(()=>new Set(Ct.value)),At=p(()=>{var t;const a=String(be.value||"").toLowerCase();return["tp","tn","fp","fn"].includes(a)?{active:!0,indexSet:Dt.value,accent:((t=W[a])==null?void 0:t.color)||"#111827"}:null}),ct=p(()=>be.value!=="all"&&tt.value&&!Qe.value);let qe=0,e=0,n=null,l=null,u=0,d=0;const k=()=>{window.clearTimeout(n),n=window.setTimeout(()=>{Nt(),Et(),Se(),Mt()},80)},F=a=>{var t;return((t=h.find(i=>i.key===a))==null?void 0:t.label)||a.toUpperCase()},B=a=>yt(a),w=(a,t=2)=>a==null||Number.isNaN(Number(a))?"--":Number(a).toFixed(t),T=a=>`${(Number(a||0)*100).toFixed(0)}%`,C=(a,t,i)=>Math.max(t,Math.min(i,a)),U=a=>{const t=String(a||"").toLowerCase();return t.includes("high")||t.includes("高")?"高风险":t.includes("medium")||t.includes("中")?"中风险":t.includes("low")||t.includes("低")?"低风险":"未知"},oe=a=>`${C(Number(a||0),0,100)*3.6}`,m=a=>{var t;return(((t=$.value)==null?void 0:t.boreholes)||[]).filter(i=>Number(i[a])<50).length},z=a=>{var t,i;return O.value?{min:0,mean:50,max:100}:((i=(t=$.value)==null?void 0:t.statistics)==null?void 0:i[a])||{min:0,mean:0,max:0}},re=()=>{const a=Number(I.value);I.value=Number.isFinite(a)?Math.max(5,Math.min(24,Math.round(a))):9},Q=(a,t,i)=>{if(!Array.isArray(i)||i.length===0)return{borehole:null,distance:null};let g=null,r=Number.POSITIVE_INFINITY;for(const S of i){const _=Number(S.x)-a,N=Number(S.y)-t,P=Math.hypot(_,N);P<r&&(r=P,g=S)}return{borehole:g,distance:Number.isFinite(r)?r:null}},le=()=>{const a=Oe.value;return[A.value,R.value,H.value,a.rsi.toFixed(3),a.bri.toFixed(3),a.asi.toFixed(3)].join("|")},ze=a=>t=>{t?(ot[a]=t,Mt()):delete ot[a]},Nt=()=>{if(!s.value||!c.value||!M.value)return;const a=s.value.getBoundingClientRect(),t=window.devicePixelRatio||1,i=Math.max(1,Math.floor(a.width*t)),g=Math.max(1,Math.floor(a.height*t));for(const r of[c.value,M.value])r.width=i,r.height=g},Et=()=>{var t;const a=(t=$.value)==null?void 0:t.bounds;!a||!c.value||(He(a,c.value.width,c.value.height,62),Se())},pn=(a,t,i)=>{const g=String(be.value||"").toLowerCase();if(!["tp","tn","fp","fn"].includes(g)||!Ue.value.available)return;const r=W[g],S=Ct.value;S.length&&(a.save(),a.fillStyle="rgba(15, 23, 42, 0.88)",a.fillRect(12,10,250,28),a.fillStyle="#f4f9f8",a.font="600 12px 'Noto Sans SC', 'Segoe UI', sans-serif",a.fillText(`联动筛选: ${r.label} (${S.length})  Esc清除`,22,29),a.restore())},Bt=()=>{var _,N,P;if(qe=0,!c.value||!M.value)return;const a=$.value,t=c.value.getContext("2d"),i=M.value.getContext("2d");if(t.clearRect(0,0,c.value.width,c.value.height),i.clearRect(0,0,M.value.width,M.value.height),!a)return;const g=j.value,r=z(g);ht(t,(_=a.grids)==null?void 0:_[g],a.bounds,lt,g,r,We,{showContours:ae.value,contourLevels:I.value});const S=At.value?X(Z({},At.value),{animate:ct.value,pulseT:performance.now()/1e3}):null;bt(i,a.boreholes,g,r,a.bounds,We,((P=(N=J.value)==null?void 0:N.borehole)==null?void 0:P.borehole_name)||"",S),pn(i,a.boreholes||[],a.bounds),J.value&&(i.strokeStyle="rgba(15, 23, 42, 0.55)",i.lineWidth=1.1,i.setLineDash([5,4]),i.beginPath(),i.moveTo(J.value.sx,0),i.lineTo(J.value.sx,M.value.height),i.moveTo(0,J.value.sy),i.lineTo(M.value.width,J.value.sy),i.stroke(),i.setLineDash([])),ct.value&&Se()},vn=()=>{var t;e=0;const a=$.value;if(a)for(const i of h){const g=ot[i.key];g&&wt(g,(t=a.grids)==null?void 0:t[i.key],i.key,z(i.key))}},Se=()=>{qe||(qe=window.requestAnimationFrame(Bt))},Mt=()=>{e||(e=window.requestAnimationFrame(vn))},Ht=()=>{var r,S;const a=(r=$.value)==null?void 0:r.evaluation_inputs;if((a==null?void 0:a.mode)==="real_label_stream"){const _=Array.isArray(a.y_true)?a.y_true:[],N=Array.isArray(a.y_prob)?a.y_prob:[];if(_.length===N.length&&_.length>=2){const P=_.map(Y=>Number(Y)>=1?1:0),se=N.map(Y=>C(Number(Y),0,1));if(se.every(Y=>Number.isFinite(Y))&&new Set(P).size>1)return{mode:"real_label_stream",source:String(a.source||""),sourceFile:String(a.source||""),y_true:P,y_prob:se,yTrue:P,yProb:se}}}const t=((S=$.value)==null?void 0:S.boreholes)||[];if(t.length<4)return null;let i=t.map(_=>_.rsi<50||_.bri<50||_.asi<50?1:0);const g=t.map(_=>C(1-Number(_.mpi||0)/100,0,1));if(new Set(i).size<2){const _=t.map(P=>Number(P.mpi||0)).sort((P,se)=>P-se),N=_[Math.floor(_.length/2)];i=t.map(P=>Number(P.mpi||0)<=N?1:0)}return{mode:"pseudo_threshold",source:"",sourceFile:"",y_true:i,y_prob:g,yTrue:i,yProb:g}},fn=()=>Ce(this,null,function*(){var i,g;const a=++d,t=Ht();if(!t){if(a!==d)return;G.value="none",Ke.value="",E.value=null,he.value="当前煤层钻孔点不足，无法计算评估指标。";return}if(a===d){G.value=t.mode||"pseudo_threshold",Ke.value=t.sourceFile||"",ue.value=!0,he.value="";try{const r=yield Qn({y_true:t.y_true||t.yTrue,y_prob:t.y_prob||t.yProb});if(a!==d)return;E.value=r.data}catch(r){if(a!==d)return;E.value=null,he.value=((g=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:g.detail)||"评估指标计算失败"}finally{a===d&&(ue.value=!1)}}}),jt=a=>Ce(this,null,function*(){$.value=a,J.value=null,be.value="all",yield Vt(),Nt(),Et(),Se(),Mt(),fn()}),It=(...t)=>Ce(this,[...t],function*({force:a=!1}={}){var r,S;if(!A.value)return;const i=++u,g=le();if(!a&&at.has(g)){if(i!==u)return;yield jt(at.get(g));return}de.value=!0;try{const _=yield Kn(A.value,R.value,H.value,Oe.value);if(i!==u)return;const N=_.data;at.set(g,N),yield jt(N),ce("AlgorithmValidation",{validationReady:!0})}catch(_){if(i!==u)return;he.value=((S=(r=_==null?void 0:_.response)==null?void 0:r.data)==null?void 0:S.detail)||"空间总览加载失败"}finally{i===u&&(de.value=!1)}}),yn=a=>{const t=String(a||"").toLowerCase();["tp","tn","fp","fn"].includes(t)&&tt.value&&(be.value=be.value===t?"all":t,Se())},Gt=()=>{be.value="all",Se()},qt=a=>{a.key==="Escape"&&be.value!=="all"&&Gt()},hn=a=>{var t,i;!Me.value||!s.value||a.pointerType==="mouse"&&a.button!==0||ye.value!==null&&ye.value!==a.pointerId||(ye.value=a.pointerId,(i=(t=s.value).setPointerCapture)==null||i.call(t,a.pointerId),Ft(a.clientX,a.clientY))},bn=a=>{var fe,Y,_e,Ne,Fe;if(ye.value!==null&&a.pointerId!==ye.value||!M.value||!Me.value)return;const t=M.value.getBoundingClientRect(),i=window.devicePixelRatio||1,g=(a.clientX-t.left)*i,r=(a.clientY-t.top)*i;if(Re.x=a.clientX-t.left,Re.y=a.clientY-t.top,lt.isDragging){vt(a.clientX,a.clientY),Se();return}const S=(fe=$.value)==null?void 0:fe.bounds,_=Be(g,r,S),N=j.value,P=Q(_.x,_.y,((Y=$.value)==null?void 0:Y.boreholes)||[]),se=gt(g,r,((_e=$.value)==null?void 0:_e.boreholes)||[],S,We);J.value={sx:g,sy:r,worldX:_.x,worldY:_.y,gridValue:xt((Fe=(Ne=$.value)==null?void 0:Ne.grids)==null?void 0:Fe[N],S,_.x,_.y),borehole:se,nearestBorehole:P.borehole,nearestDistance:P.distance},Se()},gn=a=>{var t,i;ye.value!==null&&a.pointerId!==ye.value||((i=(t=s.value)==null?void 0:t.hasPointerCapture)!=null&&i.call(t,a.pointerId)&&s.value.releasePointerCapture(a.pointerId),ye.value=null,et())},xn=a=>{var t,i;ye.value!==null&&a.pointerId!==ye.value||((i=(t=s.value)==null?void 0:t.hasPointerCapture)!=null&&i.call(t,a.pointerId)&&s.value.releasePointerCapture(a.pointerId),ye.value=null,et(),J.value=null,Se())},wn=a=>{var t,i;if(ye.value!==null&&a.pointerId===ye.value){if((i=(t=s.value)==null?void 0:t.hasPointerCapture)==null?void 0:i.call(t,a.pointerId))return;ye.value=null,et()}lt.isDragging||(J.value=null,Se())},Sn=a=>{var S;if(!M.value||!Me.value)return;const t=M.value.getBoundingClientRect(),i=window.devicePixelRatio||1,g=(a.clientX-t.left)*i,r=(a.clientY-t.top)*i;ft(a.deltaY<0?1.14:.88,g,r,(S=$.value)==null?void 0:S.bounds),Se()},_n=(a,t)=>{ve.metric=a,Yt(a,t)},Yt=(a,t)=>{if(!f.value)return;const i=f.value.getBoundingClientRect();ve.visible=!0,ve.metric=a,ve.x=t.clientX-i.left,ve.y=t.clientY-i.top},kn=()=>{ve.visible=!1},Zt=a=>String(a||"figure").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),Xt=(a,t="image/png",i=1)=>new Promise((g,r)=>{a.toBlob(S=>{S?g(S):r(new Error("Canvas 导出失败"))},t,i)}),Cn=a=>{const t=a.cloneNode(!0);return t.getAttribute("xmlns")||t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.getAttribute("xmlns:xlink")||t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),new XMLSerializer().serializeToString(t)},An=(a,t,i,g=3)=>Ce(this,null,function*(){const r=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),S=URL.createObjectURL(r);try{const _=yield new Promise((se,fe)=>{const Y=new Image;Y.onload=()=>se(Y),Y.onerror=()=>fe(new Error("SVG 转 PNG 失败")),Y.src=S}),N=document.createElement("canvas");N.width=Math.max(1,Math.round(t*g)),N.height=Math.max(1,Math.round(i*g));const P=N.getContext("2d");return P.fillStyle="#ffffff",P.fillRect(0,0,N.width,N.height),P.drawImage(_,0,0,N.width,N.height),yield Xt(N,"image/png",1)}finally{URL.revokeObjectURL(S)}}),Nn=()=>new Promise(a=>window.requestAnimationFrame(a)),Jt=a=>Ce(this,null,function*(){const t=Qe.value;Qe.value=!0,Bt(),yield Nn();try{return yield a()}finally{Qe.value=t,Bt(),ct.value&&Se()}}),Mn=()=>Ce(this,null,function*(){!c.value||!M.value||(yield Jt(()=>Ce(this,null,function*(){const t=c.value.width,i=c.value.height,g=document.createElement("canvas");g.width=Math.round(t*3),g.height=Math.round(i*3);const r=g.getContext("2d");r.scale(3,3),r.fillStyle="#ffffff",r.fillRect(0,0,t,i),r.drawImage(c.value,0,0),r.drawImage(M.value,0,0),r.fillStyle="rgba(15, 23, 42, 0.92)",r.font="14px 'Times New Roman', 'Noto Serif SC', serif",r.fillText(`煤层：${A.value||"--"} | 指标：${F(j.value)} | 分辨率：${R.value}`,16,26);const S=document.createElement("a");S.href=g.toDataURL("image/png",1),S.download=`algorithm_validation_${A.value||"seam"}_${j.value}_hd.png`,S.click()})))}),In=()=>Ce(this,null,function*(){if(!(!L.value||!Me.value||ie.value)){ie.value=!0,ke.value="";try{yield Jt(()=>Ce(this,null,function*(){var Ne,Fe,Ye;const a=yield pt(),t=new a,i=new Date().toISOString().replace(/[:.]/g,"-"),g=document.createElement("canvas"),r=3,S=c.value.width,_=c.value.height;g.width=Math.round(S*r),g.height=Math.round(_*r);const N=g.getContext("2d");N.scale(r,r),N.fillStyle="#ffffff",N.fillRect(0,0,S,_),N.drawImage(c.value,0,0),N.drawImage(M.value,0,0),N.fillStyle="rgba(15, 23, 42, 0.92)",N.font="14px 'Times New Roman', 'Noto Serif SC', serif",N.fillText(`煤层：${A.value||"--"} | 指标：${F(j.value)} | 分辨率：${R.value}`,16,26),t.file("figures/main_heatmap_hd.png",yield Xt(g,"image/png",1));const P=L.value.querySelectorAll(".science-section .figure-card");let se=0;for(const Ze of P){se+=1;const Ie=((Fe=(Ne=Ze.querySelector("h4"))==null?void 0:Ne.textContent)==null?void 0:Fe.trim())||`图${se}`,Xe=Ze.querySelector(".science-chart svg");if(!Xe)continue;const $t=Xe.getBoundingClientRect(),Ve=(Ye=Xe.viewBox)==null?void 0:Ye.baseVal,Ln=(Ve==null?void 0:Ve.width)||$t.width||960,zn=(Ve==null?void 0:Ve.height)||$t.height||540,Kt=Cn(Xe),Qt=Zt(`${String(se).padStart(2,"0")}_${Ie}`);t.file(`figures/${Qt}.svg`,Kt),t.file(`figures/${Qt}.png`,yield An(Kt,Ln,zn,3))}t.file("data/spatial_statistics.json",JSON.stringify(je.value,null,2)),t.file("data/evaluation.json",JSON.stringify(E.value||{},null,2)),t.file("data/science_result.json",JSON.stringify(ut.value||{},null,2)),t.file("README.txt",["新算法实证图组导出包",`时间: ${new Date().toLocaleString()}`,`煤层: ${A.value||"--"}`,`主图指标: ${F(j.value)}`,"","内容说明:","- figures/: 主热力图和图2-图11（SVG+PNG）","- data/: 统计与评估原始数据"].join(`
`));const fe=yield t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),Y=URL.createObjectURL(fe),_e=document.createElement("a");_e.href=Y,_e.download=`新算法实证图组_${Zt(A.value||"seam")}_${i}.zip`,_e.click(),URL.revokeObjectURL(Y)})),ke.value="图组包导出完成。"}catch(a){ke.value=(a==null?void 0:a.message)||"图组包导出失败"}finally{ie.value=!1}}}),$n=()=>{if(!$.value)return;const a=new Blob([JSON.stringify($.value,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),i=document.createElement("a");i.href=t,i.download=`algorithm_validation_${A.value||"seam"}_spatial.json`,i.click(),URL.revokeObjectURL(t)},Rn=()=>Ce(this,null,function*(){L.value&&(document.fullscreenElement?yield document.exitFullscreen():yield L.value.requestFullscreen())}),Fn=a=>Array.isArray(a)?a[0]||"":typeof a=="string"?a:"",Pn=()=>{x.push({name:"Report",query:A.value?{seam:A.value}:void 0})},Tn=()=>Ce(this,null,function*(){var a,t,i,g;try{const r=yield Jn(),S=((a=r==null?void 0:r.data)==null?void 0:a.seams)||[];if(D.value=S,S.length===0)return;const _=Fn((t=q.query)==null?void 0:t.seam)||Ae.selectedSeam||"16-3煤",N=S.find(P=>P.name===_);A.value=(N==null?void 0:N.name)||S[0].name,v(A.value)}catch(r){he.value=((g=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:g.detail)||"煤层列表加载失败"}});return Le(j,()=>Se()),Le(ae,()=>Se()),Le(I,()=>{re(),Se()}),Le(O,()=>{Se(),Mt()}),Le([R,H],()=>{me.value&&It({force:!1})}),Le(A,()=>{v(A.value||""),me.value&&It({force:!1})}),Le(tt,a=>{!a&&be.value!=="all"&&(be.value="all",Se())}),Le(()=>[V.rsi,V.bri,V.asi],()=>{me.value&&(window.clearTimeout(l),l=window.setTimeout(()=>It({force:!1}),300))}),dn(()=>Ce(this,null,function*(){re(),yield Tn(),A.value&&(yield It({force:!0})),me.value=!0,window.addEventListener("resize",k),window.addEventListener("keydown",qt)})),mn(()=>{var a,t;window.clearTimeout(l),window.clearTimeout(n),qe&&window.cancelAnimationFrame(qe),e&&window.cancelAnimationFrame(e),s.value&&ye.value!==null&&((t=(a=s.value).hasPointerCapture)!=null&&t.call(a,ye.value))&&s.value.releasePointerCapture(ye.value),ye.value=null,window.removeEventListener("resize",k),window.removeEventListener("keydown",qt)}),(a,t)=>{var i,g;return ee(),te("div",{ref_key:"pageRoot",ref:L,class:"validation-page"},[o("nav",zo,[o("div",Do,[o("button",{class:"icon-btn",type:"button",title:"返回",onClick:t[0]||(t[0]=r=>qn(x).back())},[...t[16]||(t[16]=[o("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{d:"M19 12H5m0 0 6-6m-6 6 6 6"})],-1)])]),t[21]||(t[21]=o("h1",null,"新算法实证",-1)),t[22]||(t[22]=o("span",{class:"divider"},null,-1)),o("label",Eo,[t[17]||(t[17]=o("span",null,"煤层",-1)),De(o("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>A.value=r)},[(ee(!0),te(Je,null,Ot(D.value,r=>(ee(),te("option",{key:r.name,value:r.name},y(r.name),9,Bo))),128))],512),[[on,A.value]])]),Me.value?(ee(),te("div",Oo,[o("span",null,[t[18]||(t[18]=Pe("均值 ",-1)),o("b",null,y(w(st.value.mean)),1)]),o("span",null,[t[19]||(t[19]=Pe("最低 ",-1)),o("b",null,y(w(st.value.min)),1)]),o("span",Uo,[t[20]||(t[20]=Pe("高风险点 ",-1)),o("b",null,y(Tt.value),1)])])):we("",!0)]),o("div",Vo,[o("button",{class:nt(["tool-btn",{active:ne.value}]),type:"button",onClick:t[2]||(t[2]=r=>ne.value=!ne.value)},"权重",2),o("button",{class:nt(["tool-btn",{active:pe.value}]),type:"button",onClick:t[3]||(t[3]=r=>pe.value=!pe.value)},"评估",2),o("button",{class:"tool-btn",type:"button",onClick:Mn},"导出高清图"),o("button",{class:"tool-btn",type:"button",disabled:ie.value||!Me.value,onClick:In},y(ie.value?"打包中...":"导出图组包"),9,Wo),o("button",{class:"tool-btn",type:"button",disabled:!Me.value,onClick:Pn},"下一步：结果报告",8,Ho),o("button",{class:"tool-btn",type:"button",onClick:Rn},"全屏")])]),o("section",jo,[(ee(),te(Je,null,Ot(h,r=>{var S,_,N,P,se,fe,Y,_e,Ne;return o("button",{key:r.key,class:nt(["metric-card",{active:j.value===r.key}]),type:"button",onClick:Fe=>j.value=r.key},[o("div",qo,[o("strong",null,y(r.label),1),o("span",null,y(r.desc),1)]),o("div",Yo,y(w((N=(_=(S=$.value)==null?void 0:S.statistics)==null?void 0:_[r.key])==null?void 0:N.mean)),1),o("div",Zo,[o("span",null,"最低 "+y(w((fe=(se=(P=$.value)==null?void 0:P.statistics)==null?void 0:se[r.key])==null?void 0:fe.min)),1),o("span",null,"最高 "+y(w((Ne=(_e=(Y=$.value)==null?void 0:Y.statistics)==null?void 0:_e[r.key])==null?void 0:Ne.max)),1)]),o("div",{class:"risk-bar",style:mt({background:B(r.key)})},null,4)],10,Go)}),64))]),o("section",Xo,[o("div",Jo,[o("header",Ko,[o("div",null,[o("h2",null,y(F(j.value))+"全矿区插值热力图",1),t[23]||(t[23]=o("p",null,"双击适配视图，拖拽平移，滚轮缩放",-1))]),o("div",Qo,[o("label",null,[t[24]||(t[24]=Pe("分辨率",-1)),De(o("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>R.value=r),type:"number",min:"20",max:"120",step:"5"},null,512),[[dt,R.value,void 0,{number:!0}]])]),o("label",null,[t[25]||(t[25]=Pe("线级",-1)),De(o("input",{"onUpdate:modelValue":t[5]||(t[5]=r=>I.value=r),type:"number",min:"5",max:"24",step:"1"},null,512),[[dt,I.value,void 0,{number:!0}]])]),o("label",null,[t[27]||(t[27]=Pe("插值 ",-1)),De(o("select",{"onUpdate:modelValue":t[6]||(t[6]=r=>H.value=r)},[...t[26]||(t[26]=[o("option",{value:"idw"},"反距离权重",-1),o("option",{value:"linear"},"线性插值",-1),o("option",{value:"nearest"},"最近邻",-1),o("option",{value:"kriging"},"克里金",-1)])],512),[[on,H.value]])]),o("label",ea,[De(o("input",{"onUpdate:modelValue":t[7]||(t[7]=r=>ae.value=r),type:"checkbox"},null,512),[[an,ae.value]]),t[28]||(t[28]=Pe("等值线",-1))]),o("label",ta,[De(o("input",{"onUpdate:modelValue":t[8]||(t[8]=r=>O.value=r),type:"checkbox"},null,512),[[an,O.value]]),t[29]||(t[29]=Pe("固定量程(0-100)",-1))])])]),Me.value?(ee(),te("div",na,[t[30]||(t[30]=o("span",{class:"trust-chip real"},"空间图：真实钻孔与坐标数据",-1)),o("span",oa,"评估："+y(Lt.value),1),Pt.value?(ee(),te("span",aa,"当前指标范围 "+y(w(St.value))+"，固定量程会压缩色差",1)):we("",!0),be.value!=="all"&&kt.value>0?(ee(),te("span",la," 联动高亮 "+y(zt(be.value))+" · "+y(kt.value)+"点 ",1)):we("",!0),Ke.value?(ee(),te("span",sa,"标签源 "+y(Ke.value),1)):we("",!0),o("span",ra,"钻孔 "+y(((i=$.value)==null?void 0:i.borehole_count)||0)+" 个 · 坐标源 zuobiao.csv",1)])):we("",!0),o("div",{ref_key:"stageContainer",ref:s,class:"stage",onPointerdown:hn,onPointermove:bn,onPointerup:gn,onPointercancel:xn,onPointerleave:wn,onWheel:ln(Sn,["prevent"]),onContextmenu:t[9]||(t[9]=ln(()=>{},["prevent"])),onDblclick:Et},[o("canvas",{ref_key:"heatmapCanvas",ref:c,class:"layer"},null,512),o("canvas",{ref_key:"overlayCanvas",ref:M,class:"layer"},null,512),de.value?(ee(),te("div",ia,[t[31]||(t[31]=o("div",{class:"skeleton"},null,-1)),t[32]||(t[32]=o("div",{class:"skeleton"},null,-1)),o("p",null,"正在计算 "+y(A.value||"目标煤层")+" 空间指标...",1)])):we("",!0)],544),o("footer",ua,[o("div",{class:"legend-track",style:mt({background:B(j.value)})},null,4),o("div",ca,[o("span",null,y(w(it.value.min)),1),o("span",null,y(w(it.value.mean)),1),o("span",null,y(w(it.value.max)),1)])])]),o("aside",{ref_key:"thumbPanelRef",ref:f,class:nt(["thumb-panel",{collapsed:xe.value}])},[o("header",null,[t[33]||(t[33]=o("h3",null,"指标缩略图",-1)),o("button",{class:"icon-btn mini",type:"button",onClick:t[10]||(t[10]=r=>xe.value=!xe.value)},y(xe.value?"展开":"收起"),1)]),o("div",da,[(ee(),te(Je,null,Ot(h,r=>{var S,_;return o("button",{key:`thumb-${r.key}`,class:nt(["thumb-item",{active:j.value===r.key}]),type:"button",onClick:N=>j.value=r.key,onMouseenter:N=>_n(r.key,N),onMousemove:N=>Yt(r.key,N),onMouseleave:kn},[o("canvas",{ref_for:!0,ref:ze(r.key),class:"thumb-canvas"},null,512),o("div",pa,[o("strong",null,y(r.label),1),o("span",null,"均值 "+y(w((S=je.value[r.key])==null?void 0:S.mean)),1),o("span",null,"σ "+y(w((_=je.value[r.key])==null?void 0:_.std)),1)])],42,ma)}),64))]),ve.visible&&Ge.value?(ee(),te("div",{key:0,class:"thumb-tooltip",style:mt({left:`${ve.x+12}px`,top:`${ve.y+12}px`})},[o("p",null,[o("strong",null,y(F(ve.metric))+"统计",1)]),o("p",null,"最小值 "+y(w(Ge.value.min)),1),o("p",null,"最大值 "+y(w(Ge.value.max)),1),o("p",null,"均值 "+y(w(Ge.value.mean)),1),o("p",null,"标准差 "+y(w(Ge.value.std)),1)],4)):we("",!0)],2)]),$e(rn,{name:"fade-up"},{default:sn(()=>[ne.value?(ee(),te("aside",va,[o("header",null,[t[34]||(t[34]=o("h3",null,"权重配置",-1)),o("button",{type:"button",class:"close-btn",onClick:t[11]||(t[11]=r=>ne.value=!1)},"×")]),t[38]||(t[38]=o("p",null,"RSI / BRI / ASI 自动归一化。调整后 300ms 内自动重算。",-1)),o("label",fa,[t[35]||(t[35]=o("span",null,"RSI",-1)),De(o("input",{"onUpdate:modelValue":t[12]||(t[12]=r=>V.rsi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[dt,V.rsi,void 0,{number:!0}]]),o("strong",null,y(T(Oe.value.rsi)),1)]),o("label",ya,[t[36]||(t[36]=o("span",null,"BRI",-1)),De(o("input",{"onUpdate:modelValue":t[13]||(t[13]=r=>V.bri=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[dt,V.bri,void 0,{number:!0}]]),o("strong",null,y(T(Oe.value.bri)),1)]),o("label",ha,[t[37]||(t[37]=o("span",null,"ASI",-1)),De(o("input",{"onUpdate:modelValue":t[14]||(t[14]=r=>V.asi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[dt,V.asi,void 0,{number:!0}]]),o("strong",null,y(T(Oe.value.asi)),1)])])):we("",!0)]),_:1}),$e(rn,{name:"drawer-up"},{default:sn(()=>{var r,S,_,N,P,se,fe,Y;return[pe.value?(ee(),te("section",ba,[o("header",null,[t[39]||(t[39]=o("h3",null,"算法评估面板（当前煤层批量结果）",-1)),o("div",ga,[o("button",{type:"button",class:"tool-btn small",onClick:$n},"导出数据"),o("button",{type:"button",class:"close-btn",onClick:t[15]||(t[15]=_e=>pe.value=!1)},"×")])]),ue.value?(ee(),te("div",xa,"正在计算评估指标...")):E.value?(ee(),te(Je,{key:2},[o("div",Sa,[o("div",_a,[t[40]||(t[40]=o("span",null,"AUC",-1)),o("strong",null,y(w(E.value.auc,4)),1)]),o("div",ka,[t[41]||(t[41]=o("span",null,"PR-AUC",-1)),o("strong",null,y(w(E.value.pr_auc,4)),1)]),o("div",Ca,[t[42]||(t[42]=o("span",null,"F1",-1)),o("strong",null,y(w(E.value.f1,4)),1)]),o("div",Aa,[t[43]||(t[43]=o("span",null,"Brier",-1)),o("strong",null,y(w(E.value.brier,4)),1)]),o("div",Na,[t[44]||(t[44]=o("span",null,"ECE",-1)),o("strong",null,y(w(E.value.ece,4)),1)])]),o("div",Ma,[o("div",Ia,[t[49]||(t[49]=o("h4",null,"混淆矩阵",-1)),o("div",$a,[o("div",Ra,[t[45]||(t[45]=o("span",null,"TN",-1)),o("b",null,y((S=(r=E.value.confusion_matrix)==null?void 0:r.tn)!=null?S:0),1)]),o("div",Fa,[t[46]||(t[46]=o("span",null,"FP",-1)),o("b",null,y((N=(_=E.value.confusion_matrix)==null?void 0:_.fp)!=null?N:0),1)]),o("div",Pa,[t[47]||(t[47]=o("span",null,"FN",-1)),o("b",null,y((se=(P=E.value.confusion_matrix)==null?void 0:P.fn)!=null?se:0),1)]),o("div",Ta,[t[48]||(t[48]=o("span",null,"TP",-1)),o("b",null,y((Y=(fe=E.value.confusion_matrix)==null?void 0:fe.tp)!=null?Y:0),1)])])]),o("div",La,[t[56]||(t[56]=o("h4",null,"基线对比（SVG）",-1)),(ee(),te("svg",za,[t[50]||(t[50]=o("rect",{x:"0",y:"0",width:"560",height:"170",fill:"#fff"},null,-1)),t[51]||(t[51]=o("text",{x:"14",y:"26"},"基线 MPI",-1)),t[52]||(t[52]=o("rect",{x:"112",y:"12",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"12",width:oe(_t.value),height:"18",rx:"9",fill:"#64748b"},null,8,Da),o("text",Ea,y(w(_t.value,3)),1),t[53]||(t[53]=o("text",{x:"14",y:"90"},"新算法 MPI",-1)),t[54]||(t[54]=o("rect",{x:"112",y:"76",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"76",width:oe(rt.value),height:"18",rx:"9",fill:"#0f766e"},null,8,Ba),o("text",Oa,y(w(rt.value,3)),1),t[55]||(t[55]=o("text",{x:"14",y:"148",fill:"#64748b"},"注：基于当前煤层批量钻孔的空间实证均值。",-1))]))])])],64)):(ee(),te("div",wa,y(he.value||"暂无评估数据"),1))])):we("",!0)]}),_:1}),Me.value?(ee(),te("section",Ua,[o("header",null,[t[58]||(t[58]=o("h3",null,"期刊级图组（自动生成）",-1)),t[59]||(t[59]=o("p",null,"全部图件已直接展示，满足对比、消融、校准、判别与机制解释需求。",-1)),t[60]||(t[60]=o("p",{class:"data-note"},"说明：评估与部分机制曲线目前为模型推导/示意，不等同于真实标签实验结果。",-1)),o("p",Va,[t[57]||(t[57]=Pe(" 图11支持点击 TP/TN/FP/FN 联动主图高亮。 ",-1)),be.value!=="all"?(ee(),te(Je,{key:0},[Pe("可按 Esc 快速清除筛选。")],64)):we("",!0),tt.value?we("",!0):(ee(),te(Je,{key:1},[Pe("当前样本与钻孔点未一一对齐，联动高亮不可用。")],64))]),t[61]||(t[61]=o("p",{class:"data-note"},"导出高清图与图组包时会自动冻结脉冲动画，保证稿件图件为静态一致版。",-1)),be.value!=="all"?(ee(),te("button",{key:0,type:"button",class:"tool-btn small",onClick:Gt},"清除联动高亮")):we("",!0),ke.value?(ee(),te("p",Wa,y(ke.value),1)):we("",!0)]),$e(Lo,{result:ut.value,evaluation:E.value,onMatrixSelect:yn},null,8,["result","evaluation"])])):we("",!0),J.value&&Me.value?(ee(),te("div",{key:1,class:"hover-tooltip",style:mt({left:`${Re.x+14}px`,top:`${Re.y+14}px`})},[o("p",null,"坐标："+y(w(J.value.worldX,2))+", "+y(w(J.value.worldY,2)),1),o("p",null,y(F(j.value))+"插值："+y(w(J.value.gridValue,3)),1),o("p",null,"最近钻孔："+y(((g=J.value.nearestBorehole)==null?void 0:g.borehole_name)||"--")+"（"+y(w(J.value.nearestDistance,1))+" m）",1),J.value.borehole?(ee(),te(Je,{key:0},[o("p",null,[o("strong",null,y(J.value.borehole.borehole_name),1)]),o("p",null,"RSI "+y(w(J.value.borehole.rsi,2))+" | BRI "+y(w(J.value.borehole.bri,2)),1),o("p",null,"ASI "+y(w(J.value.borehole.asi,2))+" | MPI "+y(w(J.value.borehole.mpi,2)),1),o("p",Ha,y(U(J.value.borehole.risk_label)),1)],64)):we("",!0)],4)):we("",!0)],512)}}},el=Wt(ja,[["__scopeId","data-v-0c0f0219"]]);export{el as default};
