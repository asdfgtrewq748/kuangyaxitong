var w=(L,I,f)=>new Promise((C,M)=>{var A=i=>{try{k(f.next(i))}catch(F){M(F)}},P=i=>{try{k(f.throw(i))}catch(F){M(F)}},k=i=>i.done?C(i.value):Promise.resolve(i.value).then(A,P);k((f=f.apply(L,I)).next())});import{u as Q,a as $}from"./vue-router-Dfza_nYx.js";import{_ as G,u as H,a as J}from"./index-D34UQVup.js";import{x as K,y as X,z as Y,A as Z,g as ss,b as ts,B as es,l as as}from"./api-DtdLAmLC.js";import{be as ns,b8 as v,b7 as s,bh as B,bn as os,bb as o,bc as D,b9 as z,b as O,b5 as b}from"./vendor-BiQoUjbf.js";import"./network-T6nY3V_4.js";const is={class:"page"},ls={class:"card"},ds={class:"action-buttons"},rs=["disabled"],cs={key:0,class:"spinner sm"},us={key:0,class:"report-content"},ms={class:"summary-cards"},ps={class:"card-title"},_s={class:"card-stats"},vs={class:"card-stat"},bs={class:"stat-value"},ys={class:"card-stat"},hs={class:"stat-value"},xs={class:"card-stat"},gs={class:"stat-value"},ks={class:"card-additional"},fs={key:0,class:"card"},Fs={class:"section-title"},Ps={class:"mpi-summary-grid"},Ss={class:"mpi-summary-item"},Is={class:"stat-value"},ws={class:"mpi-summary-item"},Ms={class:"stat-value"},Rs={class:"mpi-summary-item"},Ds={class:"stat-value"},zs={class:"mpi-summary-item"},Cs={class:"stat-value"},As={class:"mpi-summary-item"},js={class:"stat-value"},Bs={class:"mpi-summary-item"},Os={class:"stat-value"},Ls={class:"mpi-markers"},Ns={class:"mpi-marker"},Ts={class:"mpi-marker"},Vs={class:"card"},qs={class:"table-wrapper"},Es={class:"table"},Us={key:1,class:"empty-state"},Ws={__name:"Report",setup(L){const I=J(),f=Q(),C=$(),{setSelectedSeam:M,markStepDone:A}=H(),P=O(!1),k=O(null),i=O(null),F=new Map,T=()=>w(this,null,function*(){var n,t;P.value=!0;try{const y="idw",m="x",r="ascending",p="decrease",l="fixed",c="initial",[e,h,S,R]=yield Promise.all([K(y,60),X({method:y,grid_size:60,axis:m,count:3,direction:r,mode:p,decay:.08,elastic_modulus:.4,density:.3,tensile_strength:.3}),Y(l,c,60),Z({model:l,target:c,grid_size:60,axis:m,count:3,direction:r,mode:p,decay:.08})]);k.value=[{name:"çŸ¿å‹æŒ‡æ ‡",stats:e.data.grid},{name:"çŸ¿å‹æŒ‡æ ‡-å·¥ä½œé¢",stats:h.data.grid},{name:"æ¥å‹æ­¥è·",stats:S.data.grid},{name:"æ¥å‹æ­¥è·-å·¥ä½œé¢",stats:R.data.grid}],i.value=yield E(),A("Report",{reportGeneratedAt:new Date().toISOString()}),I.add("æŠ¥å‘Šç”Ÿæˆå®Œæˆ","success")}catch(y){I.add(((t=(n=y.response)==null?void 0:n.data)==null?void 0:t.detail)||"ç”Ÿæˆå¤±è´¥","error")}finally{P.value=!1}}),V=n=>w(this,null,function*(){if(!n)return null;if(F.has(n))return F.get(n);try{const{data:t}=yield as(n);return F.set(n,t),t}catch(t){return F.set(n,null),null}}),q=(...y)=>w(this,[...y],function*(n=[],t=""){var m,g;const x=[];for(const r of n){const p=r.layers||[],a=p.find(d=>d.name===t),l=p.filter(d=>d.name!==t),c=[];for(const d of l){const e=yield V(d.name);c.push({thickness:d.thickness||0,name:d.name||"",density:e==null?void 0:e.density,bulk_modulus:e==null?void 0:e.bulk_modulus,shear_modulus:e==null?void 0:e.shear_modulus,cohesion:e==null?void 0:e.cohesion,friction_angle:e==null?void 0:e.friction_angle,tensile_strength:e==null?void 0:e.tensile_strength,compressive_strength:e==null?void 0:e.compressive_strength,elastic_modulus:e==null?void 0:e.elastic_modulus,poisson_ratio:e==null?void 0:e.poisson_ratio})}const u=(g=(m=r.seam_top_depth)!=null?m:r.total_overburden_thickness)!=null?g:0,_=(a==null?void 0:a.thickness)||0;x.push({x:r.x,y:r.y,borehole:r.name,thickness:_,burial_depth:u,z_top:u,z_bottom:u+_,strata:c})}return x}),E=()=>w(this,null,function*(){try{const{data:n}=yield ss(),t=n.seams||[];if(t.length===0)return null;const y=t[0].name,{data:x}=yield ts(y),m=x.boreholes||[];if(m.length===0)return null;const g=yield q(m,y),{data:r}=yield es(g),p=r.results||[],a=p.reduce((e,h)=>{var S,R,N;return e.rsi+=((S=h.breakdown)==null?void 0:S.rsi)||0,e.bri+=((R=h.breakdown)==null?void 0:R.bri)||0,e.asi+=((N=h.breakdown)==null?void 0:N.asi)||0,e},{rsi:0,bri:0,asi:0}),l=p.length||1,c={rsi:a.rsi/l,bri:a.bri/l,asi:a.asi/l},u=[...p].sort((e,h)=>e.mpi-h.mpi),_=u.slice(0,3),d=u.slice(-3).reverse();return{seamName:y,stats:r.summary||{},breakdown:c,high:d,low:_}}catch(n){return null}}),j=n=>Array.isArray(n)?n[0]||"":typeof n=="string"?n:"",U=()=>{var n,t;C.push({name:"AlgorithmValidation",query:j((n=f.query)==null?void 0:n.seam)?{seam:j((t=f.query)==null?void 0:t.seam)}:void 0})},W=()=>{var g,r,p,a;const n=k.value.map(l=>{var c,u,_,d,e,h,S;return{æŒ‡æ ‡:l.name,æœ€å°å€¼:(c=l.stats.min)==null?void 0:c.toFixed(3),æœ€å¤§å€¼:(u=l.stats.max)==null?void 0:u.toFixed(3),å¹³å‡å€¼:(_=l.stats.mean)==null?void 0:_.toFixed(3),æ ‡å‡†å·®:(d=l.stats.std)==null?void 0:d.toFixed(3),P10:(e=l.stats.p10)==null?void 0:e.toFixed(3),P50:(h=l.stats.p50)==null?void 0:h.toFixed(3),P90:(S=l.stats.p90)==null?void 0:S.toFixed(3)}});i.value&&n.push({æŒ‡æ ‡:`MPIç»¼åˆæŒ‡æ ‡ï¼ˆ${i.value.seamName}ï¼‰`,æœ€å°å€¼:(g=i.value.stats.min)==null?void 0:g.toFixed(3),æœ€å¤§å€¼:(r=i.value.stats.max)==null?void 0:r.toFixed(3),å¹³å‡å€¼:(p=i.value.stats.mean)==null?void 0:p.toFixed(3),æ ‡å‡†å·®:(a=i.value.stats.std)==null?void 0:a.toFixed(3),P10:"",P50:"",P90:""});const t=[Object.keys(n[0]).join(","),...n.map(l=>Object.values(l).join(","))].join(`
`),y=new Blob([t],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(y),m=document.createElement("a");m.href=x,m.download=`pressure_report_${new Date().toISOString().slice(0,10)}.csv`,m.click(),URL.revokeObjectURL(x),I.add("æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ","success")};return ns(()=>{var t;const n=j((t=f.query)==null?void 0:t.seam);n&&M(n)}),(n,t)=>{var y,x,m,g,r,p;return b(),v("div",is,[t[17]||(t[17]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"ğŸ“‘ ç»“æœæŠ¥å‘Š"),s("p",{class:"page-subtitle"},"ç”Ÿæˆç»¼åˆåˆ†ææŠ¥å‘Šï¼Œæ±‡æ€»æ‰€æœ‰è®¡ç®—ç»“æœ")],-1)),s("div",ls,[t[0]||(t[0]=s("h3",{class:"section-title"},"ç”ŸæˆæŠ¥å‘Š",-1)),t[1]||(t[1]=s("p",{class:"section-desc"},"ç‚¹å‡»ç”ŸæˆæŒ‰é’®è·å–å®Œæ•´çš„åˆ†ææŠ¥å‘Š",-1)),s("div",ds,[s("button",{class:"btn primary",onClick:T,disabled:P.value},[P.value?(b(),v("span",cs)):B("",!0),os(" "+o(P.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆç»¼åˆæŠ¥å‘Š"),1)],8,rs),k.value?(b(),v("button",{key:0,class:"btn secondary",onClick:W}," å¯¼å‡ºæŠ¥å‘Š ")):B("",!0),s("button",{class:"btn secondary",onClick:U}," è¿”å›å®è¯é¡µ ")])]),k.value?(b(),v("div",us,[s("div",ms,[(b(!0),v(D,null,z(k.value,a=>{var l,c,u,_,d;return b(),v("div",{key:a.name,class:"summary-card"},[s("div",ps,o(a.name),1),s("div",_s,[s("div",vs,[t[2]||(t[2]=s("span",{class:"stat-label"},"æœ€å°å€¼",-1)),s("span",bs,o(((l=a.stats.min)==null?void 0:l.toFixed(3))||"-"),1)]),s("div",ys,[t[3]||(t[3]=s("span",{class:"stat-label"},"æœ€å¤§å€¼",-1)),s("span",hs,o(((c=a.stats.max)==null?void 0:c.toFixed(3))||"-"),1)]),s("div",xs,[t[4]||(t[4]=s("span",{class:"stat-label"},"å¹³å‡å€¼",-1)),s("span",gs,o(((u=a.stats.mean)==null?void 0:u.toFixed(3))||"-"),1)])]),s("div",ks,[s("span",null,"æ ‡å‡†å·®: "+o(((_=a.stats.std)==null?void 0:_.toFixed(3))||"-"),1),s("span",null,"P50: "+o(((d=a.stats.p50)==null?void 0:d.toFixed(3))||"-"),1)])])}),128))]),i.value?(b(),v("div",fs,[s("h3",Fs,"MPIä¸“é¢˜åˆ†æï¼ˆ"+o(i.value.seamName)+"ï¼‰",1),t[13]||(t[13]=s("p",{class:"section-desc"},"ç»¼åˆMPIä¸åˆ†é¡¹æŒ‡æ ‡ç»Ÿè®¡ï¼Œå¹¶æ ‡æ³¨é«˜/ä½MPIåŒºåŸŸ",-1)),s("div",Ps,[s("div",Ss,[t[5]||(t[5]=s("span",{class:"stat-label"},"MPIæœ€å°å€¼",-1)),s("span",Is,o(((y=i.value.stats.min)==null?void 0:y.toFixed(2))||"-"),1)]),s("div",ws,[t[6]||(t[6]=s("span",{class:"stat-label"},"MPIæœ€å¤§å€¼",-1)),s("span",Ms,o(((x=i.value.stats.max)==null?void 0:x.toFixed(2))||"-"),1)]),s("div",Rs,[t[7]||(t[7]=s("span",{class:"stat-label"},"MPIå¹³å‡å€¼",-1)),s("span",Ds,o(((m=i.value.stats.mean)==null?void 0:m.toFixed(2))||"-"),1)]),s("div",zs,[t[8]||(t[8]=s("span",{class:"stat-label"},"RSIå¹³å‡å€¼",-1)),s("span",Cs,o(((g=i.value.breakdown.rsi)==null?void 0:g.toFixed(2))||"-"),1)]),s("div",As,[t[9]||(t[9]=s("span",{class:"stat-label"},"BRIå¹³å‡å€¼",-1)),s("span",js,o(((r=i.value.breakdown.bri)==null?void 0:r.toFixed(2))||"-"),1)]),s("div",Bs,[t[10]||(t[10]=s("span",{class:"stat-label"},"ASIå¹³å‡å€¼",-1)),s("span",Os,o(((p=i.value.breakdown.asi)==null?void 0:p.toFixed(2))||"-"),1)])]),s("div",Ls,[s("div",Ns,[t[11]||(t[11]=s("div",{class:"mpi-marker-title"},"é«˜MPIåŒºåŸŸï¼ˆä½é£é™©ï¼‰",-1)),s("ul",null,[(b(!0),v(D,null,z(i.value.high,a=>(b(),v("li",{key:a.id},o(a.id)+"ï¼šMPI "+o(a.mpi.toFixed(2)),1))),128))])]),s("div",Ts,[t[12]||(t[12]=s("div",{class:"mpi-marker-title"},"ä½MPIåŒºåŸŸï¼ˆé«˜é£é™©ï¼‰",-1)),s("ul",null,[(b(!0),v(D,null,z(i.value.low,a=>(b(),v("li",{key:a.id},o(a.id)+"ï¼šMPI "+o(a.mpi.toFixed(2)),1))),128))])])])])):B("",!0),s("div",Vs,[t[15]||(t[15]=s("h3",{class:"section-title"},"è¯¦ç»†ç»Ÿè®¡æ•°æ®",-1)),s("div",qs,[s("table",Es,[t[14]||(t[14]=s("thead",null,[s("tr",null,[s("th",null,"æŒ‡æ ‡"),s("th",null,"æœ€å°å€¼"),s("th",null,"æœ€å¤§å€¼"),s("th",null,"å¹³å‡å€¼"),s("th",null,"æ ‡å‡†å·®"),s("th",null,"P10"),s("th",null,"P50"),s("th",null,"P90")])],-1)),s("tbody",null,[(b(!0),v(D,null,z(k.value,a=>{var l,c,u,_,d,e,h;return b(),v("tr",{key:a.name},[s("td",null,[s("strong",null,o(a.name),1)]),s("td",null,o(((l=a.stats.min)==null?void 0:l.toFixed(3))||"-"),1),s("td",null,o(((c=a.stats.max)==null?void 0:c.toFixed(3))||"-"),1),s("td",null,o(((u=a.stats.mean)==null?void 0:u.toFixed(3))||"-"),1),s("td",null,o(((_=a.stats.std)==null?void 0:_.toFixed(3))||"-"),1),s("td",null,o(((d=a.stats.p10)==null?void 0:d.toFixed(3))||"-"),1),s("td",null,o(((e=a.stats.p50)==null?void 0:e.toFixed(3))||"-"),1),s("td",null,o(((h=a.stats.p90)==null?void 0:h.toFixed(3))||"-"),1)])}),128))])])])])])):(b(),v("div",Us,[...t[16]||(t[16]=[s("div",{class:"empty-icon"},"ğŸ“Š",-1),s("p",null,"æš‚æ— æŠ¥å‘Šæ•°æ®",-1),s("p",{class:"empty-hint"},"è¯·å…ˆå®Œæˆæ•°æ®åˆ†æåå†ç”ŸæˆæŠ¥å‘Š",-1)])]))])}}},Xs=G(Ws,[["__scopeId","data-v-ea0738ee"]]);export{Xs as default};
