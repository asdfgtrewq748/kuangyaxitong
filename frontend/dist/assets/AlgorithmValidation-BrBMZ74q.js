var Un=Object.defineProperty,Vn=Object.defineProperties;var Wn=Object.getOwnPropertyDescriptors;var tn=Object.getOwnPropertySymbols;var Hn=Object.prototype.hasOwnProperty,jn=Object.prototype.propertyIsEnumerable;var on=Math.pow,nn=(g,Y,x)=>Y in g?Un(g,Y,{enumerable:!0,configurable:!0,writable:!0,value:x}):g[Y]=x,X=(g,Y)=>{for(var x in Y||(Y={}))Hn.call(Y,x)&&nn(g,x,Y[x]);if(tn)for(var x of tn(Y))jn.call(Y,x)&&nn(g,x,Y[x]);return g},J=(g,Y)=>Vn(g,Wn(Y));var Ce=(g,Y,x)=>new Promise((Ae,v)=>{var ce=z=>{try{W(x.next(z))}catch(s){v(s)}},h=z=>{try{W(x.throw(z))}catch(s){v(s)}},W=z=>z.done?Ae(z.value):Promise.resolve(z.value).then(ce,h);W((x=x.apply(g,Y)).next())});import{_ as Wt,u as Gn,b as qn}from"./index-C6WNepMi.js";import{r as $t,bB as Yn,bC as Zn,bA as Xn,bf as mn,n as Vt,w as ze,b4 as pn,b5 as Q,b8 as ee,bn as ct,b as ne,c as m,b7 as a,bb as f,bi as he,ba as tt,bj as $e,u as Jn,br as Ee,bv as an,bc as Xe,b9 as Ot,bo as Fe,bs as ut,bt as ln,bm as sn,bh as rn,bx as un,a as Kn}from"./vendor-CA5Q5CdR.js";import{a as Qn,u as eo}from"./vue-router-D9BXaJFq.js";import{g as to,v as no,n as oo}from"./api-CfsGh-st.js";import"./echarts-CG3_94Cz.js";import{i as ao}from"./echarts-Dy-VGqd_.js";import"./network-T6nY3V_4.js";function lo(){const g=$t({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),Y=(z,s,y)=>{if(!y)return{x:0,y:0};const c=z-y.min_x,M=y.max_y-s;return{x:c*g.scale+g.x,y:M*g.scale+g.y}},x=(z,s,y)=>{if(!y||g.scale===0)return{x:0,y:0};const c=(z-g.x)/g.scale,M=(s-g.y)/g.scale;return{x:y.min_x+c,y:y.max_y-M}};return{viewport:g,worldToScreen:Y,screenToWorld:x,fitToBounds:(z,s,y,c=56)=>{if(!z||!s||!y)return;const M=Math.max(z.max_x-z.min_x,1e-6),D=Math.max(z.max_y-z.min_y,1e-6),k=Math.min((s-c*2)/M,(y-c*2)/D),R=(z.min_x+z.max_x)/2,I=(z.min_y+z.max_y)/2;g.scale=Math.max(.01,k),g.x=s/2-(R-z.min_x)*g.scale,g.y=y/2-(z.max_y-I)*g.scale},startDrag:(z,s)=>{g.isDragging=!0,g.lastX=z,g.lastY=s},dragTo:(z,s)=>{g.isDragging&&(g.x+=z-g.lastX,g.y+=s-g.lastY,g.lastX=z,g.lastY=s)},endDrag:()=>{g.isDragging=!1},zoomAt:(z,s,y,c,M=.1,D=50)=>{if(!c)return;const k=Math.max(M,Math.min(D,g.scale*z));if(k===g.scale)return;const R=x(s,y,c);g.scale=k,g.x=s-(R.x-c.min_x)*g.scale,g.y=y-(c.max_y-R.y)*g.scale}}}const cn={mpi:["#0e7490","#14b8a6","#facc15","#fb923c","#dc2626"],rsi:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],bri:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],asi:["#0e7490","#14b8a6","#84cc16","#f59e0b","#dc2626"]},Ut=g=>Math.max(0,Math.min(1,g)),so=g=>{const x=String(g||"").match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return x?{r:Number(x[1]),g:Number(x[2]),b:Number(x[3])}:null},ro=(g,Y=.8)=>{const x=so(g);if(!x)return"#94a3b8";const Ae=Math.round(x.r*.299+x.g*.587+x.b*.114),v=Math.round(Ae*Y+235*(1-Y));return`rgb(${v},${v},${v})`},dn=g=>{var Ae,v;const Y=Number((Ae=g==null?void 0:g.min)!=null?Ae:0),x=Number((v=g==null?void 0:g.max)!=null?v:100);return!Number.isFinite(Y)||!Number.isFinite(x)||Y===x?{min:0,max:100}:{min:Y,max:x}};function io(){const g=s=>cn[s]||cn.mpi,Y=s=>`linear-gradient(90deg, ${g(s).join(",")})`,x=(s,y,c)=>{const{min:M,max:D}=dn(c),k=Ut((Number(y)-M)/(D-M));return Yn(g(s))(k)},Ae=(s,y,c,M,D,k,R={})=>{var N;const I=y.length,H=((N=y[0])==null?void 0:N.length)||0;if(I<2||H<2)return;const le=new Array(I*H);let U=0;for(let B=0;B<I;B+=1)for(let ue=0;ue<H;ue+=1)le[U]=Number(y[B][ue]||0),U+=1;const{min:G,max:de}=dn(D),me=Math.max(5,Number(R.contourLevels||9)),oe=Zn(G,de,me).slice(1,-1);if(!oe.length)return;const pe=Xn().size([H,I]).thresholds(oe)(le),we=Math.max(c.max_x-c.min_x,1e-6),V=Math.max(c.max_y-c.min_y,1e-6);s.save(),s.strokeStyle=R.contourColor||"rgba(15,23,42,0.32)",s.lineWidth=M.scale>2?1.2:.9,s.globalAlpha=M.scale<.65?.45:.7;for(const B of pe)for(const ue of B.coordinates)for(const be of ue)if(!(!Array.isArray(be)||be.length<2)){s.beginPath();for(let re=0;re<be.length;re+=1){const ke=be[re],K=c.min_x+ke[0]/Math.max(H-1,1)*we,Re=c.max_y-ke[1]/Math.max(I-1,1)*V,ve=k(K,Re,c);re===0?s.moveTo(ve.x,ve.y):s.lineTo(ve.x,ve.y)}s.closePath(),s.stroke()}s.restore()};return{getLegendGradient:Y,drawGrid:(s,y,c,M,D,k,R,I={})=>{var we;if(!s||!Array.isArray(y)||y.length===0||!c)return;const H=y.length,le=((we=y[0])==null?void 0:we.length)||0;if(!le)return;const U=c.max_x-c.min_x,G=c.max_y-c.min_y,de=U/le,me=G/H,oe=s.canvas.width,pe=s.canvas.height;for(let V=0;V<H;V+=1){const N=y[V],B=c.max_y-V*me;for(let ue=0;ue<le;ue+=1){const be=c.min_x+ue*de,re=R(be,B,c),ke=R(be+de,B-me,c),K=Math.min(re.x,ke.x),Re=Math.min(re.y,ke.y),ve=Math.abs(ke.x-re.x)+.8,q=Math.abs(ke.y-re.y)+.8;K>oe||K+ve<0||Re>pe||Re+q<0||(s.fillStyle=x(D,Number(N[ue]||0),k),s.fillRect(K,Re,ve,q))}}if(I.showContours!==!1&&Ae(s,y,c,M,k,R,I),M.scale>3.2){s.strokeStyle="rgba(255,255,255,0.18)",s.lineWidth=1,s.beginPath();for(let V=0;V<=H;V+=1){const N=c.max_y-V*me,B=R(c.min_x,N,c),ue=R(c.max_x,N,c);s.moveTo(B.x,B.y),s.lineTo(ue.x,ue.y)}for(let V=0;V<=le;V+=1){const N=c.min_x+V*de,B=R(N,c.min_y,c),ue=R(N,c.max_y,c);s.moveTo(B.x,B.y),s.lineTo(ue.x,ue.y)}s.stroke()}},drawBoreholes:(s,y,c,M,D,k,R="",I=null)=>{if(!s||!Array.isArray(y)||!D)return;const H=!!(I!=null&&I.active&&(I==null?void 0:I.indexSet)instanceof Set&&I.indexSet.size>0),le=String((I==null?void 0:I.accent)||"#111827"),U=!!(I!=null&&I.animate),G=Number((I==null?void 0:I.pulseT)||0);for(let de=0;de<y.length;de+=1){const me=y[de],oe=k(me.x,me.y,D),pe=R&&R===me.borehole_name,we=!H||I.indexSet.has(de),V=U&&H&&we?(Math.sin(G*5+de*.35)+1)/2:0,N=pe?7.5:we&&H?6.6:5.8;s.save();const B=x(c,me[c],M);s.globalAlpha=H&&!we?.24:1,s.fillStyle=H&&!we?ro(B,.84):B,s.strokeStyle=pe?"#111827":we&&H?le:"rgba(255,255,255,0.95)",s.lineWidth=pe?2.4:1.8,s.beginPath(),s.arc(oe.x,oe.y,N,0,Math.PI*2),s.fill(),s.stroke(),we&&H&&!pe&&(s.globalAlpha=.95,s.strokeStyle=le,s.lineWidth=2,s.beginPath(),s.arc(oe.x,oe.y,N+3.6,0,Math.PI*2),s.stroke(),U&&(s.globalAlpha=.35+V*.45,s.lineWidth=1.6+V*.9,s.beginPath(),s.arc(oe.x,oe.y,N+6+V*5.5,0,Math.PI*2),s.stroke())),s.restore()}},pickNearestBorehole:(s,y,c,M,D,k=14)=>{if(!Array.isArray(c)||!M)return null;let R=null,I=Number.POSITIVE_INFINITY;for(const H of c){const le=D(H.x,H.y,M),U=Math.hypot(s-le.x,y-le.y);U<I&&(I=U,R=H)}return I<=k?R:null},sampleGridValue:(s,y,c,M)=>{var U;if(!Array.isArray(s)||s.length===0||!y)return null;const D=s.length,k=((U=s[0])==null?void 0:U.length)||0;if(!k)return null;const R=Ut((c-y.min_x)/Math.max(y.max_x-y.min_x,1e-6)),I=Ut((y.max_y-M)/Math.max(y.max_y-y.min_y,1e-6)),H=Math.max(0,Math.min(k-1,Math.floor(R*(k-1)))),le=Math.max(0,Math.min(D-1,Math.floor(I*(D-1))));return Number(s[le][H])},drawMiniHeatmap:(s,y,c,M)=>{var de;if(!s||!Array.isArray(y)||y.length===0)return;const D=window.devicePixelRatio||1,k=s.clientWidth||150,R=s.clientHeight||110;s.width=Math.round(k*D),s.height=Math.round(R*D);const I=s.getContext("2d");I.setTransform(D,0,0,D,0,0),I.clearRect(0,0,k,R);const H=y.length,le=((de=y[0])==null?void 0:de.length)||0;if(!le)return;const U=k/le,G=R/H;for(let me=0;me<H;me+=1)for(let oe=0;oe<le;oe+=1)I.fillStyle=x(c,Number(y[me][oe]||0),M),I.fillRect(oe*U,me*G,U+.4,G+.4);I.strokeStyle="rgba(255,255,255,0.35)",I.strokeRect(0,0,k,R)}}}const uo={__name:"ScienceChart",props:{option:{type:Object,required:!0},height:{type:[String,Number],default:320}},emits:["chart-click"],setup(g,{emit:Y}){const x=g,Ae=Y,v=ne(null);let ce=null,h=null;const W=m(()=>typeof x.height=="number"?`${x.height}px`:x.height),z=()=>{ce&&ce.setOption(x.option||{},{notMerge:!0,lazyUpdate:!0,silent:!0})},s=()=>{ce&&ce.resize()},y=D=>{Ae("chart-click",D)},c=()=>{if(v.value){if(typeof ResizeObserver!="undefined"){h=new ResizeObserver(()=>{s()}),h.observe(v.value);return}window.addEventListener("resize",s)}},M=()=>{h?(h.disconnect(),h=null):window.removeEventListener("resize",s)};return mn(()=>Ce(this,null,function*(){yield Vt(),v.value&&(ce=ao(v.value,null,{renderer:"canvas"}),ce.on("click",y),z(),c())})),ze(()=>x.option,()=>{z()}),ze(()=>x.height,()=>Ce(this,null,function*(){yield Vt(),s()})),pn(()=>{M(),ce&&(ce.off("click",y),ce.dispose(),ce=null)}),(D,k)=>(Q(),ee("div",{ref_key:"container",ref:v,class:"science-chart",style:ct({height:W.value})},null,4))}},Le=Wt(uo,[["__scopeId","data-v-40fa2a4e"]]),co={class:"science-gallery"},mo={class:"gallery-head"},po={class:"head-metrics"},vo={class:"metric-chip"},fo={class:"metric-chip"},yo={key:0,class:"metric-chip"},ho={key:1,class:"metric-chip"},bo={class:"figure-card"},go={class:"caption meta"},xo={class:"figure-card"},wo={class:"caption meta"},_o={class:"figure-card"},So={class:"caption meta"},ko={class:"figure-card"},Co={class:"caption meta"},Ao={class:"figure-card"},Mo={class:"caption meta"},No={class:"figure-card"},Io={class:"caption meta"},$o={class:"figure-card"},Ro={class:"caption meta"},Po={class:"figure-card"},Fo={class:"caption meta"},To={class:"figure-card"},Lo={class:"caption meta"},zo={class:"figure-card"},Eo={class:"caption meta"},xe="'Times New Roman', 'Noto Serif SC', 'Source Han Serif SC', serif",Do={__name:"ValidationScienceFigures",props:{result:{type:Object,default:null},evaluation:{type:Object,default:null}},emits:["matrix-select"],setup(g,{emit:Y}){const x=g,Ae=Y,v={blue:"#1d4ed8",cyan:"#0891b2",green:"#15803d",orange:"#d97706",red:"#b91c1c",purple:"#7c3aed",slate:"#475569"},ce={left:66,right:26,top:46,bottom:62},h=(t,n,l)=>Math.max(n,Math.min(l,t)),W=(t,n=0)=>{const l=Number(t);return Number.isFinite(l)?l:n},z=t=>`${(h(W(t,0),0,1)*100).toFixed(1)}%`,s=(t,n=3)=>Number(W(t,0).toFixed(n)),y=(t,n,l=0)=>n>0?t/n:l,c=(t,n=!0)=>({type:n?"value":"category",name:t,nameLocation:"middle",nameGap:38,nameTextStyle:{fontFamily:xe,fontSize:12,color:"#0f172a"},axisLabel:{fontFamily:xe,fontSize:11,color:"#0f172a"},axisLine:{lineStyle:{color:"#0f172a",width:1.15}},axisTick:{lineStyle:{color:"#334155",width:1}},splitLine:{show:!0,lineStyle:{color:"#e2e8f0",width:.8,type:"dashed"}}}),M={top:6,textStyle:{fontFamily:xe,fontSize:11,color:"#0f172a"}},D={right:8,top:6,itemSize:14,iconStyle:{borderColor:"#334155"},feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"框选缩放",back:"还原缩放"}},restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}},k=[{type:"inside",xAxisIndex:0,filterMode:"none",zoomOnMouseWheel:"ctrl",moveOnMouseMove:!0}],R=m(()=>{var t;return((t=x.result)==null?void 0:t.evaluation_inputs)||{}}),I=m(()=>{var n,l;const t=((n=R.value)==null?void 0:n.mode)||((l=R.value)==null?void 0:l.source)||"pseudo_threshold";return String(t)}),H=m(()=>{var t,n;return String(((t=R.value)==null?void 0:t.source)||((n=R.value)==null?void 0:n.sourceFile)||"")}),le=m(()=>I.value==="real_label_stream"?"真实标签流":I.value==="pseudo_threshold"?"伪标签估计":"未知"),U=m(()=>{var d,_,F,E;const t=Array.isArray((d=R.value)==null?void 0:d.y_true)?R.value.y_true:Array.isArray((_=R.value)==null?void 0:_.yTrue)?R.value.yTrue:[],n=Array.isArray((F=R.value)==null?void 0:F.y_prob)?R.value.y_prob:Array.isArray((E=R.value)==null?void 0:E.yProb)?R.value.yProb:[],l=Math.min(t.length,n.length),u=[];for(let j=0;j<l;j+=1){const P=W(t[j],0)>=1?1:0,$=h(W(n[j],0),0,1);u.push({y:P,p:$})}return u}),G=m(()=>U.value.length),de=m(()=>U.value.filter(t=>t.y===1).length),me=m(()=>G.value-de.value),oe=m(()=>y(de.value,Math.max(G.value,1),0)),pe=m(()=>G.value>=6&&de.value>0&&me.value>0),we=m(()=>{const t=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const n of U.value)t.push(Number(n.p.toFixed(3)));return Array.from(new Set(t.map(n=>h(n,0,1)))).sort((n,l)=>l-n)}),V=t=>{let n=0,l=0,u=0,d=0;for(const O of U.value){const C=O.p>=t?1:0;O.y===1&&C===1?n+=1:O.y===1&&C===0?d+=1:O.y===0&&C===1?l+=1:u+=1}const _=y(n,n+d,0),F=y(n,n+l,0),E=y(u,u+l,0),j=y(l,l+u,0),P=y(n+u,n+u+l+d,0),$=y(2*F*_,F+_,0);return{threshold:t,tp:n,fp:l,tn:u,fn:d,recall:_,precision:F,specificity:E,fpr:j,accuracy:P,f1:$}},N=m(()=>we.value.map(t=>V(t))),B=m(()=>{if(!pe.value)return[[0,0],[.06,.28],[.15,.54],[.33,.75],[.56,.89],[1,1]];const t=N.value.map(n=>[n.fpr,n.recall]);return t.push([0,0],[1,1]),t.sort((n,l)=>n[0]-l[0]||n[1]-l[1]),t}),ue=m(()=>{if(!pe.value)return[[0,1],[.15,.9],[.35,.82],[.55,.73],[.75,.61],[1,.5]];const t=N.value.map(n=>[n.recall,n.precision]);return t.push([0,1],[1,oe.value]),t.sort((n,l)=>n[0]-l[0]||l[1]-n[1]),t}),be=t=>{let n=0;for(let l=1;l<t.length;l+=1){const[u,d]=t[l-1],[_,F]=t[l];n+=(_-u)*((d+F)/2)}return h(n,0,1)},re=(t,n,l=0)=>{const u=t.filter(j=>Number.isFinite(j)).slice().sort((j,P)=>j-P);if(!u.length)return l;const d=h(n,0,1)*(u.length-1),_=Math.floor(d),F=Math.min(u.length-1,_+1),E=d-_;return u[_]*(1-E)+u[F]*E},ke=(t,n)=>{if(!Array.isArray(t)||t.length===0)return 0;if(t.length===1||n<=t[0][0])return h(W(t[0][1],0),0,1);for(let l=1;l<t.length;l+=1){const[u,d]=t[l-1],[_,F]=t[l];if(n<=_){if(Math.abs(_-u)<1e-12)return h(Math.max(d,F),0,1);const E=(n-u)/(_-u);return h(d+(F-d)*E,0,1)}}return h(W(t[t.length-1][1],0),0,1)},K=t=>{const n=t.length,l=t.reduce((P,$)=>P+($.y>=1?1:0),0),u=n-l;if(n<2||l<=0||u<=0)return{roc:[[0,0],[1,1]],pr:[[0,1],[1,h(y(l,Math.max(n,1),0),0,1)]],auc:.5,prAuc:.5};const d=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const P of t)d.push(Number(P.p.toFixed(3)));const _=Array.from(new Set(d.map(P=>h(P,0,1)))).sort((P,$)=>$-P),F=[],E=[];for(const P of _){let $=0,O=0,C=0,p=0;for(const ae of t){const Te=ae.p>=P?1:0;ae.y===1&&Te===1?$+=1:ae.y===1&&Te===0?p+=1:ae.y===0&&Te===1?O+=1:C+=1}const L=y($,$+p,0),ie=y($,$+O,0),te=y(O,O+C,0);F.push([te,L]),E.push([L,ie])}F.push([0,0],[1,1]),F.sort((P,$)=>P[0]-$[0]||P[1]-$[1]);const j=h(y(l,n,0),0,1);return E.push([0,1],[1,j]),E.sort((P,$)=>P[0]-$[0]||$[1]-P[1]),{roc:F,pr:E,auc:be(F),prAuc:be(E)}},Re=m(()=>{let t=2166136261;for(let n=0;n<U.value.length;n+=1){const l=U.value[n],u=l.y>=1?1:0,d=Math.round(h(l.p,0,1)*1e3);t^=u*733+d*31+n*131>>>0,t=Math.imul(t,16777619)>>>0}return t||1315423911}),ve=m(()=>pe.value?G.value<=60?240:G.value<=180?180:120:0),q=m(()=>{if(!pe.value)return null;const t=U.value.length,n=ve.value;if(n<=0||t<6)return null;const l=Array.from({length:21},(p,L)=>L/20),u=l.map(()=>[]),d=l.map(()=>[]),_=[],F=[];let E=Re.value>>>0;const j=()=>{E+=1831565813;let p=E;return p=Math.imul(p^p>>>15,p|1),p^=p+Math.imul(p^p>>>7,p|61),((p^p>>>14)>>>0)/4294967296};for(let p=0;p<n;p+=1){const L=[];for(let te=0;te<t;te+=1)L.push(U.value[Math.floor(j()*t)]);const ie=K(L);_.push(ie.auc),F.push(ie.prAuc);for(let te=0;te<l.length;te+=1){const ae=l[te];u[te].push(ke(ie.roc,ae)),d[te].push(ke(ie.pr,ae))}}const P=u.map(p=>re(p,.025,0)),$=u.map(p=>re(p,.975,1)),O=d.map(p=>re(p,.025,0)),C=d.map(p=>re(p,.975,1));return{iterations:n,grid:l,rocLow:P,rocHigh:$,prLow:O,prHigh:C,aucLow:h(re(_,.025,Be.value),0,1),aucHigh:h(re(_,.975,Be.value),0,1),prAucLow:h(re(F,.025,He.value),0,1),prAucHigh:h(re(F,.975,He.value),0,1)}}),Je=m(()=>q.value?{low:q.value.grid.map((t,n)=>[t,q.value.rocLow[n]]),high:q.value.grid.map((t,n)=>[t,q.value.rocHigh[n]])}:{low:[],high:[]}),ge=m(()=>q.value?q.value.grid.map((t,n)=>[t,Math.max(q.value.rocHigh[n]-q.value.rocLow[n],0)]):[]),ye=m(()=>q.value?{low:q.value.grid.map((t,n)=>[t,q.value.prLow[n]]),high:q.value.grid.map((t,n)=>[t,q.value.prHigh[n]])}:{low:[],high:[]}),Ke=m(()=>q.value?q.value.grid.map((t,n)=>[t,Math.max(q.value.prHigh[n]-q.value.prLow[n],0)]):[]),nt=m(()=>be(B.value)),ot=m(()=>be(ue.value)),De=m(()=>pe.value?N.value.reduce((t,n)=>{const l=n.recall-n.fpr;return l>t.j?J(X({},n),{j:l}):t},{threshold:.5,fpr:1,recall:0,j:-1}):{threshold:.5,fpr:.22,recall:.78,j:.56}),dt=m(()=>pe.value?N.value.reduce((t,n)=>n.f1>t.f1?n:t,N.value[0]||{threshold:.5,recall:0,precision:0,f1:0}):{threshold:.5,recall:.74,precision:.78,f1:.76}),at=m(()=>{if(!U.value.length)return .25;const t=U.value.reduce((n,l)=>n+on(l.p-l.y,2),0);return h(t/U.value.length,0,1)}),We=m(()=>{if(!pe.value)return{centers:[.1,.22,.34,.46,.58,.7,.82,.94],pred:[.11,.23,.36,.45,.57,.69,.8,.9],obs:[.14,.2,.31,.49,.55,.63,.78,.89],lower:[.04,.08,.19,.31,.39,.47,.63,.74],band:[.2,.24,.24,.18,.16,.16,.15,.15],count:[4,6,8,11,12,10,7,5],ece:.043};const t=8,n=Array.from({length:t+1},(p,L)=>L/t),l=Array.from({length:t},()=>0),u=Array.from({length:t},()=>0),d=Array.from({length:t},()=>0);for(const p of U.value){const L=Math.min(t-1,Math.floor(p.p*t));l[L]+=1,u[L]+=p.p,d[L]+=p.y}const _=[],F=[],E=[],j=[],P=[],$=[];for(let p=0;p<t;p+=1){if(l[p]<=0)continue;const L=u[p]/l[p],ie=d[p]/l[p],te=1.96*Math.sqrt(y(ie*(1-ie),l[p],0)),ae=h(ie-te,0,1),Te=h(ie+te,0,1);_.push((n[p]+n[p+1])/2),F.push(L),E.push(ie),j.push(ae),P.push(Te-ae),$.push(l[p])}const O=Math.max(U.value.length,1),C=F.reduce((p,L,ie)=>p+Math.abs(L-E[ie])*$[ie],0)/O;return{centers:_,pred:F,obs:E,lower:j,band:P,count:$,ece:C}}),Be=m(()=>{var l,u,d;const t=W((l=x.evaluation)==null?void 0:l.auc,NaN);if(!Number.isNaN(t)&&t>0)return h(t,.5,1);const n=W((d=(u=x.result)==null?void 0:u.kpi)==null?void 0:d.auc,NaN);return!Number.isNaN(n)&&n>0?h(n,.5,1):h(nt.value,.5,1)}),He=m(()=>{var n;const t=W((n=x.evaluation)==null?void 0:n.pr_auc,NaN);return!Number.isNaN(t)&&t>0?h(t,.4,1):h(ot.value,.4,1)}),Rt=m(()=>{var l,u,d;const t=W((l=x.evaluation)==null?void 0:l.brier,NaN);if(!Number.isNaN(t)&&t>=0)return h(t,0,1);const n=W((d=(u=x.result)==null?void 0:u.kpi)==null?void 0:d.brier_score,NaN);return!Number.isNaN(n)&&n>=0?h(n,0,1):h(at.value,0,1)}),mt=m(()=>{var n;const t=W((n=x.evaluation)==null?void 0:n.ece,NaN);return!Number.isNaN(t)&&t>=0?h(t,0,1):h(We.value.ece,0,1)}),Qe=m(()=>{var l;const t=(l=x.evaluation)==null?void 0:l.confusion_matrix;if(t&&["tp","tn","fp","fn"].every(u=>Number.isFinite(Number(t[u]))))return{tp:Number(t.tp),tn:Number(t.tn),fp:Number(t.fp),fn:Number(t.fn)};const n=N.value.find(u=>Math.abs(u.threshold-.5)<1e-9);return n?{tp:n.tp,tn:n.tn,fp:n.fp,fn:n.fn}:{tp:13,tn:31,fp:6,fn:8}}),pt=m(()=>{const t=Qe.value,n=y(t.tp+t.tn,t.tp+t.tn+t.fp+t.fn,0),l=y(t.tp,t.tp+t.fp,0),u=y(t.tp,t.tp+t.fn,0),d=y(t.tn,t.tn+t.fp,0);return{accuracy:n,precision:l,recall:u,specificity:d}}),vt=m(()=>{var $,O,C;const t=W((C=(O=($=x.result)==null?void 0:$.modules)==null?void 0:O.rsi)==null?void 0:C.value,62),n=["伪顶","直接顶","老顶Ⅰ","老顶Ⅱ","关键层A","关键层B","关键层C","覆岩"],l=[0,-4,-2,1,3,4,2,1],u=n.map((p,L)=>h(t+l[L]*3+Math.sin(L*1.2)*2.2,24,96)),d=n.map((p,L)=>h(9-L*.7+(100-t)*.03,3,12)),_=u.map((p,L)=>h(p-d[L],0,100)),E=u.map((p,L)=>h(p+d[L],0,100)).map((p,L)=>s(p-_[L],4)),j=u.map(p=>h(102-p,4,90)),P=u.reduce((p,L,ie,te)=>L<te[p]?ie:p,0);return{layers:n,stability:u,lower:_,band:E,damage:j,minIdx:P}}),ft=m(()=>{var $,O,C,p,L,ie;const t=Array.from({length:12},(te,ae)=>`T${String(ae+1).padStart(2,"0")}`),n=W((C=(O=($=x.result)==null?void 0:$.modules)==null?void 0:O.bri)==null?void 0:C.event_count,20),l=W((ie=(L=(p=x.result)==null?void 0:p.modules)==null?void 0:L.bri)==null?void 0:ie.avg_magnitude,2.6),u=t.map((te,ae)=>Math.max(1,Math.round(n/t.length*(.8+.6*Math.sin((ae+1)/1.7))))),d=u.map((te,ae)=>s(te*(18+l*6)*(.85+.25*Math.cos((ae+2)/2.3)))),_=d.map((te,ae)=>s((d[Math.max(0,ae-1)]+d[ae]+d[Math.min(d.length-1,ae+1)])/3,2));let F=0;const E=d.reduce((te,ae)=>te+ae,0)||1,j=d.map(te=>(F+=te,s(F/E*100,2))),P=d.reduce((te,ae,Te,At)=>ae>At[te]?Te:te,0);return{windows:t,energy:d,smooth:_,eventRate:u,cumulativeRisk:j,peakIdx:P}}),yt=m(()=>{var E,j,P;const t=W((P=(j=(E=x.result)==null?void 0:E.modules)==null?void 0:j.asi)==null?void 0:P.value,58),n=[2.5,3,3.5,4,5,6,7,8,9,10],l=n.map($=>s(h(6.5+t*.06+10/Math.max($,1),4,34),3)),u=n.map($=>s(h(12+t*.16+18/Math.max($-1.5,1),8,48),3)),d=n.map(($,O)=>s(h(y(u[O],l[O],1),1,4.5),3)),_=u.reduce(($,O,C,p)=>O>p[$]?C:$,0),F=n.find(($,O)=>d[O]<2)||n[n.length-1];return{dist:n,radial:l,tangential:u,kt:d,peakIdx:_,riskRadius:F}}),ht=m(()=>{var $,O,C;const t=(C=(O=($=x.result)==null?void 0:$.figures)==null?void 0:O.fig5_dbn)==null?void 0:C.posterior,n=[{t:"t-4",high_risk_prob:.31},{t:"t-3",high_risk_prob:.35},{t:"t-2",high_risk_prob:.42},{t:"t-1",high_risk_prob:.48},{t:"t",high_risk_prob:.56}],l=Array.isArray(t)&&t.length?t:n,u=l.map(p=>String(p.t)),d=l.map(p=>h(W(p.high_risk_prob,0),0,1)),_=h(.22-Math.sqrt(Math.max(G.value,1))/22,.06,.2),F=d.map(p=>h(p-_,0,1)),j=d.map(p=>h(p+_,0,1)).map((p,L)=>s(p-F[L],4)),P=d.filter(p=>p>=.6).length;return{labels:u,p:d,lower:F,band:j,alertCount:P}}),bt=m(()=>{var P,$,O,C,p;const t=h(W(($=(P=x.result)==null?void 0:P.fusion)==null?void 0:$.mpi,52),0,100),n=h(W((p=(C=(O=x.result)==null?void 0:O.fusion)==null?void 0:C.baseline)==null?void 0:p.mpi,t-4.5),0,100),l=h(Be.value,.5,1),u=h(He.value,.4,1),d=h(Rt.value,0,1),_=["MPI","AUC×100","PR-AUC×100","(1-Brier)×100"],F=[s(t,2),s(l*100,2),s(u*100,2),s((1-d)*100,2)],E=[s(n,2),s(h((l-.05)*100,0,100),2),s(h((u-.06)*100,0,100),2),s(h((1-(d+.05))*100,0,100),2)],j=F.map((L,ie)=>s(L-E[ie],2));return{categories:_,newScores:F,baseScores:E,gain:j}}),gt=m(()=>{var $,O;const t=s(h(Be.value*100,45,99),2),n=((O=($=x.result)==null?void 0:$.fusion)==null?void 0:O.dynamic_weights)||{rsi:.4,bri:.35,asi:.25},l=s(2.5+W(n.rsi,.4)*16,2),u=s(2.5+W(n.bri,.35)*16,2),d=s(2.5+W(n.asi,.25)*16,2),_=["全模型","去RSI","去BRI","去ASI"],F=[t,s(h(t-l,40,99),2),s(h(t-u,40,99),2),s(h(t-d,40,99),2)],E=[0,l,u,d],j=l+u+d||1,P=[0,s(l/j*100,1),s(u/j*100,1),s(d/j*100,1)];return{categories:_,score:F,drop:E,contribution:P}}),Oe=m(()=>{const t=vt.value,n=t.layers[t.minIdx],l=t.stability[t.minIdx];return`关键结论：最低稳定层位为 ${n}（${l.toFixed(1)}%），${l<60?"低于":"高于"}60%预警阈值。`}),Ne=m(()=>{const t=ft.value;return`关键结论：峰值窗口 ${t.windows[t.peakIdx]}，能量 ${t.energy[t.peakIdx].toFixed(1)} a.u.，累计风险在后半段快速抬升。`}),Pt=m(()=>{const t=yt.value;return`关键结论：切向应力峰值出现在 r=${t.dist[t.peakIdx]} m，Kt>2 高风险圈带约在 r≤${t.riskRadius.toFixed(1)} m。`}),xt=m(()=>{const t=ht.value;return`关键结论：最新后验概率 ${t.p[t.p.length-1].toFixed(3)}，达到0.6报警阈值的时间片数量为 ${t.alertCount}。`}),wt=m(()=>{const t=bt.value,n=t.gain.reduce((l,u,d,_)=>u>_[l]?d:l,0);return`关键结论：最大增益指标为 ${t.categories[n]}（+${t.gain[n].toFixed(2)}）。`}),lt=m(()=>{const t=gt.value,n=t.drop.reduce((l,u,d,_)=>u>_[l]?d:l,0);return`关键结论：${t.categories[n]} 对整体性能贡献最大（移除后下降 ${t.drop[n].toFixed(2)} 分）。`}),_t=m(()=>`关键结论：ECE=${mt.value.toFixed(4)}，有效分箱 ${We.value.centers.length} 个。`),Ft=m(()=>{const t=De.value,n=q.value,l=n?`，95%CI=[${n.aucLow.toFixed(3)}, ${n.aucHigh.toFixed(3)}]`:"";return`关键结论：AUC=${Be.value.toFixed(3)}${l}，最优阈值≈${t.threshold.toFixed(3)}（TPR=${t.recall.toFixed(2)}, FPR=${t.fpr.toFixed(2)}）。`}),st=m(()=>{const t=dt.value,n=q.value,l=n?`，95%CI=[${n.prAucLow.toFixed(3)}, ${n.prAucHigh.toFixed(3)}]`:"";return`关键结论：PR-AUC=${He.value.toFixed(3)}${l}，最佳F1=${t.f1.toFixed(3)} 对应阈值≈${t.threshold.toFixed(3)}。`}),St=m(()=>{const t=pt.value;return`关键结论：Accuracy=${(t.accuracy*100).toFixed(1)}%，Precision=${(t.precision*100).toFixed(1)}%，Recall=${(t.recall*100).toFixed(1)}%。`}),Tt=t=>{var l;const n=String(((l=t==null?void 0:t.data)==null?void 0:l.label)||(t==null?void 0:t.name)||"").toUpperCase();(n==="TP"||n==="TN"||n==="FP"||n==="FN")&&Ae("matrix-select",n.toLowerCase())},Lt=m(()=>{const t=vt.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.orange,v.red],animationDuration:350,grid:ce,legend:M,toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("层位",!1)),{data:t.layers,nameGap:30}),yAxis:[J(X({},c("稳定度 / 置信区间 (%)",!0)),{min:0,max:100}),J(X({},c("损伤占比 (%)",!0)),{min:0,max:100})],series:[{name:"CI下界",type:"line",stack:"rsi_ci",data:t.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"rsi_ci",data:t.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.14)"}},{name:"稳定度",type:"line",data:t.stability,smooth:!0,symbolSize:7,lineStyle:{width:2.5,color:v.blue},itemStyle:{color:v.blue},markLine:{symbol:"none",label:{formatter:"预警阈值 60%",color:"#7f1d1d",fontFamily:xe,fontSize:10},lineStyle:{type:"dashed",color:"#b91c1c",width:1.2},data:[{yAxis:60}]},markPoint:{symbol:"circle",symbolSize:44,label:{color:"#111827",fontFamily:xe,fontSize:10,formatter:"最低层"},itemStyle:{color:"#fee2e2",borderColor:"#b91c1c",borderWidth:1.2},data:[{coord:[t.minIdx,t.stability[t.minIdx]]}]}},{name:"损伤占比",type:"bar",yAxisIndex:1,data:t.damage,barWidth:14,itemStyle:{color:v.orange,opacity:.75}}]}}),rt=m(()=>{const t=ft.value;return{color:[v.orange,v.cyan,v.red],animationDuration:350,grid:ce,legend:M,toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("时间窗",!1)),{data:t.windows,nameGap:30}),yAxis:[J(X({},c("能量释放 / 平滑能量 (a.u.)",!0)),{min:0}),J(X({},c("事件频次 / 累计风险 (%)",!0)),{min:0,max:110})],series:[{name:"能量释放",type:"bar",data:t.energy,barWidth:14,itemStyle:{color:v.orange,opacity:.82},markPoint:{symbol:"pin",symbolSize:34,data:[{name:"峰值",coord:[t.peakIdx,t.energy[t.peakIdx]]}],label:{formatter:"峰值",fontSize:10,color:"#111827"}}},{name:"平滑能量",type:"line",data:t.smooth,smooth:!0,symbolSize:5,lineStyle:{width:2,color:v.cyan}},{name:"事件频次",type:"line",yAxisIndex:1,data:t.eventRate,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.slate}},{name:"累计风险",type:"line",yAxisIndex:1,data:t.cumulativeRisk,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red}}]}}),je=m(()=>{const t=yt.value;return{color:[v.blue,v.red,v.purple],animationDuration:350,grid:{left:64,right:54,top:46,bottom:62},legend:M,toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("径向距离 r (m)",!0)),{min:2,max:10}),yAxis:[J(X({},c("应力 (MPa)",!0)),{min:0,max:50}),J(X({},c("应力集中系数 Kt",!0)),{min:1,max:4.5,position:"right"})],series:[{name:"径向应力 σr",type:"line",data:t.dist.map((n,l)=>[n,t.radial[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.2,color:v.blue}},{name:"切向应力 σθ",type:"line",data:t.dist.map((n,l)=>[n,t.tangential[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.4,color:v.red},markPoint:{symbol:"circle",symbolSize:40,itemStyle:{color:"#fee2e2",borderColor:v.red,borderWidth:1.2},label:{formatter:"峰值",fontSize:10,color:"#111827"},data:[{coord:[t.dist[t.peakIdx],t.tangential[t.peakIdx]]}]}},{name:"Kt=σθ/σr",type:"line",yAxisIndex:1,data:t.dist.map((n,l)=>[n,t.kt[l]]),smooth:!0,symbolSize:5,lineStyle:{width:1.9,type:"dashed",color:v.purple},markLine:{symbol:"none",label:{formatter:"Kt=2",color:v.purple,fontFamily:xe,fontSize:10},lineStyle:{color:v.purple,width:1.1,type:"dashed"},data:[{yAxis:2}]}}]}}),Ge=m(()=>{const t=ht.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.red],animationDuration:350,grid:ce,legend:M,toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("时间片",!1)),{data:t.labels,nameGap:30}),yAxis:J(X({},c("高风险后验概率",!0)),{min:0,max:1}),series:[{name:"CI下界",type:"line",stack:"dbn_ci",data:t.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"dbn_ci",data:t.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.18)"}},{name:"后验概率",type:"line",data:t.p,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red},markLine:{symbol:"none",lineStyle:{type:"dashed",width:1.15},data:[{yAxis:.3,name:"关注阈值",lineStyle:{color:v.orange}},{yAxis:.6,name:"报警阈值",lineStyle:{color:v.red}}]}}]}}),it=m(()=>{const t=bt.value;return{color:[v.cyan,v.slate,v.red],animationDuration:350,grid:{left:74,right:54,top:46,bottom:66},legend:M,toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("指标",!1)),{data:t.categories,nameGap:30}),yAxis:[J(X({},c("归一化分数",!0)),{min:0,max:100}),J(X({},c("增益(新-基线)",!0)),{min:Math.min(...t.gain)-2,max:Math.max(...t.gain)+2,position:"right"})],series:[{name:"新算法",type:"bar",data:t.newScores,barWidth:14,itemStyle:{color:v.cyan}},{name:"基线算法",type:"bar",data:t.baseScores,barWidth:14,itemStyle:{color:v.slate,opacity:.85}},{name:"增益",type:"line",yAxisIndex:1,data:t.gain,symbol:"diamond",symbolSize:8,lineStyle:{width:2.2,color:v.red},label:{show:!0,position:"top",color:v.red,fontFamily:xe,fontSize:10,formatter:({value:n})=>`+${Number(n).toFixed(2)}`}}]}}),zt=m(()=>{const t=gt.value,n=t.drop.reduce((l,u,d,_)=>u>_[l]?d:l,0);return{color:[v.green,v.red,v.orange],animationDuration:350,grid:{left:66,right:52,top:46,bottom:64},legend:M,toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("模型版本",!1)),{data:t.categories,nameGap:30}),yAxis:[J(X({},c("性能分数 (AUC×100)",!0)),{min:40,max:100}),J(X({},c("下降分数 / 贡献(%)",!0)),{min:0,max:Math.max(...t.drop,...t.contribution)+8,position:"right"})],series:[{name:"性能分数",type:"bar",data:t.score,barWidth:16,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:xe,fontSize:10,formatter:({value:l})=>Number(l).toFixed(1)}},{name:"下降分数",type:"line",yAxisIndex:1,data:t.drop,symbolSize:8,lineStyle:{width:2,color:v.red},itemStyle:{color:v.red},markPoint:{symbol:"pin",symbolSize:34,data:[{coord:[n,t.drop[n]],name:"最大下降"}],label:{formatter:"最大下降",fontSize:10,color:"#111827"}}},{name:"贡献率(%)",type:"line",yAxisIndex:1,data:t.contribution,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.orange}}]}}),Ue=m(()=>{const t=We.value,n=Math.max(...t.count,1);return{color:[v.blue,"rgba(29,78,216,0.2)","#94a3b8",v.cyan],animationDuration:350,grid:{left:66,right:54,top:46,bottom:62},legend:M,toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("预测概率",!0)),{min:0,max:1,interval:.1}),yAxis:[J(X({},c("真实频率",!0)),{min:0,max:1,interval:.1}),J(X({},c("样本数",!0)),{min:0,max:n+2,position:"right"})],series:[{name:"理想校准线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.4,type:"dashed",color:"#94a3b8"}},{name:"CI下界",type:"line",stack:"cal_ci",data:t.centers.map((l,u)=>[l,t.lower[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"cal_ci",data:t.centers.map((l,u)=>[l,t.band[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.15)"}},{name:"校准曲线",type:"line",data:t.centers.map((l,u)=>[l,t.obs[u]]),smooth:!0,symbolSize:7,lineStyle:{width:2.4,color:v.blue},itemStyle:{color:v.blue}},{name:"分箱样本数",type:"bar",yAxisIndex:1,data:t.centers.map((l,u)=>[l,t.count[u]]),barWidth:18,itemStyle:{color:"#cbd5e1",opacity:.6}}],graphic:[{type:"text",right:26,top:18,style:{text:`ECE=${mt.value.toFixed(4)}`,font:`600 12px ${xe}`,fill:"#0f172a"}}]}}),et=m(()=>{const t=De.value,n=Je.value,l=ge.value,u=q.value,d=`ROC 曲线 (AUC=${Be.value.toFixed(3)})`,_=u?`AUC 95%CI [${u.aucLow.toFixed(3)}, ${u.aucHigh.toFixed(3)}]`:"AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.blue,v.red],animationDuration:350,grid:ce,legend:J(X({},M),{data:["随机参考线",d,"最优阈值点"]}),toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("假阳性率 FPR",!0)),{min:0,max:1,interval:.1}),yAxis:J(X({},c("真阳性率 TPR",!0)),{min:0,max:1,interval:.1}),series:[{name:"随机参考线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__roc_ci_low__",type:"line",stack:"roc_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__roc_ci_band__",type:"line",stack:"roc_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"ROC 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"ROC 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:d,type:"line",smooth:!0,data:B.value,symbolSize:5,lineStyle:{width:2.6,color:v.blue},areaStyle:{color:"rgba(29,78,216,0.12)"}},{name:"最优阈值点",type:"scatter",data:[[t.fpr,t.recall]],symbolSize:12,itemStyle:{color:v.red},label:{show:!0,position:"top",fontFamily:xe,fontSize:10,color:v.red,formatter:`thr=${t.threshold.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:_,font:`600 11px ${xe}`,fill:"#0f172a"}}]}}),kt=m(()=>{const n=[];for(let l=1;l<=99;l+=1){const u=l/100,d=2*u-.6;if(d<=0)continue;const _=h(.6*u/d,0,1);_>0&&_<=1&&n.push([u,_])}return n}),Ct=m(()=>{const t=dt.value,n=ye.value,l=Ke.value,u=q.value,d=`PR 曲线 (PR-AUC=${He.value.toFixed(3)})`,_=u?`PR-AUC 95%CI [${u.prAucLow.toFixed(3)}, ${u.prAucHigh.toFixed(3)}]`:"PR-AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.orange,v.red,v.green],animationDuration:350,grid:ce,legend:J(X({},M),{data:["基线(阳性占比)","F1=0.6 等值线",d,"最佳F1点"]}),toolbox:D,dataZoom:k,tooltip:{trigger:"axis"},xAxis:J(X({},c("召回率 Recall",!0)),{min:0,max:1,interval:.1}),yAxis:J(X({},c("精确率 Precision",!0)),{min:0,max:1,interval:.1}),series:[{name:"基线(阳性占比)",type:"line",data:[[0,oe.value],[1,oe.value]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__pr_ci_low__",type:"line",stack:"pr_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__pr_ci_band__",type:"line",stack:"pr_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"PR 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"PR 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"F1=0.6 等值线",type:"line",data:kt.value,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:v.orange}},{name:d,type:"line",smooth:!0,data:ue.value,symbolSize:5,lineStyle:{width:2.6,color:v.red}},{name:"最佳F1点",type:"scatter",data:[[t.recall,t.precision]],symbolSize:12,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:xe,fontSize:10,color:v.green,formatter:`F1=${t.f1.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:_,font:`600 11px ${xe}`,fill:"#0f172a"}}]}}),Et=m(()=>{const t=Qe.value,n=Math.max(t.tp+t.tn+t.fp+t.fn,1),l=[{value:[0,0,t.tn,t.tn/n],label:"TN"},{value:[1,0,t.fp,t.fp/n],label:"FP"},{value:[0,1,t.fn,t.fn/n],label:"FN"},{value:[1,1,t.tp,t.tp/n],label:"TP"}],u=pt.value;return{animationDuration:350,grid:{left:76,right:120,top:38,bottom:66},toolbox:J(X({},D),{feature:{restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}}),tooltip:{trigger:"item",formatter:({data:d})=>`${d.label}：${d.value[2]} (${(d.value[3]*100).toFixed(1)}%)`},xAxis:J(X({},c("预测类别",!1)),{data:["低风险","高风险"],nameGap:34,splitLine:{show:!1}}),yAxis:J(X({},c("真实类别",!1)),{data:["低风险","高风险"],nameGap:54,splitLine:{show:!1}}),visualMap:{min:0,max:Math.max(t.tp,t.tn,t.fp,t.fn,1),orient:"vertical",right:18,top:"middle",text:["高","低"],textStyle:{fontFamily:xe,fontSize:11,color:"#0f172a"},inRange:{color:["#ecfeff","#67e8f9","#0e7490"]}},series:[{name:"混淆矩阵",type:"heatmap",data:l,label:{show:!0,color:"#0f172a",fontFamily:xe,fontSize:11,formatter:({data:d})=>`${d.label}
${d.value[2]}
${(d.value[3]*100).toFixed(1)}%`},itemStyle:{borderWidth:1,borderColor:"#e2e8f0"}}],graphic:[{type:"group",right:10,bottom:8,children:[{type:"text",top:0,style:{text:`Acc ${(u.accuracy*100).toFixed(1)}%`,font:`600 11px ${xe}`,fill:"#0f172a"}},{type:"text",top:16,style:{text:`Prec ${(u.precision*100).toFixed(1)}%`,font:`600 11px ${xe}`,fill:"#0f172a"}},{type:"text",top:32,style:{text:`Rec ${(u.recall*100).toFixed(1)}%`,font:`600 11px ${xe}`,fill:"#0f172a"}},{type:"text",top:48,style:{text:`Spec ${(u.specificity*100).toFixed(1)}%`,font:`600 11px ${xe}`,fill:"#0f172a"}}]}]}});return(t,n)=>(Q(),ee("section",co,[a("header",mo,[n[0]||(n[0]=a("div",{class:"head-title"},[a("h4",null,"SCI 配图增强版（图2-图11）"),a("p",null,"统一采用期刊风格坐标系、阈值注记、置信区间和关键决策点标注。")],-1)),a("div",po,[a("span",vo,"样本 n="+f(G.value),1),a("span",fo,"正样本占比 "+f(z(oe.value)),1),q.value?(Q(),ee("span",yo,"Bootstrap "+f(q.value.iterations)+"次",1)):he("",!0),a("span",{class:tt(["metric-chip",{warn:I.value!=="real_label_stream"}])},"评估源 "+f(le.value),3),H.value?(Q(),ee("span",ho,"标签文件 "+f(H.value),1)):he("",!0)])]),a("article",bo,[n[1]||(n[1]=a("h4",null,"图2 | RSI 机制剖面图（稳定度-损伤-置信带）",-1)),$e(Le,{option:Lt.value,height:336},null,8,["option"]),n[2]||(n[2]=a("p",{class:"caption"},"怎么看：稳定度实线越高越好，误差带越窄代表层位响应更稳定，损伤柱越低越好。",-1)),a("p",go,f(Oe.value),1)]),a("article",xo,[n[3]||(n[3]=a("h4",null,"图3 | BRI 微震能量释放、事件频次与累计风险",-1)),$e(Le,{option:rt.value,height:336},null,8,["option"]),n[4]||(n[4]=a("p",{class:"caption"},"怎么看：能量柱与事件频次线共同识别冲击窗口，累计风险线反映风险积聚过程。",-1)),a("p",wo,f(Ne.value),1)]),a("article",_o,[n[5]||(n[5]=a("h4",null,"图4 | ASI 径向/切向应力与应力集中系数 Kt",-1)),$e(Le,{option:je.value,height:336},null,8,["option"]),n[6]||(n[6]=a("p",{class:"caption"},"怎么看：切向应力峰值与 Kt>2 区段对应高风险圈带，径向应力反映卸压后衰减。",-1)),a("p",So,f(Pt.value),1)]),a("article",ko,[n[7]||(n[7]=a("h4",null,"图5 | DBN 后验概率时序（95% CI + 预警阈值）",-1)),$e(Le,{option:Ge.value,height:336},null,8,["option"]),n[8]||(n[8]=a("p",{class:"caption"},"怎么看：后验概率曲线跨过 0.6 报警阈值时需触发强化巡检，CI 带越窄越可信。",-1)),a("p",Co,f(xt.value),1)]),a("article",Ao,[n[9]||(n[9]=a("h4",null,"图6 | 新旧算法多指标对比（分数 + 增益）",-1)),$e(Le,{option:it.value,height:336},null,8,["option"]),n[10]||(n[10]=a("p",{class:"caption"},"怎么看：柱形给出绝对分数，增益折线给出替代旧算法的实际收益幅度。",-1)),a("p",Mo,f(wt.value),1)]),a("article",No,[n[11]||(n[11]=a("h4",null,"图7 | 消融实验（模块贡献与性能下降）",-1)),$e(Le,{option:zt.value,height:336},null,8,["option"]),n[12]||(n[12]=a("p",{class:"caption"},"怎么看：去除模块后的性能下降越大，说明该模块对总体性能贡献越关键。",-1)),a("p",Io,f(lt.value),1)]),a("article",$o,[n[13]||(n[13]=a("h4",null,"图8 | 校准曲线（含样本直方图与置信区间）",-1)),$e(Le,{option:Ue.value,height:336},null,8,["option"]),n[14]||(n[14]=a("p",{class:"caption"},"怎么看：曲线贴近对角线且 ECE 越低，模型概率输出越可直接用于阈值决策。",-1)),a("p",Ro,f(_t.value),1)]),a("article",Po,[n[15]||(n[15]=a("h4",null,"图9 | ROC 曲线（最优阈值点与 AUC）",-1)),$e(Le,{option:et.value,height:336},null,8,["option"]),n[16]||(n[16]=a("p",{class:"caption"},"怎么看：曲线越靠左上角越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，红点为 Youden 最优阈值。",-1)),a("p",Fo,f(Ft.value),1)]),a("article",To,[n[17]||(n[17]=a("h4",null,"图10 | PR 曲线（基线、F1 等值线与最优点）",-1)),$e(Le,{option:Ct.value,height:336},null,8,["option"]),n[18]||(n[18]=a("p",{class:"caption"},"怎么看：PR 曲线整体越高越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，绿点为最佳F1运行点。",-1)),a("p",Lo,f(st.value),1)]),a("article",zo,[n[19]||(n[19]=a("h4",null,"图11 | 混淆矩阵热图（计数 + 占比 + 诊断指标）",-1)),$e(Le,{option:Et.value,height:336,onChartClick:Tt},null,8,["option"]),n[20]||(n[20]=a("p",{class:"caption"},"怎么看：对角线高、非对角低为理想状态；右侧指标用于误报/漏报成本权衡。",-1)),a("p",Eo,f(St.value),1)])]))}},Bo=Wt(Do,[["__scopeId","data-v-f81ec0ce"]]),Oo={class:"top-nav"},Uo={class:"nav-left"},Vo={class:"seam-select"},Wo=["value"],Ho={key:0,class:"mini-stats"},jo={class:"danger"},Go={class:"nav-right"},qo=["disabled"],Yo=["disabled"],Zo={class:"metric-dashboard"},Xo=["onClick"],Jo={class:"head"},Ko={key:0,class:"problem-dot"},Qo={class:"value"},ea={class:"meta"},ta={class:"main-layout"},na={class:"main-canvas-card"},oa={class:"canvas-head"},aa={class:"canvas-controls"},la={class:"check"},sa={class:"check"},ra={key:0,class:"trust-banner"},ia={class:"trust-chip warn"},ua={class:"trust-chip info"},ca={key:0,class:"trust-chip danger"},da={key:1,class:"trust-chip hint"},ma={key:2,class:"trust-chip link"},pa={key:3,class:"trust-meta"},va={class:"trust-meta"},fa={key:0,class:"loading-mask"},ya={class:"legend-wrap"},ha={class:"legend-labels"},ba={class:"thumb-list"},ga=["onClick","onMouseenter","onMousemove"],xa={class:"thumb-meta"},wa={key:0,class:"floating-panel"},_a={class:"weight-row"},Sa={class:"weight-row"},ka={class:"weight-row"},Ca={key:0,class:"eval-drawer"},Aa={class:"actions"},Ma={key:0,class:"panel-empty"},Na={key:1,class:"panel-empty"},Ia={class:"eval-grid"},$a={class:"metric"},Ra={class:"metric"},Pa={class:"metric"},Fa={class:"metric"},Ta={class:"metric"},La={class:"eval-content"},za={class:"cm-card"},Ea={class:"cm-grid"},Da={class:"cm-cell"},Ba={class:"cm-cell warn"},Oa={class:"cm-cell warn"},Ua={class:"cm-cell"},Va={class:"baseline-card"},Wa={viewBox:"0 0 560 170",class:"baseline-svg"},Ha=["width"],ja={x:"485",y:"26"},Ga=["width"],qa={x:"485",y:"90"},Ya={key:0,class:"science-section"},Za={class:"data-note"},Xa={key:1,class:"export-note"},Ja={class:"risk"},Ka="advanced_v2_asi_calibrated_v1",Qa={__name:"AlgorithmValidation",setup(g){const Y=eo(),x=Qn(),{workspaceState:Ae,setSelectedSeam:v,markStepDone:ce}=Gn(),h=[{key:"mpi",label:"MPI",desc:"综合指标"},{key:"rsi",label:"RSI",desc:"顶板稳定"},{key:"bri",label:"BRI",desc:"冲击风险"},{key:"asi",label:"ASI",desc:"支承应力"}],W={tp:{label:"TP 真阳性",color:"#15803d"},tn:{label:"TN 真阴性",color:"#0e7490"},fp:{label:"FP 假阳性",color:"#d97706"},fn:{label:"FN 假阴性",color:"#b91c1c"}},z=ne(null),s=ne(null),y=ne(null),c=ne(null),M=ne(null),D=ne([]),k=ne(""),R=ne(50),I=ne(9),H=ne("idw"),le=ne(!0),U=ne(!1),G=ne("mpi"),de=ne(!1),me=ne(!1),oe=ne(!1),pe=ne(!0),we=ne(!1),V=$t({rsi:.4,bri:.35,asi:.25}),N=Kn(null),B=ne(null),ue=ne(!1),be=ne(""),re=ne(!1),ke=ne(""),K=ne(null),Re=$t({x:0,y:0}),ve=$t({visible:!1,metric:"",x:0,y:0}),q=ne("pseudo_threshold"),Je=ne(""),ge=ne("all"),ye=ne(null),Ke=ne(!1),nt={},ot=new Map;let De=null;const dt=()=>Ce(this,null,function*(){if(De)return De;const o=yield qn(()=>import("./jszip-CsMIhXuR.js").then(e=>e.j),[]);if(De=(o==null?void 0:o.default)||(o==null?void 0:o.JSZip)||window.JSZip||null,!De)throw new Error("JSZip 加载失败");return De}),{viewport:at,worldToScreen:We,screenToWorld:Be,fitToBounds:He,startDrag:Rt,dragTo:mt,endDrag:Qe,zoomAt:pt}=lo(),{getLegendGradient:vt,drawGrid:ft,drawBoreholes:yt,pickNearestBorehole:ht,sampleGridValue:bt,drawMiniHeatmap:gt}=io(),Oe=m(()=>{const o=V.rsi+V.bri+V.asi||1;return{rsi:V.rsi/o,bri:V.bri/o,asi:V.asi/o}}),Ne=m(()=>{var o,e,i;return!!((o=N.value)!=null&&o.grids&&((e=N.value)!=null&&e.statistics)&&((i=N.value)!=null&&i.boreholes))}),Pt=m(()=>{var e;const o=String(((e=N.value)==null?void 0:e.algorithm_mode)||"");return o==="advanced_v2"?"新算法(advanced_v2)":o||"未标记"}),xt=m(()=>{var i,b;const o=(i=N.value)==null?void 0:i.problem_indicators;if(Array.isArray(o))return o;const e=((b=N.value)==null?void 0:b.indicator_diagnostics)||{};return Object.keys(e).filter(r=>{var w;return((w=e==null?void 0:e[r])==null?void 0:w.status)&&e[r].status!=="ok"})}),wt=m(()=>xt.value.map(o=>P(o))),lt=m(()=>{var o,e;return((e=(o=N.value)==null?void 0:o.statistics)==null?void 0:e[G.value])||{}}),_t=m(()=>{const o=lt.value,e=Number(o==null?void 0:o.min),i=Number(o==null?void 0:o.max);return!Number.isFinite(e)||!Number.isFinite(i)?0:Math.max(0,i-e)}),Ft=m(()=>Ne.value&&U.value&&_t.value<20),st=m(()=>{var o,e,i;return Number(((i=(e=(o=N.value)==null?void 0:o.statistics)==null?void 0:e.mpi)==null?void 0:i.mean)||0)}),St=m(()=>Math.max(0,st.value-4.5)),Tt=m(()=>ae(G.value)),Lt=m(()=>q.value==="real_label_stream"?"真实标签流":q.value==="pseudo_threshold"?"伪标签估计（阈值构造）":q.value==="none"?"无可评估样本":"未知来源"),rt=m(()=>{var o,e;return U.value?{min:0,mean:50,max:100}:((e=(o=N.value)==null?void 0:o.statistics)==null?void 0:e[G.value])||{min:0,mean:0,max:0}}),je=m(()=>{var e,i,b,r;const o={};for(const w of h){const S=((i=(e=N.value)==null?void 0:e.statistics)==null?void 0:i[w.key])||{},A=(r=(b=N.value)==null?void 0:b.grids)==null?void 0:r[w.key];let T=0,se=0,fe=0,Z=Number.POSITIVE_INFINITY,Se=Number.NEGATIVE_INFINITY;if(Array.isArray(A))for(const qe of A)for(const Ye of qe||[]){const Ie=Number(Ye);Number.isFinite(Ie)&&(T+=1,se+=Ie,fe+=Ie*Ie,Ie<Z&&(Z=Ie),Ie>Se&&(Se=Ie))}const Me=T?se/T:Number(S.mean||0),Pe=T?Math.max(fe/T-Me*Me,0):0;o[w.key]={min:Number.isFinite(Number(S.min))?Number(S.min):T?Z:0,max:Number.isFinite(Number(S.max))?Number(S.max):T?Se:0,mean:Me,std:Math.sqrt(Pe)}}return o}),Ge=m(()=>je.value[ve.metric]||null),it=m(()=>{var Z,Se,Me,Pe,qe,Ye,Ie,Ze;if(!Ne.value)return null;const o=je.value,e=((Z=N.value)==null?void 0:Z.boreholes)||[],i=jt(),b=Number(((Se=o.mpi)==null?void 0:Se.mean)||0),r=Math.max(0,b-4.5),w=r>0?(b-r)/r*100:0,S=e.length||1,A=ae("mpi")/S,T=L(1-b/100,0,1),se=L(Number(((Me=B.value)==null?void 0:Me.auc)||.7)-.5,0,.45),fe=["t-4","t-3","t-2","t-1","t"].map((It,Ve)=>({t:It,high_risk_prob:L(T+(Ve-2)*.05+se*.2,.05,.95)}));return{modules:{rsi:{value:Number(((Pe=o.rsi)==null?void 0:Pe.mean)||0),input_layers:6},bri:{value:Number(((qe=o.bri)==null?void 0:qe.mean)||0),event_count:e.length,avg_magnitude:2.6},asi:{value:Number(((Ye=o.asi)==null?void 0:Ye.mean)||0),avg_friction_angle:31.2}},fusion:{mpi:b,baseline:{mpi:r},dynamic_weights:Oe.value},kpi:{mpi_mean:b,high_risk_ratio:A,auc:Number(((Ie=B.value)==null?void 0:Ie.auc)||.7),brier_score:Number(((Ze=B.value)==null?void 0:Ze.brier)||.24),improvement_vs_baseline_pct:w},figures:{fig5_dbn:{posterior:fe}},evaluation_inputs:i}}),zt=o=>{var e;return((e=W[String(o||"").toLowerCase()])==null?void 0:e.label)||"全部"},Ue=m(()=>{var S,A;const o=((S=N.value)==null?void 0:S.boreholes)||[],e=((A=it.value)==null?void 0:A.evaluation_inputs)||{},i=Array.isArray(e.y_true)?e.y_true:Array.isArray(e.yTrue)?e.yTrue:[],b=Array.isArray(e.y_prob)?e.y_prob:Array.isArray(e.yProb)?e.yProb:[];if(!o.length||i.length!==o.length||b.length!==o.length)return{available:!1,roles:[],counts:{tp:0,tn:0,fp:0,fn:0}};const r=[],w={tp:0,tn:0,fp:0,fn:0};for(let T=0;T<o.length;T+=1){const se=Number(i[T])>=1?1:0,fe=Number(b[T])>=.5?1:0,Z=se===1?fe===1?"tp":"fn":fe===1?"fp":"tn";r.push(Z),w[Z]+=1}return{available:!0,roles:r,counts:w}}),et=m(()=>Ue.value.available),kt=m(()=>{var e;if(ge.value==="all")return 0;const o=String(ge.value).toLowerCase();return Number(((e=Ue.value.counts)==null?void 0:e[o])||0)}),Ct=m(()=>{const o=String(ge.value||"").toLowerCase();if(!Ue.value.available||!["tp","tn","fp","fn"].includes(o))return[];const e=[];for(let i=0;i<Ue.value.roles.length;i+=1)Ue.value.roles[i]===o&&e.push(i);return e}),Et=m(()=>new Set(Ct.value)),t=m(()=>{var e;const o=String(ge.value||"").toLowerCase();return["tp","tn","fp","fn"].includes(o)?{active:!0,indexSet:Et.value,accent:((e=W[o])==null?void 0:e.color)||"#111827"}:null}),n=m(()=>ge.value!=="all"&&et.value&&!Ke.value);let l=0,u=0,d=null,_=null,F=0,E=0;const j=()=>{window.clearTimeout(d),d=window.setTimeout(()=>{Ht(),Dt(),_e(),Mt()},80)},P=o=>{var e;return((e=h.find(i=>i.key===o))==null?void 0:e.label)||o.toUpperCase()},$=o=>xt.value.includes(o),O=o=>vt(o),C=(o,e=2)=>o==null||Number.isNaN(Number(o))?"--":Number(o).toFixed(e),p=o=>`${(Number(o||0)*100).toFixed(0)}%`,L=(o,e,i)=>Math.max(e,Math.min(i,o)),ie=o=>{const e=String(o||"").toLowerCase();return e.includes("high")||e.includes("高")?"高风险":e.includes("medium")||e.includes("中")?"中风险":e.includes("low")||e.includes("低")?"低风险":"未知"},te=o=>`${L(Number(o||0),0,100)*3.6}`,ae=o=>{var e;return(((e=N.value)==null?void 0:e.boreholes)||[]).filter(i=>Number(i[o])<50).length},Te=o=>{var e,i;return U.value?{min:0,mean:50,max:100}:((i=(e=N.value)==null?void 0:e.statistics)==null?void 0:i[o])||{min:0,mean:0,max:0}},At=()=>{const o=Number(I.value);I.value=Number.isFinite(o)?Math.max(5,Math.min(24,Math.round(o))):9},vn=(o,e,i)=>{if(!Array.isArray(i)||i.length===0)return{borehole:null,distance:null};let b=null,r=Number.POSITIVE_INFINITY;for(const w of i){const S=Number(w.x)-o,A=Number(w.y)-e,T=Math.hypot(S,A);T<r&&(r=T,b=w)}return{borehole:b,distance:Number.isFinite(r)?r:null}},fn=()=>{const o=Oe.value;return[Ka,k.value,R.value,H.value,o.rsi.toFixed(3),o.bri.toFixed(3),o.asi.toFixed(3)].join("|")},yn=o=>e=>{e?(nt[o]=e,Mt()):delete nt[o]},Ht=()=>{if(!s.value||!c.value||!M.value)return;const o=s.value.getBoundingClientRect(),e=window.devicePixelRatio||1,i=Math.max(1,Math.floor(o.width*e)),b=Math.max(1,Math.floor(o.height*e));for(const r of[c.value,M.value])r.width=i,r.height=b},Dt=()=>{var e;const o=(e=N.value)==null?void 0:e.bounds;!o||!c.value||(He(o,c.value.width,c.value.height,62),_e())},hn=(o,e,i)=>{const b=String(ge.value||"").toLowerCase();if(!["tp","tn","fp","fn"].includes(b)||!Ue.value.available)return;const r=W[b],w=Ct.value;w.length&&(o.save(),o.fillStyle="rgba(15, 23, 42, 0.88)",o.fillRect(12,10,250,28),o.fillStyle="#f4f9f8",o.font="600 12px 'Noto Sans SC', 'Segoe UI', sans-serif",o.fillText(`联动筛选: ${r.label} (${w.length})  Esc清除`,22,29),o.restore())},Bt=()=>{var S,A,T;if(l=0,!c.value||!M.value)return;const o=N.value,e=c.value.getContext("2d"),i=M.value.getContext("2d");if(e.clearRect(0,0,c.value.width,c.value.height),i.clearRect(0,0,M.value.width,M.value.height),!o)return;const b=G.value,r=Te(b);ft(e,(S=o.grids)==null?void 0:S[b],o.bounds,at,b,r,We,{showContours:le.value,contourLevels:I.value});const w=t.value?J(X({},t.value),{animate:n.value,pulseT:performance.now()/1e3}):null;yt(i,o.boreholes,b,r,o.bounds,We,((T=(A=K.value)==null?void 0:A.borehole)==null?void 0:T.borehole_name)||"",w),hn(i,o.boreholes||[],o.bounds),K.value&&(i.strokeStyle="rgba(15, 23, 42, 0.55)",i.lineWidth=1.1,i.setLineDash([5,4]),i.beginPath(),i.moveTo(K.value.sx,0),i.lineTo(K.value.sx,M.value.height),i.moveTo(0,K.value.sy),i.lineTo(M.value.width,K.value.sy),i.stroke(),i.setLineDash([])),n.value&&_e()},bn=()=>{var e;u=0;const o=N.value;if(o)for(const i of h){const b=nt[i.key];b&&gt(b,(e=o.grids)==null?void 0:e[i.key],i.key,Te(i.key))}},_e=()=>{l||(l=window.requestAnimationFrame(Bt))},Mt=()=>{u||(u=window.requestAnimationFrame(bn))},jt=()=>{var r,w;const o=(r=N.value)==null?void 0:r.evaluation_inputs;if((o==null?void 0:o.mode)==="real_label_stream"){const S=Array.isArray(o.y_true)?o.y_true:[],A=Array.isArray(o.y_prob)?o.y_prob:[];if(S.length===A.length&&S.length>=2){const T=S.map(Z=>Number(Z)>=1?1:0),se=A.map(Z=>L(Number(Z),0,1));if(se.every(Z=>Number.isFinite(Z))&&new Set(T).size>1)return{mode:"real_label_stream",source:String(o.source||""),sourceFile:String(o.source||""),y_true:T,y_prob:se,yTrue:T,yProb:se}}}const e=((w=N.value)==null?void 0:w.boreholes)||[];if(e.length<4)return null;let i=e.map(S=>S.rsi<50||S.bri<50||S.asi<50?1:0);const b=e.map(S=>L(1-Number(S.mpi||0)/100,0,1));if(new Set(i).size<2){const S=e.map(T=>Number(T.mpi||0)).sort((T,se)=>T-se),A=S[Math.floor(S.length/2)];i=e.map(T=>Number(T.mpi||0)<=A?1:0)}return{mode:"pseudo_threshold",source:"",sourceFile:"",y_true:i,y_prob:b,yTrue:i,yProb:b}},gn=()=>Ce(this,null,function*(){var i,b;const o=++E,e=jt();if(!e){if(o!==E)return;q.value="none",Je.value="",B.value=null,be.value="当前煤层钻孔点不足，无法计算评估指标。";return}if(o===E){q.value=e.mode||"pseudo_threshold",Je.value=e.sourceFile||"",ue.value=!0,be.value="";try{const r=yield oo({y_true:e.y_true||e.yTrue,y_prob:e.y_prob||e.yProb});if(o!==E)return;B.value=r.data}catch(r){if(o!==E)return;B.value=null,be.value=((b=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:b.detail)||"评估指标计算失败"}finally{o===E&&(ue.value=!1)}}}),Gt=o=>Ce(this,null,function*(){N.value=o,K.value=null,ge.value="all",yield Vt(),Ht(),Dt(),_e(),Mt(),gn()}),Nt=(...e)=>Ce(this,[...e],function*({force:o=!1}={}){var r,w;if(!k.value)return;const i=++F,b=fn();if(!o&&ot.has(b)){if(i!==F)return;yield Gt(ot.get(b));return}de.value=!0;try{const S=yield no(k.value,R.value,H.value,Oe.value);if(i!==F)return;const A=S.data;ot.set(b,A),yield Gt(A),ce("AlgorithmValidation",{validationReady:!0})}catch(S){if(i!==F)return;be.value=((w=(r=S==null?void 0:S.response)==null?void 0:r.data)==null?void 0:w.detail)||"空间总览加载失败"}finally{i===F&&(de.value=!1)}}),xn=o=>{const e=String(o||"").toLowerCase();["tp","tn","fp","fn"].includes(e)&&et.value&&(ge.value=ge.value===e?"all":e,_e())},qt=()=>{ge.value="all",_e()},Yt=o=>{o.key==="Escape"&&ge.value!=="all"&&qt()},wn=o=>{var e,i;!Ne.value||!s.value||o.pointerType==="mouse"&&o.button!==0||ye.value!==null&&ye.value!==o.pointerId||(ye.value=o.pointerId,(i=(e=s.value).setPointerCapture)==null||i.call(e,o.pointerId),Rt(o.clientX,o.clientY))},_n=o=>{var fe,Z,Se,Me,Pe;if(ye.value!==null&&o.pointerId!==ye.value||!M.value||!Ne.value)return;const e=M.value.getBoundingClientRect(),i=window.devicePixelRatio||1,b=(o.clientX-e.left)*i,r=(o.clientY-e.top)*i;if(Re.x=o.clientX-e.left,Re.y=o.clientY-e.top,at.isDragging){mt(o.clientX,o.clientY),_e();return}const w=(fe=N.value)==null?void 0:fe.bounds,S=Be(b,r,w),A=G.value,T=vn(S.x,S.y,((Z=N.value)==null?void 0:Z.boreholes)||[]),se=ht(b,r,((Se=N.value)==null?void 0:Se.boreholes)||[],w,We);K.value={sx:b,sy:r,worldX:S.x,worldY:S.y,gridValue:bt((Pe=(Me=N.value)==null?void 0:Me.grids)==null?void 0:Pe[A],w,S.x,S.y),borehole:se,nearestBorehole:T.borehole,nearestDistance:T.distance},_e()},Sn=o=>{var e,i;ye.value!==null&&o.pointerId!==ye.value||((i=(e=s.value)==null?void 0:e.hasPointerCapture)!=null&&i.call(e,o.pointerId)&&s.value.releasePointerCapture(o.pointerId),ye.value=null,Qe())},kn=o=>{var e,i;ye.value!==null&&o.pointerId!==ye.value||((i=(e=s.value)==null?void 0:e.hasPointerCapture)!=null&&i.call(e,o.pointerId)&&s.value.releasePointerCapture(o.pointerId),ye.value=null,Qe(),K.value=null,_e())},Cn=o=>{var e,i;if(ye.value!==null&&o.pointerId===ye.value){if((i=(e=s.value)==null?void 0:e.hasPointerCapture)==null?void 0:i.call(e,o.pointerId))return;ye.value=null,Qe()}at.isDragging||(K.value=null,_e())},An=o=>{var w;if(!M.value||!Ne.value)return;const e=M.value.getBoundingClientRect(),i=window.devicePixelRatio||1,b=(o.clientX-e.left)*i,r=(o.clientY-e.top)*i;pt(o.deltaY<0?1.14:.88,b,r,(w=N.value)==null?void 0:w.bounds),_e()},Mn=(o,e)=>{ve.metric=o,Zt(o,e)},Zt=(o,e)=>{if(!y.value)return;const i=y.value.getBoundingClientRect();ve.visible=!0,ve.metric=o,ve.x=e.clientX-i.left,ve.y=e.clientY-i.top},Nn=()=>{ve.visible=!1},Xt=o=>String(o||"figure").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),Jt=(o,e="image/png",i=1)=>new Promise((b,r)=>{o.toBlob(w=>{w?b(w):r(new Error("Canvas 导出失败"))},e,i)}),In=o=>{const e=o.cloneNode(!0);return e.getAttribute("xmlns")||e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.getAttribute("xmlns:xlink")||e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),new XMLSerializer().serializeToString(e)},$n=(o,e,i,b=3)=>Ce(this,null,function*(){const r=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),w=URL.createObjectURL(r);try{const S=yield new Promise((se,fe)=>{const Z=new Image;Z.onload=()=>se(Z),Z.onerror=()=>fe(new Error("SVG 转 PNG 失败")),Z.src=w}),A=document.createElement("canvas");A.width=Math.max(1,Math.round(e*b)),A.height=Math.max(1,Math.round(i*b));const T=A.getContext("2d");return T.fillStyle="#ffffff",T.fillRect(0,0,A.width,A.height),T.drawImage(S,0,0,A.width,A.height),yield Jt(A,"image/png",1)}finally{URL.revokeObjectURL(w)}}),Rn=()=>new Promise(o=>window.requestAnimationFrame(o)),Kt=o=>Ce(this,null,function*(){const e=Ke.value;Ke.value=!0,Bt(),yield Rn();try{return yield o()}finally{Ke.value=e,Bt(),n.value&&_e()}}),Pn=()=>Ce(this,null,function*(){!c.value||!M.value||(yield Kt(()=>Ce(this,null,function*(){const e=c.value.width,i=c.value.height,b=document.createElement("canvas");b.width=Math.round(e*3),b.height=Math.round(i*3);const r=b.getContext("2d");r.scale(3,3),r.fillStyle="#ffffff",r.fillRect(0,0,e,i),r.drawImage(c.value,0,0),r.drawImage(M.value,0,0),r.fillStyle="rgba(15, 23, 42, 0.92)",r.font="14px 'Times New Roman', 'Noto Serif SC', serif",r.fillText(`煤层：${k.value||"--"} | 指标：${P(G.value)} | 分辨率：${R.value}`,16,26);const w=document.createElement("a");w.href=b.toDataURL("image/png",1),w.download=`algorithm_validation_${k.value||"seam"}_${G.value}_hd.png`,w.click()})))}),Fn=()=>Ce(this,null,function*(){if(!(!z.value||!Ne.value||re.value)){re.value=!0,ke.value="";try{yield Kt(()=>Ce(this,null,function*(){var Me,Pe,qe;const o=yield dt(),e=new o,i=new Date().toISOString().replace(/[:.]/g,"-"),b=document.createElement("canvas"),r=3,w=c.value.width,S=c.value.height;b.width=Math.round(w*r),b.height=Math.round(S*r);const A=b.getContext("2d");A.scale(r,r),A.fillStyle="#ffffff",A.fillRect(0,0,w,S),A.drawImage(c.value,0,0),A.drawImage(M.value,0,0),A.fillStyle="rgba(15, 23, 42, 0.92)",A.font="14px 'Times New Roman', 'Noto Serif SC', serif",A.fillText(`煤层：${k.value||"--"} | 指标：${P(G.value)} | 分辨率：${R.value}`,16,26),e.file("figures/main_heatmap_hd.png",yield Jt(b,"image/png",1));const T=z.value.querySelectorAll(".science-section .figure-card");let se=0;for(const Ye of T){se+=1;const Ie=((Pe=(Me=Ye.querySelector("h4"))==null?void 0:Me.textContent)==null?void 0:Pe.trim())||`图${se}`,Ze=Ye.querySelector(".science-chart svg");if(!Ze)continue;const It=Ze.getBoundingClientRect(),Ve=(qe=Ze.viewBox)==null?void 0:qe.baseVal,Bn=(Ve==null?void 0:Ve.width)||It.width||960,On=(Ve==null?void 0:Ve.height)||It.height||540,Qt=In(Ze),en=Xt(`${String(se).padStart(2,"0")}_${Ie}`);e.file(`figures/${en}.svg`,Qt),e.file(`figures/${en}.png`,yield $n(Qt,Bn,On,3))}e.file("data/spatial_statistics.json",JSON.stringify(je.value,null,2)),e.file("data/evaluation.json",JSON.stringify(B.value||{},null,2)),e.file("data/science_result.json",JSON.stringify(it.value||{},null,2)),e.file("README.txt",["新算法实证图组导出包",`时间: ${new Date().toLocaleString()}`,`煤层: ${k.value||"--"}`,`主图指标: ${P(G.value)}`,"","内容说明:","- figures/: 主热力图和图2-图11（SVG+PNG）","- data/: 统计与评估原始数据"].join(`
`));const fe=yield e.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),Z=URL.createObjectURL(fe),Se=document.createElement("a");Se.href=Z,Se.download=`新算法实证图组_${Xt(k.value||"seam")}_${i}.zip`,Se.click(),URL.revokeObjectURL(Z)})),ke.value="图组包导出完成。"}catch(o){ke.value=(o==null?void 0:o.message)||"图组包导出失败"}finally{re.value=!1}}}),Tn=()=>{if(!N.value)return;const o=new Blob([JSON.stringify(N.value,null,2)],{type:"application/json"}),e=URL.createObjectURL(o),i=document.createElement("a");i.href=e,i.download=`algorithm_validation_${k.value||"seam"}_spatial.json`,i.click(),URL.revokeObjectURL(e)},Ln=()=>Ce(this,null,function*(){z.value&&(document.fullscreenElement?yield document.exitFullscreen():yield z.value.requestFullscreen())}),zn=o=>Array.isArray(o)?o[0]||"":typeof o=="string"?o:"",En=()=>{x.push({name:"Report",query:k.value?{seam:k.value}:void 0})},Dn=()=>Ce(this,null,function*(){var o,e,i,b;try{const r=yield to(),w=((o=r==null?void 0:r.data)==null?void 0:o.seams)||[];if(D.value=w,w.length===0)return;const S=zn((e=Y.query)==null?void 0:e.seam)||Ae.selectedSeam||"16-3煤",A=w.find(T=>T.name===S);k.value=(A==null?void 0:A.name)||w[0].name,v(k.value)}catch(r){be.value=((b=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:b.detail)||"煤层列表加载失败"}});return ze(G,()=>_e()),ze(le,()=>_e()),ze(I,()=>{At(),_e()}),ze(U,()=>{_e(),Mt()}),ze([R,H],()=>{me.value&&Nt({force:!1})}),ze(k,()=>{v(k.value||""),me.value&&Nt({force:!1})}),ze(et,o=>{!o&&ge.value!=="all"&&(ge.value="all",_e())}),ze(()=>[V.rsi,V.bri,V.asi],()=>{me.value&&(window.clearTimeout(_),_=window.setTimeout(()=>Nt({force:!1}),300))}),mn(()=>Ce(this,null,function*(){At(),yield Dn(),k.value&&(yield Nt({force:!0})),me.value=!0,window.addEventListener("resize",j),window.addEventListener("keydown",Yt)})),pn(()=>{var o,e;window.clearTimeout(_),window.clearTimeout(d),l&&window.cancelAnimationFrame(l),u&&window.cancelAnimationFrame(u),s.value&&ye.value!==null&&((e=(o=s.value).hasPointerCapture)!=null&&e.call(o,ye.value))&&s.value.releasePointerCapture(ye.value),ye.value=null,window.removeEventListener("resize",j),window.removeEventListener("keydown",Yt)}),(o,e)=>{var i,b;return Q(),ee("div",{ref_key:"pageRoot",ref:z,class:"validation-page"},[a("nav",Oo,[a("div",Uo,[a("button",{class:"icon-btn",type:"button",title:"返回",onClick:e[0]||(e[0]=r=>Jn(x).back())},[...e[16]||(e[16]=[a("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[a("path",{d:"M19 12H5m0 0 6-6m-6 6 6 6"})],-1)])]),e[21]||(e[21]=a("h1",null,"新算法实证",-1)),e[22]||(e[22]=a("span",{class:"divider"},null,-1)),a("label",Vo,[e[17]||(e[17]=a("span",null,"煤层",-1)),Ee(a("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>k.value=r)},[(Q(!0),ee(Xe,null,Ot(D.value,r=>(Q(),ee("option",{key:r.name,value:r.name},f(r.name),9,Wo))),128))],512),[[an,k.value]])]),Ne.value?(Q(),ee("div",Ho,[a("span",null,[e[18]||(e[18]=Fe("均值 ",-1)),a("b",null,f(C(lt.value.mean)),1)]),a("span",null,[e[19]||(e[19]=Fe("最低 ",-1)),a("b",null,f(C(lt.value.min)),1)]),a("span",jo,[e[20]||(e[20]=Fe("高风险点 ",-1)),a("b",null,f(Tt.value),1)])])):he("",!0)]),a("div",Go,[a("button",{class:tt(["tool-btn",{active:oe.value}]),type:"button",onClick:e[2]||(e[2]=r=>oe.value=!oe.value)},"权重",2),a("button",{class:tt(["tool-btn",{active:pe.value}]),type:"button",onClick:e[3]||(e[3]=r=>pe.value=!pe.value)},"评估",2),a("button",{class:"tool-btn",type:"button",onClick:Pn},"导出高清图"),a("button",{class:"tool-btn",type:"button",disabled:re.value||!Ne.value,onClick:Fn},f(re.value?"打包中...":"导出图组包"),9,qo),a("button",{class:"tool-btn",type:"button",disabled:!Ne.value,onClick:En},"下一步：结果报告",8,Yo),a("button",{class:"tool-btn",type:"button",onClick:Ln},"全屏")])]),a("section",Zo,[(Q(),ee(Xe,null,Ot(h,r=>{var w,S,A,T,se,fe,Z,Se,Me;return a("button",{key:r.key,class:tt(["metric-card",{active:G.value===r.key,problematic:$(r.key)}]),type:"button",onClick:Pe=>G.value=r.key},[a("div",Jo,[a("strong",null,f(r.label),1),a("span",null,f(r.desc),1),$(r.key)?(Q(),ee("em",Ko,"! 异常")):he("",!0)]),a("div",Qo,f(C((A=(S=(w=N.value)==null?void 0:w.statistics)==null?void 0:S[r.key])==null?void 0:A.mean)),1),a("div",ea,[a("span",null,"最低 "+f(C((fe=(se=(T=N.value)==null?void 0:T.statistics)==null?void 0:se[r.key])==null?void 0:fe.min)),1),a("span",null,"最高 "+f(C((Me=(Se=(Z=N.value)==null?void 0:Z.statistics)==null?void 0:Se[r.key])==null?void 0:Me.max)),1)]),a("div",{class:"risk-bar",style:ct({background:O(r.key)})},null,4)],10,Xo)}),64))]),a("section",ta,[a("div",na,[a("header",oa,[a("div",null,[a("h2",null,f(P(G.value))+"全矿区插值热力图",1),e[23]||(e[23]=a("p",null,"双击适配视图，拖拽平移，滚轮缩放",-1))]),a("div",aa,[a("label",null,[e[24]||(e[24]=Fe("分辨率",-1)),Ee(a("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>R.value=r),type:"number",min:"20",max:"120",step:"5"},null,512),[[ut,R.value,void 0,{number:!0}]])]),a("label",null,[e[25]||(e[25]=Fe("线级",-1)),Ee(a("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>I.value=r),type:"number",min:"5",max:"24",step:"1"},null,512),[[ut,I.value,void 0,{number:!0}]])]),a("label",null,[e[27]||(e[27]=Fe("插值 ",-1)),Ee(a("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>H.value=r)},[...e[26]||(e[26]=[a("option",{value:"idw"},"反距离权重",-1),a("option",{value:"linear"},"线性插值",-1),a("option",{value:"nearest"},"最近邻",-1),a("option",{value:"kriging"},"克里金",-1)])],512),[[an,H.value]])]),a("label",la,[Ee(a("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>le.value=r),type:"checkbox"},null,512),[[ln,le.value]]),e[28]||(e[28]=Fe("等值线",-1))]),a("label",sa,[Ee(a("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>U.value=r),type:"checkbox"},null,512),[[ln,U.value]]),e[29]||(e[29]=Fe("固定量程(0-100)",-1))])])]),Ne.value?(Q(),ee("div",ra,[e[30]||(e[30]=a("span",{class:"trust-chip real"},"空间图：真实钻孔与坐标数据",-1)),a("span",ia,"评估："+f(Lt.value),1),a("span",ua,"算法："+f(Pt.value),1),wt.value.length?(Q(),ee("span",ca," 指标异常："+f(wt.value.join("、")),1)):he("",!0),Ft.value?(Q(),ee("span",da,"当前指标范围 "+f(C(_t.value))+"，固定量程会压缩色差",1)):he("",!0),ge.value!=="all"&&kt.value>0?(Q(),ee("span",ma," 联动高亮 "+f(zt(ge.value))+" · "+f(kt.value)+"点 ",1)):he("",!0),Je.value?(Q(),ee("span",pa,"标签源 "+f(Je.value),1)):he("",!0),a("span",va,"钻孔 "+f(((i=N.value)==null?void 0:i.borehole_count)||0)+" 个 · 坐标源 zuobiao.csv",1)])):he("",!0),a("div",{ref_key:"stageContainer",ref:s,class:"stage",onPointerdown:wn,onPointermove:_n,onPointerup:Sn,onPointercancel:kn,onPointerleave:Cn,onWheel:sn(An,["prevent"]),onContextmenu:e[9]||(e[9]=sn(()=>{},["prevent"])),onDblclick:Dt},[a("canvas",{ref_key:"heatmapCanvas",ref:c,class:"layer"},null,512),a("canvas",{ref_key:"overlayCanvas",ref:M,class:"layer"},null,512),de.value?(Q(),ee("div",fa,[e[31]||(e[31]=a("div",{class:"skeleton"},null,-1)),e[32]||(e[32]=a("div",{class:"skeleton"},null,-1)),a("p",null,"正在计算 "+f(k.value||"目标煤层")+" 空间指标...",1)])):he("",!0)],544),a("footer",ya,[a("div",{class:"legend-track",style:ct({background:O(G.value)})},null,4),a("div",ha,[a("span",null,f(C(rt.value.min)),1),a("span",null,f(C(rt.value.mean)),1),a("span",null,f(C(rt.value.max)),1)])])]),a("aside",{ref_key:"thumbPanelRef",ref:y,class:tt(["thumb-panel",{collapsed:we.value}])},[a("header",null,[e[33]||(e[33]=a("h3",null,"指标缩略图",-1)),a("button",{class:"icon-btn mini",type:"button",onClick:e[10]||(e[10]=r=>we.value=!we.value)},f(we.value?"展开":"收起"),1)]),a("div",ba,[(Q(),ee(Xe,null,Ot(h,r=>{var w,S;return a("button",{key:`thumb-${r.key}`,class:tt(["thumb-item",{active:G.value===r.key}]),type:"button",onClick:A=>G.value=r.key,onMouseenter:A=>Mn(r.key,A),onMousemove:A=>Zt(r.key,A),onMouseleave:Nn},[a("canvas",{ref_for:!0,ref:yn(r.key),class:"thumb-canvas"},null,512),a("div",xa,[a("strong",null,f(r.label),1),a("span",null,"均值 "+f(C((w=je.value[r.key])==null?void 0:w.mean)),1),a("span",null,"σ "+f(C((S=je.value[r.key])==null?void 0:S.std)),1)])],42,ga)}),64))]),ve.visible&&Ge.value?(Q(),ee("div",{key:0,class:"thumb-tooltip",style:ct({left:`${ve.x+12}px`,top:`${ve.y+12}px`})},[a("p",null,[a("strong",null,f(P(ve.metric))+"统计",1)]),a("p",null,"最小值 "+f(C(Ge.value.min)),1),a("p",null,"最大值 "+f(C(Ge.value.max)),1),a("p",null,"均值 "+f(C(Ge.value.mean)),1),a("p",null,"标准差 "+f(C(Ge.value.std)),1)],4)):he("",!0)],2)]),$e(un,{name:"fade-up"},{default:rn(()=>[oe.value?(Q(),ee("aside",wa,[a("header",null,[e[34]||(e[34]=a("h3",null,"权重配置",-1)),a("button",{type:"button",class:"close-btn",onClick:e[11]||(e[11]=r=>oe.value=!1)},"×")]),e[38]||(e[38]=a("p",null,"RSI / BRI / ASI 自动归一化。调整后 300ms 内自动重算。",-1)),a("label",_a,[e[35]||(e[35]=a("span",null,"RSI",-1)),Ee(a("input",{"onUpdate:modelValue":e[12]||(e[12]=r=>V.rsi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[ut,V.rsi,void 0,{number:!0}]]),a("strong",null,f(p(Oe.value.rsi)),1)]),a("label",Sa,[e[36]||(e[36]=a("span",null,"BRI",-1)),Ee(a("input",{"onUpdate:modelValue":e[13]||(e[13]=r=>V.bri=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[ut,V.bri,void 0,{number:!0}]]),a("strong",null,f(p(Oe.value.bri)),1)]),a("label",ka,[e[37]||(e[37]=a("span",null,"ASI",-1)),Ee(a("input",{"onUpdate:modelValue":e[14]||(e[14]=r=>V.asi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[ut,V.asi,void 0,{number:!0}]]),a("strong",null,f(p(Oe.value.asi)),1)])])):he("",!0)]),_:1}),$e(un,{name:"drawer-up"},{default:rn(()=>{var r,w,S,A,T,se,fe,Z;return[pe.value?(Q(),ee("section",Ca,[a("header",null,[e[39]||(e[39]=a("h3",null,"算法评估面板（当前煤层批量结果）",-1)),a("div",Aa,[a("button",{type:"button",class:"tool-btn small",onClick:Tn},"导出数据"),a("button",{type:"button",class:"close-btn",onClick:e[15]||(e[15]=Se=>pe.value=!1)},"×")])]),ue.value?(Q(),ee("div",Ma,"正在计算评估指标...")):B.value?(Q(),ee(Xe,{key:2},[a("div",Ia,[a("div",$a,[e[40]||(e[40]=a("span",null,"AUC",-1)),a("strong",null,f(C(B.value.auc,4)),1)]),a("div",Ra,[e[41]||(e[41]=a("span",null,"PR-AUC",-1)),a("strong",null,f(C(B.value.pr_auc,4)),1)]),a("div",Pa,[e[42]||(e[42]=a("span",null,"F1",-1)),a("strong",null,f(C(B.value.f1,4)),1)]),a("div",Fa,[e[43]||(e[43]=a("span",null,"Brier",-1)),a("strong",null,f(C(B.value.brier,4)),1)]),a("div",Ta,[e[44]||(e[44]=a("span",null,"ECE",-1)),a("strong",null,f(C(B.value.ece,4)),1)])]),a("div",La,[a("div",za,[e[49]||(e[49]=a("h4",null,"混淆矩阵",-1)),a("div",Ea,[a("div",Da,[e[45]||(e[45]=a("span",null,"TN",-1)),a("b",null,f((w=(r=B.value.confusion_matrix)==null?void 0:r.tn)!=null?w:0),1)]),a("div",Ba,[e[46]||(e[46]=a("span",null,"FP",-1)),a("b",null,f((A=(S=B.value.confusion_matrix)==null?void 0:S.fp)!=null?A:0),1)]),a("div",Oa,[e[47]||(e[47]=a("span",null,"FN",-1)),a("b",null,f((se=(T=B.value.confusion_matrix)==null?void 0:T.fn)!=null?se:0),1)]),a("div",Ua,[e[48]||(e[48]=a("span",null,"TP",-1)),a("b",null,f((Z=(fe=B.value.confusion_matrix)==null?void 0:fe.tp)!=null?Z:0),1)])])]),a("div",Va,[e[56]||(e[56]=a("h4",null,"基线对比（SVG）",-1)),(Q(),ee("svg",Wa,[e[50]||(e[50]=a("rect",{x:"0",y:"0",width:"560",height:"170",fill:"#fff"},null,-1)),e[51]||(e[51]=a("text",{x:"14",y:"26"},"基线 MPI",-1)),e[52]||(e[52]=a("rect",{x:"112",y:"12",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),a("rect",{x:"112",y:"12",width:te(St.value),height:"18",rx:"9",fill:"#64748b"},null,8,Ha),a("text",ja,f(C(St.value,3)),1),e[53]||(e[53]=a("text",{x:"14",y:"90"},"新算法 MPI",-1)),e[54]||(e[54]=a("rect",{x:"112",y:"76",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),a("rect",{x:"112",y:"76",width:te(st.value),height:"18",rx:"9",fill:"#0f766e"},null,8,Ga),a("text",qa,f(C(st.value,3)),1),e[55]||(e[55]=a("text",{x:"14",y:"148",fill:"#64748b"},"注：基于当前煤层批量钻孔的空间实证均值。",-1))]))])])],64)):(Q(),ee("div",Na,f(be.value||"暂无评估数据"),1))])):he("",!0)]}),_:1}),Ne.value?(Q(),ee("section",Ya,[a("header",null,[e[58]||(e[58]=a("h3",null,"期刊级图组（自动生成）",-1)),e[59]||(e[59]=a("p",null,"全部图件已直接展示，满足对比、消融、校准、判别与机制解释需求。",-1)),e[60]||(e[60]=a("p",{class:"data-note"},"说明：评估与部分机制曲线目前为模型推导/示意，不等同于真实标签实验结果。",-1)),a("p",Za,[e[57]||(e[57]=Fe(" 图11支持点击 TP/TN/FP/FN 联动主图高亮。 ",-1)),ge.value!=="all"?(Q(),ee(Xe,{key:0},[Fe("可按 Esc 快速清除筛选。")],64)):he("",!0),et.value?he("",!0):(Q(),ee(Xe,{key:1},[Fe("当前样本与钻孔点未一一对齐，联动高亮不可用。")],64))]),e[61]||(e[61]=a("p",{class:"data-note"},"导出高清图与图组包时会自动冻结脉冲动画，保证稿件图件为静态一致版。",-1)),ge.value!=="all"?(Q(),ee("button",{key:0,type:"button",class:"tool-btn small",onClick:qt},"清除联动高亮")):he("",!0),ke.value?(Q(),ee("p",Xa,f(ke.value),1)):he("",!0)]),$e(Bo,{result:it.value,evaluation:B.value,onMatrixSelect:xn},null,8,["result","evaluation"])])):he("",!0),K.value&&Ne.value?(Q(),ee("div",{key:1,class:"hover-tooltip",style:ct({left:`${Re.x+14}px`,top:`${Re.y+14}px`})},[a("p",null,"坐标："+f(C(K.value.worldX,2))+", "+f(C(K.value.worldY,2)),1),a("p",null,f(P(G.value))+"插值："+f(C(K.value.gridValue,3)),1),a("p",null,"最近钻孔："+f(((b=K.value.nearestBorehole)==null?void 0:b.borehole_name)||"--")+"（"+f(C(K.value.nearestDistance,1))+" m）",1),K.value.borehole?(Q(),ee(Xe,{key:0},[a("p",null,[a("strong",null,f(K.value.borehole.borehole_name),1)]),a("p",null,"RSI "+f(C(K.value.borehole.rsi,2))+" | BRI "+f(C(K.value.borehole.bri,2)),1),a("p",null,"ASI "+f(C(K.value.borehole.asi,2))+" | MPI "+f(C(K.value.borehole.mpi,2)),1),a("p",Ja,f(ie(K.value.borehole.risk_label)),1)],64)):he("",!0)],4)):he("",!0)],512)}}},il=Wt(Qa,[["__scopeId","data-v-ccf8a7be"]]);export{il as default};
