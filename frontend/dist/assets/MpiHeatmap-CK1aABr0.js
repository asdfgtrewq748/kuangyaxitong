var N=($,C,s)=>new Promise((x,I)=>{var E=f=>{try{k(s.next(f))}catch(R){I(R)}},_=f=>{try{k(s.throw(f))}catch(R){I(R)}},k=f=>f.done?x(f.value):Promise.resolve(f.value).then(E,_);k((s=s.apply($,C)).next())});import{w as de,bf as fe,b4 as ke,b5 as h,b8 as y,b7 as e,bc as ue,b9 as ce,bq as W,bw as ge,bb as w,bo as q,bi as L,bj as he,bh as xe,bn as ye,ba as oe,bx as we,n as _e,b,c as Y,bm as ve,br as J,bu as pe,bs as Me,bt as me}from"./vendor-DlrH7ZQK.js";import{_ as be,a as Ce}from"./index-DeI7uYOw.js";import{a as Ie,n as $e,d as Pe,o as Se,q as Re,r as Be}from"./api-C8NVcaPd.js";import"./vue-router-u9NpsLKd.js";import"./network-T6nY3V_4.js";const je={class:"mpi-heatmap-viewer"},Ue={key:0,class:"heatmap-skeleton"},Ee={class:"skeleton-grid"},Ve=["src"],Fe={key:1,class:"empty-state"},Ne={class:"empty-text"},Te={key:3,class:"empty-state"},Le=["aria-label"],Oe={class:"tooltip-body"},He={class:"tooltip-row"},We={class:"tooltip-value"},De={class:"tooltip-row"},ze={class:"tooltip-value"},Xe={class:"tooltip-row tooltip-row-highlight"},Ae={class:"tooltip-value tooltip-value-primary"},Ye={class:"tooltip-row"},Je={__name:"MpiHeatmapViewer",props:{mode:{type:String,default:"image"},imageUrl:{type:String,default:""},grid:{type:Array,default:()=>[]},bounds:{type:Object,default:null},workface:{type:Object,default:null},showBoundary:{type:Boolean,default:!0},showMask:{type:Boolean,default:!0},palette:{type:Array,default:()=>[]},size:{type:Number,default:560},loading:{type:Boolean,default:!1}},emits:["hover","imageError","retry","export","fullscreen"],setup($,{emit:C}){const s=$,x=C,I=b(null),E=b(null),_=b(null),k=b(null),f=b(null),R=b({x:0,y:0}),T=b(""),B=Y(()=>({left:`${R.value.x+16}px`,top:`${R.value.y+16}px`})),D=Y(()=>!s.grid||s.grid.length===0),j=["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],O=Y(()=>s.palette&&s.palette.length?s.palette:j),U={left:.1,top:.1,width:.85,height:.8},G=o=>o==null?"未知":o>=.7?"低风险":o>=.4?"中等风险":"高风险",z=o=>o==null?"risk-unknown":o>=.7?"risk-low":o>=.4?"risk-medium":"risk-high",K=()=>{if(s.mode==="image"&&s.imageUrl){const o=document.createElement("a");o.href=s.imageUrl,o.download=`MPI热力图_${new Date().toISOString().slice(0,10)}.png`,o.click()}else if(s.mode==="canvas"&&_.value){const o=document.createElement("a");o.download=`MPI热力图_${new Date().toISOString().slice(0,10)}.png`,o.href=_.value.toDataURL("image/png"),o.click()}x("export")},ne=()=>{I.value&&(document.fullscreenElement?document.exitFullscreen():I.value.requestFullscreen()),x("fullscreen")},V=()=>N(this,null,function*(){yield _e();const o=I.value;if(!o)return;const a=o.getBoundingClientRect(),l=Math.floor(a.width),c=Math.floor(a.height),i=window.devicePixelRatio||1,v=k.value;v&&(v.width=l*i,v.height=c*i,v.style.width=`${l}px`,v.style.height=`${c}px`,v.getContext("2d").setTransform(i,0,0,i,0,0));const n=_.value;n&&s.mode==="canvas"&&(n.width=l*i,n.height=c*i,n.style.width=`${l}px`,n.style.height=`${c}px`,n.getContext("2d").setTransform(i,0,0,i,0,0)),se(),re()}),M=()=>{T.value="热力图图片加载失败",x("imageError")},X=()=>{const o=I.value;if(!o)return null;const a=o.getBoundingClientRect();let l=0,c=0,i=a.width,v=a.height;if(s.mode==="image"&&E.value){const n=E.value.getBoundingClientRect();l=n.left-a.left,c=n.top-a.top,i=n.width,v=n.height}return{x:l+i*U.left,y:c+v*U.top,width:i*U.width,height:v*U.height}},Q=(o,a)=>{if(!s.bounds)return{x:0,y:0};const l=X();if(!l)return{x:0,y:0};const c=s.bounds.max_x-s.bounds.min_x,i=s.bounds.max_y-s.bounds.min_y,v=(o-s.bounds.min_x)/(c||1),n=(s.bounds.max_y-a)/(i||1);return{x:l.x+v*l.width,y:l.y+n*l.height}},Z=(o,a)=>{if(!s.bounds)return null;const l=X();if(!l||o<l.x||a<l.y||o>l.x+l.width||a>l.y+l.height)return null;const c=(o-l.x)/l.width,i=(a-l.y)/l.height;return{x:s.bounds.min_x+c*(s.bounds.max_x-s.bounds.min_x),y:s.bounds.max_y-i*(s.bounds.max_y-s.bounds.min_y)}},le=o=>{var u,p;if(!o||!s.grid||s.grid.length===0)return null;const a=s.grid.length,l=((u=s.grid[0])==null?void 0:u.length)||0;if(a===0||l===0)return null;const c=s.bounds.max_x-s.bounds.min_x,i=s.bounds.max_y-s.bounds.min_y,v=Math.min(l-1,Math.max(0,Math.round((o.x-s.bounds.min_x)/(c||1)*(l-1)))),n=Math.min(a-1,Math.max(0,Math.round((o.y-s.bounds.min_y)/(i||1)*(a-1)))),t=(p=s.grid[n])==null?void 0:p[v];return Number.isFinite(t)?t:null},ie=o=>{var t;const a=(t=I.value)==null?void 0:t.getBoundingClientRect();if(!a)return;const l=o.clientX-a.left,c=o.clientY-a.top;R.value={x:l,y:c};const i=Z(l,c);if(!i){f.value=null,x("hover",null);return}const v=le(i);if(v==null){f.value=null,x("hover",null);return}const n={x:i.x,y:i.y,value:v};f.value=n,x("hover",n)},ee=()=>{f.value=null,x("hover",null)},te=o=>{const a=O.value,l=o*(a.length-1),c=Math.floor(l),i=l-c,v=a[Math.min(c,a.length-1)],n=a[Math.min(c+1,a.length-1)],t=S=>{const r=S.replace("#",""),F=parseInt(r.slice(0,2),16),A=parseInt(r.slice(2,4),16),ae=parseInt(r.slice(4,6),16);return{r:F,g:A,b:ae}},u=t(v),p=t(n),g=Math.round(u.r+(p.r-u.r)*i),d=Math.round(u.g+(p.g-u.g)*i),P=Math.round(u.b+(p.b-u.b)*i);return`rgb(${g}, ${d}, ${P})`},se=()=>{var p;if(s.mode!=="canvas"||!_.value||!s.grid||s.grid.length===0)return;const o=_.value.getContext("2d"),a=X();if(!a)return;o.clearRect(0,0,_.value.width,_.value.height);const l=s.grid.length,c=((p=s.grid[0])==null?void 0:p.length)||0;let i=1/0,v=-1/0;for(const g of s.grid)for(const d of g)Number.isFinite(d)&&(d<i&&(i=d),d>v&&(v=d));const n=v-i||1,t=a.width/c,u=a.height/l;for(let g=0;g<l;g++)for(let d=0;d<c;d++){const P=s.grid[g][d];if(!Number.isFinite(P))continue;const S=(P-i)/n;o.fillStyle=te(S),o.fillRect(a.x+d*t,a.y+g*u,t+.5,u+.5)}},re=()=>{if(!k.value)return;const o=k.value.getContext("2d"),a=k.value.getBoundingClientRect();if(o.clearRect(0,0,a.width,a.height),!s.workface||!s.bounds)return;const l=s.workface.type==="polygon"?s.workface.points:[[s.workface.bounds.min_x,s.workface.bounds.min_y],[s.workface.bounds.max_x,s.workface.bounds.min_y],[s.workface.bounds.max_x,s.workface.bounds.max_y],[s.workface.bounds.min_x,s.workface.bounds.max_y]];!l||l.length<3||(o.save(),o.beginPath(),l.forEach((c,i)=>{const v=Q(c[0],c[1]);i===0?o.moveTo(v.x,v.y):o.lineTo(v.x,v.y)}),o.closePath(),s.showMask&&(o.fillStyle="rgba(37, 99, 235, 0.18)",o.fill()),s.showBoundary&&(o.strokeStyle="rgba(30, 64, 175, 0.9)",o.lineWidth=2,o.setLineDash([6,4]),o.stroke(),o.setLineDash([])),o.restore())};return de(()=>[s.mode,s.grid,s.bounds,s.workface,s.showBoundary,s.showMask,s.imageUrl],()=>{s.imageUrl&&(T.value=""),V()},{deep:!0}),fe(()=>{window.addEventListener("resize",V),V()}),ke(()=>{window.removeEventListener("resize",V)}),(o,a)=>(h(),y("div",je,[$.loading?(h(),y("div",Ue,[a[1]||(a[1]=e("div",{class:"skeleton-header"},[e("div",{class:"skeleton-title"}),e("div",{class:"skeleton-subtitle"})],-1)),e("div",Ee,[(h(),y(ue,null,ce(9,l=>e("div",{key:l,class:"skeleton-cell"})),64))]),a[2]||(a[2]=W('<div class="skeleton-spinner" data-v-b7f5e698><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b7f5e698><circle cx="12" cy="12" r="10" opacity="0.25" data-v-b7f5e698></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round" data-v-b7f5e698><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite" data-v-b7f5e698></animateTransform></path></svg></div>',1))])):(h(),y("div",{key:1,ref_key:"stageRef",ref:I,class:"heatmap-stage",onMousemove:ie,onMouseleave:ee,tabindex:"0",onKeydown:ge(ee,["esc"])},[$.mode==="image"&&$.imageUrl?(h(),y("img",{key:0,ref_key:"imageRef",ref:E,src:$.imageUrl,class:"heatmap-image",loading:"lazy",decoding:"async",onLoad:V,onError:M,alt:"MPI热力图"},null,40,Ve)):$.mode==="image"&&!$.imageUrl?(h(),y("div",Fe,[a[4]||(a[4]=W('<div class="empty-icon" data-v-b7f5e698><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b7f5e698><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-b7f5e698></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-b7f5e698></circle><polyline points="21 15 16 10 5 21" data-v-b7f5e698></polyline></svg></div>',1)),e("p",Ne,w(T.value||"暂无热力图图片"),1),T.value?(h(),y("button",{key:0,class:"btn-retry",onClick:a[0]||(a[0]=l=>o.$emit("retry"))},[...a[3]||(a[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"})],-1),q(" 重试 ",-1)])])):L("",!0)])):L("",!0),$.mode==="canvas"?(h(),y("canvas",{key:2,ref_key:"heatmapCanvas",ref:_,class:"heatmap-canvas"},null,512)):L("",!0),$.mode==="canvas"&&D.value?(h(),y("div",Te,[...a[5]||(a[5]=[W('<div class="empty-icon" data-v-b7f5e698><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b7f5e698><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-b7f5e698></rect><line x1="3" y1="9" x2="21" y2="9" data-v-b7f5e698></line><line x1="9" y1="21" x2="9" y2="9" data-v-b7f5e698></line></svg></div><p class="empty-text" data-v-b7f5e698>暂无MPI网格数据</p>',2)])])):L("",!0),e("canvas",{ref_key:"overlayCanvas",ref:k,class:"overlay-canvas"},null,512),he(we,{name:"tooltip-fade"},{default:xe(()=>{var l,c;return[f.value?(h(),y("div",{key:0,class:"hover-tooltip",style:ye(B.value),role:"tooltip","aria-label":`MPI值: ${(l=f.value.value)==null?void 0:l.toFixed(2)}`},[a[11]||(a[11]=e("div",{class:"tooltip-header"},[e("svg",{class:"tooltip-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"}),e("path",{d:"M12 6v6l4 2"})]),e("span",{class:"tooltip-title"},"MPI综合指标")],-1)),e("div",Oe,[e("div",He,[a[6]||(a[6]=e("span",{class:"tooltip-label"},"X坐标",-1)),e("span",We,w(f.value.x.toFixed(1))+" m",1)]),e("div",De,[a[7]||(a[7]=e("span",{class:"tooltip-label"},"Y坐标",-1)),e("span",ze,w(f.value.y.toFixed(1))+" m",1)]),a[10]||(a[10]=e("div",{class:"tooltip-divider"},null,-1)),e("div",Xe,[a[8]||(a[8]=e("span",{class:"tooltip-label"},"MPI值",-1)),e("span",Ae,w((c=f.value.value)==null?void 0:c.toFixed(3)),1)]),e("div",Ye,[a[9]||(a[9]=e("span",{class:"tooltip-label"},"风险等级",-1)),e("span",{class:oe(["tooltip-badge",z(f.value.value)])},w(G(f.value.value)),3)])])],12,Le)):L("",!0)]}),_:1}),e("div",{class:"export-actions"},[e("button",{class:"btn-export",onClick:K,title:"导出热力图"},[...a[12]||(a[12]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])]),e("button",{class:"btn-export",onClick:ne,title:"全屏显示"},[...a[13]||(a[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})],-1)])])])],544))]))}},qe=be(Je,[["__scopeId","data-v-b7f5e698"]]),Ge={class:"page mpi-heatmap-page"},Ke={class:"mpi-layout"},Qe={class:"left-panel"},Ze={class:"card"},et={class:"sample-actions"},tt={key:0,class:"workface-list"},st={class:"workface-header"},at={class:"workface-items"},ot=["onClick"],nt={class:"workface-type"},lt={key:1,class:"empty-tip"},it={class:"card"},rt={class:"param-group"},dt=["value"],ut={class:"param-group"},ct={class:"param-group"},vt={class:"action-buttons"},pt=["disabled"],mt={key:0,class:"spinner sm"},ft=["disabled"],gt={class:"card"},ht={class:"toggle-row"},yt={class:"toggle-item"},bt={class:"toggle-item"},kt={class:"param-group"},xt={class:"mode-tabs"},wt={class:"right-panel"},_t={class:"card"},Mt={class:"heatmap-header"},Ct={class:"heatmap-actions"},It={key:0,class:"tag"},$t={key:1,class:"tag ghost"},Pt={key:0,class:"workface-bounds"},St={key:1,class:"legend"},Rt={key:2,class:"stats-grid"},Bt={class:"stat-item"},jt={class:"stat-value"},Ut={class:"stat-item"},Et={class:"stat-value"},Vt={class:"stat-item"},Ft={class:"stat-value"},Nt={class:"stat-item"},Tt={class:"stat-value"},Lt={key:3,class:"empty-state"},Ot={__name:"MpiHeatmap",setup($){const C=Ce(),s=b([]),x=b(""),I=b("idw"),E=b(80),_=b(!1),k=b([]),f=b(0),R=b(!0),T=b(!0),B=b("image"),D=b(""),j=b(null),O=b(null),U=b({}),G=b(null),z=new Map,K=["#0e7490","#14b8a6","#facc15","#fb923c","#dc2626"],ne=Y(()=>`linear-gradient(90deg, ${K.join(", ")})`),V=Y(()=>Array.isArray(j.value)&&j.value.length>0),M=Y(()=>k.value.length&&k.value[Math.min(f.value,k.value.length-1)]||null),X=()=>{var n;(n=Q.value)==null||n.click()},Q=b(null),Z=()=>{localStorage.setItem("mpi-workfaces",JSON.stringify(k.value))},le=()=>{const n=localStorage.getItem("mpi-workfaces");if(n)try{k.value=JSON.parse(n)||[]}catch(t){k.value=[]}},ie=()=>{k.value=[],f.value=0,Z()},ee=n=>N(this,null,function*(){var u,p,g;const t=(u=n.target.files)==null?void 0:u[0];if(t)try{const{data:d}=yield $e(t);k.value=d.workfaces||[],f.value=0,Z(),C.add(`已导入 ${k.value.length} 个工作面`,"success")}catch(d){C.add(((g=(p=d.response)==null?void 0:p.data)==null?void 0:g.detail)||"工作面解析失败","error")}}),te=n=>{if(n==="csv"){se(`name,xmin,xmax,ymin,ymax
工作面A,100,400,200,600
工作面B,450,750,150,500
`,"workfaces_example.csv","text/csv");return}se(JSON.stringify({workfaces:[{name:"工作面A",bounds:{min_x:100,max_x:400,min_y:200,max_y:600}},{name:"工作面B",points:[[450,150],[750,150],[720,500],[480,520]]}]},null,2),"workfaces_example.json","application/json")},se=(n,t,u)=>{const p=new Blob([n],{type:u}),g=URL.createObjectURL(p),d=document.createElement("a");d.href=g,d.download=t,d.click(),URL.revokeObjectURL(g)},re=()=>N(this,null,function*(){try{const{data:n}=yield Ie();s.value=n.seams||[],!x.value&&s.value.length&&(x.value=s.value[0].name)}catch(n){C.add("加载煤层失败","error")}}),o=n=>N(this,null,function*(){if(!n)return null;if(z.has(n))return z.get(n);try{const{data:t}=yield Be(n);return z.set(n,t),t}catch(t){return z.set(n,null),null}}),a=(...t)=>N(this,[...t],function*(n=[]){var p,g;const u=[];for(const d of n){const P=d.layers||[],S=P.find(H=>H.name===x.value),r=P.filter(H=>H.name!==x.value),F=[];for(const H of r){const m=yield o(H.name);F.push({thickness:H.thickness||0,name:H.name||"",density:m==null?void 0:m.density,bulk_modulus:m==null?void 0:m.bulk_modulus,shear_modulus:m==null?void 0:m.shear_modulus,cohesion:m==null?void 0:m.cohesion,friction_angle:m==null?void 0:m.friction_angle,tensile_strength:m==null?void 0:m.tensile_strength,compressive_strength:m==null?void 0:m.compressive_strength,elastic_modulus:m==null?void 0:m.elastic_modulus,poisson_ratio:m==null?void 0:m.poisson_ratio})}const A=(g=(p=d.seam_top_depth)!=null?p:d.total_overburden_thickness)!=null?g:0,ae=(S==null?void 0:S.thickness)||0;u.push({x:d.x,y:d.y,borehole:d.name,thickness:ae,burial_depth:A,z_top:A,z_bottom:A+ae,strata:F})}return u}),l=()=>N(this,null,function*(){var n,t,u,p;if(x.value){_.value=!0;try{const{data:g}=yield Pe(x.value),d=g.boreholes||[];if(!d.length){C.add("当前煤层无可用钻孔数据","error");return}const P=yield a(d),S=((n=M.value)==null?void 0:n.bounds)||null,{data:r}=yield Se(P,E.value,I.value,null,S);j.value=r.grid,O.value=r.bounds,U.value=r.statistics||{},(t=M.value)!=null&&t.bounds&&c(M.value.bounds,r.bounds),B.value==="image"&&(yield i()),C.add("MPI热力图计算完成","success")}catch(g){C.add(((p=(u=g.response)==null?void 0:u.data)==null?void 0:p.detail)||"MPI计算失败","error")}finally{_.value=!1}}}),c=(n,t)=>{if(!n||!t)return;const u=n.min_x<t.min_x||n.max_x>t.max_x,p=n.min_y<t.min_y||n.max_y>t.max_y;(u||p)&&C.add("工作面范围超出MPI网格边界，显示可能被裁剪","warning")},i=()=>N(this,null,function*(){var n,t,u;if(!(!j.value||!O.value))try{const p=(n=M.value)!=null&&n.name?`MPI热力图 - ${M.value.name}`:"MPI热力图",{data:g}=yield Re({grid:j.value,bounds:O.value,title:p,property_name:"MPI",num_levels:12,dpi:200,smooth_sigma:1,colormap:"odi"});D.value=`data:image/png;base64,${g.image}`}catch(p){C.add(((u=(t=p.response)==null?void 0:t.data)==null?void 0:u.detail)||"热力图图像生成失败","error")}}),v=()=>{B.value==="image"&&(B.value="canvas",C.add("图像加载失败，已切换到Canvas模式","warning"))};return de(B,n=>N(this,null,function*(){n==="image"&&j.value&&!D.value&&(yield i())})),de(f,()=>{j.value&&(j.value=null,O.value=null,D.value="",U.value={},C.add("工作面已切换，请重新计算MPI热力图","info"))}),fe(()=>{re(),le()}),(n,t)=>{var u,p,g,d,P,S;return h(),y("div",Ge,[t[32]||(t[32]=W('<div class="page-header" data-v-735f5227><div class="page-header-content" data-v-735f5227><div class="page-header-icon" data-v-735f5227><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-735f5227><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" data-v-735f5227></path><path d="M12 6v6l4 2" data-v-735f5227></path></svg></div><div data-v-735f5227><h1 class="page-title" data-v-735f5227>MPI热力图分析</h1><p class="page-subtitle" data-v-735f5227>独立展示MPI综合指标分布，支持多工作面上传、切换与热力图渲染</p></div></div></div>',1)),e("div",Ke,[e("div",Qe,[e("div",Ze,[t[12]||(t[12]=e("h3",{class:"section-title"},"工作面坐标文件",-1)),t[13]||(t[13]=e("p",{class:"section-desc"},"上传多工作面坐标文件（矩形为主，多边形可选）",-1)),e("div",{class:"upload-box",onClick:X,tabindex:"0",onKeydown:ge(X,["enter"])},[e("input",{ref_key:"workfaceInput",ref:Q,type:"file",accept:".csv,.json,.txt",onChange:ee,style:{display:"none"}},null,544),t[10]||(t[10]=W('<div class="upload-icon" data-v-735f5227><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-735f5227><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-735f5227></path><polyline points="17 8 12 3 7 8" data-v-735f5227></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-735f5227></line></svg></div><div class="upload-text" data-v-735f5227>上传工作面坐标文件</div><div class="upload-hint" data-v-735f5227>支持 CSV / JSON / TXT</div>',3))],32),t[14]||(t[14]=e("div",{class:"helper-text"}," 未上传工作面时，将使用全部网格边界进行渲染。 ",-1)),e("div",et,[e("button",{class:"btn ghost",onClick:t[0]||(t[0]=ve(r=>te("csv"),["stop"]))},"下载CSV示例"),e("button",{class:"btn ghost",onClick:t[1]||(t[1]=ve(r=>te("json"),["stop"]))},"下载JSON示例")]),k.value.length?(h(),y("div",tt,[e("div",st,[e("span",null,"已解析 "+w(k.value.length)+" 个工作面",1),e("button",{class:"btn small ghost",onClick:ie},"清空")]),e("div",at,[(h(!0),y(ue,null,ce(k.value,(r,F)=>(h(),y("button",{key:r.name+F,class:oe(["workface-btn",{active:f.value===F}]),onClick:A=>f.value=F},[q(w(r.name||`工作面 ${F+1}`)+" ",1),e("span",nt,w(r.type==="polygon"?"多边形":"矩形"),1)],10,ot))),128))])])):(h(),y("div",lt,[...t[11]||(t[11]=[W('<div class="empty-icon" data-v-735f5227><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-735f5227><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-735f5227></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-735f5227></circle><polyline points="21 15 16 10 5 21" data-v-735f5227></polyline></svg></div><p data-v-735f5227>请上传工作面坐标文件</p>',2)])]))]),e("div",it,[t[19]||(t[19]=e("h3",{class:"section-title"},"MPI计算设置",-1)),e("div",rt,[t[15]||(t[15]=e("label",{class:"param-label"},"煤层",-1)),J(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>x.value=r),class:"param-select"},[(h(!0),y(ue,null,ce(s.value,r=>(h(),y("option",{key:r.name,value:r.name},w(r.name),9,dt))),128))],512),[[pe,x.value]])]),e("div",ut,[t[17]||(t[17]=e("label",{class:"param-label"},"插值方法",-1)),J(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>I.value=r),class:"param-select"},[...t[16]||(t[16]=[e("option",{value:"idw"},"IDW",-1),e("option",{value:"linear"},"Linear",-1),e("option",{value:"nearest"},"Nearest",-1)])],512),[[pe,I.value]])]),e("div",ct,[t[18]||(t[18]=e("label",{class:"param-label"},"网格分辨率",-1)),J(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>E.value=r),type:"number",min:"20",max:"200",class:"param-input"},null,512),[[Me,E.value,void 0,{number:!0}]])]),e("div",vt,[e("button",{class:"btn primary",onClick:l,disabled:_.value||!x.value},[_.value?(h(),y("span",mt)):L("",!0),q(" "+w(_.value?"计算中...":"计算MPI热力图"),1)],8,pt),e("button",{class:"btn secondary",onClick:i,disabled:_.value||!V.value}," 刷新图像 ",8,ft)])]),e("div",gt,[t[23]||(t[23]=e("h3",{class:"section-title"},"显示设置",-1)),e("div",ht,[e("label",yt,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=r=>R.value=r)},null,512),[[me,R.value]]),t[20]||(t[20]=q(" 显示边界 ",-1))]),e("label",bt,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=r=>T.value=r)},null,512),[[me,T.value]]),t[21]||(t[21]=q(" 显示遮罩 ",-1))])]),e("div",kt,[t[22]||(t[22]=e("label",{class:"param-label"},"渲染模式",-1)),e("div",xt,[e("button",{class:oe(["mode-tab",{active:B.value==="image"}]),onClick:t[7]||(t[7]=r=>B.value="image")},"图像",2),e("button",{class:oe(["mode-tab",{active:B.value==="canvas"}]),onClick:t[8]||(t[8]=r=>B.value="canvas")},"Canvas",2)])])])]),e("div",wt,[e("div",_t,[e("div",Mt,[t[24]||(t[24]=e("h3",{class:"section-title"},"MPI综合指标分布",-1)),e("div",Ct,[M.value?(h(),y("span",It,"当前："+w(M.value.name),1)):(h(),y("span",$t,"未选择工作面"))])]),(u=M.value)!=null&&u.bounds?(h(),y("div",Pt," 范围：X "+w(M.value.bounds.min_x)+" ~ "+w(M.value.bounds.max_x)+"， Y "+w(M.value.bounds.min_y)+" ~ "+w(M.value.bounds.max_y),1)):L("",!0),he(qe,{mode:B.value,"image-url":D.value,grid:j.value||[],bounds:O.value,workface:M.value,"show-boundary":R.value,"show-mask":T.value,palette:K,onHover:t[9]||(t[9]=r=>G.value=r),onImageError:v},null,8,["mode","image-url","grid","bounds","workface","show-boundary","show-mask"]),V.value?(h(),y("div",St,[t[25]||(t[25]=e("div",{class:"legend-label"},"MPI风险渐变（ODI色盘）",-1)),e("div",{class:"legend-bar",style:ye({background:ne.value})},null,4),t[26]||(t[26]=e("div",{class:"legend-scale"},[e("span",null,"高风险（低MPI）"),e("span",null,"低风险（高MPI）")],-1))])):L("",!0),V.value?(h(),y("div",Rt,[e("div",Bt,[t[27]||(t[27]=e("span",{class:"stat-label"},"最小值",-1)),e("span",jt,w(((p=U.value.min)==null?void 0:p.toFixed(2))||"-"),1)]),e("div",Ut,[t[28]||(t[28]=e("span",{class:"stat-label"},"最大值",-1)),e("span",Et,w(((g=U.value.max)==null?void 0:g.toFixed(2))||"-"),1)]),e("div",Vt,[t[29]||(t[29]=e("span",{class:"stat-label"},"平均值",-1)),e("span",Ft,w(((d=U.value.mean)==null?void 0:d.toFixed(2))||"-"),1)]),e("div",Nt,[t[30]||(t[30]=e("span",{class:"stat-label"},"悬停值",-1)),e("span",Tt,w(((S=(P=G.value)==null?void 0:P.value)==null?void 0:S.toFixed(2))||"-"),1)])])):(h(),y("div",Lt,[...t[31]||(t[31]=[W('<div class="empty-icon" data-v-735f5227><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-735f5227><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-735f5227></rect><line x1="3" y1="9" x2="21" y2="9" data-v-735f5227></line><line x1="9" y1="21" x2="9" y2="9" data-v-735f5227></line></svg></div><p data-v-735f5227>请选择煤层并计算MPI热力图</p>',2)])]))])])])])}}},Yt=be(Ot,[["__scopeId","data-v-735f5227"]]);export{Yt as default};
