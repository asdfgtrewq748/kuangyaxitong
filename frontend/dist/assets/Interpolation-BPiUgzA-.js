var It=Object.defineProperty,Et=Object.defineProperties;var Dt=Object.getOwnPropertyDescriptors;var Mt=Object.getOwnPropertySymbols;var Yt=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var ve=Math.pow,Ft=(U,ne,G)=>ne in U?It(U,ne,{enumerable:!0,configurable:!0,writable:!0,value:G}):U[ne]=G,vt=(U,ne)=>{for(var G in ne||(ne={}))Yt.call(ne,G)&&Ft(U,G,ne[G]);if(Mt)for(var G of Mt(ne))Lt.call(ne,G)&&Ft(U,G,ne[G]);return U},ht=(U,ne)=>Et(U,Dt(ne));var Ke=(U,ne,G)=>new Promise((W,De)=>{var Se=he=>{try{ke(G.next(he))}catch(we){De(we)}},Ae=he=>{try{ke(G.throw(he))}catch(we){De(we)}},ke=he=>he.done?W(he.value):Promise.resolve(he.value).then(Se,Ae);ke((G=G.apply(U,ne)).next())});import{w as Xt,b5 as b,b8 as k,b7 as o,bb as x,bn as lt,bm as Pt,bi as le,bc as st,b9 as nt,ba as Oe,b as M,c as Ee,bf as zt,bq as ot,br as St,bs as $t,bt as Ht,bo as ft,b6 as At,n as mt}from"./vendor-CA5Q5CdR.js";import{u as qt,a as Ut}from"./vue-router-D9BXaJFq.js";import{_ as Wt,u as Ot,a as Vt}from"./index-C6WNepMi.js";import{g as Qt,a as Jt,b as Kt,c as jt}from"./api-CfsGh-st.js";import"./network-T6nY3V_4.js";const Gt={key:0,class:"error-placeholder"},Zt={class:"error-detail"},eo={key:1,class:"loading-placeholder"},to=["src"],oo=["viewBox"],lo={key:0},so=["x1","y1","x2","y2"],no=["cx","cy"],ao=["x","y"],io=["cx","cy"],ro=["x","y"],co=["x","y"],uo=["x1","y1","x2","y2"],vo=["transform","onMouseenter"],ho=["fill"],fo={class:"map-controls"},mo={key:1,class:"legend"},go={class:"legend-title"},po={class:"legend-range"},yo={class:"legend-min"},bo={class:"legend-bar"},xo={class:"legend-max"},ko={class:"legend-mid"},_o={key:0,class:"tooltip-borehole"},So={class:"tooltip-name"},wo={class:"tooltip-coords"},Co={class:"tooltip-value"},To={class:"tooltip-label"},Mo={class:"tooltip-number"},Fo={__name:"ContourMap",props:{imageUrl:{type:String,default:""},boreholes:{type:Array,default:()=>[]},bounds:{type:Object,default:()=>({})},property:{type:String,default:"thickness"},propertyLabel:{type:String,default:"厚度"},valueRange:{type:Object,default:()=>({min:0,max:10})},colormap:{type:String,default:"YlOrBr"},crossSectionMode:{type:Boolean,default:!1}},emits:["crossSectionChange","crossSectionComplete"],setup(U,{expose:ne,emit:G}){const W=U,De=G,Se=M(null),Ae=M(800),ke=M(600),he=M(!1),we=M(null),N=M(1),Te=M(0),ae=M(0),ge=M(!1),Q=M(!1),Ye=M({x:0,y:0}),Ce=M(null),ue=M(null),Me=M({x:0,y:0}),_e=M(!0),h=M({start:null,end:null,distance:null}),J=M(null),de=Ee(()=>{if(W.bounds&&W.bounds.min_x!==void 0)return{minX:W.bounds.min_x,maxX:W.bounds.max_x,minY:W.bounds.min_y,maxY:W.bounds.max_y,rangeX:W.bounds.max_x-W.bounds.min_x,rangeY:W.bounds.max_y-W.bounds.min_y};if(W.boreholes.length===0)return null;let c=1/0,r=-1/0,f=1/0,S=-1/0;return W.boreholes.forEach($=>{$.x<c&&(c=$.x),$.x>r&&(r=$.x),$.y<f&&(f=$.y),$.y>S&&(S=$.y)}),{minX:c,maxX:r,minY:f,maxY:S,rangeX:r-c,rangeY:S-f}}),Be=Ee(()=>{if(!de.value||W.boreholes.length===0)return[];if(!he.value||!W.imageUrl)return[];const c=de.value,r=Ae.value,f=ke.value;if(!Number.isFinite(r)||!Number.isFinite(f)||r<=0||f<=0)return[];if(!Number.isFinite(c.rangeX)||!Number.isFinite(c.rangeY)||c.rangeX<=0||c.rangeY<=0)return[];const S=r*.1,$=r*(1-.1-.85),te=f*.1,ie=f*(1-.1-.8),pe=r-S-$,Z=f-te-ie;return W.boreholes.map(re=>{var tt,dt;const ye=(tt=re.x)!=null?tt:re.borehole_x,qe=(dt=re.y)!=null?dt:re.borehole_y;if(ye==null||qe==null)return null;const et=(ye-c.minX)/c.rangeX,ut=(qe-c.minY)/c.rangeY,xt=S+et*pe,kt=f-te-ut*Z;return ht(vt({},re),{x:ye,y:qe,canvasX:Math.round(xt*10)/10,canvasY:Math.round(kt*10)/10,color:Re(re[W.property]||re.thickness||re.burial_depth)})}).filter(re=>re!==null)}),Re=c=>{var $,te;if(c==null)return"#3b82f6";const r=(($=W.valueRange)==null?void 0:$.min)||0,f=((te=W.valueRange)==null?void 0:te.max)||1,S=Math.max(0,Math.min(1,(c-r)/(f-r||1)));return W.colormap==="YlOrBr"?je(S,[{t:0,r:255,g:255,b:204},{t:.25,r:255,g:230,b:153},{t:.5,r:255,g:190,b:121},{t:.75,r:230,g:140,b:80},{t:1,r:160,g:80,b:50}]):je(S,[{t:0,r:68,g:1,b:84},{t:.25,r:59,g:82,b:139},{t:.5,r:33,g:154,b:141},{t:.75,r:94,g:201,b:98},{t:1,r:253,g:231,b:37}])},je=(c,r)=>{let f=r[0],S=r[r.length-1];for(let Z=0;Z<r.length-1;Z++)if(c>=r[Z].t&&c<=r[Z+1].t){f=r[Z],S=r[Z+1];break}const $=S.t!==f.t?(c-f.t)/(S.t-f.t):0,te=Math.round(f.r+(S.r-f.r)*$),ie=Math.round(f.g+(S.g-f.g)*$),pe=Math.round(f.b+(S.b-f.b)*$);return`rgb(${te}, ${ie}, ${pe})`},We=Ee(()=>({transform:`scale(${N.value}) translate(${Te.value/N.value}px, ${ae.value/N.value}px)`,transformOrigin:"center center",transition:ge.value?"none":"transform 0.1s ease-out"})),at=Ee(()=>({position:"absolute",top:"50%",left:"50%",transform:`translate(-50%, -50%) scale(${N.value}) translate(${Te.value/N.value}px, ${ae.value/N.value}px)`,transformOrigin:"center center",pointerEvents:"none",transition:ge.value?"none":"transform 0.1s ease-out",maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto"})),it=Ee(()=>({left:Me.value.x+15+"px",top:Me.value.y+15+"px"})),gt=Ee(()=>W.colormap==="YlOrBr"?"background: linear-gradient(to right, #fffacc, #ffe699, #ffbe79, #e68c50, #a05032)":"background: linear-gradient(to right, #440154, #3b528b, #21918c, #5ec962, #fde725)"),pt=Ee(()=>{var f,S;const c=Number((f=W.valueRange)==null?void 0:f.min),r=Number((S=W.valueRange)==null?void 0:S.max);return!Number.isFinite(c)||!Number.isFinite(r)?0:(c+r)/2}),rt=c=>{Ae.value=c.target.naturalWidth,ke.value=c.target.naturalHeight,he.value=!0,we.value=null},ct=c=>{var r;we.value="图片加载失败，请检查数据",he.value=!1,console.error("Image load error:",c,((r=W.imageUrl)==null?void 0:r.substring(0,50))+"...")},I=()=>{N.value=Math.min(N.value*1.2,3)},Ge=()=>{N.value=Math.max(N.value/1.2,.5)},Le=()=>{N.value=1,Te.value=0,ae.value=0},He=()=>{h.value={start:null,end:null,distance:null},J.value=null,De("crossSectionChange",null)},Xe=(c,r)=>{if(!Se.value)return null;const f=Se.value.getBoundingClientRect(),S=f.width/2,$=f.height/2,te=(c-S-Te.value)/N.value+S,ie=(r-$-ae.value)/N.value+$,pe=(f.width-Ae.value)/2,Z=(f.height-ke.value)/2;return{x:te-pe,y:ie-Z}},Ve=(c,r)=>{if(!de.value)return null;const f=Ae.value,S=ke.value,$=f*.1,te=f*(1-.1-.85),ie=S*.1,pe=S*(1-.1-.8),Z=f-$-te,re=S-ie-pe,ye=de.value,qe=ye.minX+(c-$)/Z*ye.rangeX,et=ye.minY+(S-r-ie)/re*ye.rangeY;return{x:qe,y:et}},yt=c=>{var r,f;if(!(c.pointerType!=="touch"&&c.button!==0))if(Ce.value=c.pointerId,(f=(r=Se.value)==null?void 0:r.setPointerCapture)==null||f.call(r,c.pointerId),W.crossSectionMode){const S=Xe(c.clientX,c.clientY);if(!S)return;if(!h.value.start)h.value.start=S,Q.value=!0;else if(h.value.end)h.value={start:S,end:null,distance:null},Q.value=!0;else{h.value.end=S,Q.value=!1;const $=Ve(S.x,S.y),te=Ve(h.value.start.x,h.value.start.y);if($&&te){const ie=Math.sqrt(ve(te.x-$.x,2)+ve(te.y-$.y,2));h.value.distance=ie}J.value=null,De("crossSectionComplete",{start:Ve(h.value.start.x,h.value.start.y),end:Ve(h.value.end.x,h.value.end.y),startCanvas:h.value.start,endCanvas:h.value.end,distance:h.value.distance})}De("crossSectionChange",h.value)}else ge.value=!0,Ye.value={x:c.clientX-Te.value,y:c.clientY-ae.value}},Ze=c=>{var r,f;Ce.value!==null&&c.pointerId!==Ce.value||(Ce.value=null,(f=(r=Se.value)==null?void 0:r.releasePointerCapture)==null||f.call(r,c.pointerId),ge.value=!1)},O=c=>{if(Se.value){if(Se.value.getBoundingClientRect(),W.crossSectionMode&&Q.value){const r=Xe(c.clientX,c.clientY);r&&(J.value=r),Me.value={x:c.clientX,y:c.clientY};return}if(ge.value){Te.value=c.clientX-Ye.value.x,ae.value=c.clientY-Ye.value.y;return}c.pointerType!=="touch"&&(Me.value={x:c.clientX,y:c.clientY})}},Qe=()=>{ge.value||(ue.value=null)},bt=c=>{c.preventDefault();const r=c.deltaY>0?.9:1.1;N.value=Math.max(.5,Math.min(3,N.value*r))};return Xt(()=>W.imageUrl,()=>{Le(),he.value=!1,we.value=null}),ne({resetView:Le,resetCrossSection:He,boreholes:Be,crossSectionLine:h}),(c,r)=>{var f,S,$,te,ie,pe;return b(),k("div",{class:Oe(["contour-map-wrapper",{"cross-section-mode":U.crossSectionMode}])},[o("div",{ref_key:"imageContainer",ref:Se,class:"image-container",onPointerdown:yt,onPointermove:O,onPointerup:Ze,onPointercancel:Ze,onPointerleave:Qe,onWheel:Pt(bt,["prevent"]),onContextmenu:r[0]||(r[0]=Pt(()=>{},["prevent"]))},[we.value?(b(),k("div",Gt,[r[3]||(r[3]=o("p",null,"⚠️ 图片加载失败",-1)),o("p",Zt,x(we.value),1),r[4]||(r[4]=o("p",{class:"error-hint"},"请检查后端服务是否正常运行",-1))])):U.imageUrl?(b(),k("img",{key:2,src:U.imageUrl,class:"contour-image",style:lt(We.value),alt:"Contour Map",loading:"lazy",decoding:"async",onLoad:rt,onError:ct},null,44,to)):(b(),k("div",eo,[...r[5]||(r[5]=[o("div",{class:"spinner"},null,-1),o("p",null,"正在生成等值线图...",-1)])]))],544),U.imageUrl?(b(),k("svg",{key:0,class:"borehole-overlay",viewBox:`0 0 ${Ae.value} ${ke.value}`,style:lt(at.value),preserveAspectRatio:"xMidYMid meet"},[r[7]||(r[7]=o("defs",null,[o("filter",{id:"shadow",x:"-50%",y:"-50%",width:"200%",height:"200%"},[o("feDropShadow",{dx:"0",dy:"1",stdDeviation:"2","flood-opacity":"0.3"})]),o("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto"},[o("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#f59e0b"})])],-1)),h.value.start&&h.value.end?(b(),k("g",lo,[o("line",{x1:h.value.start.x,y1:h.value.start.y,x2:h.value.end.x,y2:h.value.end.y,stroke:"#f59e0b","stroke-width":"3","stroke-dasharray":"8,4","marker-end":"url(#arrowhead)",class:"cross-section-line"},null,8,so),o("circle",{cx:h.value.start.x,cy:h.value.start.y,r:"8",fill:"#f59e0b",stroke:"white","stroke-width":"2",class:"cross-section-marker"},null,8,no),o("text",{x:h.value.start.x,y:h.value.start.y-15,fill:"#f59e0b","font-size":"14","font-weight":"bold","text-anchor":"middle"},"A",8,ao),o("circle",{cx:h.value.end.x,cy:h.value.end.y,r:"8",fill:"#f59e0b",stroke:"white","stroke-width":"2",class:"cross-section-marker"},null,8,io),o("text",{x:h.value.end.x,y:h.value.end.y-15,fill:"#f59e0b","font-size":"14","font-weight":"bold","text-anchor":"middle"},"A'",8,ro),o("text",{x:(h.value.start.x+h.value.end.x)/2,y:(h.value.start.y+h.value.end.y)/2-15,fill:"white","font-size":"12","text-anchor":"middle",class:"distance-label"},x((f=h.value.distance)==null?void 0:f.toFixed(0))+"m",9,co)])):le("",!0),U.crossSectionMode&&h.value.start&&J.value?(b(),k("line",{key:1,x1:h.value.start.x,y1:h.value.start.y,x2:J.value.x,y2:J.value.y,stroke:"rgba(245, 158, 11, 0.5)","stroke-width":"2","stroke-dasharray":"4,4"},null,8,uo)):le("",!0),_e.value?(b(!0),k(st,{key:2},nt(Be.value,(Z,re)=>(b(),k("g",{key:re,transform:`translate(${Z.canvasX}, ${Z.canvasY})`,class:"borehole-marker",onMouseenter:ye=>ue.value=ht(vt({},Z),{isBorehole:!0}),onMouseleave:r[1]||(r[1]=ye=>ue.value=null)},[r[6]||(r[6]=o("circle",{r:"9",fill:"rgba(255,255,255,0.95)",filter:"url(#shadow)"},null,-1)),o("circle",{r:"6",fill:Z.color||"#3b82f6",stroke:"#1e3a8a","stroke-width":"1.5"},null,8,ho)],40,vo))),128)):le("",!0)],12,oo)):le("",!0),o("div",fo,[o("button",{class:"control-btn",onClick:I,title:"放大"},[...r[8]||(r[8]=[o("span",null,"+",-1)])]),o("button",{class:"control-btn",onClick:Ge,title:"缩小"},[...r[9]||(r[9]=[o("span",null,"−",-1)])]),o("button",{class:"control-btn",onClick:Le,title:"重置"},[...r[10]||(r[10]=[o("span",null,"⟲",-1)])]),o("button",{class:Oe(["control-btn",{active:_e.value}]),onClick:r[2]||(r[2]=Z=>_e.value=!_e.value),title:"显示或隐藏钻孔点"},[...r[11]||(r[11]=[o("span",null,"◉",-1)])],2)]),U.valueRange?(b(),k("div",mo,[o("div",go,x(U.propertyLabel),1),o("div",po,[o("span",yo,x((S=U.valueRange.min)==null?void 0:S.toFixed(2))+"m",1),o("div",bo,[o("div",{class:"legend-gradient",style:lt(gt.value)},null,4)]),o("span",xo,x(($=U.valueRange.max)==null?void 0:$.toFixed(2))+"m",1)]),o("div",ko,"中值 "+x(pt.value.toFixed(2))+" m",1)])):le("",!0),ue.value?(b(),k("div",{key:2,class:"hover-tooltip",style:lt(it.value)},[ue.value.isBorehole?(b(),k("div",_o,[o("div",So,x(ue.value.name||ue.value.borehole),1),o("div",wo,"("+x((te=ue.value.x)==null?void 0:te.toFixed(1))+", "+x((ie=ue.value.y)==null?void 0:ie.toFixed(1))+")",1),o("div",Co,[o("span",To,x(U.propertyLabel)+":",1),o("span",Mo,x((pe=ue.value.value)==null?void 0:pe.toFixed(2))+" m",1)])])):le("",!0)],4)):le("",!0)],2)}}},Bt=Wt(Fo,[["__scopeId","data-v-c959f615"]]),Po={class:"page"},$o={class:"header"},Ao={class:"muted"},Bo={key:0,class:"header-stats"},Ro={class:"stat-badge"},Wo={class:"stat-badge primary"},No={class:"stat-badge"},Io={key:0,class:"card"},Eo={class:"seam-selection-grid"},Do=["onClick"],Yo={class:"seam-card-header"},Lo={class:"seam-name"},Xo={class:"seam-count"},zo={class:"seam-card-stats"},Ho={class:"mini-stat"},qo={class:"mini-stat-value"},Uo={class:"mini-stat"},Oo={class:"mini-stat-value"},Vo={key:1,class:"grid"},Qo={class:"card params-card compact-card"},Jo={class:"param-row"},Ko={class:"tab-buttons"},jo=["onClick"],Go={class:"param-row"},Zo={class:"param-header"},el={class:"param-value"},tl={class:"param-row"},ol={class:"param-header"},ll={class:"param-value"},sl={class:"param-row"},nl={class:"tab-buttons quality-tabs"},al=["onClick"],il={key:0,class:"param-row"},rl={class:"toggle-btn",style:{width:"100%"}},cl={key:0,class:"hint-text"},ul={class:"action-buttons"},dl=["disabled"],vl={key:0,class:"spinner sm"},hl={key:1,class:"status-text"},fl={class:"card compact-card"},ml={key:0,class:"histogram-wrapper"},gl={key:1,class:"empty-state"},pl={key:2,class:"stats-grid"},yl={class:"stat-item"},bl={class:"stat-value"},xl={class:"stat-item"},kl={class:"stat-value"},_l={class:"stat-item"},Sl={class:"stat-value"},wl={class:"stat-item"},Cl={class:"stat-value"},Tl={class:"stat-item"},Ml={class:"stat-value"},Fl={class:"stat-item"},Pl={class:"stat-value"},$l={class:"card compact-card"},Al={class:"stratigraphic-wrapper"},Bl={class:"lithology-legend-compact"},Rl={class:"legend-name"},Wl={key:0,class:"map-row"},Nl={class:"card map-card-large"},Il={class:"map-header"},El={key:0,class:"section-desc"},Dl={key:1,class:"section-desc"},Yl={class:"map-wrapper"},Ll={key:0,class:"spinner"},Xl={class:"card map-card-large"},zl={class:"map-header"},Hl={key:0,class:"section-desc"},ql={key:1,class:"section-desc"},Ul={class:"map-wrapper"},Ol={key:0,class:"spinner"},Vl={key:1,class:"card map-card-full"},Ql={class:"map-wrapper uncertainty-wrapper"},Jl={key:0,class:"spinner"},Kl={key:2,class:"card map-card-full"},jl={class:"map-header"},Gl={class:"section-title"},Zl={class:"section-badge"},es={class:"cross-section-wrapper"},Rt="interpolation:lastContour:v1",ts={__name:"Interpolation",setup(U,{expose:ne}){const G=Vt(),W=qt(),De=Ut(),{workspaceState:Se,setSelectedSeam:Ae,markStepDone:ke}=Ot(),he=M(!1),we=M(null),N=M(!1),Te=M([]),ae=M(null),ge=M(null),Q=M([]),Ye=M([]),Ce=M("kriging"),ue=M(80),Me=M(10),_e=M("standard"),h=M(""),J=M(null),de=M(null),Be=M(!1),Re=M({line:null,points:[],depthProfile:[],distance:null,hasData:!1}),je=M(null),We=M(null),at=M(null),it=M(null),gt=[{key:"kriging",label:"Kriging"},{key:"idw",label:"IDW"},{key:"linear",label:"Linear"},{key:"nearest",label:"Nearest"}],pt=[{key:"fast",label:"快速"},{key:"standard",label:"标准"},{key:"high",label:"高精"}],rt={fast:{dpi:120,smoothSigma:.75,label:"快速"},standard:{dpi:200,smoothSigma:1.15,label:"标准"},high:{dpi:300,smoothSigma:1.35,label:"高精"}},ct={fast:72,standard:96,high:128},I={textColor:"#111827",subTextColor:"#475569",axisColor:"#1f2937",gridColor:"rgba(148, 163, 184, 0.28)",fontFamily:"'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif",monoFamily:"'JetBrains Mono', 'SFMono-Regular', Consolas, monospace"};let Ge=0,Le=0,He=null,Xe=null;const Ve={细砂岩:"#FCEBB6",粉砂岩:"#E0FFFF",泥岩:"#D3D3D3",中砂岩:"#FCEBB6",粗砂岩:"#F5DEB3",砾岩:"#DEB887",炭质泥岩:"#8B8B8B",砂质泥岩:"#D8D8D8",泥质砂岩:"#E8E8E8",石灰岩:"#B0E0E6",煤:"#2F4F4F"},yt={细砂岩:{facecolor:"#FCEBB6",hatch:"...",edgecolor:"#999999"},粉砂岩:{facecolor:"#E0FFFF",hatch:"...",edgecolor:"#AAAAAA"},泥岩:{facecolor:"#D3D3D3",hatch:"---",edgecolor:"#666666"},中砂岩:{facecolor:"#FCEBB6",hatch:"...",edgecolor:"#999999"},粗砂岩:{facecolor:"#F5DEB3",hatch:"...",edgecolor:"#999999"},砾岩:{facecolor:"#DEB887",hatch:"ooo",edgecolor:"#8B4513"},炭质泥岩:{facecolor:"#8B8B8B",hatch:"---",edgecolor:"#444444"},砂质泥岩:{facecolor:"#D8D8D8",hatch:"-..",edgecolor:"#777777"},泥质砂岩:{facecolor:"#E8E8E8",hatch:".-.",edgecolor:"#888888"},石灰岩:{facecolor:"#B0E0E6",hatch:"+++",edgecolor:"#5F9EA0"},煤:{facecolor:"#2F4F4F",hatch:"",edgecolor:"#1a1a1a"}},Ze=t=>({kriging:"Kriging",idw:"IDW",linear:"Linear",nearest:"Nearest"})[t]||t,O=(t,e=400,i=!1)=>{const n=i?I.monoFamily:I.fontFamily;return`${e} ${t}px ${n}`},Qe=t=>{t.imageSmoothingEnabled=!0,"imageSmoothingQuality"in t&&(t.imageSmoothingQuality="high"),t.lineCap="round",t.lineJoin="round"},bt=Ee(()=>Q.value.map(t=>Number(t.thickness)).filter(t=>Number.isFinite(t))),c=Ee(()=>{const t=bt.value,e=t.length;if(!e)return{count:0,mean:0,stdDev:0,cv:0,min:0,max:0};const i=t.reduce((s,g)=>s+g,0)/e,n=t.reduce((s,g)=>s+ve(g-i,2),0)/e,m=Math.sqrt(n),l=Math.min(...t),a=Math.max(...t),u=i>0?m/i*100:0;return{count:e,mean:i,stdDev:m,cv:u,min:l,max:a}}),r=t=>{var e,i;Q.value=(t==null?void 0:t.boreholes)||Q.value,(e=t==null?void 0:t.thickness)!=null&&e.image?J.value={imageUrl:`data:image/png;base64,${t.thickness.image}`,valueRange:t.thickness.value_range,bounds:t.bounds}:J.value=null,(i=t==null?void 0:t.depth)!=null&&i.image?de.value={imageUrl:`data:image/png;base64,${t.depth.image}`,valueRange:t.depth.value_range,bounds:t.bounds}:de.value=null},f=t=>{var e;if(typeof window=="undefined")return null;try{const i=window.sessionStorage.getItem(Rt);if(!i)return null;const n=JSON.parse(i);return!(n!=null&&n.seamName)||n.seamName!==t||!((e=n==null?void 0:n.data)!=null&&e.bounds)?null:n}catch(i){return null}},S=(t,e)=>{if(typeof window!="undefined")try{const i={seamName:t,updatedAt:Date.now(),method:Ce.value,gridSize:ue.value,contourLevels:Me.value,quality:_e.value,data:{bounds:(e==null?void 0:e.bounds)||null,boreholes:(e==null?void 0:e.boreholes)||[],thickness:(e==null?void 0:e.thickness)||null,depth:(e==null?void 0:e.depth)||null}};window.sessionStorage.setItem(Rt,JSON.stringify(i))}catch(i){}},$=()=>Ke(this,null,function*(){he.value=!0;try{const{data:t}=yield Qt();Te.value=t.seams||[]}catch(t){we.value="加载煤层失败"}finally{he.value=!1}}),te=(t=[])=>{let e=0;return t.map(i=>{var a,u;const n=Number((a=i.thickness)!=null?a:0)||0;let m=Number(i.z_top),l=Number(i.z_bottom);if(Number.isFinite(m)||(m=e),Number.isFinite(l)||(l=m+n),!Number.isFinite(n)||n===0){const s=Math.max((l||0)-(m||0),0);s>0&&(i.thickness=s)}return e=l,ht(vt({},i),{thickness:Number((u=i.thickness)!=null?u:n)||0,z_top:m,z_bottom:l})})},ie=t=>Ke(this,null,function*(){var i,n;const e=++Le;ae.value=t,Ae((t==null?void 0:t.name)||""),J.value=null,de.value=null,Ye.value=[],h.value="";try{const m=f(t.name);m!=null&&m.data&&(r(m.data),h.value="已加载上次缓存结果，正在后台刷新...",yield mt(),Z());const l=Jt(t.name),a=Kt(t.name).catch(()=>null),{data:u}=yield l;if(e!==Le)return;ge.value=u,Q.value=u.points||[],yield mt(),ye(),ke("Interpolation",{interpolationPoints:Q.value.length||0}),pe({presetKey:"fast",forceRefresh:!1,silent:!0,autoMode:!0}),Ke(this,null,function*(){var C;const s=yield a;if(e!==Le)return;const g=((C=s==null?void 0:s.data)==null?void 0:C.boreholes)||[],P=g.reduce((F,V)=>{var H,D;const q=((H=F==null?void 0:F.layers)==null?void 0:H.length)||0;return(((D=V==null?void 0:V.layers)==null?void 0:D.length)||0)>q?V:F},g[0]),w=te((P==null?void 0:P.layers)||[]);Ye.value=w.sort((F,V)=>(F.z_top||0)-(V.z_top||0)),yield mt(),qe()})}catch(m){if(e!==Le)return;G.add("加载煤层详情失败: "+(((n=(i=m.response)==null?void 0:i.data)==null?void 0:n.detail)||m.message),"error")}}),pe=(...e)=>Ke(this,[...e],function*(t={}){var g,P,w;if(!ae.value)return;const{presetKey:i=_e.value,forceRefresh:n=!1,silent:m=!1,autoMode:l=!1}=t,a=rt[i]||rt.standard,u=ae.value.name,s=++Ge;N.value=!0,h.value=l?`正在生成${a.label}预览图...`:`正在渲染${a.label}质量结果...`;try{const{data:C}=yield jt(u,Ce.value,ue.value,Me.value,a.dpi,a.smoothSigma,{forceRefresh:n});if(s!==Ge)return;r(C),S(u,C),yield mt(),Z(),ye(),ke("Interpolation",{interpolationPoints:Q.value.length||0}),m||G.add("等值线图生成完成","success")}catch(C){console.error("Interpolate error:",C),console.error("Error response:",(g=C.response)==null?void 0:g.data),G.add(((w=(P=C.response)==null?void 0:P.data)==null?void 0:w.detail)||"生成等值线图失败","error")}finally{s===Ge&&(N.value=!1,h.value="")}}),Z=()=>{if(typeof window=="undefined"){re();return}if(typeof window.cancelIdleCallback=="function"&&He!==null&&(window.cancelIdleCallback(He),He=null),Xe!==null&&(window.clearTimeout(Xe),Xe=null),typeof window.requestIdleCallback=="function"){He=window.requestIdleCallback(()=>{He=null,re()},{timeout:240});return}Xe=window.setTimeout(()=>{Xe=null,re()},16)},re=()=>{var R,xe;if(!Q.value.length||!J.value)return;const t=it.value;if(!t)return;const e=t.getContext("2d");if(!e)return;const i=(R=t.parentElement)==null?void 0:R.getBoundingClientRect(),n=Math.max(720,Math.floor((i==null?void 0:i.width)||900)),m=Math.max(420,Math.floor((i==null?void 0:i.height)||550)),l=typeof window!="undefined"&&window.devicePixelRatio||1;t.width=Math.floor(n*l),t.height=Math.floor(m*l),t.style.width=`${n}px`,t.style.height=`${m}px`,e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),e.setTransform(l,0,0,l,0,0),Qe(e);const a=n,u=m,s=J.value.bounds;if(!(s&&Number.isFinite(s.min_x)&&Number.isFinite(s.max_x)&&Number.isFinite(s.min_y)&&Number.isFinite(s.max_y)&&s.max_x>s.min_x&&s.max_y>s.min_y))return;const P=Q.value.map(T=>({x:Number(T.x),y:Number(T.y)})).filter(T=>Number.isFinite(T.x)&&Number.isFinite(T.y));if(P.length===0)return;e.fillStyle="#ffffff",e.fillRect(0,0,a,u);const w={left:56,right:48,top:26,bottom:76},C=a-w.left-w.right-58,F=u-w.top-w.bottom,V=Math.max(30,Number(ue.value)||80),q=ct[_e.value]||ct.standard,A=Math.max(64,Math.min(144,Math.round((V+q)/2))),H=[],D=500;for(let T=0;T<A;T++){H[T]=[];for(let X=0;X<A;X++){const z=s.min_x+X/A*(s.max_x-s.min_x),Ne=s.max_y-T/A*(s.max_y-s.min_y);let Ie=1/0;for(const ze of P){const Je=Math.sqrt(ve(z-ze.x,2)+ve(Ne-ze.y,2));Je<Ie&&(Ie=Je)}H[T][X]=Math.min(1.6,Ie/D*1.6)}}const K=[],Y=_e.value==="high"?3:_e.value==="standard"?2.4:2,ce=Math.max(1,Math.ceil(Y*2));for(let T=0;T<A;T++){K[T]=[];for(let X=0;X<A;X++){let z=0,Ne=0;for(let Ie=-ce;Ie<=ce;Ie++)for(let ze=-ce;ze<=ce;ze++){const Je=T+Ie,_t=X+ze;if(Je>=0&&Je<A&&_t>=0&&_t<A){const wt=Math.sqrt(ze*ze+Ie*Ie),Ct=Math.exp(-(wt*wt)/(2*Y*Y)),Tt=(xe=H[Je])==null?void 0:xe[_t];if(!Number.isFinite(Tt))continue;z+=Tt*Ct,Ne+=Ct}}K[T][X]=Ne>0?z/Ne:H[T][X]}}const be=T=>{const X=Math.min(1.5,Math.max(0,T))/1.5;if(X<.5){const z=X*2;return{r:Math.floor(49+206*z),g:Math.floor(130+125*z),b:Math.floor(189+-189*z)}}else{const z=(X-.5)*2;return{r:Math.floor(255+-40*z),g:Math.floor(255+-207*z),b:Math.floor(0+48*z)}}},L=C/A,ee=F/A;for(let T=0;T<A;T++)for(let X=0;X<A;X++){const z=K[T][X],Ne=be(z);e.fillStyle=`rgb(${Ne.r}, ${Ne.g}, ${Ne.b})`,e.fillRect(w.left+X*L,w.top+(A-1-T)*ee,L+1,ee+1)}const j=6;for(const T of P){const X=w.left+(T.x-s.min_x)/(s.max_x-s.min_x)*C,z=w.top+(s.max_y-T.y)/(s.max_y-s.min_y)*F;e.beginPath(),e.arc(X,z,j,0,Math.PI*2),e.fillStyle="#000000",e.fill()}e.strokeStyle="#000000",e.lineWidth=2,e.strokeRect(w.left,w.top,C,F);const v=w.left+20,E=w.top+F-80,p=120,d=50;e.fillStyle="#ffffff",e.strokeStyle="#000000",e.lineWidth=1.5,e.fillRect(v,E,p,d),e.strokeRect(v,E,p,d),e.fillStyle="#d73027",e.fillRect(v+10,E+28,15,15),e.strokeStyle="#000000",e.lineWidth=1,e.strokeRect(v+10,E+28,15,15),e.fillStyle=I.textColor,e.font=O(12),e.textAlign="left",e.fillText("高不确定性",v+32,E+40),e.beginPath(),e.arc(v+17,E+18,j,0,Math.PI*2),e.fillStyle="#000000",e.fill(),e.fillText("钻孔位置",v+32,E+22);const _=w.left+C-150,B=E,se=130,fe=35;e.fillStyle="#ffffff",e.strokeStyle="#000000",e.lineWidth=1.5,e.fillRect(_,B,se,fe),e.strokeRect(_,B,se,fe),e.fillStyle=I.textColor,e.font=O(11),e.textAlign="left",e.fillText("0",_+10,B+22),e.textAlign="center",e.fillText("500",_+75,B+22),e.textAlign="right",e.fillText("1000 米",_+120,B+22);const Fe=B+12;e.strokeStyle="#000000",e.lineWidth=2,e.beginPath(),e.moveTo(_+10,Fe),e.lineTo(_+120,Fe),e.stroke(),e.lineWidth=4,e.beginPath(),e.moveTo(_+10,Fe),e.lineTo(_+75,Fe),e.stroke();const oe=w.left+C+20,me=w.top,Pe=20,$e=F;for(let T=0;T<$e;T++){const X=(1-T/$e)*1.5,z=be(X);e.fillStyle=`rgb(${z.r}, ${z.g}, ${z.b})`,e.fillRect(oe,me+T,Pe,1)}e.strokeStyle="#000000",e.lineWidth=1.5,e.strokeRect(oe,me,Pe,$e),e.fillStyle=I.subTextColor,e.font=O(10),e.textAlign="left";const Ue=[0,.5,1,1.5],y=["0","0.5","1.0","1.5+"];Ue.forEach((T,X)=>{const z=me+$e-T/1.5*$e;e.beginPath(),e.moveTo(oe+Pe,z),e.lineTo(oe+Pe+4,z),e.strokeStyle="#000000",e.lineWidth=1,e.stroke(),e.fillText(y[X],oe+Pe+8,z+4)}),e.save(),e.translate(oe+Pe+35,me+$e/2),e.rotate(-Math.PI/2),e.textAlign="center",e.font=O(11,500),e.fillText("不确定性 (归一化)",0,0),e.restore(),e.fillStyle=I.textColor,e.font=O(13,700),e.textAlign="center",e.fillText("Fig. 3 | 插值不确定性分布",w.left+C/2,u-28),e.fillStyle=I.subTextColor,e.font=O(10),e.fillText("红色区域表示较高不确定性，蓝色区域表示相对可靠。",w.left+C/2,u-12)},ye=()=>{var $e,Ue;const t=je.value;if(!t||Q.value.length===0)return;const e=t.getContext("2d");if(!e)return;const i=window.devicePixelRatio||1,n=t.parentElement,m=(n==null?void 0:n.clientWidth)||t.clientWidth||500,l=(n==null?void 0:n.clientHeight)||t.clientHeight||350;t.width=Math.round(m*i),t.height=Math.round(l*i),t.style.width=`${m}px`,t.style.height=`${l}px`,e.setTransform(i,0,0,i,0,0),Qe(e);const a=m,u=l,s=Q.value.map(y=>Number(y.thickness)).filter(y=>Number.isFinite(y));if(s.length===0)return;const g=Math.min(...s),P=Math.max(...s),w=s.reduce((y,R)=>y+R,0)/s.length,C=s.reduce((y,R)=>y+ve(R-w,2),0)/s.length,F=Math.sqrt(C),V=P-g,q=[...s].sort((y,R)=>y-R),A=($e=q[Math.floor((q.length-1)*.25)])!=null?$e:g,H=(Ue=q[Math.floor((q.length-1)*.75)])!=null?Ue:P,D=Math.max(H-A,0),K=D>Number.EPSILON?2*D/Math.cbrt(q.length):0,Y=K>0&&V>0?Math.round(V/K):16,ce=Math.max(10,Math.min(28,Y||16)),be=V>0?V/ce:1,L=Array(ce).fill(0);for(const y of s){const R=V>0?Math.floor((y-g)/be):Math.floor(ce/2),xe=Math.max(0,Math.min(R,ce-1));L[xe]++}const ee=Math.max(...L),j="#5f8fb0",v="#c5523a",E=.85;e.fillStyle="#ffffff",e.fillRect(0,0,a,u);const p={left:50,right:25,top:45,bottom:45},d=a-p.left-p.right,_=u-p.top-p.bottom,B=d/ce,se=_/(ee*1.1);e.fillStyle=j,e.globalAlpha=E;for(let y=0;y<ce;y++){const R=L[y]*se,xe=p.left+y*B,T=u-p.bottom-R;R>0&&(e.fillRect(xe,T,B-1,R),e.strokeStyle="white",e.lineWidth=.8,e.strokeRect(xe,T,B-1,R))}e.globalAlpha=1;const fe=F>Number.EPSILON&&V>0;if(fe){e.strokeStyle=v,e.lineWidth=2,e.beginPath();for(let y=0;y<=100;y++){const R=p.left+y/100*d,xe=g+y/100*V,X=1/(F*Math.sqrt(2*Math.PI))*Math.exp(-.5*ve((xe-w)/F,2))*s.length*be,z=u-p.bottom-X*se;y===0?e.moveTo(R,z):e.lineTo(R,z)}e.stroke()}e.strokeStyle=I.axisColor,e.lineWidth=1,e.beginPath(),e.moveTo(p.left,p.top),e.lineTo(p.left,u-p.bottom),e.stroke(),e.beginPath(),e.moveTo(p.left,u-p.bottom),e.lineTo(a-p.right,u-p.bottom),e.stroke();const Fe=4;e.strokeStyle=I.axisColor,e.lineWidth=1;for(let y=0;y<=6;y++){const R=p.left+y/6*d;e.beginPath(),e.moveTo(R,u-p.bottom),e.lineTo(R,u-p.bottom+Fe),e.stroke()}for(let y=0;y<=5;y++){const R=u-p.bottom-y/5*_;e.beginPath(),e.moveTo(p.left,R),e.lineTo(p.left-Fe,R),e.stroke()}e.fillStyle=I.subTextColor,e.font=O(10),e.textAlign="center";for(let y=0;y<=6;y++){const R=g+y/6*(P-g),xe=p.left+y/6*d;e.fillText(R.toFixed(1),xe,u-p.bottom+15)}e.textAlign="right";for(let y=0;y<=5;y++){const R=Math.round(y/5*(ee*1.1)),xe=u-p.bottom-y/5*_;e.fillText(R.toString(),p.left-6,xe+3)}e.fillStyle=I.subTextColor,e.font=O(11),e.textAlign="center",e.fillText("厚度 (m)",p.left+d/2,u-8),e.save(),e.translate(12,p.top+_/2),e.rotate(-Math.PI/2),e.fillText("频数",0,0),e.restore(),e.fillStyle=I.textColor,e.font=O(12,700),e.textAlign="left",e.fillText("Fig. 1 | 煤层厚度频率分布 (n="+s.length+")",p.left,18),e.fillStyle=I.textColor,e.font=O(10),e.textAlign="left";const oe=a-p.right-120,me=p.top+10;e.fillStyle=j,e.globalAlpha=E,e.fillRect(oe,me-4,12,10),e.globalAlpha=1,e.strokeStyle="white",e.lineWidth=.8,e.strokeRect(oe,me-4,12,10),e.fillText("观测值",oe+16,me+4),fe&&(e.strokeStyle=v,e.lineWidth=2,e.beginPath(),e.moveTo(oe,me+20),e.lineTo(oe+12,me+20),e.stroke(),e.fillStyle="#000000",e.fillText("密度拟合",oe+16,me+24)),e.fillStyle=I.subTextColor,e.font=O(9,400,!0),e.textAlign="left";const Pe=`μ=${w.toFixed(2)}  σ=${F.toFixed(2)}`;e.fillText(Pe,oe,me+42)},qe=()=>{const t=at.value;if(!t||Ye.value.length===0)return;const e=t.getContext("2d"),i=window.devicePixelRatio||1,n=t.parentElement,m=(n==null?void 0:n.clientWidth)||t.clientWidth||280,l=(n==null?void 0:n.clientHeight)||t.clientHeight||500;t.width=Math.round(m*i),t.height=Math.round(l*i),t.style.width=`${m}px`,t.style.height=`${l}px`,e.setTransform(i,0,0,i,0,0),Qe(e);const a=m,u=l;e.fillStyle="#FFFFFF",e.fillRect(0,0,a,u);const s=Ye.value;let g=Math.max(...s.map(L=>L.z_bottom||0));if((!Number.isFinite(g)||g<=0)&&(g=s.reduce((L,ee)=>L+(Number(ee.thickness)||0),0)),!Number.isFinite(g)||g<=0)return;const P={top:24,bottom:22},w=(u-P.top-P.bottom)/g,C=P.top,F=14,V=Math.max(110,Math.min(160,a*.3)),q=Math.max(80,Math.min(140,a*.22)),A=F+q+16+V,D=Math.max(16,(a-A)/2),K=D+F,Y=K+q+16;e.fillStyle=I.textColor,e.font=O(12,700),e.textAlign="left",e.fillText("Fig. 2 | 代表性钻孔地层柱状图",K,18);const ce=4,be=Math.max(5,Math.ceil(g/6/5)*5)||10;e.strokeStyle=I.gridColor,e.lineWidth=1,e.fillStyle=I.subTextColor,e.font=O(10),e.textAlign="right",e.beginPath(),e.moveTo(D,C),e.lineTo(D,u-P.bottom),e.stroke();for(let L=0;L<=g;L+=be){const ee=C+L*w;e.beginPath(),e.moveTo(D,ee),e.lineTo(D+ce,ee),e.stroke(),e.fillText(`${Math.round(L)} m`,D-6,ee+3)}e.save(),e.translate(D-28,C+(u-P.bottom-C)/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillStyle=I.subTextColor,e.font=O(11),e.fillText("深度 (m)",0,0),e.restore(),s.forEach((L,ee)=>{const j=C+(L.z_top||0)*w,v=L.thickness||0,E=Math.max(v*w,3),p=yt[L.name]||{facecolor:"#D3D3D3",hatch:"---",edgecolor:"#666666"};e.fillStyle=p.facecolor,e.fillRect(K,j,q,E),E>6&&p.hatch&&et(e,p.hatch,K,j,q,E,p.edgecolor),e.strokeStyle="#1a1a1a",e.lineWidth=.5,e.strokeRect(K,j,q,E),E>10&&(e.fillStyle=I.subTextColor,e.font=O(10),e.textAlign="left",e.fillText(L.name,Y,j+E/2+3),e.fillStyle="#2563EB",e.font=O(9,500,!0),e.fillText(`${v.toFixed(1)}米`,Y,j+E/2+14))}),e.strokeStyle="#94A3B8",e.lineWidth=1,e.strokeRect(K,C,q,u-C-P.bottom)},et=(t,e,i,n,m,l,a)=>{t.save(),t.beginPath(),t.rect(i,n,m,l),t.clip(),t.strokeStyle=a,t.globalAlpha=.4,t.lineWidth=.5;const u=6;switch(e){case"...":case"ooo":t.fillStyle=a,t.globalAlpha=.3;for(let s=u/2;s<m;s+=u)for(let g=u/2;g<l;g+=u)t.beginPath(),e==="ooo"?t.arc(i+s,n+g,2.5,0,Math.PI*2):t.arc(i+s,n+g,1,0,Math.PI*2),t.fill();break;case"---":t.globalAlpha=.5;for(let s=4;s<l;s+=u)t.beginPath(),t.moveTo(i,n+s),t.lineTo(i+m,n+s),t.stroke();break;case"+++":case"xx":t.globalAlpha=.3;for(let s=u/2;s<m;s+=u)for(let g=u/2;g<l;g+=u)t.beginPath(),t.moveTo(i+s-3,n+g),t.lineTo(i+s+3,n+g),t.stroke(),t.beginPath(),t.moveTo(i+s,n+g-3),t.lineTo(i+s,n+g+3),t.stroke();break;case"-..":case".-.":t.globalAlpha=.5;for(let s=u;s<l;s+=u*1.5)t.beginPath(),t.moveTo(i,n+s),t.lineTo(i+m/2,n+s),t.stroke(),t.fillStyle=a,t.beginPath(),t.arc(i+m*.75,n+s,1.5,0,Math.PI*2),t.fill();break;case"//":case"\\\\":t.globalAlpha=.4;for(let s=-l;s<m;s+=u)t.beginPath(),t.moveTo(i+s,n),t.lineTo(i+s+l,n+l),t.stroke();break}t.restore()},ut=t=>{Re.value={line:{start:t.startCanvas,end:t.endCanvas},worldLine:{start:t.start,end:t.end},points:t.points||[],depthProfile:[],distance:t.distance,hasData:!0},xt(t.start,t.end,t.distance)},xt=(t,e,i)=>{if(!Q.value.length||i===null)return;const n=We.value;if(!n)return;const m=n.getContext("2d");if(!m)return;const l=typeof window!="undefined"&&window.devicePixelRatio||1,a=Math.max(640,n.offsetWidth||900),u=300;n.width=Math.round(a*l),n.height=Math.round(u*l),n.style.width=`${a}px`,n.style.height=`${u}px`,m.setTransform(l,0,0,l,0,0);const s=100,g=(e.x-t.x)/s,P=(e.y-t.y)/s,w=[];for(let C=0;C<=s;C++){const F=t.x+g*C,V=t.y+P*C,q=Q.value.map(A=>{const H=Math.sqrt(ve(F-A.x,2)+ve(V-A.y,2));return{depth:A.burial_depth,distance:H}}).filter(A=>A.depth!=null&&A.distance<500);if(q.length>0){let A=0,H=0;for(const D of q){const K=1/ve(D.distance+1,2);H+=D.depth*K,A+=K}w.push({distance:C/s*i,depth:H/A})}}Re.value.depthProfile=w,kt(w,i,a,u)},kt=(t,e,i,n)=>{var E,p;const m=We.value;if(!m)return;const l=m.getContext("2d");if(!l)return;if(Qe(l),l.fillStyle="#FFFFFF",l.fillRect(0,0,i,n),!t.length||!Number.isFinite(e)||e<=0){l.fillStyle=I.subTextColor,l.font=O(14),l.textAlign="center",l.fillText("当前剖面线附近缺少可用埋深数据，请重选剖面线。",i/2,n/2);return}const a={left:50,right:30,top:35,bottom:40},u=i-a.left-a.right,s=n-a.top-a.bottom,g=t.map(d=>d.depth),P=Math.min(...g),w=Math.max(...g),C=w-P||1,F={topSoil:"#8FBC8F",sandstone:"#F4A460",shale:"#778899",coal:"#2F2F2F",sandyShale:"#A9A9A9",limestone:"#B0C4DE"},q=s/6;[F.limestone,F.sandyShale,F.coal,F.shale,F.sandstone,F.topSoil].forEach((d,_)=>{const B=a.top+_*q;l.fillStyle=d,l.globalAlpha=.08,l.fillRect(a.left,B,u,q),l.globalAlpha=1}),l.strokeStyle=I.gridColor,l.lineWidth=.8;const H=10;for(let d=0;d<=H;d++){const _=a.left+d/H*u;l.beginPath(),l.moveTo(_,a.top),l.lineTo(_,n-a.bottom),l.stroke()}const D=5;for(let d=0;d<=D;d++){const _=a.top+d/D*s;l.beginPath(),l.moveTo(a.left,_),l.lineTo(i-a.right,_),l.stroke()}l.strokeStyle=I.axisColor,l.lineWidth=1,l.beginPath(),l.moveTo(a.left,a.top),l.lineTo(a.left,n-a.bottom),l.stroke(),l.beginPath(),l.moveTo(a.left,n-a.bottom),l.lineTo(i-a.right,n-a.bottom),l.stroke();const K=4;l.strokeStyle="rgba(148, 163, 184, 0.75)",l.lineWidth=1;for(let d=0;d<=H;d++){const _=a.left+d/H*u;l.beginPath(),l.moveTo(_,n-a.bottom),l.lineTo(_,n-a.bottom+K),l.stroke()}for(let d=0;d<=D;d++){const _=n-a.bottom-d/D*s;l.beginPath(),l.moveTo(a.left,_),l.lineTo(a.left-K,_),l.stroke()}l.beginPath(),l.strokeStyle=F.sandstone,l.lineWidth=2.5,l.lineCap="round",l.lineJoin="round";const Y=t.map(d=>({x:a.left+d.distance/e*u,y:n-a.bottom-(d.depth-P)/C*s}));if(l.moveTo(Y[0].x,Y[0].y),Y.length>2){for(let B=1;B<Y.length-1;B++){const se=(Y[B].x+Y[B+1].x)/2,fe=(Y[B].y+Y[B+1].y)/2;l.quadraticCurveTo(Y[B].x,Y[B].y,se,fe)}const d=Y[Y.length-1],_=Y[Y.length-2];l.quadraticCurveTo(_.x,_.y,d.x,d.y)}else Y.length===2&&l.lineTo(Y[1].x,Y[1].y);l.stroke(),l.lineTo(a.left+u,n-a.bottom),l.lineTo(a.left,n-a.bottom),l.closePath(),l.fillStyle="rgba(244, 164, 96, 0.12)",l.fill();for(const d of Q.value){if(d.burial_depth==null)continue;const _=d.x,B=d.y,se=((E=Re.value.worldLine)==null?void 0:E.start)||{x:0,y:0},fe=((p=Re.value.worldLine)==null?void 0:p.end)||{x:0,y:0},Fe=Math.sqrt(ve(fe.x-se.x,2)+ve(fe.y-se.y,2));if(Fe===0)continue;const oe=((_-se.x)*(fe.x-se.x)+(B-se.y)*(fe.y-se.y))/ve(Fe,2),me=se.x+oe*(fe.x-se.x),Pe=se.y+oe*(fe.y-se.y);if(Math.sqrt(ve(_-me,2)+ve(B-Pe,2))<50&&oe>=0&&oe<=1){const Ue=a.left+oe*u,y=n-a.bottom-(d.burial_depth-P)/C*s;l.beginPath(),l.arc(Ue,y,4,0,Math.PI*2),l.fillStyle=F.coal,l.fill(),l.strokeStyle="#ffffff",l.lineWidth=1.5,l.stroke(),l.fillStyle=I.subTextColor,l.font=O(10),l.textAlign="center";const R=d.borehole||d.name||"";R&&l.fillText(R,Ue,y-10)}}l.fillStyle=I.subTextColor,l.font=O(11),l.textAlign="center";for(let d=0;d<=H;d++){const _=a.left+d/H*u,B=d/H*e;l.fillText(`${B.toFixed(0)}`,_,n-15)}l.textAlign="right";for(let d=0;d<=D;d++){const _=n-a.bottom-d/D*s,B=P+d/D*C;l.fillText(`${B.toFixed(0)}`,a.left-8,_+4)}l.fillStyle=I.subTextColor,l.font=O(12),l.textAlign="center",l.fillText("剖面距离 (米)",a.left+u/2,n-5),l.save(),l.translate(12,a.top+s/2),l.rotate(-Math.PI/2),l.fillText("埋藏深度 (米)",0,0),l.restore(),l.fillStyle=I.textColor,l.font=O(13,700),l.textAlign="left",l.fillText(`Fig. 4 | 剖面 A-A' 深度分布 (${P.toFixed(1)}-${w.toFixed(1)} m)`,a.left,18);const ce=Math.max(10,e/4),be=[10,20,50,100,200,500,1e3];let L=be[0];for(const d of be)d<=ce&&(L=d);const ee=Math.max(34,Math.min(110,L/e*u)),j=i-a.right-ee-16,v=n-a.bottom+12;l.strokeStyle=I.axisColor,l.lineWidth=2,l.beginPath(),l.moveTo(j,v),l.lineTo(j+ee,v),l.stroke(),l.beginPath(),l.moveTo(j,v-3),l.lineTo(j,v+3),l.stroke(),l.beginPath(),l.moveTo(j+ee,v-3),l.lineTo(j+ee,v+3),l.stroke(),l.fillStyle=I.subTextColor,l.font=O(10,500),l.textAlign="center",l.fillText(`比例尺: ${Math.round(L)} m`,j+ee/2,v+12)},tt=()=>{Be.value=!1,Re.value={line:null,points:[],depthProfile:[],distance:null,hasData:!1},We.value&&We.value.getContext("2d").clearRect(0,0,We.value.width,We.value.height)},dt=()=>{var t;De.push({name:"AcademicAlgorithm",query:(t=ae.value)!=null&&t.name?{seam:ae.value.name}:void 0})},Nt=t=>Array.isArray(t)?t[0]||"":typeof t=="string"?t:"";return zt(()=>Ke(this,null,function*(){var i;yield $();const t=Nt((i=W.query)==null?void 0:i.seam)||Se.selectedSeam;if(!t)return;const e=Te.value.find(n=>n.name===t);e&&(yield ie(e))})),ne({resetView:()=>{tt()}}),(t,e)=>{var i,n,m,l,a,u,s,g,P,w,C,F,V,q,A,H,D,K,Y,ce,be,L,ee,j;return b(),k("div",Po,[o("div",$o,[o("div",null,[e[5]||(e[5]=o("h2",null,"插值分析",-1)),o("div",Ao,x(((i=ae.value)==null?void 0:i.name)||"请选择煤层并执行空间插值分析"),1)]),ae.value&&ge.value?(b(),k("div",Bo,[o("div",Ro,[e[6]||(e[6]=o("span",{class:"stat-label"},"厚度范围",-1)),o("strong",null,x(((l=(m=(n=ge.value)==null?void 0:n.thickness)==null?void 0:m.min)==null?void 0:l.toFixed(2))||"-")+" - "+x(((s=(u=(a=ge.value)==null?void 0:a.thickness)==null?void 0:u.max)==null?void 0:s.toFixed(2))||"-")+" m",1)]),o("div",Wo,[e[7]||(e[7]=o("span",{class:"stat-label"},"平均厚度",-1)),o("strong",null,x(((w=(P=(g=ge.value)==null?void 0:g.thickness)==null?void 0:P.mean)==null?void 0:w.toFixed(2))||"-")+" m",1)]),o("div",No,[e[8]||(e[8]=o("span",{class:"stat-label"},"钻孔数量",-1)),o("strong",null,x(((C=ge.value)==null?void 0:C.borehole_count)||Q.value.length||"-"),1)])])):le("",!0)]),ae.value?(b(),k("div",Vo,[o("div",Qo,[e[20]||(e[20]=ot('<h3 class="section-title" data-v-6e116d8c><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-6e116d8c><circle cx="12" cy="12" r="3" data-v-6e116d8c></circle><path d="M12 1v6m0 6v6" data-v-6e116d8c></path><path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24" data-v-6e116d8c></path><path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24" data-v-6e116d8c></path></svg> 插值参数 </h3>',1)),o("div",Jo,[e[12]||(e[12]=o("label",{class:"param-label"},"插值方法",-1)),o("div",Ko,[(b(),k(st,null,nt(gt,v=>o("button",{key:v.key,class:Oe(["tab-btn",{active:Ce.value===v.key}]),onClick:E=>Ce.value=v.key},x(v.label),11,jo)),64))])]),o("div",Go,[o("div",Zo,[e[13]||(e[13]=o("label",{class:"param-label"},"网格密度",-1)),o("span",el,x(ue.value),1)]),St(o("input",{"onUpdate:modelValue":e[0]||(e[0]=v=>ue.value=v),type:"range",min:"30",max:"150",step:"10",class:"slider"},null,512),[[$t,ue.value,void 0,{number:!0}]]),e[14]||(e[14]=o("div",{class:"slider-labels"},[o("span",null,"粗"),o("span",null,"细")],-1))]),o("div",tl,[o("div",ol,[e[15]||(e[15]=o("label",{class:"param-label"},"等值线级别",-1)),o("span",ll,x(Me.value),1)]),St(o("input",{"onUpdate:modelValue":e[1]||(e[1]=v=>Me.value=v),type:"range",min:"5",max:"20",step:"1",class:"slider"},null,512),[[$t,Me.value,void 0,{number:!0}]]),e[16]||(e[16]=o("div",{class:"slider-labels"},[o("span",null,"少"),o("span",null,"多")],-1))]),o("div",sl,[e[17]||(e[17]=o("label",{class:"param-label"},"渲染质量",-1)),o("div",nl,[(b(),k(st,null,nt(pt,v=>o("button",{key:v.key,class:Oe(["tab-btn",{active:_e.value===v.key}]),onClick:E=>_e.value=v.key},x(v.label),11,al)),64))]),e[18]||(e[18]=o("div",{class:"slider-labels quality-hint"},[o("span",null,"默认先快速预览，需要时再切换更高质量重算。")],-1))]),J.value?(b(),k("div",il,[o("label",rl,[St(o("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=v=>Be.value=v)},null,512),[[Ht,Be.value]]),e[19]||(e[19]=o("span",null,"绘制剖面线",-1))]),Be.value?(b(),k("p",cl,"在地图上点击两点绘制剖面线")):le("",!0)])):le("",!0),o("div",ul,[o("button",{class:"btn primary",onClick:e[3]||(e[3]=v=>pe({forceRefresh:!0,silent:!1})),disabled:N.value},[N.value?(b(),k("span",vl)):le("",!0),ft(" "+x(N.value?"计算中...":"生成等值线图"),1)],8,dl),o("button",{class:"btn outline",onClick:e[4]||(e[4]=v=>{ae.value=null,J.value=null,de.value=null})}," 更换煤层 "),J.value||de.value?(b(),k("button",{key:0,class:"btn outline",onClick:dt}," 下一步：新算法原理 ")):le("",!0)]),h.value?(b(),k("p",hl,x(h.value),1)):le("",!0)]),o("div",fl,[e[28]||(e[28]=ot('<h3 class="section-title" data-v-6e116d8c><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-6e116d8c><line x1="18" y1="20" x2="18" y2="10" data-v-6e116d8c></line><line x1="12" y1="20" x2="12" y2="4" data-v-6e116d8c></line><line x1="6" y1="20" x2="6" y2="14" data-v-6e116d8c></line></svg> 数据分布 </h3>',1)),Q.value.length>0?(b(),k("div",ml,[o("canvas",{ref_key:"histogramCanvas",ref:je,class:"histogram-canvas"},null,512)])):(b(),k("div",gl,[...e[21]||(e[21]=[o("p",null,"暂无数据分布",-1)])])),Q.value.length>0?(b(),k("div",pl,[o("div",yl,[e[22]||(e[22]=o("span",{class:"stat-label"},"样本数",-1)),o("span",bl,x(c.value.count),1)]),o("div",xl,[e[23]||(e[23]=o("span",{class:"stat-label"},"均值",-1)),o("span",kl,x(c.value.mean.toFixed(2))+"m",1)]),o("div",_l,[e[24]||(e[24]=o("span",{class:"stat-label"},"标准差",-1)),o("span",Sl,x(c.value.stdDev.toFixed(2))+"m",1)]),o("div",wl,[e[25]||(e[25]=o("span",{class:"stat-label"},"变异系数",-1)),o("span",Cl,x(c.value.cv.toFixed(2)),1)]),o("div",Tl,[e[26]||(e[26]=o("span",{class:"stat-label"},"最小值",-1)),o("span",Ml,x(c.value.min.toFixed(2))+"m",1)]),o("div",Fl,[e[27]||(e[27]=o("span",{class:"stat-label"},"最大值",-1)),o("span",Pl,x(c.value.max.toFixed(2))+"m",1)])])):le("",!0)]),o("div",$l,[e[29]||(e[29]=ot('<h3 class="section-title" data-v-6e116d8c><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-6e116d8c><path d="M12 2L2 7l10 5 10-5-10-5z" data-v-6e116d8c></path><path d="m2 17 10 5 10-5" data-v-6e116d8c></path><path d="m2 12 10 5 10-5" data-v-6e116d8c></path></svg> 地层柱状图 </h3>',1)),o("div",Al,[o("canvas",{ref_key:"stratigraphicCanvas",ref:at,class:"stratigraphic-canvas"},null,512)]),o("div",Bl,[(b(),k(st,null,nt(Ve,(v,E)=>o("div",{key:E,class:"legend-item-compact"},[o("div",{class:"legend-color",style:lt({background:v})},null,4),o("span",Rl,x(E),1)])),64))])]),ae.value?(b(),k("div",Wl,[o("div",Nl,[o("div",Il,[o("div",null,[e[30]||(e[30]=o("h3",{class:"section-title"},[o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"})]),ft(" 煤层厚度分布 ")],-1)),J.value?(b(),k("p",El,x(Ze(Ce.value))+" · "+x((q=(V=(F=J.value)==null?void 0:F.valueRange)==null?void 0:V.min)==null?void 0:q.toFixed(1))+" - "+x((D=(H=(A=J.value)==null?void 0:A.valueRange)==null?void 0:H.max)==null?void 0:D.toFixed(1))+" m",1)):(b(),k("p",Dl,"正在准备厚度分布图..."))])]),o("div",Yl,[J.value?(b(),At(Bt,{key:0,"image-url":J.value.imageUrl,boreholes:Q.value,bounds:J.value.bounds,property:"thickness","property-label":"厚度","value-range":J.value.valueRange,colormap:"YlOrBr","cross-section-mode":Be.value,onCrossSectionComplete:ut},null,8,["image-url","boreholes","bounds","value-range","cross-section-mode"])):(b(),k("div",{key:1,class:Oe(["map-placeholder",{loading:N.value}])},[N.value?(b(),k("div",Ll)):le("",!0),o("p",null,x(N.value?"正在计算厚度分布图...":"点击“生成等值线图”后显示厚度分布图。"),1)],2))])]),o("div",Xl,[o("div",zl,[o("div",null,[e[31]||(e[31]=o("h3",{class:"section-title"},[o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o("path",{d:"m2 17 10 5 10-5"})]),ft(" 煤层埋深分布 ")],-1)),de.value?(b(),k("p",Hl,x(Ze(Ce.value))+" · "+x((ce=(Y=(K=de.value)==null?void 0:K.valueRange)==null?void 0:Y.min)==null?void 0:ce.toFixed(1))+" - "+x((ee=(L=(be=de.value)==null?void 0:be.valueRange)==null?void 0:L.max)==null?void 0:ee.toFixed(1))+" m",1)):(b(),k("p",ql,"正在准备埋深分布图..."))])]),o("div",Ul,[de.value?(b(),At(Bt,{key:0,"image-url":de.value.imageUrl,boreholes:Q.value,bounds:de.value.bounds,property:"burial_depth","property-label":"埋深","value-range":de.value.valueRange,colormap:"viridis","cross-section-mode":Be.value,onCrossSectionComplete:ut},null,8,["image-url","boreholes","bounds","value-range","cross-section-mode"])):(b(),k("div",{key:1,class:Oe(["map-placeholder",{loading:N.value}])},[N.value?(b(),k("div",Ol)):le("",!0),o("p",null,x(N.value?"正在计算埋深分布图...":"点击“生成等值线图”后显示埋深分布图。"),1)],2))])])])):le("",!0),ae.value?(b(),k("div",Vl,[e[32]||(e[32]=ot('<div class="map-header" data-v-6e116d8c><div data-v-6e116d8c><h3 class="section-title" data-v-6e116d8c><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-6e116d8c><circle cx="12" cy="12" r="10" data-v-6e116d8c></circle><line x1="12" y1="8" x2="12" y2="12" data-v-6e116d8c></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-6e116d8c></line></svg> 插值不确定性分布 </h3><p class="section-desc" data-v-6e116d8c>红色区域表示高不确定性，蓝色区域更可靠</p></div></div>',1)),o("div",Ql,[J.value?(b(),k("canvas",{key:0,ref_key:"uncertaintyCanvas",ref:it,class:"uncertainty-canvas"},null,512)):(b(),k("div",{key:1,class:Oe(["map-placeholder",{loading:N.value}])},[N.value?(b(),k("div",Jl)):le("",!0),o("p",null,x(N.value?"正在计算不确定性分布图...":"完成插值后显示不确定性分布图。"),1)],2))])])):le("",!0),Re.value.hasData?(b(),k("div",Kl,[o("div",jl,[o("div",null,[o("h3",Gl,[e[33]||(e[33]=o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("path",{d:"M3 3v18h18"}),o("path",{d:"m19 9-5 5-4-4-3 3"})],-1)),e[34]||(e[34]=ft(" 剖面切片 (A-A') ",-1)),o("span",Zl,x((j=Re.value.distance)==null?void 0:j.toFixed(0))+" m",1)])]),o("button",{class:"btn outline small",onClick:tt},"重置")]),o("div",es,[o("canvas",{ref_key:"crossSectionCanvas",ref:We,class:"cross-section-canvas"},null,512)])])):le("",!0)])):(b(),k("div",Io,[e[11]||(e[11]=ot('<h3 class="section-title" data-v-6e116d8c><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-6e116d8c><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-6e116d8c></rect><line x1="3" y1="9" x2="21" y2="9" data-v-6e116d8c></line><line x1="9" y1="21" x2="9" y2="9" data-v-6e116d8c></line></svg> 选择分析煤层 </h3><p class="section-desc" data-v-6e116d8c>从以下可用煤层中选择一个进行插值分析</p>',2)),o("div",Eo,[(b(!0),k(st,null,nt(Te.value,v=>{var E,p,d,_,B;return b(),k("div",{key:v.name,class:"seam-selection-card",onClick:se=>ie(v)},[o("div",Yo,[o("span",Lo,x(v.name),1),o("span",Xo,x(v.borehole_count)+" 个钻孔",1)]),o("div",zo,[o("div",Ho,[e[9]||(e[9]=o("span",{class:"mini-stat-label"},"平均厚度",-1)),o("span",qo,x((E=v.avg_thickness)==null?void 0:E.toFixed(2))+" m",1)]),o("div",Uo,[e[10]||(e[10]=o("span",{class:"mini-stat-label"},"厚度范围",-1)),o("span",Oo,x((d=(p=v.thickness_range)==null?void 0:p.min)==null?void 0:d.toFixed(1))+"-"+x((B=(_=v.thickness_range)==null?void 0:_.max)==null?void 0:B.toFixed(1))+" m",1)])])],8,Do)}),128))])]))])}}},cs=Wt(ts,[["__scopeId","data-v-6e116d8c"]]);export{cs as default};
