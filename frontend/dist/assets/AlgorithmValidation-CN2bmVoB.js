var $n=Object.defineProperty,Rn=Object.defineProperties;var Fn=Object.getOwnPropertyDescriptors;var Xt=Object.getOwnPropertySymbols;var Pn=Object.prototype.hasOwnProperty,Tn=Object.prototype.propertyIsEnumerable;var Kt=Math.pow,Jt=(g,Y,x)=>Y in g?$n(g,Y,{enumerable:!0,configurable:!0,writable:!0,value:x}):g[Y]=x,Z=(g,Y)=>{for(var x in Y||(Y={}))Pn.call(Y,x)&&Jt(g,x,Y[x]);if(Xt)for(var x of Xt(Y))Tn.call(Y,x)&&Jt(g,x,Y[x]);return g},X=(g,Y)=>Rn(g,Fn(Y));var Me=(g,Y,x)=>new Promise((ke,v)=>{var ce=T=>{try{B(x.next(T))}catch(r){v(r)}},h=T=>{try{B(x.throw(T))}catch(r){v(r)}},B=T=>T.done?ke(T.value):Promise.resolve(T.value).then(ce,h);B((x=x.apply(g,Y)).next())});import{_ as Bt,u as Ln,b as zn}from"./index-CqmxJPzg.js";import{r as Rt,bB as Dn,bC as En,bA as Bn,be as ln,n as sn,w as De,bv as rn,b5 as te,b8 as ne,bm as vt,b as Q,c as p,b7 as o,bb as y,bh as Se,ba as et,bi as Ie,u as Un,bq as ze,bu as Qt,bc as Xe,b9 as Dt,bn as Fe,br as pt,bs as en,bl as On,bg as tn,bx as nn,a as Vn}from"./vendor-BiQoUjbf.js";import{a as Wn,u as Hn}from"./vue-router-Dfza_nYx.js";import{g as jn,v as Gn,n as Yn}from"./api-BhRy5Rwk.js";import"./echarts-CkoSHfYc.js";import{i as qn}from"./echarts-AB_YLQA7.js";import"./network-T6nY3V_4.js";function Zn(){const g=Rt({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),Y=(T,r,f)=>{if(!f)return{x:0,y:0};const u=T-f.min_x,A=f.max_y-r;return{x:u*g.scale+g.x,y:A*g.scale+g.y}},x=(T,r,f)=>{if(!f||g.scale===0)return{x:0,y:0};const u=(T-g.x)/g.scale,A=(r-g.y)/g.scale;return{x:f.min_x+u,y:f.max_y-A}};return{viewport:g,worldToScreen:Y,screenToWorld:x,fitToBounds:(T,r,f,u=56)=>{if(!T||!r||!f)return;const A=Math.max(T.max_x-T.min_x,1e-6),U=Math.max(T.max_y-T.min_y,1e-6),_=Math.min((r-u*2)/A,(f-u*2)/U),$=(T.min_x+T.max_x)/2,M=(T.min_y+T.max_y)/2;g.scale=Math.max(.01,_),g.x=r/2-($-T.min_x)*g.scale,g.y=f/2-(T.max_y-M)*g.scale},startDrag:(T,r)=>{g.isDragging=!0,g.lastX=T,g.lastY=r},dragTo:(T,r)=>{g.isDragging&&(g.x+=T-g.lastX,g.y+=r-g.lastY,g.lastX=T,g.lastY=r)},endDrag:()=>{g.isDragging=!1},zoomAt:(T,r,f,u,A=.1,U=50)=>{if(!u)return;const _=Math.max(A,Math.min(U,g.scale*T));if(_===g.scale)return;const $=x(r,f,u);g.scale=_,g.x=r-($.x-u.min_x)*g.scale,g.y=f-(u.max_y-$.y)*g.scale}}}const on={mpi:["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],rsi:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],bri:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],asi:["#3b82f6","#6366f1","#8b5cf6","#ec4899","#dc2626"]},Et=g=>Math.max(0,Math.min(1,g)),Xn=g=>{const x=String(g||"").match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return x?{r:Number(x[1]),g:Number(x[2]),b:Number(x[3])}:null},Jn=(g,Y=.8)=>{const x=Xn(g);if(!x)return"#94a3b8";const ke=Math.round(x.r*.299+x.g*.587+x.b*.114),v=Math.round(ke*Y+235*(1-Y));return`rgb(${v},${v},${v})`},an=g=>{var ke,v;const Y=Number((ke=g==null?void 0:g.min)!=null?ke:0),x=Number((v=g==null?void 0:g.max)!=null?v:100);return!Number.isFinite(Y)||!Number.isFinite(x)||Y===x?{min:0,max:100}:{min:Y,max:x}};function Kn(){const g=r=>on[r]||on.mpi,Y=r=>`linear-gradient(90deg, ${g(r).join(",")})`,x=(r,f,u)=>{const{min:A,max:U}=an(u),_=Et((Number(f)-A)/(U-A));return Dn(g(r))(_)},ke=(r,f,u,A,U,_,$={})=>{var I;const M=f.length,W=((I=f[0])==null?void 0:I.length)||0;if(M<2||W<2)return;const ae=new Array(M*W);let O=0;for(let z=0;z<M;z+=1)for(let ue=0;ue<W;ue+=1)ae[O]=Number(f[z][ue]||0),O+=1;const{min:j,max:de}=an(U),me=Math.max(5,Number($.contourLevels||9)),oe=En(j,de,me).slice(1,-1);if(!oe.length)return;const pe=Bn().size([W,M]).thresholds(oe)(ae),be=Math.max(u.max_x-u.min_x,1e-6),V=Math.max(u.max_y-u.min_y,1e-6);r.save(),r.strokeStyle=$.contourColor||"rgba(15,23,42,0.32)",r.lineWidth=A.scale>2?1.2:.9,r.globalAlpha=A.scale<.65?.45:.7;for(const z of pe)for(const ue of z.coordinates)for(const ye of ue)if(!(!Array.isArray(ye)||ye.length<2)){r.beginPath();for(let ie=0;ie<ye.length;ie+=1){const _e=ye[ie],J=u.min_x+_e[0]/Math.max(W-1,1)*be,$e=u.max_y-_e[1]/Math.max(M-1,1)*V,ve=_(J,$e,u);ie===0?r.moveTo(ve.x,ve.y):r.lineTo(ve.x,ve.y)}r.closePath(),r.stroke()}r.restore()};return{getLegendGradient:Y,drawGrid:(r,f,u,A,U,_,$,M={})=>{var be;if(!r||!Array.isArray(f)||f.length===0||!u)return;const W=f.length,ae=((be=f[0])==null?void 0:be.length)||0;if(!ae)return;const O=u.max_x-u.min_x,j=u.max_y-u.min_y,de=O/ae,me=j/W,oe=r.canvas.width,pe=r.canvas.height;for(let V=0;V<W;V+=1){const I=f[V],z=u.max_y-V*me;for(let ue=0;ue<ae;ue+=1){const ye=u.min_x+ue*de,ie=$(ye,z,u),_e=$(ye+de,z-me,u),J=Math.min(ie.x,_e.x),$e=Math.min(ie.y,_e.y),ve=Math.abs(_e.x-ie.x)+.8,G=Math.abs(_e.y-ie.y)+.8;J>oe||J+ve<0||$e>pe||$e+G<0||(r.fillStyle=x(U,Number(I[ue]||0),_),r.fillRect(J,$e,ve,G))}}if(M.showContours!==!1&&ke(r,f,u,A,_,$,M),A.scale>3.2){r.strokeStyle="rgba(255,255,255,0.18)",r.lineWidth=1,r.beginPath();for(let V=0;V<=W;V+=1){const I=u.max_y-V*me,z=$(u.min_x,I,u),ue=$(u.max_x,I,u);r.moveTo(z.x,z.y),r.lineTo(ue.x,ue.y)}for(let V=0;V<=ae;V+=1){const I=u.min_x+V*de,z=$(I,u.min_y,u),ue=$(I,u.max_y,u);r.moveTo(z.x,z.y),r.lineTo(ue.x,ue.y)}r.stroke()}},drawBoreholes:(r,f,u,A,U,_,$="",M=null)=>{if(!r||!Array.isArray(f)||!U)return;const W=!!(M!=null&&M.active&&(M==null?void 0:M.indexSet)instanceof Set&&M.indexSet.size>0),ae=String((M==null?void 0:M.accent)||"#111827"),O=!!(M!=null&&M.animate),j=Number((M==null?void 0:M.pulseT)||0);for(let de=0;de<f.length;de+=1){const me=f[de],oe=_(me.x,me.y,U),pe=$&&$===me.borehole_name,be=!W||M.indexSet.has(de),V=O&&W&&be?(Math.sin(j*5+de*.35)+1)/2:0,I=pe?7.5:be&&W?6.6:5.8;r.save();const z=x(u,me[u],A);r.globalAlpha=W&&!be?.24:1,r.fillStyle=W&&!be?Jn(z,.84):z,r.strokeStyle=pe?"#111827":be&&W?ae:"rgba(255,255,255,0.95)",r.lineWidth=pe?2.4:1.8,r.beginPath(),r.arc(oe.x,oe.y,I,0,Math.PI*2),r.fill(),r.stroke(),be&&W&&!pe&&(r.globalAlpha=.95,r.strokeStyle=ae,r.lineWidth=2,r.beginPath(),r.arc(oe.x,oe.y,I+3.6,0,Math.PI*2),r.stroke(),O&&(r.globalAlpha=.35+V*.45,r.lineWidth=1.6+V*.9,r.beginPath(),r.arc(oe.x,oe.y,I+6+V*5.5,0,Math.PI*2),r.stroke())),r.restore()}},pickNearestBorehole:(r,f,u,A,U,_=14)=>{if(!Array.isArray(u)||!A)return null;let $=null,M=Number.POSITIVE_INFINITY;for(const W of u){const ae=U(W.x,W.y,A),O=Math.hypot(r-ae.x,f-ae.y);O<M&&(M=O,$=W)}return M<=_?$:null},sampleGridValue:(r,f,u,A)=>{var O;if(!Array.isArray(r)||r.length===0||!f)return null;const U=r.length,_=((O=r[0])==null?void 0:O.length)||0;if(!_)return null;const $=Et((u-f.min_x)/Math.max(f.max_x-f.min_x,1e-6)),M=Et((f.max_y-A)/Math.max(f.max_y-f.min_y,1e-6)),W=Math.max(0,Math.min(_-1,Math.floor($*(_-1)))),ae=Math.max(0,Math.min(U-1,Math.floor(M*(U-1))));return Number(r[ae][W])},drawMiniHeatmap:(r,f,u,A)=>{var de;if(!r||!Array.isArray(f)||f.length===0)return;const U=window.devicePixelRatio||1,_=r.clientWidth||150,$=r.clientHeight||110;r.width=Math.round(_*U),r.height=Math.round($*U);const M=r.getContext("2d");M.setTransform(U,0,0,U,0,0),M.clearRect(0,0,_,$);const W=f.length,ae=((de=f[0])==null?void 0:de.length)||0;if(!ae)return;const O=_/ae,j=$/W;for(let me=0;me<W;me+=1)for(let oe=0;oe<ae;oe+=1)M.fillStyle=x(u,Number(f[me][oe]||0),A),M.fillRect(oe*O,me*j,O+.4,j+.4);M.strokeStyle="rgba(255,255,255,0.35)",M.strokeRect(0,0,_,$)}}}const Qn={__name:"ScienceChart",props:{option:{type:Object,required:!0},height:{type:[String,Number],default:320}},emits:["chart-click"],setup(g,{emit:Y}){const x=g,ke=Y,v=Q(null);let ce=null;const h=p(()=>typeof x.height=="number"?`${x.height}px`:x.height),B=()=>{ce&&ce.setOption(x.option||{},!0)},T=()=>{ce&&ce.resize()},r=f=>{ke("chart-click",f)};return ln(()=>Me(this,null,function*(){yield sn(),v.value&&(ce=qn(v.value,null,{renderer:"svg"}),ce.on("click",r),B(),window.addEventListener("resize",T))})),De(()=>x.option,()=>{B()},{deep:!0}),rn(()=>{window.removeEventListener("resize",T),ce&&(ce.off("click",r),ce.dispose(),ce=null)}),(f,u)=>(te(),ne("div",{ref_key:"container",ref:v,class:"science-chart",style:vt({height:h.value})},null,4))}},Pe=Bt(Qn,[["__scopeId","data-v-8491ce69"]]),eo={class:"science-gallery"},to={class:"gallery-head"},no={class:"head-metrics"},oo={class:"metric-chip"},ao={class:"metric-chip"},lo={key:0,class:"metric-chip"},so={key:1,class:"metric-chip"},ro={class:"figure-card"},io={class:"caption meta"},uo={class:"figure-card"},co={class:"caption meta"},mo={class:"figure-card"},po={class:"caption meta"},vo={class:"figure-card"},fo={class:"caption meta"},yo={class:"figure-card"},ho={class:"caption meta"},go={class:"figure-card"},bo={class:"caption meta"},xo={class:"figure-card"},wo={class:"caption meta"},So={class:"figure-card"},_o={class:"caption meta"},ko={class:"figure-card"},Ao={class:"caption meta"},Mo={class:"figure-card"},Co={class:"caption meta"},ge="'Times New Roman', 'Noto Serif SC', 'Source Han Serif SC', serif",No={__name:"ValidationScienceFigures",props:{result:{type:Object,default:null},evaluation:{type:Object,default:null}},emits:["matrix-select"],setup(g,{emit:Y}){const x=g,ke=Y,v={blue:"#1d4ed8",cyan:"#0891b2",green:"#15803d",orange:"#d97706",red:"#b91c1c",purple:"#7c3aed",slate:"#475569"},ce={left:66,right:26,top:46,bottom:62},h=(e,n,l)=>Math.max(n,Math.min(l,e)),B=(e,n=0)=>{const l=Number(e);return Number.isFinite(l)?l:n},T=e=>`${(h(B(e,0),0,1)*100).toFixed(1)}%`,r=(e,n=3)=>Number(B(e,0).toFixed(n)),f=(e,n,l=0)=>n>0?e/n:l,u=(e,n=!0)=>({type:n?"value":"category",name:e,nameLocation:"middle",nameGap:38,nameTextStyle:{fontFamily:ge,fontSize:12,color:"#0f172a"},axisLabel:{fontFamily:ge,fontSize:11,color:"#0f172a"},axisLine:{lineStyle:{color:"#0f172a",width:1.15}},axisTick:{lineStyle:{color:"#334155",width:1}},splitLine:{show:!0,lineStyle:{color:"#e2e8f0",width:.8,type:"dashed"}}}),A={top:6,textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"}},U={right:8,top:6,itemSize:14,iconStyle:{borderColor:"#334155"},feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"框选缩放",back:"还原缩放"}},restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}},_=[{type:"inside",xAxisIndex:0,filterMode:"none",zoomOnMouseWheel:"ctrl",moveOnMouseMove:!0}],$=p(()=>{var e;return((e=x.result)==null?void 0:e.evaluation_inputs)||{}}),M=p(()=>{var n,l;const e=((n=$.value)==null?void 0:n.mode)||((l=$.value)==null?void 0:l.source)||"pseudo_threshold";return String(e)}),W=p(()=>{var e,n;return String(((e=$.value)==null?void 0:e.source)||((n=$.value)==null?void 0:n.sourceFile)||"")}),ae=p(()=>M.value==="real_label_stream"?"真实标签流":M.value==="pseudo_threshold"?"伪标签估计":"未知"),O=p(()=>{var d,w,F,D;const e=Array.isArray((d=$.value)==null?void 0:d.y_true)?$.value.y_true:Array.isArray((w=$.value)==null?void 0:w.yTrue)?$.value.yTrue:[],n=Array.isArray((F=$.value)==null?void 0:F.y_prob)?$.value.y_prob:Array.isArray((D=$.value)==null?void 0:D.yProb)?$.value.yProb:[],l=Math.min(e.length,n.length),s=[];for(let H=0;H<l;H+=1){const P=B(e[H],0)>=1?1:0,C=h(B(n[H],0),0,1);s.push({y:P,p:C})}return s}),j=p(()=>O.value.length),de=p(()=>O.value.filter(e=>e.y===1).length),me=p(()=>j.value-de.value),oe=p(()=>f(de.value,Math.max(j.value,1),0)),pe=p(()=>j.value>=6&&de.value>0&&me.value>0),be=p(()=>{const e=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const n of O.value)e.push(Number(n.p.toFixed(3)));return Array.from(new Set(e.map(n=>h(n,0,1)))).sort((n,l)=>l-n)}),V=e=>{let n=0,l=0,s=0,d=0;for(const E of O.value){const le=E.p>=e?1:0;E.y===1&&le===1?n+=1:E.y===1&&le===0?d+=1:E.y===0&&le===1?l+=1:s+=1}const w=f(n,n+d,0),F=f(n,n+l,0),D=f(s,s+l,0),H=f(l,l+s,0),P=f(n+s,n+s+l+d,0),C=f(2*F*w,F+w,0);return{threshold:e,tp:n,fp:l,tn:s,fn:d,recall:w,precision:F,specificity:D,fpr:H,accuracy:P,f1:C}},I=p(()=>be.value.map(e=>V(e))),z=p(()=>{if(!pe.value)return[[0,0],[.06,.28],[.15,.54],[.33,.75],[.56,.89],[1,1]];const e=I.value.map(n=>[n.fpr,n.recall]);return e.push([0,0],[1,1]),e.sort((n,l)=>n[0]-l[0]||n[1]-l[1]),e}),ue=p(()=>{if(!pe.value)return[[0,1],[.15,.9],[.35,.82],[.55,.73],[.75,.61],[1,.5]];const e=I.value.map(n=>[n.recall,n.precision]);return e.push([0,1],[1,oe.value]),e.sort((n,l)=>n[0]-l[0]||l[1]-n[1]),e}),ye=e=>{let n=0;for(let l=1;l<e.length;l+=1){const[s,d]=e[l-1],[w,F]=e[l];n+=(w-s)*((d+F)/2)}return h(n,0,1)},ie=(e,n,l=0)=>{const s=e.filter(H=>Number.isFinite(H)).slice().sort((H,P)=>H-P);if(!s.length)return l;const d=h(n,0,1)*(s.length-1),w=Math.floor(d),F=Math.min(s.length-1,w+1),D=d-w;return s[w]*(1-D)+s[F]*D},_e=(e,n)=>{if(!Array.isArray(e)||e.length===0)return 0;if(e.length===1||n<=e[0][0])return h(B(e[0][1],0),0,1);for(let l=1;l<e.length;l+=1){const[s,d]=e[l-1],[w,F]=e[l];if(n<=w){if(Math.abs(w-s)<1e-12)return h(Math.max(d,F),0,1);const D=(n-s)/(w-s);return h(d+(F-d)*D,0,1)}}return h(B(e[e.length-1][1],0),0,1)},J=e=>{const n=e.length,l=e.reduce((P,C)=>P+(C.y>=1?1:0),0),s=n-l;if(n<2||l<=0||s<=0)return{roc:[[0,0],[1,1]],pr:[[0,1],[1,h(f(l,Math.max(n,1),0),0,1)]],auc:.5,prAuc:.5};const d=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const P of e)d.push(Number(P.p.toFixed(3)));const w=Array.from(new Set(d.map(P=>h(P,0,1)))).sort((P,C)=>C-P),F=[],D=[];for(const P of w){let C=0,E=0,le=0,m=0;for(const ee of e){const Le=ee.p>=P?1:0;ee.y===1&&Le===1?C+=1:ee.y===1&&Le===0?m+=1:ee.y===0&&Le===1?E+=1:le+=1}const L=f(C,C+m,0),se=f(C,C+E,0),K=f(E,E+le,0);F.push([K,L]),D.push([L,se])}F.push([0,0],[1,1]),F.sort((P,C)=>P[0]-C[0]||P[1]-C[1]);const H=h(f(l,n,0),0,1);return D.push([0,1],[1,H]),D.sort((P,C)=>P[0]-C[0]||C[1]-P[1]),{roc:F,pr:D,auc:ye(F),prAuc:ye(D)}},$e=p(()=>{let e=2166136261;for(let n=0;n<O.value.length;n+=1){const l=O.value[n],s=l.y>=1?1:0,d=Math.round(h(l.p,0,1)*1e3);e^=s*733+d*31+n*131>>>0,e=Math.imul(e,16777619)>>>0}return e||1315423911}),ve=p(()=>pe.value?j.value<=60?240:j.value<=180?180:120:0),G=p(()=>{if(!pe.value)return null;const e=O.value.length,n=ve.value;if(n<=0||e<6)return null;const l=Array.from({length:21},(m,L)=>L/20),s=l.map(()=>[]),d=l.map(()=>[]),w=[],F=[];let D=$e.value>>>0;const H=()=>{D+=1831565813;let m=D;return m=Math.imul(m^m>>>15,m|1),m^=m+Math.imul(m^m>>>7,m|61),((m^m>>>14)>>>0)/4294967296};for(let m=0;m<n;m+=1){const L=[];for(let K=0;K<e;K+=1)L.push(O.value[Math.floor(H()*e)]);const se=J(L);w.push(se.auc),F.push(se.prAuc);for(let K=0;K<l.length;K+=1){const ee=l[K];s[K].push(_e(se.roc,ee)),d[K].push(_e(se.pr,ee))}}const P=s.map(m=>ie(m,.025,0)),C=s.map(m=>ie(m,.975,1)),E=d.map(m=>ie(m,.025,0)),le=d.map(m=>ie(m,.975,1));return{iterations:n,grid:l,rocLow:P,rocHigh:C,prLow:E,prHigh:le,aucLow:h(ie(w,.025,Ee.value),0,1),aucHigh:h(ie(w,.975,Ee.value),0,1),prAucLow:h(ie(F,.025,Ve.value),0,1),prAucHigh:h(ie(F,.975,Ve.value),0,1)}}),Je=p(()=>G.value?{low:G.value.grid.map((e,n)=>[e,G.value.rocLow[n]]),high:G.value.grid.map((e,n)=>[e,G.value.rocHigh[n]])}:{low:[],high:[]}),he=p(()=>G.value?G.value.grid.map((e,n)=>[e,Math.max(G.value.rocHigh[n]-G.value.rocLow[n],0)]):[]),Ke=p(()=>G.value?{low:G.value.grid.map((e,n)=>[e,G.value.prLow[n]]),high:G.value.grid.map((e,n)=>[e,G.value.prHigh[n]])}:{low:[],high:[]}),tt=p(()=>G.value?G.value.grid.map((e,n)=>[e,Math.max(G.value.prHigh[n]-G.value.prLow[n],0)]):[]),nt=p(()=>ye(z.value)),Oe=p(()=>ye(ue.value)),ft=p(()=>pe.value?I.value.reduce((e,n)=>{const l=n.recall-n.fpr;return l>e.j?X(Z({},n),{j:l}):e},{threshold:.5,fpr:1,recall:0,j:-1}):{threshold:.5,fpr:.22,recall:.78,j:.56}),ot=p(()=>pe.value?I.value.reduce((e,n)=>n.f1>e.f1?n:e,I.value[0]||{threshold:.5,recall:0,precision:0,f1:0}):{threshold:.5,recall:.74,precision:.78,f1:.76}),at=p(()=>{if(!O.value.length)return .25;const e=O.value.reduce((n,l)=>n+Kt(l.p-l.y,2),0);return h(e/O.value.length,0,1)}),lt=p(()=>{if(!pe.value)return{centers:[.1,.22,.34,.46,.58,.7,.82,.94],pred:[.11,.23,.36,.45,.57,.69,.8,.9],obs:[.14,.2,.31,.49,.55,.63,.78,.89],lower:[.04,.08,.19,.31,.39,.47,.63,.74],band:[.2,.24,.24,.18,.16,.16,.15,.15],count:[4,6,8,11,12,10,7,5],ece:.043};const e=8,n=Array.from({length:e+1},(m,L)=>L/e),l=Array.from({length:e},()=>0),s=Array.from({length:e},()=>0),d=Array.from({length:e},()=>0);for(const m of O.value){const L=Math.min(e-1,Math.floor(m.p*e));l[L]+=1,s[L]+=m.p,d[L]+=m.y}const w=[],F=[],D=[],H=[],P=[],C=[];for(let m=0;m<e;m+=1){if(l[m]<=0)continue;const L=s[m]/l[m],se=d[m]/l[m],K=1.96*Math.sqrt(f(se*(1-se),l[m],0)),ee=h(se-K,0,1),Le=h(se+K,0,1);w.push((n[m]+n[m+1])/2),F.push(L),D.push(se),H.push(ee),P.push(Le-ee),C.push(l[m])}const E=Math.max(O.value.length,1),le=F.reduce((m,L,se)=>m+Math.abs(L-D[se])*C[se],0)/E;return{centers:w,pred:F,obs:D,lower:H,band:P,count:C,ece:le}}),Ee=p(()=>{var l,s,d;const e=B((l=x.evaluation)==null?void 0:l.auc,NaN);if(!Number.isNaN(e)&&e>0)return h(e,.5,1);const n=B((d=(s=x.result)==null?void 0:s.kpi)==null?void 0:d.auc,NaN);return!Number.isNaN(n)&&n>0?h(n,.5,1):h(nt.value,.5,1)}),Ve=p(()=>{var n;const e=B((n=x.evaluation)==null?void 0:n.pr_auc,NaN);return!Number.isNaN(e)&&e>0?h(e,.4,1):h(Oe.value,.4,1)}),Ft=p(()=>{var l,s,d;const e=B((l=x.evaluation)==null?void 0:l.brier,NaN);if(!Number.isNaN(e)&&e>=0)return h(e,0,1);const n=B((d=(s=x.result)==null?void 0:s.kpi)==null?void 0:d.brier_score,NaN);return!Number.isNaN(n)&&n>=0?h(n,0,1):h(at.value,0,1)}),st=p(()=>{var n;const e=B((n=x.evaluation)==null?void 0:n.ece,NaN);return!Number.isNaN(e)&&e>=0?h(e,0,1):h(lt.value.ece,0,1)}),yt=p(()=>{var l;const e=(l=x.evaluation)==null?void 0:l.confusion_matrix;if(e&&["tp","tn","fp","fn"].every(s=>Number.isFinite(Number(e[s]))))return{tp:Number(e.tp),tn:Number(e.tn),fp:Number(e.fp),fn:Number(e.fn)};const n=I.value.find(s=>Math.abs(s.threshold-.5)<1e-9);return n?{tp:n.tp,tn:n.tn,fp:n.fp,fn:n.fn}:{tp:13,tn:31,fp:6,fn:8}}),ht=p(()=>{const e=yt.value,n=f(e.tp+e.tn,e.tp+e.tn+e.fp+e.fn,0),l=f(e.tp,e.tp+e.fp,0),s=f(e.tp,e.tp+e.fn,0),d=f(e.tn,e.tn+e.fp,0);return{accuracy:n,precision:l,recall:s,specificity:d}}),gt=p(()=>{var C,E,le;const e=B((le=(E=(C=x.result)==null?void 0:C.modules)==null?void 0:E.rsi)==null?void 0:le.value,62),n=["伪顶","直接顶","老顶Ⅰ","老顶Ⅱ","关键层A","关键层B","关键层C","覆岩"],l=[0,-4,-2,1,3,4,2,1],s=n.map((m,L)=>h(e+l[L]*3+Math.sin(L*1.2)*2.2,24,96)),d=n.map((m,L)=>h(9-L*.7+(100-e)*.03,3,12)),w=s.map((m,L)=>h(m-d[L],0,100)),D=s.map((m,L)=>h(m+d[L],0,100)).map((m,L)=>r(m-w[L],4)),H=s.map(m=>h(102-m,4,90)),P=s.reduce((m,L,se,K)=>L<K[m]?se:m,0);return{layers:n,stability:s,lower:w,band:D,damage:H,minIdx:P}}),bt=p(()=>{var C,E,le,m,L,se;const e=Array.from({length:12},(K,ee)=>`T${String(ee+1).padStart(2,"0")}`),n=B((le=(E=(C=x.result)==null?void 0:C.modules)==null?void 0:E.bri)==null?void 0:le.event_count,20),l=B((se=(L=(m=x.result)==null?void 0:m.modules)==null?void 0:L.bri)==null?void 0:se.avg_magnitude,2.6),s=e.map((K,ee)=>Math.max(1,Math.round(n/e.length*(.8+.6*Math.sin((ee+1)/1.7))))),d=s.map((K,ee)=>r(K*(18+l*6)*(.85+.25*Math.cos((ee+2)/2.3)))),w=d.map((K,ee)=>r((d[Math.max(0,ee-1)]+d[ee]+d[Math.min(d.length-1,ee+1)])/3,2));let F=0;const D=d.reduce((K,ee)=>K+ee,0)||1,H=d.map(K=>(F+=K,r(F/D*100,2))),P=d.reduce((K,ee,Le,xe)=>ee>xe[K]?Le:K,0);return{windows:e,energy:d,smooth:w,eventRate:s,cumulativeRisk:H,peakIdx:P}}),xt=p(()=>{var D,H,P;const e=B((P=(H=(D=x.result)==null?void 0:D.modules)==null?void 0:H.asi)==null?void 0:P.value,58),n=[2.5,3,3.5,4,5,6,7,8,9,10],l=n.map(C=>r(h(6.5+e*.06+10/Math.max(C,1),4,34),3)),s=n.map(C=>r(h(12+e*.16+18/Math.max(C-1.5,1),8,48),3)),d=n.map((C,E)=>r(h(f(s[E],l[E],1),1,4.5),3)),w=s.reduce((C,E,le,m)=>E>m[C]?le:C,0),F=n.find((C,E)=>d[E]<2)||n[n.length-1];return{dist:n,radial:l,tangential:s,kt:d,peakIdx:w,riskRadius:F}}),wt=p(()=>{var C,E,le;const e=(le=(E=(C=x.result)==null?void 0:C.figures)==null?void 0:E.fig5_dbn)==null?void 0:le.posterior,n=[{t:"t-4",high_risk_prob:.31},{t:"t-3",high_risk_prob:.35},{t:"t-2",high_risk_prob:.42},{t:"t-1",high_risk_prob:.48},{t:"t",high_risk_prob:.56}],l=Array.isArray(e)&&e.length?e:n,s=l.map(m=>String(m.t)),d=l.map(m=>h(B(m.high_risk_prob,0),0,1)),w=h(.22-Math.sqrt(Math.max(j.value,1))/22,.06,.2),F=d.map(m=>h(m-w,0,1)),H=d.map(m=>h(m+w,0,1)).map((m,L)=>r(m-F[L],4)),P=d.filter(m=>m>=.6).length;return{labels:s,p:d,lower:F,band:H,alertCount:P}}),St=p(()=>{var P,C,E,le,m;const e=h(B((C=(P=x.result)==null?void 0:P.fusion)==null?void 0:C.mpi,52),0,100),n=h(B((m=(le=(E=x.result)==null?void 0:E.fusion)==null?void 0:le.baseline)==null?void 0:m.mpi,e-4.5),0,100),l=h(Ee.value,.5,1),s=h(Ve.value,.4,1),d=h(Ft.value,0,1),w=["MPI","AUC×100","PR-AUC×100","(1-Brier)×100"],F=[r(e,2),r(l*100,2),r(s*100,2),r((1-d)*100,2)],D=[r(n,2),r(h((l-.05)*100,0,100),2),r(h((s-.06)*100,0,100),2),r(h((1-(d+.05))*100,0,100),2)],H=F.map((L,se)=>r(L-D[se],2));return{categories:w,newScores:F,baseScores:D,gain:H}}),Te=p(()=>{var C,E;const e=r(h(Ee.value*100,45,99),2),n=((E=(C=x.result)==null?void 0:C.fusion)==null?void 0:E.dynamic_weights)||{rsi:.4,bri:.35,asi:.25},l=r(2.5+B(n.rsi,.4)*16,2),s=r(2.5+B(n.bri,.35)*16,2),d=r(2.5+B(n.asi,.25)*16,2),w=["全模型","去RSI","去BRI","去ASI"],F=[e,r(h(e-l,40,99),2),r(h(e-s,40,99),2),r(h(e-d,40,99),2)],D=[0,l,s,d],H=l+s+d||1,P=[0,r(l/H*100,1),r(s/H*100,1),r(d/H*100,1)];return{categories:w,score:F,drop:D,contribution:P}}),Ce=p(()=>{const e=gt.value,n=e.layers[e.minIdx],l=e.stability[e.minIdx];return`关键结论：最低稳定层位为 ${n}（${l.toFixed(1)}%），${l<60?"低于":"高于"}60%预警阈值。`}),_t=p(()=>{const e=bt.value;return`关键结论：峰值窗口 ${e.windows[e.peakIdx]}，能量 ${e.energy[e.peakIdx].toFixed(1)} a.u.，累计风险在后半段快速抬升。`}),rt=p(()=>{const e=xt.value;return`关键结论：切向应力峰值出现在 r=${e.dist[e.peakIdx]} m，Kt>2 高风险圈带约在 r≤${e.riskRadius.toFixed(1)} m。`}),kt=p(()=>{const e=wt.value;return`关键结论：最新后验概率 ${e.p[e.p.length-1].toFixed(3)}，达到0.6报警阈值的时间片数量为 ${e.alertCount}。`}),Pt=p(()=>{const e=St.value,n=e.gain.reduce((l,s,d,w)=>s>w[l]?d:l,0);return`关键结论：最大增益指标为 ${e.categories[n]}（+${e.gain[n].toFixed(2)}）。`}),Tt=p(()=>{const e=Te.value,n=e.drop.reduce((l,s,d,w)=>s>w[l]?d:l,0);return`关键结论：${e.categories[n]} 对整体性能贡献最大（移除后下降 ${e.drop[n].toFixed(2)} 分）。`}),it=p(()=>`关键结论：ECE=${st.value.toFixed(4)}，有效分箱 ${lt.value.centers.length} 个。`),We=p(()=>{const e=ft.value,n=G.value,l=n?`，95%CI=[${n.aucLow.toFixed(3)}, ${n.aucHigh.toFixed(3)}]`:"";return`关键结论：AUC=${Ee.value.toFixed(3)}${l}，最优阈值≈${e.threshold.toFixed(3)}（TPR=${e.recall.toFixed(2)}, FPR=${e.fpr.toFixed(2)}）。`}),He=p(()=>{const e=ot.value,n=G.value,l=n?`，95%CI=[${n.prAucLow.toFixed(3)}, ${n.prAucHigh.toFixed(3)}]`:"";return`关键结论：PR-AUC=${Ve.value.toFixed(3)}${l}，最佳F1=${e.f1.toFixed(3)} 对应阈值≈${e.threshold.toFixed(3)}。`}),ut=p(()=>{const e=ht.value;return`关键结论：Accuracy=${(e.accuracy*100).toFixed(1)}%，Precision=${(e.precision*100).toFixed(1)}%，Recall=${(e.recall*100).toFixed(1)}%。`}),Lt=e=>{var l;const n=String(((l=e==null?void 0:e.data)==null?void 0:l.label)||(e==null?void 0:e.name)||"").toUpperCase();(n==="TP"||n==="TN"||n==="FP"||n==="FN")&&ke("matrix-select",n.toLowerCase())},Be=p(()=>{const e=gt.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.orange,v.red],animationDuration:350,grid:ce,legend:A,toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("层位",!1)),{data:e.layers,nameGap:30}),yAxis:[X(Z({},u("稳定度 / 置信区间 (%)",!0)),{min:0,max:100}),X(Z({},u("损伤占比 (%)",!0)),{min:0,max:100})],series:[{name:"CI下界",type:"line",stack:"rsi_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"rsi_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.14)"}},{name:"稳定度",type:"line",data:e.stability,smooth:!0,symbolSize:7,lineStyle:{width:2.5,color:v.blue},itemStyle:{color:v.blue},markLine:{symbol:"none",label:{formatter:"预警阈值 60%",color:"#7f1d1d",fontFamily:ge,fontSize:10},lineStyle:{type:"dashed",color:"#b91c1c",width:1.2},data:[{yAxis:60}]},markPoint:{symbol:"circle",symbolSize:44,label:{color:"#111827",fontFamily:ge,fontSize:10,formatter:"最低层"},itemStyle:{color:"#fee2e2",borderColor:"#b91c1c",borderWidth:1.2},data:[{coord:[e.minIdx,e.stability[e.minIdx]]}]}},{name:"损伤占比",type:"bar",yAxisIndex:1,data:e.damage,barWidth:14,itemStyle:{color:v.orange,opacity:.75}}]}}),Qe=p(()=>{const e=bt.value;return{color:[v.orange,v.cyan,v.red],animationDuration:350,grid:ce,legend:A,toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("时间窗",!1)),{data:e.windows,nameGap:30}),yAxis:[X(Z({},u("能量释放 / 平滑能量 (a.u.)",!0)),{min:0}),X(Z({},u("事件频次 / 累计风险 (%)",!0)),{min:0,max:110})],series:[{name:"能量释放",type:"bar",data:e.energy,barWidth:14,itemStyle:{color:v.orange,opacity:.82},markPoint:{symbol:"pin",symbolSize:34,data:[{name:"峰值",coord:[e.peakIdx,e.energy[e.peakIdx]]}],label:{formatter:"峰值",fontSize:10,color:"#111827"}}},{name:"平滑能量",type:"line",data:e.smooth,smooth:!0,symbolSize:5,lineStyle:{width:2,color:v.cyan}},{name:"事件频次",type:"line",yAxisIndex:1,data:e.eventRate,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.slate}},{name:"累计风险",type:"line",yAxisIndex:1,data:e.cumulativeRisk,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red}}]}}),At=p(()=>{const e=xt.value;return{color:[v.blue,v.red,v.purple],animationDuration:350,grid:{left:64,right:54,top:46,bottom:62},legend:A,toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("径向距离 r (m)",!0)),{min:2,max:10}),yAxis:[X(Z({},u("应力 (MPa)",!0)),{min:0,max:50}),X(Z({},u("应力集中系数 Kt",!0)),{min:1,max:4.5,position:"right"})],series:[{name:"径向应力 σr",type:"line",data:e.dist.map((n,l)=>[n,e.radial[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.2,color:v.blue}},{name:"切向应力 σθ",type:"line",data:e.dist.map((n,l)=>[n,e.tangential[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.4,color:v.red},markPoint:{symbol:"circle",symbolSize:40,itemStyle:{color:"#fee2e2",borderColor:v.red,borderWidth:1.2},label:{formatter:"峰值",fontSize:10,color:"#111827"},data:[{coord:[e.dist[e.peakIdx],e.tangential[e.peakIdx]]}]}},{name:"Kt=σθ/σr",type:"line",yAxisIndex:1,data:e.dist.map((n,l)=>[n,e.kt[l]]),smooth:!0,symbolSize:5,lineStyle:{width:1.9,type:"dashed",color:v.purple},markLine:{symbol:"none",label:{formatter:"Kt=2",color:v.purple,fontFamily:ge,fontSize:10},lineStyle:{color:v.purple,width:1.1,type:"dashed"},data:[{yAxis:2}]}}]}}),Mt=p(()=>{const e=wt.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.red],animationDuration:350,grid:ce,legend:A,toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("时间片",!1)),{data:e.labels,nameGap:30}),yAxis:X(Z({},u("高风险后验概率",!0)),{min:0,max:1}),series:[{name:"CI下界",type:"line",stack:"dbn_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"dbn_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.18)"}},{name:"后验概率",type:"line",data:e.p,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red},markLine:{symbol:"none",lineStyle:{type:"dashed",width:1.15},data:[{yAxis:.3,name:"关注阈值",lineStyle:{color:v.orange}},{yAxis:.6,name:"报警阈值",lineStyle:{color:v.red}}]}}]}}),zt=p(()=>{const e=St.value;return{color:[v.cyan,v.slate,v.red],animationDuration:350,grid:{left:74,right:54,top:46,bottom:66},legend:A,toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("指标",!1)),{data:e.categories,nameGap:30}),yAxis:[X(Z({},u("归一化分数",!0)),{min:0,max:100}),X(Z({},u("增益(新-基线)",!0)),{min:Math.min(...e.gain)-2,max:Math.max(...e.gain)+2,position:"right"})],series:[{name:"新算法",type:"bar",data:e.newScores,barWidth:14,itemStyle:{color:v.cyan}},{name:"基线算法",type:"bar",data:e.baseScores,barWidth:14,itemStyle:{color:v.slate,opacity:.85}},{name:"增益",type:"line",yAxisIndex:1,data:e.gain,symbol:"diamond",symbolSize:8,lineStyle:{width:2.2,color:v.red},label:{show:!0,position:"top",color:v.red,fontFamily:ge,fontSize:10,formatter:({value:n})=>`+${Number(n).toFixed(2)}`}}]}}),Ct=p(()=>{const e=Te.value,n=e.drop.reduce((l,s,d,w)=>s>w[l]?d:l,0);return{color:[v.green,v.red,v.orange],animationDuration:350,grid:{left:66,right:52,top:46,bottom:64},legend:A,toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("模型版本",!1)),{data:e.categories,nameGap:30}),yAxis:[X(Z({},u("性能分数 (AUC×100)",!0)),{min:40,max:100}),X(Z({},u("下降分数 / 贡献(%)",!0)),{min:0,max:Math.max(...e.drop,...e.contribution)+8,position:"right"})],series:[{name:"性能分数",type:"bar",data:e.score,barWidth:16,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,formatter:({value:l})=>Number(l).toFixed(1)}},{name:"下降分数",type:"line",yAxisIndex:1,data:e.drop,symbolSize:8,lineStyle:{width:2,color:v.red},itemStyle:{color:v.red},markPoint:{symbol:"pin",symbolSize:34,data:[{coord:[n,e.drop[n]],name:"最大下降"}],label:{formatter:"最大下降",fontSize:10,color:"#111827"}}},{name:"贡献率(%)",type:"line",yAxisIndex:1,data:e.contribution,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.orange}}]}}),ct=p(()=>{const e=lt.value,n=Math.max(...e.count,1);return{color:[v.blue,"rgba(29,78,216,0.2)","#94a3b8",v.cyan],animationDuration:350,grid:{left:66,right:54,top:46,bottom:62},legend:A,toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("预测概率",!0)),{min:0,max:1,interval:.1}),yAxis:[X(Z({},u("真实频率",!0)),{min:0,max:1,interval:.1}),X(Z({},u("样本数",!0)),{min:0,max:n+2,position:"right"})],series:[{name:"理想校准线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.4,type:"dashed",color:"#94a3b8"}},{name:"CI下界",type:"line",stack:"cal_ci",data:e.centers.map((l,s)=>[l,e.lower[s]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"cal_ci",data:e.centers.map((l,s)=>[l,e.band[s]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.15)"}},{name:"校准曲线",type:"line",data:e.centers.map((l,s)=>[l,e.obs[s]]),smooth:!0,symbolSize:7,lineStyle:{width:2.4,color:v.blue},itemStyle:{color:v.blue}},{name:"分箱样本数",type:"bar",yAxisIndex:1,data:e.centers.map((l,s)=>[l,e.count[s]]),barWidth:18,itemStyle:{color:"#cbd5e1",opacity:.6}}],graphic:[{type:"text",right:26,top:18,style:{text:`ECE=${st.value.toFixed(4)}`,font:`600 12px ${ge}`,fill:"#0f172a"}}]}}),je=p(()=>{const e=ft.value,n=Je.value,l=he.value,s=G.value,d=`ROC 曲线 (AUC=${Ee.value.toFixed(3)})`,w=s?`AUC 95%CI [${s.aucLow.toFixed(3)}, ${s.aucHigh.toFixed(3)}]`:"AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.blue,v.red],animationDuration:350,grid:ce,legend:X(Z({},A),{data:["随机参考线",d,"最优阈值点"]}),toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("假阳性率 FPR",!0)),{min:0,max:1,interval:.1}),yAxis:X(Z({},u("真阳性率 TPR",!0)),{min:0,max:1,interval:.1}),series:[{name:"随机参考线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__roc_ci_low__",type:"line",stack:"roc_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__roc_ci_band__",type:"line",stack:"roc_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"ROC 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"ROC 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:d,type:"line",smooth:!0,data:z.value,symbolSize:5,lineStyle:{width:2.6,color:v.blue},areaStyle:{color:"rgba(29,78,216,0.12)"}},{name:"最优阈值点",type:"scatter",data:[[e.fpr,e.recall]],symbolSize:12,itemStyle:{color:v.red},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:v.red,formatter:`thr=${e.threshold.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:w,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),Ge=p(()=>{const n=[];for(let l=1;l<=99;l+=1){const s=l/100,d=2*s-.6;if(d<=0)continue;const w=h(.6*s/d,0,1);w>0&&w<=1&&n.push([s,w])}return n}),dt=p(()=>{const e=ot.value,n=Ke.value,l=tt.value,s=G.value,d=`PR 曲线 (PR-AUC=${Ve.value.toFixed(3)})`,w=s?`PR-AUC 95%CI [${s.prAucLow.toFixed(3)}, ${s.prAucHigh.toFixed(3)}]`:"PR-AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.orange,v.red,v.green],animationDuration:350,grid:ce,legend:X(Z({},A),{data:["基线(阳性占比)","F1=0.6 等值线",d,"最佳F1点"]}),toolbox:U,dataZoom:_,tooltip:{trigger:"axis"},xAxis:X(Z({},u("召回率 Recall",!0)),{min:0,max:1,interval:.1}),yAxis:X(Z({},u("精确率 Precision",!0)),{min:0,max:1,interval:.1}),series:[{name:"基线(阳性占比)",type:"line",data:[[0,oe.value],[1,oe.value]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__pr_ci_low__",type:"line",stack:"pr_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__pr_ci_band__",type:"line",stack:"pr_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"PR 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"PR 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"F1=0.6 等值线",type:"line",data:Ge.value,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:v.orange}},{name:d,type:"line",smooth:!0,data:ue.value,symbolSize:5,lineStyle:{width:2.6,color:v.red}},{name:"最佳F1点",type:"scatter",data:[[e.recall,e.precision]],symbolSize:12,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:v.green,formatter:`F1=${e.f1.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:w,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),mt=p(()=>{const e=yt.value,n=Math.max(e.tp+e.tn+e.fp+e.fn,1),l=[{value:[0,0,e.tn,e.tn/n],label:"TN"},{value:[1,0,e.fp,e.fp/n],label:"FP"},{value:[0,1,e.fn,e.fn/n],label:"FN"},{value:[1,1,e.tp,e.tp/n],label:"TP"}],s=ht.value;return{animationDuration:350,grid:{left:76,right:120,top:38,bottom:66},toolbox:X(Z({},U),{feature:{restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}}),tooltip:{trigger:"item",formatter:({data:d})=>`${d.label}：${d.value[2]} (${(d.value[3]*100).toFixed(1)}%)`},xAxis:X(Z({},u("预测类别",!1)),{data:["低风险","高风险"],nameGap:34,splitLine:{show:!1}}),yAxis:X(Z({},u("真实类别",!1)),{data:["低风险","高风险"],nameGap:54,splitLine:{show:!1}}),visualMap:{min:0,max:Math.max(e.tp,e.tn,e.fp,e.fn,1),orient:"vertical",right:18,top:"middle",text:["高","低"],textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"},inRange:{color:["#ecfeff","#67e8f9","#0e7490"]}},series:[{name:"混淆矩阵",type:"heatmap",data:l,label:{show:!0,color:"#0f172a",fontFamily:ge,fontSize:11,formatter:({data:d})=>`${d.label}
${d.value[2]}
${(d.value[3]*100).toFixed(1)}%`},itemStyle:{borderWidth:1,borderColor:"#e2e8f0"}}],graphic:[{type:"group",right:10,bottom:8,children:[{type:"text",top:0,style:{text:`Acc ${(s.accuracy*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:16,style:{text:`Prec ${(s.precision*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:32,style:{text:`Rec ${(s.recall*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:48,style:{text:`Spec ${(s.specificity*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}}]}]}});return(e,n)=>(te(),ne("section",eo,[o("header",to,[n[0]||(n[0]=o("div",{class:"head-title"},[o("h4",null,"SCI 配图增强版（图2-图11）"),o("p",null,"统一采用期刊风格坐标系、阈值注记、置信区间和关键决策点标注。")],-1)),o("div",no,[o("span",oo,"样本 n="+y(j.value),1),o("span",ao,"正样本占比 "+y(T(oe.value)),1),G.value?(te(),ne("span",lo,"Bootstrap "+y(G.value.iterations)+"次",1)):Se("",!0),o("span",{class:et(["metric-chip",{warn:M.value!=="real_label_stream"}])},"评估源 "+y(ae.value),3),W.value?(te(),ne("span",so,"标签文件 "+y(W.value),1)):Se("",!0)])]),o("article",ro,[n[1]||(n[1]=o("h4",null,"图2 | RSI 机制剖面图（稳定度-损伤-置信带）",-1)),Ie(Pe,{option:Be.value,height:336},null,8,["option"]),n[2]||(n[2]=o("p",{class:"caption"},"怎么看：稳定度实线越高越好，误差带越窄代表层位响应更稳定，损伤柱越低越好。",-1)),o("p",io,y(Ce.value),1)]),o("article",uo,[n[3]||(n[3]=o("h4",null,"图3 | BRI 微震能量释放、事件频次与累计风险",-1)),Ie(Pe,{option:Qe.value,height:336},null,8,["option"]),n[4]||(n[4]=o("p",{class:"caption"},"怎么看：能量柱与事件频次线共同识别冲击窗口，累计风险线反映风险积聚过程。",-1)),o("p",co,y(_t.value),1)]),o("article",mo,[n[5]||(n[5]=o("h4",null,"图4 | ASI 径向/切向应力与应力集中系数 Kt",-1)),Ie(Pe,{option:At.value,height:336},null,8,["option"]),n[6]||(n[6]=o("p",{class:"caption"},"怎么看：切向应力峰值与 Kt>2 区段对应高风险圈带，径向应力反映卸压后衰减。",-1)),o("p",po,y(rt.value),1)]),o("article",vo,[n[7]||(n[7]=o("h4",null,"图5 | DBN 后验概率时序（95% CI + 预警阈值）",-1)),Ie(Pe,{option:Mt.value,height:336},null,8,["option"]),n[8]||(n[8]=o("p",{class:"caption"},"怎么看：后验概率曲线跨过 0.6 报警阈值时需触发强化巡检，CI 带越窄越可信。",-1)),o("p",fo,y(kt.value),1)]),o("article",yo,[n[9]||(n[9]=o("h4",null,"图6 | 新旧算法多指标对比（分数 + 增益）",-1)),Ie(Pe,{option:zt.value,height:336},null,8,["option"]),n[10]||(n[10]=o("p",{class:"caption"},"怎么看：柱形给出绝对分数，增益折线给出替代旧算法的实际收益幅度。",-1)),o("p",ho,y(Pt.value),1)]),o("article",go,[n[11]||(n[11]=o("h4",null,"图7 | 消融实验（模块贡献与性能下降）",-1)),Ie(Pe,{option:Ct.value,height:336},null,8,["option"]),n[12]||(n[12]=o("p",{class:"caption"},"怎么看：去除模块后的性能下降越大，说明该模块对总体性能贡献越关键。",-1)),o("p",bo,y(Tt.value),1)]),o("article",xo,[n[13]||(n[13]=o("h4",null,"图8 | 校准曲线（含样本直方图与置信区间）",-1)),Ie(Pe,{option:ct.value,height:336},null,8,["option"]),n[14]||(n[14]=o("p",{class:"caption"},"怎么看：曲线贴近对角线且 ECE 越低，模型概率输出越可直接用于阈值决策。",-1)),o("p",wo,y(it.value),1)]),o("article",So,[n[15]||(n[15]=o("h4",null,"图9 | ROC 曲线（最优阈值点与 AUC）",-1)),Ie(Pe,{option:je.value,height:336},null,8,["option"]),n[16]||(n[16]=o("p",{class:"caption"},"怎么看：曲线越靠左上角越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，红点为 Youden 最优阈值。",-1)),o("p",_o,y(We.value),1)]),o("article",ko,[n[17]||(n[17]=o("h4",null,"图10 | PR 曲线（基线、F1 等值线与最优点）",-1)),Ie(Pe,{option:dt.value,height:336},null,8,["option"]),n[18]||(n[18]=o("p",{class:"caption"},"怎么看：PR 曲线整体越高越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，绿点为最佳F1运行点。",-1)),o("p",Ao,y(He.value),1)]),o("article",Mo,[n[19]||(n[19]=o("h4",null,"图11 | 混淆矩阵热图（计数 + 占比 + 诊断指标）",-1)),Ie(Pe,{option:mt.value,height:336,onChartClick:Lt},null,8,["option"]),n[20]||(n[20]=o("p",{class:"caption"},"怎么看：对角线高、非对角低为理想状态；右侧指标用于误报/漏报成本权衡。",-1)),o("p",Co,y(ut.value),1)])]))}},Io=Bt(No,[["__scopeId","data-v-f81ec0ce"]]),$o={class:"top-nav"},Ro={class:"nav-left"},Fo={class:"seam-select"},Po=["value"],To={key:0,class:"mini-stats"},Lo={class:"danger"},zo={class:"nav-right"},Do=["disabled"],Eo=["disabled"],Bo={class:"metric-dashboard"},Uo=["onClick"],Oo={class:"head"},Vo={class:"value"},Wo={class:"meta"},Ho={class:"main-layout"},jo={class:"main-canvas-card"},Go={class:"canvas-head"},Yo={class:"canvas-controls"},qo={class:"check"},Zo={class:"check"},Xo={key:0,class:"trust-banner"},Jo={class:"trust-chip warn"},Ko={key:0,class:"trust-chip link"},Qo={key:1,class:"trust-meta"},ea={class:"trust-meta"},ta={key:0,class:"loading-mask"},na={class:"legend-wrap"},oa={class:"legend-labels"},aa={class:"thumb-list"},la=["onClick","onMouseenter","onMousemove"],sa={class:"thumb-meta"},ra={key:0,class:"floating-panel"},ia={class:"weight-row"},ua={class:"weight-row"},ca={class:"weight-row"},da={key:0,class:"eval-drawer"},ma={class:"actions"},pa={key:0,class:"panel-empty"},va={key:1,class:"panel-empty"},fa={class:"eval-grid"},ya={class:"metric"},ha={class:"metric"},ga={class:"metric"},ba={class:"metric"},xa={class:"metric"},wa={class:"eval-content"},Sa={class:"cm-card"},_a={class:"cm-grid"},ka={class:"cm-cell"},Aa={class:"cm-cell warn"},Ma={class:"cm-cell warn"},Ca={class:"cm-cell"},Na={class:"baseline-card"},Ia={viewBox:"0 0 560 170",class:"baseline-svg"},$a=["width"],Ra={x:"485",y:"26"},Fa=["width"],Pa={x:"485",y:"90"},Ta={key:0,class:"science-section"},La={class:"data-note"},za={key:1,class:"export-note"},Da={class:"risk"},Ea={__name:"AlgorithmValidation",setup(g){const Y=Hn(),x=Wn(),{workspaceState:ke,setSelectedSeam:v,markStepDone:ce}=Ln(),h=[{key:"mpi",label:"MPI",desc:"综合指标"},{key:"rsi",label:"RSI",desc:"顶板稳定"},{key:"bri",label:"BRI",desc:"冲击风险"},{key:"asi",label:"ASI",desc:"支承应力"}],B={tp:{label:"TP 真阳性",color:"#15803d"},tn:{label:"TN 真阴性",color:"#1d4ed8"},fp:{label:"FP 假阳性",color:"#d97706"},fn:{label:"FN 假阴性",color:"#b91c1c"}},T=Q(null),r=Q(null),f=Q(null),u=Q(null),A=Q(null),U=Q([]),_=Q(""),$=Q(50),M=Q(9),W=Q("idw"),ae=Q(!0),O=Q(!0),j=Q("mpi"),de=Q(!1),me=Q(!1),oe=Q(!1),pe=Q(!0),be=Q(!1),V=Rt({rsi:.4,bri:.35,asi:.25}),I=Vn(null),z=Q(null),ue=Q(!1),ye=Q(""),ie=Q(!1),_e=Q(""),J=Q(null),$e=Rt({x:0,y:0}),ve=Rt({visible:!1,metric:"",x:0,y:0}),G=Q("pseudo_threshold"),Je=Q(""),he=Q("all"),Ke=Q(!1),tt={},nt=new Map;let Oe=null;const ft=()=>Me(this,null,function*(){if(Oe)return Oe;const a=yield zn(()=>import("./jszip-CsMIhXuR.js").then(t=>t.j),[]);if(Oe=(a==null?void 0:a.default)||(a==null?void 0:a.JSZip)||window.JSZip||null,!Oe)throw new Error("JSZip 加载失败");return Oe}),{viewport:ot,worldToScreen:at,screenToWorld:lt,fitToBounds:Ee,startDrag:Ve,dragTo:Ft,endDrag:st,zoomAt:yt}=Zn(),{getLegendGradient:ht,drawGrid:gt,drawBoreholes:bt,pickNearestBorehole:xt,sampleGridValue:wt,drawMiniHeatmap:St}=Kn(),Te=p(()=>{const a=V.rsi+V.bri+V.asi||1;return{rsi:V.rsi/a,bri:V.bri/a,asi:V.asi/a}}),Ce=p(()=>{var a,t,c;return!!((a=I.value)!=null&&a.grids&&((t=I.value)!=null&&t.statistics)&&((c=I.value)!=null&&c.boreholes))}),_t=p(()=>{var a,t;return((t=(a=I.value)==null?void 0:a.statistics)==null?void 0:t[j.value])||{}}),rt=p(()=>{var a,t,c;return Number(((c=(t=(a=I.value)==null?void 0:a.statistics)==null?void 0:t.mpi)==null?void 0:c.mean)||0)}),kt=p(()=>Math.max(0,rt.value-4.5)),Pt=p(()=>H(j.value)),Tt=p(()=>G.value==="real_label_stream"?"真实标签流":G.value==="pseudo_threshold"?"伪标签估计（阈值构造）":G.value==="none"?"无可评估样本":"未知来源"),it=p(()=>{var a,t;return O.value?{min:0,mean:50,max:100}:((t=(a=I.value)==null?void 0:a.statistics)==null?void 0:t[j.value])||{min:0,mean:0,max:0}}),We=p(()=>{var t,c,b,i;const a={};for(const S of h){const k=((c=(t=I.value)==null?void 0:t.statistics)==null?void 0:c[S.key])||{},N=(i=(b=I.value)==null?void 0:b.grids)==null?void 0:i[S.key];let R=0,re=0,fe=0,q=Number.POSITIVE_INFINITY,we=Number.NEGATIVE_INFINITY;if(Array.isArray(N))for(const Ye of N)for(const qe of Ye||[]){const Ne=Number(qe);Number.isFinite(Ne)&&(R+=1,re+=Ne,fe+=Ne*Ne,Ne<q&&(q=Ne),Ne>we&&(we=Ne))}const Ae=R?re/R:Number(k.mean||0),Re=R?Math.max(fe/R-Ae*Ae,0):0;a[S.key]={min:Number.isFinite(Number(k.min))?Number(k.min):R?q:0,max:Number.isFinite(Number(k.max))?Number(k.max):R?we:0,mean:Ae,std:Math.sqrt(Re)}}return a}),He=p(()=>We.value[ve.metric]||null),ut=p(()=>{var q,we,Ae,Re,Ye,qe,Ne,Ze;if(!Ce.value)return null;const a=We.value,t=((q=I.value)==null?void 0:q.boreholes)||[],c=Ut(),b=Number(((we=a.mpi)==null?void 0:we.mean)||0),i=Math.max(0,b-4.5),S=i>0?(b-i)/i*100:0,k=t.length||1,N=H("mpi")/k,R=w(1-b/100,0,1),re=w(Number(((Ae=z.value)==null?void 0:Ae.auc)||.7)-.5,0,.45),fe=["t-4","t-3","t-2","t-1","t"].map(($t,Ue)=>({t:$t,high_risk_prob:w(R+(Ue-2)*.05+re*.2,.05,.95)}));return{modules:{rsi:{value:Number(((Re=a.rsi)==null?void 0:Re.mean)||0),input_layers:6},bri:{value:Number(((Ye=a.bri)==null?void 0:Ye.mean)||0),event_count:t.length,avg_magnitude:2.6},asi:{value:Number(((qe=a.asi)==null?void 0:qe.mean)||0),avg_friction_angle:31.2}},fusion:{mpi:b,baseline:{mpi:i},dynamic_weights:Te.value},kpi:{mpi_mean:b,high_risk_ratio:N,auc:Number(((Ne=z.value)==null?void 0:Ne.auc)||.7),brier_score:Number(((Ze=z.value)==null?void 0:Ze.brier)||.24),improvement_vs_baseline_pct:S},figures:{fig5_dbn:{posterior:fe}},evaluation_inputs:c}}),Lt=a=>{var t;return((t=B[String(a||"").toLowerCase()])==null?void 0:t.label)||"全部"},Be=p(()=>{var k,N;const a=((k=I.value)==null?void 0:k.boreholes)||[],t=((N=ut.value)==null?void 0:N.evaluation_inputs)||{},c=Array.isArray(t.y_true)?t.y_true:Array.isArray(t.yTrue)?t.yTrue:[],b=Array.isArray(t.y_prob)?t.y_prob:Array.isArray(t.yProb)?t.yProb:[];if(!a.length||c.length!==a.length||b.length!==a.length)return{available:!1,roles:[],counts:{tp:0,tn:0,fp:0,fn:0}};const i=[],S={tp:0,tn:0,fp:0,fn:0};for(let R=0;R<a.length;R+=1){const re=Number(c[R])>=1?1:0,fe=Number(b[R])>=.5?1:0,q=re===1?fe===1?"tp":"fn":fe===1?"fp":"tn";i.push(q),S[q]+=1}return{available:!0,roles:i,counts:S}}),Qe=p(()=>Be.value.available),At=p(()=>{var t;if(he.value==="all")return 0;const a=String(he.value).toLowerCase();return Number(((t=Be.value.counts)==null?void 0:t[a])||0)}),Mt=p(()=>{const a=String(he.value||"").toLowerCase();if(!Be.value.available||!["tp","tn","fp","fn"].includes(a))return[];const t=[];for(let c=0;c<Be.value.roles.length;c+=1)Be.value.roles[c]===a&&t.push(c);return t}),zt=p(()=>new Set(Mt.value)),Ct=p(()=>{var t;const a=String(he.value||"").toLowerCase();return["tp","tn","fp","fn"].includes(a)?{active:!0,indexSet:zt.value,accent:((t=B[a])==null?void 0:t.color)||"#111827"}:null}),ct=p(()=>he.value!=="all"&&Qe.value&&!Ke.value);let je=0,Ge=0,dt=null,mt=null;const e=()=>{window.clearTimeout(dt),dt=window.setTimeout(()=>{L(),se(),xe(),Nt()},80)},n=a=>{var t;return((t=h.find(c=>c.key===a))==null?void 0:t.label)||a.toUpperCase()},l=a=>ht(a),s=(a,t=2)=>a==null||Number.isNaN(Number(a))?"--":Number(a).toFixed(t),d=a=>`${(Number(a||0)*100).toFixed(0)}%`,w=(a,t,c)=>Math.max(t,Math.min(c,a)),F=a=>{const t=String(a||"").toLowerCase();return t.includes("high")||t.includes("高")?"高风险":t.includes("medium")||t.includes("中")?"中风险":t.includes("low")||t.includes("低")?"低风险":"未知"},D=a=>`${w(Number(a||0),0,100)*3.6}`,H=a=>{var t;return(((t=I.value)==null?void 0:t.boreholes)||[]).filter(c=>Number(c[a])<50).length},P=a=>{var t,c;return O.value?{min:0,mean:50,max:100}:((c=(t=I.value)==null?void 0:t.statistics)==null?void 0:c[a])||{min:0,mean:0,max:0}},C=()=>{const a=Number(M.value);M.value=Number.isFinite(a)?Math.max(5,Math.min(24,Math.round(a))):9},E=(a,t,c)=>{if(!Array.isArray(c)||c.length===0)return{borehole:null,distance:null};let b=null,i=Number.POSITIVE_INFINITY;for(const S of c){const k=Number(S.x)-a,N=Number(S.y)-t,R=Math.hypot(k,N);R<i&&(i=R,b=S)}return{borehole:b,distance:Number.isFinite(i)?i:null}},le=()=>{const a=Te.value;return[_.value,$.value,W.value,a.rsi.toFixed(3),a.bri.toFixed(3),a.asi.toFixed(3)].join("|")},m=a=>t=>{t?(tt[a]=t,Nt()):delete tt[a]},L=()=>{if(!r.value||!u.value||!A.value)return;const a=r.value.getBoundingClientRect(),t=window.devicePixelRatio||1,c=Math.max(1,Math.floor(a.width*t)),b=Math.max(1,Math.floor(a.height*t));for(const i of[u.value,A.value])i.width=c,i.height=b},se=()=>{var t;const a=(t=I.value)==null?void 0:t.bounds;!a||!u.value||(Ee(a,u.value.width,u.value.height,62),xe())},K=(a,t,c)=>{const b=String(he.value||"").toLowerCase();if(!["tp","tn","fp","fn"].includes(b)||!Be.value.available)return;const i=B[b],S=Mt.value;S.length&&(a.save(),a.fillStyle="rgba(15, 23, 42, 0.88)",a.fillRect(12,10,250,28),a.fillStyle="#f8fafc",a.font="600 12px 'Noto Sans SC', 'Segoe UI', sans-serif",a.fillText(`联动筛选: ${i.label} (${S.length})  Esc清除`,22,29),a.restore())},ee=()=>{var k,N,R;if(je=0,!u.value||!A.value)return;const a=I.value,t=u.value.getContext("2d"),c=A.value.getContext("2d");if(t.clearRect(0,0,u.value.width,u.value.height),c.clearRect(0,0,A.value.width,A.value.height),!a)return;const b=j.value,i=P(b);gt(t,(k=a.grids)==null?void 0:k[b],a.bounds,ot,b,i,at,{showContours:ae.value,contourLevels:M.value});const S=Ct.value?X(Z({},Ct.value),{animate:ct.value,pulseT:performance.now()/1e3}):null;bt(c,a.boreholes,b,i,a.bounds,at,((R=(N=J.value)==null?void 0:N.borehole)==null?void 0:R.borehole_name)||"",S),K(c,a.boreholes||[],a.bounds),J.value&&(c.strokeStyle="rgba(15, 23, 42, 0.55)",c.lineWidth=1.1,c.setLineDash([5,4]),c.beginPath(),c.moveTo(J.value.sx,0),c.lineTo(J.value.sx,A.value.height),c.moveTo(0,J.value.sy),c.lineTo(A.value.width,J.value.sy),c.stroke(),c.setLineDash([])),ct.value&&xe()},Le=()=>{var t;Ge=0;const a=I.value;if(a)for(const c of h){const b=tt[c.key];b&&St(b,(t=a.grids)==null?void 0:t[c.key],c.key,P(c.key))}},xe=()=>{je||(je=window.requestAnimationFrame(ee))},Nt=()=>{Ge||(Ge=window.requestAnimationFrame(Le))},Ut=()=>{var i,S;const a=(i=I.value)==null?void 0:i.evaluation_inputs;if((a==null?void 0:a.mode)==="real_label_stream"){const k=Array.isArray(a.y_true)?a.y_true:[],N=Array.isArray(a.y_prob)?a.y_prob:[];if(k.length===N.length&&k.length>=2){const R=k.map(q=>Number(q)>=1?1:0),re=N.map(q=>w(Number(q),0,1));if(re.every(q=>Number.isFinite(q))&&new Set(R).size>1)return{mode:"real_label_stream",source:String(a.source||""),sourceFile:String(a.source||""),y_true:R,y_prob:re,yTrue:R,yProb:re}}}const t=((S=I.value)==null?void 0:S.boreholes)||[];if(t.length<4)return null;let c=t.map(k=>k.rsi<50||k.bri<50||k.asi<50?1:0);const b=t.map(k=>w(1-Number(k.mpi||0)/100,0,1));if(new Set(c).size<2){const k=t.map(R=>Number(R.mpi||0)).sort((R,re)=>R-re),N=k[Math.floor(k.length/2)];c=t.map(R=>Number(R.mpi||0)<=N?1:0)}return{mode:"pseudo_threshold",source:"",sourceFile:"",y_true:c,y_prob:b,yTrue:c,yProb:b}},un=()=>Me(this,null,function*(){var t,c;const a=Ut();if(!a){G.value="none",Je.value="",z.value=null,ye.value="当前煤层钻孔点不足，无法计算评估指标。";return}G.value=a.mode||"pseudo_threshold",Je.value=a.sourceFile||"",ue.value=!0,ye.value="";try{const b=yield Yn({y_true:a.y_true||a.yTrue,y_prob:a.y_prob||a.yProb});z.value=b.data}catch(b){z.value=null,ye.value=((c=(t=b==null?void 0:b.response)==null?void 0:t.data)==null?void 0:c.detail)||"评估指标计算失败"}finally{ue.value=!1}}),Ot=a=>Me(this,null,function*(){I.value=a,J.value=null,he.value="all",yield sn(),L(),se(),xe(),Nt(),un()}),It=(...t)=>Me(this,[...t],function*({force:a=!1}={}){var b,i;if(!_.value)return;const c=le();if(!a&&nt.has(c)){yield Ot(nt.get(c));return}de.value=!0;try{const k=(yield Gn(_.value,$.value,W.value,Te.value)).data;nt.set(c,k),yield Ot(k),ce("AlgorithmValidation",{validationReady:!0})}catch(S){ye.value=((i=(b=S==null?void 0:S.response)==null?void 0:b.data)==null?void 0:i.detail)||"空间总览加载失败"}finally{de.value=!1}}),cn=a=>{const t=String(a||"").toLowerCase();["tp","tn","fp","fn"].includes(t)&&Qe.value&&(he.value=he.value===t?"all":t,xe())},Vt=()=>{he.value="all",xe()},Wt=a=>{a.key==="Escape"&&he.value!=="all"&&Vt()},dn=a=>{Ce.value&&Ve(a.clientX,a.clientY)},mn=a=>{var fe,q,we,Ae,Re;if(!A.value||!Ce.value)return;const t=A.value.getBoundingClientRect(),c=window.devicePixelRatio||1,b=(a.clientX-t.left)*c,i=(a.clientY-t.top)*c;if($e.x=a.clientX-t.left,$e.y=a.clientY-t.top,ot.isDragging){Ft(a.clientX,a.clientY),xe();return}const S=(fe=I.value)==null?void 0:fe.bounds,k=lt(b,i,S),N=j.value,R=E(k.x,k.y,((q=I.value)==null?void 0:q.boreholes)||[]),re=xt(b,i,((we=I.value)==null?void 0:we.boreholes)||[],S,at);J.value={sx:b,sy:i,worldX:k.x,worldY:k.y,gridValue:wt((Re=(Ae=I.value)==null?void 0:Ae.grids)==null?void 0:Re[N],S,k.x,k.y),borehole:re,nearestBorehole:R.borehole,nearestDistance:R.distance},xe()},pn=()=>st(),vn=()=>{st(),J.value=null,xe()},fn=a=>{var S;if(!A.value||!Ce.value)return;const t=A.value.getBoundingClientRect(),c=window.devicePixelRatio||1,b=(a.clientX-t.left)*c,i=(a.clientY-t.top)*c;yt(a.deltaY<0?1.14:.88,b,i,(S=I.value)==null?void 0:S.bounds),xe()},yn=(a,t)=>{ve.metric=a,Ht(a,t)},Ht=(a,t)=>{if(!f.value)return;const c=f.value.getBoundingClientRect();ve.visible=!0,ve.metric=a,ve.x=t.clientX-c.left,ve.y=t.clientY-c.top},hn=()=>{ve.visible=!1},jt=a=>String(a||"figure").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),Gt=(a,t="image/png",c=1)=>new Promise((b,i)=>{a.toBlob(S=>{S?b(S):i(new Error("Canvas 导出失败"))},t,c)}),gn=a=>{const t=a.cloneNode(!0);return t.getAttribute("xmlns")||t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.getAttribute("xmlns:xlink")||t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),new XMLSerializer().serializeToString(t)},bn=(a,t,c,b=3)=>Me(this,null,function*(){const i=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),S=URL.createObjectURL(i);try{const k=yield new Promise((re,fe)=>{const q=new Image;q.onload=()=>re(q),q.onerror=()=>fe(new Error("SVG 转 PNG 失败")),q.src=S}),N=document.createElement("canvas");N.width=Math.max(1,Math.round(t*b)),N.height=Math.max(1,Math.round(c*b));const R=N.getContext("2d");return R.fillStyle="#ffffff",R.fillRect(0,0,N.width,N.height),R.drawImage(k,0,0,N.width,N.height),yield Gt(N,"image/png",1)}finally{URL.revokeObjectURL(S)}}),xn=()=>new Promise(a=>window.requestAnimationFrame(a)),Yt=a=>Me(this,null,function*(){const t=Ke.value;Ke.value=!0,ee(),yield xn();try{return yield a()}finally{Ke.value=t,ee(),ct.value&&xe()}}),wn=()=>Me(this,null,function*(){!u.value||!A.value||(yield Yt(()=>Me(this,null,function*(){const t=u.value.width,c=u.value.height,b=document.createElement("canvas");b.width=Math.round(t*3),b.height=Math.round(c*3);const i=b.getContext("2d");i.scale(3,3),i.fillStyle="#ffffff",i.fillRect(0,0,t,c),i.drawImage(u.value,0,0),i.drawImage(A.value,0,0),i.fillStyle="rgba(15, 23, 42, 0.92)",i.font="14px 'Times New Roman', 'Noto Serif SC', serif",i.fillText(`煤层：${_.value||"--"} | 指标：${n(j.value)} | 分辨率：${$.value}`,16,26);const S=document.createElement("a");S.href=b.toDataURL("image/png",1),S.download=`algorithm_validation_${_.value||"seam"}_${j.value}_hd.png`,S.click()})))}),Sn=()=>Me(this,null,function*(){if(!(!T.value||!Ce.value||ie.value)){ie.value=!0,_e.value="";try{yield Yt(()=>Me(this,null,function*(){var Ae,Re,Ye;const a=yield ft(),t=new a,c=new Date().toISOString().replace(/[:.]/g,"-"),b=document.createElement("canvas"),i=3,S=u.value.width,k=u.value.height;b.width=Math.round(S*i),b.height=Math.round(k*i);const N=b.getContext("2d");N.scale(i,i),N.fillStyle="#ffffff",N.fillRect(0,0,S,k),N.drawImage(u.value,0,0),N.drawImage(A.value,0,0),N.fillStyle="rgba(15, 23, 42, 0.92)",N.font="14px 'Times New Roman', 'Noto Serif SC', serif",N.fillText(`煤层：${_.value||"--"} | 指标：${n(j.value)} | 分辨率：${$.value}`,16,26),t.file("figures/main_heatmap_hd.png",yield Gt(b,"image/png",1));const R=T.value.querySelectorAll(".science-section .figure-card");let re=0;for(const qe of R){re+=1;const Ne=((Re=(Ae=qe.querySelector("h4"))==null?void 0:Ae.textContent)==null?void 0:Re.trim())||`图${re}`,Ze=qe.querySelector(".science-chart svg");if(!Ze)continue;const $t=Ze.getBoundingClientRect(),Ue=(Ye=Ze.viewBox)==null?void 0:Ye.baseVal,Nn=(Ue==null?void 0:Ue.width)||$t.width||960,In=(Ue==null?void 0:Ue.height)||$t.height||540,qt=gn(Ze),Zt=jt(`${String(re).padStart(2,"0")}_${Ne}`);t.file(`figures/${Zt}.svg`,qt),t.file(`figures/${Zt}.png`,yield bn(qt,Nn,In,3))}t.file("data/spatial_statistics.json",JSON.stringify(We.value,null,2)),t.file("data/evaluation.json",JSON.stringify(z.value||{},null,2)),t.file("data/science_result.json",JSON.stringify(ut.value||{},null,2)),t.file("README.txt",["新算法实证图组导出包",`时间: ${new Date().toLocaleString()}`,`煤层: ${_.value||"--"}`,`主图指标: ${n(j.value)}`,"","内容说明:","- figures/: 主热力图和图2-图11（SVG+PNG）","- data/: 统计与评估原始数据"].join(`
`));const fe=yield t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),q=URL.createObjectURL(fe),we=document.createElement("a");we.href=q,we.download=`新算法实证图组_${jt(_.value||"seam")}_${c}.zip`,we.click(),URL.revokeObjectURL(q)})),_e.value="图组包导出完成。"}catch(a){_e.value=(a==null?void 0:a.message)||"图组包导出失败"}finally{ie.value=!1}}}),_n=()=>{if(!I.value)return;const a=new Blob([JSON.stringify(I.value,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),c=document.createElement("a");c.href=t,c.download=`algorithm_validation_${_.value||"seam"}_spatial.json`,c.click(),URL.revokeObjectURL(t)},kn=()=>Me(this,null,function*(){T.value&&(document.fullscreenElement?yield document.exitFullscreen():yield T.value.requestFullscreen())}),An=a=>Array.isArray(a)?a[0]||"":typeof a=="string"?a:"",Mn=()=>{x.push({name:"Report",query:_.value?{seam:_.value}:void 0})},Cn=()=>Me(this,null,function*(){var a,t,c,b;try{const i=yield jn(),S=((a=i==null?void 0:i.data)==null?void 0:a.seams)||[];if(U.value=S,S.length===0)return;const k=An((t=Y.query)==null?void 0:t.seam)||ke.selectedSeam||"16-3煤",N=S.find(R=>R.name===k);_.value=(N==null?void 0:N.name)||S[0].name,v(_.value)}catch(i){ye.value=((b=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:b.detail)||"煤层列表加载失败"}});return De(j,()=>xe()),De(ae,()=>xe()),De(M,()=>{C(),xe()}),De(O,()=>{xe(),Nt()}),De([$,W],()=>{me.value&&It({force:!1})}),De(_,()=>{v(_.value||""),me.value&&It({force:!1})}),De(Qe,a=>{!a&&he.value!=="all"&&(he.value="all",xe())}),De(()=>[V.rsi,V.bri,V.asi],()=>{me.value&&(window.clearTimeout(mt),mt=window.setTimeout(()=>It({force:!1}),300))}),ln(()=>Me(this,null,function*(){C(),yield Cn(),_.value&&(yield It({force:!0})),me.value=!0,window.addEventListener("resize",e),window.addEventListener("keydown",Wt)})),rn(()=>{window.clearTimeout(mt),window.clearTimeout(dt),je&&window.cancelAnimationFrame(je),Ge&&window.cancelAnimationFrame(Ge),window.removeEventListener("resize",e),window.removeEventListener("keydown",Wt)}),(a,t)=>{var c,b;return te(),ne("div",{ref_key:"pageRoot",ref:T,class:"validation-page"},[o("nav",$o,[o("div",Ro,[o("button",{class:"icon-btn",type:"button",title:"返回",onClick:t[0]||(t[0]=i=>Un(x).back())},[...t[15]||(t[15]=[o("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{d:"M19 12H5m0 0 6-6m-6 6 6 6"})],-1)])]),t[20]||(t[20]=o("h1",null,"新算法实证",-1)),t[21]||(t[21]=o("span",{class:"divider"},null,-1)),o("label",Fo,[t[16]||(t[16]=o("span",null,"煤层",-1)),ze(o("select",{"onUpdate:modelValue":t[1]||(t[1]=i=>_.value=i)},[(te(!0),ne(Xe,null,Dt(U.value,i=>(te(),ne("option",{key:i.name,value:i.name},y(i.name),9,Po))),128))],512),[[Qt,_.value]])]),Ce.value?(te(),ne("div",To,[o("span",null,[t[17]||(t[17]=Fe("均值 ",-1)),o("b",null,y(s(_t.value.mean)),1)]),o("span",null,[t[18]||(t[18]=Fe("最低 ",-1)),o("b",null,y(s(_t.value.min)),1)]),o("span",Lo,[t[19]||(t[19]=Fe("高风险点 ",-1)),o("b",null,y(Pt.value),1)])])):Se("",!0)]),o("div",zo,[o("button",{class:et(["tool-btn",{active:oe.value}]),type:"button",onClick:t[2]||(t[2]=i=>oe.value=!oe.value)},"权重",2),o("button",{class:et(["tool-btn",{active:pe.value}]),type:"button",onClick:t[3]||(t[3]=i=>pe.value=!pe.value)},"评估",2),o("button",{class:"tool-btn",type:"button",onClick:wn},"导出高清图"),o("button",{class:"tool-btn",type:"button",disabled:ie.value||!Ce.value,onClick:Sn},y(ie.value?"打包中...":"导出图组包"),9,Do),o("button",{class:"tool-btn",type:"button",disabled:!Ce.value,onClick:Mn},"下一步：结果报告",8,Eo),o("button",{class:"tool-btn",type:"button",onClick:kn},"全屏")])]),o("section",Bo,[(te(),ne(Xe,null,Dt(h,i=>{var S,k,N,R,re,fe,q,we,Ae;return o("button",{key:i.key,class:et(["metric-card",{active:j.value===i.key}]),type:"button",onClick:Re=>j.value=i.key},[o("div",Oo,[o("strong",null,y(i.label),1),o("span",null,y(i.desc),1)]),o("div",Vo,y(s((N=(k=(S=I.value)==null?void 0:S.statistics)==null?void 0:k[i.key])==null?void 0:N.mean)),1),o("div",Wo,[o("span",null,"最低 "+y(s((fe=(re=(R=I.value)==null?void 0:R.statistics)==null?void 0:re[i.key])==null?void 0:fe.min)),1),o("span",null,"最高 "+y(s((Ae=(we=(q=I.value)==null?void 0:q.statistics)==null?void 0:we[i.key])==null?void 0:Ae.max)),1)]),o("div",{class:"risk-bar",style:vt({background:l(i.key)})},null,4)],10,Uo)}),64))]),o("section",Ho,[o("div",jo,[o("header",Go,[o("div",null,[o("h2",null,y(n(j.value))+"全矿区插值热力图",1),t[22]||(t[22]=o("p",null,"双击适配视图，拖拽平移，滚轮缩放",-1))]),o("div",Yo,[o("label",null,[t[23]||(t[23]=Fe("分辨率",-1)),ze(o("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>$.value=i),type:"number",min:"20",max:"120",step:"5"},null,512),[[pt,$.value,void 0,{number:!0}]])]),o("label",null,[t[24]||(t[24]=Fe("线级",-1)),ze(o("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>M.value=i),type:"number",min:"5",max:"24",step:"1"},null,512),[[pt,M.value,void 0,{number:!0}]])]),o("label",null,[t[26]||(t[26]=Fe("插值 ",-1)),ze(o("select",{"onUpdate:modelValue":t[6]||(t[6]=i=>W.value=i)},[...t[25]||(t[25]=[o("option",{value:"idw"},"反距离权重",-1),o("option",{value:"linear"},"线性插值",-1),o("option",{value:"nearest"},"最近邻",-1),o("option",{value:"kriging"},"克里金",-1)])],512),[[Qt,W.value]])]),o("label",qo,[ze(o("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>ae.value=i),type:"checkbox"},null,512),[[en,ae.value]]),t[27]||(t[27]=Fe("等值线",-1))]),o("label",Zo,[ze(o("input",{"onUpdate:modelValue":t[8]||(t[8]=i=>O.value=i),type:"checkbox"},null,512),[[en,O.value]]),t[28]||(t[28]=Fe("固定量程(0-100)",-1))])])]),Ce.value?(te(),ne("div",Xo,[t[29]||(t[29]=o("span",{class:"trust-chip real"},"空间图：真实钻孔与坐标数据",-1)),o("span",Jo,"评估："+y(Tt.value),1),he.value!=="all"&&At.value>0?(te(),ne("span",Ko," 联动高亮 "+y(Lt(he.value))+" · "+y(At.value)+"点 ",1)):Se("",!0),Je.value?(te(),ne("span",Qo,"标签源 "+y(Je.value),1)):Se("",!0),o("span",ea,"钻孔 "+y(((c=I.value)==null?void 0:c.borehole_count)||0)+" 个 · 坐标源 zuobiao.csv",1)])):Se("",!0),o("div",{ref_key:"stageContainer",ref:r,class:"stage",onMousedown:dn,onMousemove:mn,onMouseup:pn,onMouseleave:vn,onWheel:On(fn,["prevent"]),onDblclick:se},[o("canvas",{ref_key:"heatmapCanvas",ref:u,class:"layer"},null,512),o("canvas",{ref_key:"overlayCanvas",ref:A,class:"layer"},null,512),de.value?(te(),ne("div",ta,[t[30]||(t[30]=o("div",{class:"skeleton"},null,-1)),t[31]||(t[31]=o("div",{class:"skeleton"},null,-1)),o("p",null,"正在计算 "+y(_.value||"目标煤层")+" 空间指标...",1)])):Se("",!0)],544),o("footer",na,[o("div",{class:"legend-track",style:vt({background:l(j.value)})},null,4),o("div",oa,[o("span",null,y(s(it.value.min)),1),o("span",null,y(s(it.value.mean)),1),o("span",null,y(s(it.value.max)),1)])])]),o("aside",{ref_key:"thumbPanelRef",ref:f,class:et(["thumb-panel",{collapsed:be.value}])},[o("header",null,[t[32]||(t[32]=o("h3",null,"指标缩略图",-1)),o("button",{class:"icon-btn mini",type:"button",onClick:t[9]||(t[9]=i=>be.value=!be.value)},y(be.value?"展开":"收起"),1)]),o("div",aa,[(te(),ne(Xe,null,Dt(h,i=>{var S,k;return o("button",{key:`thumb-${i.key}`,class:et(["thumb-item",{active:j.value===i.key}]),type:"button",onClick:N=>j.value=i.key,onMouseenter:N=>yn(i.key,N),onMousemove:N=>Ht(i.key,N),onMouseleave:hn},[o("canvas",{ref_for:!0,ref:m(i.key),class:"thumb-canvas"},null,512),o("div",sa,[o("strong",null,y(i.label),1),o("span",null,"均值 "+y(s((S=We.value[i.key])==null?void 0:S.mean)),1),o("span",null,"σ "+y(s((k=We.value[i.key])==null?void 0:k.std)),1)])],42,la)}),64))]),ve.visible&&He.value?(te(),ne("div",{key:0,class:"thumb-tooltip",style:vt({left:`${ve.x+12}px`,top:`${ve.y+12}px`})},[o("p",null,[o("strong",null,y(n(ve.metric))+"统计",1)]),o("p",null,"最小值 "+y(s(He.value.min)),1),o("p",null,"最大值 "+y(s(He.value.max)),1),o("p",null,"均值 "+y(s(He.value.mean)),1),o("p",null,"标准差 "+y(s(He.value.std)),1)],4)):Se("",!0)],2)]),Ie(nn,{name:"fade-up"},{default:tn(()=>[oe.value?(te(),ne("aside",ra,[o("header",null,[t[33]||(t[33]=o("h3",null,"权重配置",-1)),o("button",{type:"button",class:"close-btn",onClick:t[10]||(t[10]=i=>oe.value=!1)},"×")]),t[37]||(t[37]=o("p",null,"RSI / BRI / ASI 自动归一化。调整后 300ms 内自动重算。",-1)),o("label",ia,[t[34]||(t[34]=o("span",null,"RSI",-1)),ze(o("input",{"onUpdate:modelValue":t[11]||(t[11]=i=>V.rsi=i),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[pt,V.rsi,void 0,{number:!0}]]),o("strong",null,y(d(Te.value.rsi)),1)]),o("label",ua,[t[35]||(t[35]=o("span",null,"BRI",-1)),ze(o("input",{"onUpdate:modelValue":t[12]||(t[12]=i=>V.bri=i),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[pt,V.bri,void 0,{number:!0}]]),o("strong",null,y(d(Te.value.bri)),1)]),o("label",ca,[t[36]||(t[36]=o("span",null,"ASI",-1)),ze(o("input",{"onUpdate:modelValue":t[13]||(t[13]=i=>V.asi=i),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[pt,V.asi,void 0,{number:!0}]]),o("strong",null,y(d(Te.value.asi)),1)])])):Se("",!0)]),_:1}),Ie(nn,{name:"drawer-up"},{default:tn(()=>{var i,S,k,N,R,re,fe,q;return[pe.value?(te(),ne("section",da,[o("header",null,[t[38]||(t[38]=o("h3",null,"算法评估面板（当前煤层批量结果）",-1)),o("div",ma,[o("button",{type:"button",class:"tool-btn small",onClick:_n},"导出数据"),o("button",{type:"button",class:"close-btn",onClick:t[14]||(t[14]=we=>pe.value=!1)},"×")])]),ue.value?(te(),ne("div",pa,"正在计算评估指标...")):z.value?(te(),ne(Xe,{key:2},[o("div",fa,[o("div",ya,[t[39]||(t[39]=o("span",null,"AUC",-1)),o("strong",null,y(s(z.value.auc,4)),1)]),o("div",ha,[t[40]||(t[40]=o("span",null,"PR-AUC",-1)),o("strong",null,y(s(z.value.pr_auc,4)),1)]),o("div",ga,[t[41]||(t[41]=o("span",null,"F1",-1)),o("strong",null,y(s(z.value.f1,4)),1)]),o("div",ba,[t[42]||(t[42]=o("span",null,"Brier",-1)),o("strong",null,y(s(z.value.brier,4)),1)]),o("div",xa,[t[43]||(t[43]=o("span",null,"ECE",-1)),o("strong",null,y(s(z.value.ece,4)),1)])]),o("div",wa,[o("div",Sa,[t[48]||(t[48]=o("h4",null,"混淆矩阵",-1)),o("div",_a,[o("div",ka,[t[44]||(t[44]=o("span",null,"TN",-1)),o("b",null,y((S=(i=z.value.confusion_matrix)==null?void 0:i.tn)!=null?S:0),1)]),o("div",Aa,[t[45]||(t[45]=o("span",null,"FP",-1)),o("b",null,y((N=(k=z.value.confusion_matrix)==null?void 0:k.fp)!=null?N:0),1)]),o("div",Ma,[t[46]||(t[46]=o("span",null,"FN",-1)),o("b",null,y((re=(R=z.value.confusion_matrix)==null?void 0:R.fn)!=null?re:0),1)]),o("div",Ca,[t[47]||(t[47]=o("span",null,"TP",-1)),o("b",null,y((q=(fe=z.value.confusion_matrix)==null?void 0:fe.tp)!=null?q:0),1)])])]),o("div",Na,[t[55]||(t[55]=o("h4",null,"基线对比（SVG）",-1)),(te(),ne("svg",Ia,[t[49]||(t[49]=o("rect",{x:"0",y:"0",width:"560",height:"170",fill:"#fff"},null,-1)),t[50]||(t[50]=o("text",{x:"14",y:"26"},"基线 MPI",-1)),t[51]||(t[51]=o("rect",{x:"112",y:"12",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"12",width:D(kt.value),height:"18",rx:"9",fill:"#64748b"},null,8,$a),o("text",Ra,y(s(kt.value,3)),1),t[52]||(t[52]=o("text",{x:"14",y:"90"},"新算法 MPI",-1)),t[53]||(t[53]=o("rect",{x:"112",y:"76",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"76",width:D(rt.value),height:"18",rx:"9",fill:"#0f766e"},null,8,Fa),o("text",Pa,y(s(rt.value,3)),1),t[54]||(t[54]=o("text",{x:"14",y:"148",fill:"#64748b"},"注：基于当前煤层批量钻孔的空间实证均值。",-1))]))])])],64)):(te(),ne("div",va,y(ye.value||"暂无评估数据"),1))])):Se("",!0)]}),_:1}),Ce.value?(te(),ne("section",Ta,[o("header",null,[t[57]||(t[57]=o("h3",null,"期刊级图组（自动生成）",-1)),t[58]||(t[58]=o("p",null,"全部图件已直接展示，满足对比、消融、校准、判别与机制解释需求。",-1)),t[59]||(t[59]=o("p",{class:"data-note"},"说明：评估与部分机制曲线目前为模型推导/示意，不等同于真实标签实验结果。",-1)),o("p",La,[t[56]||(t[56]=Fe(" 图11支持点击 TP/TN/FP/FN 联动主图高亮。 ",-1)),he.value!=="all"?(te(),ne(Xe,{key:0},[Fe("可按 Esc 快速清除筛选。")],64)):Se("",!0),Qe.value?Se("",!0):(te(),ne(Xe,{key:1},[Fe("当前样本与钻孔点未一一对齐，联动高亮不可用。")],64))]),t[60]||(t[60]=o("p",{class:"data-note"},"导出高清图与图组包时会自动冻结脉冲动画，保证稿件图件为静态一致版。",-1)),he.value!=="all"?(te(),ne("button",{key:0,type:"button",class:"tool-btn small",onClick:Vt},"清除联动高亮")):Se("",!0),_e.value?(te(),ne("p",za,y(_e.value),1)):Se("",!0)]),Ie(Io,{result:ut.value,evaluation:z.value,onMatrixSelect:cn},null,8,["result","evaluation"])])):Se("",!0),J.value&&Ce.value?(te(),ne("div",{key:1,class:"hover-tooltip",style:vt({left:`${$e.x+14}px`,top:`${$e.y+14}px`})},[o("p",null,"坐标："+y(s(J.value.worldX,2))+", "+y(s(J.value.worldY,2)),1),o("p",null,y(n(j.value))+"插值："+y(s(J.value.gridValue,3)),1),o("p",null,"最近钻孔："+y(((b=J.value.nearestBorehole)==null?void 0:b.borehole_name)||"--")+"（"+y(s(J.value.nearestDistance,1))+" m）",1),J.value.borehole?(te(),ne(Xe,{key:0},[o("p",null,[o("strong",null,y(J.value.borehole.borehole_name),1)]),o("p",null,"RSI "+y(s(J.value.borehole.rsi,2))+" | BRI "+y(s(J.value.borehole.bri,2)),1),o("p",null,"ASI "+y(s(J.value.borehole.asi,2))+" | MPI "+y(s(J.value.borehole.mpi,2)),1),o("p",Da,y(F(J.value.borehole.risk_label)),1)],64)):Se("",!0)],4)):Se("",!0)],512)}}},Ya=Bt(Ea,[["__scopeId","data-v-69081277"]]);export{Ya as default};
