var Cn=Object.defineProperty,Nn=Object.defineProperties;var In=Object.getOwnPropertyDescriptors;var qt=Object.getOwnPropertySymbols;var $n=Object.prototype.hasOwnProperty,Rn=Object.prototype.propertyIsEnumerable;var Zt=Math.pow,Xt=(g,X,x)=>X in g?Cn(g,X,{enumerable:!0,configurable:!0,writable:!0,value:x}):g[X]=x,Z=(g,X)=>{for(var x in X||(X={}))$n.call(X,x)&&Xt(g,x,X[x]);if(qt)for(var x of qt(X))Rn.call(X,x)&&Xt(g,x,X[x]);return g},K=(g,X)=>Nn(g,In(X));var Ce=(g,X,x)=>new Promise((ke,v)=>{var ce=P=>{try{U(x.next(P))}catch(s){v(s)}},h=P=>{try{U(x.throw(P))}catch(s){v(s)}},U=P=>P.done?ke(P.value):Promise.resolve(P.value).then(ce,h);U((x=x.apply(g,X)).next())});import{r as Nt,bB as Fn,bC as Pn,bA as Tn,be as on,n as an,w as ze,bv as ln,b5 as te,b8 as ne,bm as mt,b as ee,c as p,b7 as o,bb as f,bh as xe,ba as Qe,bi as Ne,u as Ln,bq as Le,bu as Kt,bc as Ye,b9 as zt,bn as Fe,br as dt,bs as Jt,bl as zn,bg as Qt,bx as en,a as Dn}from"./vendor-BiQoUjbf.js";import{a as En,u as Bn}from"./vue-router-Dfza_nYx.js";import{J as Un}from"./jszip-eC0OUXGO.js";import{g as On,v as Vn,n as Wn}from"./api-DtdLAmLC.js";import{_ as Et,u as Hn}from"./index-D34UQVup.js";import"./echarts-CkoSHfYc.js";import{i as Gn}from"./echarts-AB_YLQA7.js";import"./network-T6nY3V_4.js";function jn(){const g=Nt({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),X=(P,s,y)=>{if(!y)return{x:0,y:0};const u=P-y.min_x,A=y.max_y-s;return{x:u*g.scale+g.x,y:A*g.scale+g.y}},x=(P,s,y)=>{if(!y||g.scale===0)return{x:0,y:0};const u=(P-g.x)/g.scale,A=(s-g.y)/g.scale;return{x:y.min_x+u,y:y.max_y-A}};return{viewport:g,worldToScreen:X,screenToWorld:x,fitToBounds:(P,s,y,u=56)=>{if(!P||!s||!y)return;const A=Math.max(P.max_x-P.min_x,1e-6),O=Math.max(P.max_y-P.min_y,1e-6),k=Math.min((s-u*2)/A,(y-u*2)/O),I=(P.min_x+P.max_x)/2,M=(P.min_y+P.max_y)/2;g.scale=Math.max(.01,k),g.x=s/2-(I-P.min_x)*g.scale,g.y=y/2-(P.max_y-M)*g.scale},startDrag:(P,s)=>{g.isDragging=!0,g.lastX=P,g.lastY=s},dragTo:(P,s)=>{g.isDragging&&(g.x+=P-g.lastX,g.y+=s-g.lastY,g.lastX=P,g.lastY=s)},endDrag:()=>{g.isDragging=!1},zoomAt:(P,s,y,u,A=.1,O=50)=>{if(!u)return;const k=Math.max(A,Math.min(O,g.scale*P));if(k===g.scale)return;const I=x(s,y,u);g.scale=k,g.x=s-(I.x-u.min_x)*g.scale,g.y=y-(u.max_y-I.y)*g.scale}}}const tn={mpi:["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],rsi:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],bri:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],asi:["#3b82f6","#6366f1","#8b5cf6","#ec4899","#dc2626"]},Dt=g=>Math.max(0,Math.min(1,g)),Yn=g=>{const x=String(g||"").match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return x?{r:Number(x[1]),g:Number(x[2]),b:Number(x[3])}:null},qn=(g,X=.8)=>{const x=Yn(g);if(!x)return"#94a3b8";const ke=Math.round(x.r*.299+x.g*.587+x.b*.114),v=Math.round(ke*X+235*(1-X));return`rgb(${v},${v},${v})`},nn=g=>{var ke,v;const X=Number((ke=g==null?void 0:g.min)!=null?ke:0),x=Number((v=g==null?void 0:g.max)!=null?v:100);return!Number.isFinite(X)||!Number.isFinite(x)||X===x?{min:0,max:100}:{min:X,max:x}};function Xn(){const g=s=>tn[s]||tn.mpi,X=s=>`linear-gradient(90deg, ${g(s).join(",")})`,x=(s,y,u)=>{const{min:A,max:O}=nn(u),k=Dt((Number(y)-A)/(O-A));return Fn(g(s))(k)},ke=(s,y,u,A,O,k,I={})=>{var C;const M=y.length,H=((C=y[0])==null?void 0:C.length)||0;if(M<2||H<2)return;const le=new Array(M*H);let V=0;for(let z=0;z<M;z+=1)for(let ue=0;ue<H;ue+=1)le[V]=Number(y[z][ue]||0),V+=1;const{min:j,max:de}=nn(O),me=Math.max(5,Number(I.contourLevels||9)),oe=Pn(j,de,me).slice(1,-1);if(!oe.length)return;const pe=Tn().size([H,M]).thresholds(oe)(le),be=Math.max(u.max_x-u.min_x,1e-6),W=Math.max(u.max_y-u.min_y,1e-6);s.save(),s.strokeStyle=I.contourColor||"rgba(15,23,42,0.32)",s.lineWidth=A.scale>2?1.2:.9,s.globalAlpha=A.scale<.65?.45:.7;for(const z of pe)for(const ue of z.coordinates)for(const fe of ue)if(!(!Array.isArray(fe)||fe.length<2)){s.beginPath();for(let re=0;re<fe.length;re+=1){const we=fe[re],J=u.min_x+we[0]/Math.max(H-1,1)*be,Ie=u.max_y-we[1]/Math.max(M-1,1)*W,ye=k(J,Ie,u);re===0?s.moveTo(ye.x,ye.y):s.lineTo(ye.x,ye.y)}s.closePath(),s.stroke()}s.restore()};return{getLegendGradient:X,drawGrid:(s,y,u,A,O,k,I,M={})=>{var be;if(!s||!Array.isArray(y)||y.length===0||!u)return;const H=y.length,le=((be=y[0])==null?void 0:be.length)||0;if(!le)return;const V=u.max_x-u.min_x,j=u.max_y-u.min_y,de=V/le,me=j/H,oe=s.canvas.width,pe=s.canvas.height;for(let W=0;W<H;W+=1){const C=y[W],z=u.max_y-W*me;for(let ue=0;ue<le;ue+=1){const fe=u.min_x+ue*de,re=I(fe,z,u),we=I(fe+de,z-me,u),J=Math.min(re.x,we.x),Ie=Math.min(re.y,we.y),ye=Math.abs(we.x-re.x)+.8,Y=Math.abs(we.y-re.y)+.8;J>oe||J+ye<0||Ie>pe||Ie+Y<0||(s.fillStyle=x(O,Number(C[ue]||0),k),s.fillRect(J,Ie,ye,Y))}}if(M.showContours!==!1&&ke(s,y,u,A,k,I,M),A.scale>3.2){s.strokeStyle="rgba(255,255,255,0.18)",s.lineWidth=1,s.beginPath();for(let W=0;W<=H;W+=1){const C=u.max_y-W*me,z=I(u.min_x,C,u),ue=I(u.max_x,C,u);s.moveTo(z.x,z.y),s.lineTo(ue.x,ue.y)}for(let W=0;W<=le;W+=1){const C=u.min_x+W*de,z=I(C,u.min_y,u),ue=I(C,u.max_y,u);s.moveTo(z.x,z.y),s.lineTo(ue.x,ue.y)}s.stroke()}},drawBoreholes:(s,y,u,A,O,k,I="",M=null)=>{if(!s||!Array.isArray(y)||!O)return;const H=!!(M!=null&&M.active&&(M==null?void 0:M.indexSet)instanceof Set&&M.indexSet.size>0),le=String((M==null?void 0:M.accent)||"#111827"),V=!!(M!=null&&M.animate),j=Number((M==null?void 0:M.pulseT)||0);for(let de=0;de<y.length;de+=1){const me=y[de],oe=k(me.x,me.y,O),pe=I&&I===me.borehole_name,be=!H||M.indexSet.has(de),W=V&&H&&be?(Math.sin(j*5+de*.35)+1)/2:0,C=pe?7.5:be&&H?6.6:5.8;s.save();const z=x(u,me[u],A);s.globalAlpha=H&&!be?.24:1,s.fillStyle=H&&!be?qn(z,.84):z,s.strokeStyle=pe?"#111827":be&&H?le:"rgba(255,255,255,0.95)",s.lineWidth=pe?2.4:1.8,s.beginPath(),s.arc(oe.x,oe.y,C,0,Math.PI*2),s.fill(),s.stroke(),be&&H&&!pe&&(s.globalAlpha=.95,s.strokeStyle=le,s.lineWidth=2,s.beginPath(),s.arc(oe.x,oe.y,C+3.6,0,Math.PI*2),s.stroke(),V&&(s.globalAlpha=.35+W*.45,s.lineWidth=1.6+W*.9,s.beginPath(),s.arc(oe.x,oe.y,C+6+W*5.5,0,Math.PI*2),s.stroke())),s.restore()}},pickNearestBorehole:(s,y,u,A,O,k=14)=>{if(!Array.isArray(u)||!A)return null;let I=null,M=Number.POSITIVE_INFINITY;for(const H of u){const le=O(H.x,H.y,A),V=Math.hypot(s-le.x,y-le.y);V<M&&(M=V,I=H)}return M<=k?I:null},sampleGridValue:(s,y,u,A)=>{var V;if(!Array.isArray(s)||s.length===0||!y)return null;const O=s.length,k=((V=s[0])==null?void 0:V.length)||0;if(!k)return null;const I=Dt((u-y.min_x)/Math.max(y.max_x-y.min_x,1e-6)),M=Dt((y.max_y-A)/Math.max(y.max_y-y.min_y,1e-6)),H=Math.max(0,Math.min(k-1,Math.floor(I*(k-1)))),le=Math.max(0,Math.min(O-1,Math.floor(M*(O-1))));return Number(s[le][H])},drawMiniHeatmap:(s,y,u,A)=>{var de;if(!s||!Array.isArray(y)||y.length===0)return;const O=window.devicePixelRatio||1,k=s.clientWidth||150,I=s.clientHeight||110;s.width=Math.round(k*O),s.height=Math.round(I*O);const M=s.getContext("2d");M.setTransform(O,0,0,O,0,0),M.clearRect(0,0,k,I);const H=y.length,le=((de=y[0])==null?void 0:de.length)||0;if(!le)return;const V=k/le,j=I/H;for(let me=0;me<H;me+=1)for(let oe=0;oe<le;oe+=1)M.fillStyle=x(u,Number(y[me][oe]||0),A),M.fillRect(oe*V,me*j,V+.4,j+.4);M.strokeStyle="rgba(255,255,255,0.35)",M.strokeRect(0,0,k,I)}}}const Zn={__name:"ScienceChart",props:{option:{type:Object,required:!0},height:{type:[String,Number],default:320}},emits:["chart-click"],setup(g,{emit:X}){const x=g,ke=X,v=ee(null);let ce=null;const h=p(()=>typeof x.height=="number"?`${x.height}px`:x.height),U=()=>{ce&&ce.setOption(x.option||{},!0)},P=()=>{ce&&ce.resize()},s=y=>{ke("chart-click",y)};return on(()=>Ce(this,null,function*(){yield an(),v.value&&(ce=Gn(v.value,null,{renderer:"svg"}),ce.on("click",s),U(),window.addEventListener("resize",P))})),ze(()=>x.option,()=>{U()},{deep:!0}),ln(()=>{window.removeEventListener("resize",P),ce&&(ce.off("click",s),ce.dispose(),ce=null)}),(y,u)=>(te(),ne("div",{ref_key:"container",ref:v,class:"science-chart",style:mt({height:h.value})},null,4))}},Pe=Et(Zn,[["__scopeId","data-v-8491ce69"]]),Kn={class:"science-gallery"},Jn={class:"gallery-head"},Qn={class:"head-metrics"},eo={class:"metric-chip"},to={class:"metric-chip"},no={key:0,class:"metric-chip"},oo={key:1,class:"metric-chip"},ao={class:"figure-card"},lo={class:"caption meta"},so={class:"figure-card"},ro={class:"caption meta"},io={class:"figure-card"},uo={class:"caption meta"},co={class:"figure-card"},mo={class:"caption meta"},po={class:"figure-card"},vo={class:"caption meta"},yo={class:"figure-card"},fo={class:"caption meta"},ho={class:"figure-card"},go={class:"caption meta"},bo={class:"figure-card"},xo={class:"caption meta"},wo={class:"figure-card"},So={class:"caption meta"},_o={class:"figure-card"},ko={class:"caption meta"},ge="'Times New Roman', 'Noto Serif SC', 'Source Han Serif SC', serif",Ao={__name:"ValidationScienceFigures",props:{result:{type:Object,default:null},evaluation:{type:Object,default:null}},emits:["matrix-select"],setup(g,{emit:X}){const x=g,ke=X,v={blue:"#1d4ed8",cyan:"#0891b2",green:"#15803d",orange:"#d97706",red:"#b91c1c",purple:"#7c3aed",slate:"#475569"},ce={left:66,right:26,top:46,bottom:62},h=(e,t,l)=>Math.max(t,Math.min(l,e)),U=(e,t=0)=>{const l=Number(e);return Number.isFinite(l)?l:t},P=e=>`${(h(U(e,0),0,1)*100).toFixed(1)}%`,s=(e,t=3)=>Number(U(e,0).toFixed(t)),y=(e,t,l=0)=>t>0?e/t:l,u=(e,t=!0)=>({type:t?"value":"category",name:e,nameLocation:"middle",nameGap:38,nameTextStyle:{fontFamily:ge,fontSize:12,color:"#0f172a"},axisLabel:{fontFamily:ge,fontSize:11,color:"#0f172a"},axisLine:{lineStyle:{color:"#0f172a",width:1.15}},axisTick:{lineStyle:{color:"#334155",width:1}},splitLine:{show:!0,lineStyle:{color:"#e2e8f0",width:.8,type:"dashed"}}}),A={top:6,textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"}},O={right:8,top:6,itemSize:14,iconStyle:{borderColor:"#334155"},feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"框选缩放",back:"还原缩放"}},restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}},k=[{type:"inside",xAxisIndex:0,filterMode:"none",zoomOnMouseWheel:"ctrl",moveOnMouseMove:!0}],I=p(()=>{var e;return((e=x.result)==null?void 0:e.evaluation_inputs)||{}}),M=p(()=>{var t,l;const e=((t=I.value)==null?void 0:t.mode)||((l=I.value)==null?void 0:l.source)||"pseudo_threshold";return String(e)}),H=p(()=>{var e,t;return String(((e=I.value)==null?void 0:e.source)||((t=I.value)==null?void 0:t.sourceFile)||"")}),le=p(()=>M.value==="real_label_stream"?"真实标签流":M.value==="pseudo_threshold"?"伪标签估计":"未知"),V=p(()=>{var d,_,F,E;const e=Array.isArray((d=I.value)==null?void 0:d.y_true)?I.value.y_true:Array.isArray((_=I.value)==null?void 0:_.yTrue)?I.value.yTrue:[],t=Array.isArray((F=I.value)==null?void 0:F.y_prob)?I.value.y_prob:Array.isArray((E=I.value)==null?void 0:E.yProb)?I.value.yProb:[],l=Math.min(e.length,t.length),i=[];for(let G=0;G<l;G+=1){const T=U(e[G],0)>=1?1:0,N=h(U(t[G],0),0,1);i.push({y:T,p:N})}return i}),j=p(()=>V.value.length),de=p(()=>V.value.filter(e=>e.y===1).length),me=p(()=>j.value-de.value),oe=p(()=>y(de.value,Math.max(j.value,1),0)),pe=p(()=>j.value>=6&&de.value>0&&me.value>0),be=p(()=>{const e=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const t of V.value)e.push(Number(t.p.toFixed(3)));return Array.from(new Set(e.map(t=>h(t,0,1)))).sort((t,l)=>l-t)}),W=e=>{let t=0,l=0,i=0,d=0;for(const B of V.value){const ae=B.p>=e?1:0;B.y===1&&ae===1?t+=1:B.y===1&&ae===0?d+=1:B.y===0&&ae===1?l+=1:i+=1}const _=y(t,t+d,0),F=y(t,t+l,0),E=y(i,i+l,0),G=y(l,l+i,0),T=y(t+i,t+i+l+d,0),N=y(2*F*_,F+_,0);return{threshold:e,tp:t,fp:l,tn:i,fn:d,recall:_,precision:F,specificity:E,fpr:G,accuracy:T,f1:N}},C=p(()=>be.value.map(e=>W(e))),z=p(()=>{if(!pe.value)return[[0,0],[.06,.28],[.15,.54],[.33,.75],[.56,.89],[1,1]];const e=C.value.map(t=>[t.fpr,t.recall]);return e.push([0,0],[1,1]),e.sort((t,l)=>t[0]-l[0]||t[1]-l[1]),e}),ue=p(()=>{if(!pe.value)return[[0,1],[.15,.9],[.35,.82],[.55,.73],[.75,.61],[1,.5]];const e=C.value.map(t=>[t.recall,t.precision]);return e.push([0,1],[1,oe.value]),e.sort((t,l)=>t[0]-l[0]||l[1]-t[1]),e}),fe=e=>{let t=0;for(let l=1;l<e.length;l+=1){const[i,d]=e[l-1],[_,F]=e[l];t+=(_-i)*((d+F)/2)}return h(t,0,1)},re=(e,t,l=0)=>{const i=e.filter(G=>Number.isFinite(G)).slice().sort((G,T)=>G-T);if(!i.length)return l;const d=h(t,0,1)*(i.length-1),_=Math.floor(d),F=Math.min(i.length-1,_+1),E=d-_;return i[_]*(1-E)+i[F]*E},we=(e,t)=>{if(!Array.isArray(e)||e.length===0)return 0;if(e.length===1||t<=e[0][0])return h(U(e[0][1],0),0,1);for(let l=1;l<e.length;l+=1){const[i,d]=e[l-1],[_,F]=e[l];if(t<=_){if(Math.abs(_-i)<1e-12)return h(Math.max(d,F),0,1);const E=(t-i)/(_-i);return h(d+(F-d)*E,0,1)}}return h(U(e[e.length-1][1],0),0,1)},J=e=>{const t=e.length,l=e.reduce((T,N)=>T+(N.y>=1?1:0),0),i=t-l;if(t<2||l<=0||i<=0)return{roc:[[0,0],[1,1]],pr:[[0,1],[1,h(y(l,Math.max(t,1),0),0,1)]],auc:.5,prAuc:.5};const d=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const T of e)d.push(Number(T.p.toFixed(3)));const _=Array.from(new Set(d.map(T=>h(T,0,1)))).sort((T,N)=>N-T),F=[],E=[];for(const T of _){let N=0,B=0,ae=0,m=0;for(const L of e){const $e=L.p>=T?1:0;L.y===1&&$e===1?N+=1:L.y===1&&$e===0?m+=1:L.y===0&&$e===1?B+=1:ae+=1}const D=y(N,N+m,0),se=y(N,N+B,0),Q=y(B,B+ae,0);F.push([Q,D]),E.push([D,se])}F.push([0,0],[1,1]),F.sort((T,N)=>T[0]-N[0]||T[1]-N[1]);const G=h(y(l,t,0),0,1);return E.push([0,1],[1,G]),E.sort((T,N)=>T[0]-N[0]||N[1]-T[1]),{roc:F,pr:E,auc:fe(F),prAuc:fe(E)}},Ie=p(()=>{let e=2166136261;for(let t=0;t<V.value.length;t+=1){const l=V.value[t],i=l.y>=1?1:0,d=Math.round(h(l.p,0,1)*1e3);e^=i*733+d*31+t*131>>>0,e=Math.imul(e,16777619)>>>0}return e||1315423911}),ye=p(()=>pe.value?j.value<=60?240:j.value<=180?180:120:0),Y=p(()=>{if(!pe.value)return null;const e=V.value.length,t=ye.value;if(t<=0||e<6)return null;const l=Array.from({length:21},(m,D)=>D/20),i=l.map(()=>[]),d=l.map(()=>[]),_=[],F=[];let E=Ie.value>>>0;const G=()=>{E+=1831565813;let m=E;return m=Math.imul(m^m>>>15,m|1),m^=m+Math.imul(m^m>>>7,m|61),((m^m>>>14)>>>0)/4294967296};for(let m=0;m<t;m+=1){const D=[];for(let Q=0;Q<e;Q+=1)D.push(V.value[Math.floor(G()*e)]);const se=J(D);_.push(se.auc),F.push(se.prAuc);for(let Q=0;Q<l.length;Q+=1){const L=l[Q];i[Q].push(we(se.roc,L)),d[Q].push(we(se.pr,L))}}const T=i.map(m=>re(m,.025,0)),N=i.map(m=>re(m,.975,1)),B=d.map(m=>re(m,.025,0)),ae=d.map(m=>re(m,.975,1));return{iterations:t,grid:l,rocLow:T,rocHigh:N,prLow:B,prHigh:ae,aucLow:h(re(_,.025,De.value),0,1),aucHigh:h(re(_,.975,De.value),0,1),prAucLow:h(re(F,.025,Ee.value),0,1),prAucHigh:h(re(F,.975,Ee.value),0,1)}}),qe=p(()=>Y.value?{low:Y.value.grid.map((e,t)=>[e,Y.value.rocLow[t]]),high:Y.value.grid.map((e,t)=>[e,Y.value.rocHigh[t]])}:{low:[],high:[]}),he=p(()=>Y.value?Y.value.grid.map((e,t)=>[e,Math.max(Y.value.rocHigh[t]-Y.value.rocLow[t],0)]):[]),Xe=p(()=>Y.value?{low:Y.value.grid.map((e,t)=>[e,Y.value.prLow[t]]),high:Y.value.grid.map((e,t)=>[e,Y.value.prHigh[t]])}:{low:[],high:[]}),et=p(()=>Y.value?Y.value.grid.map((e,t)=>[e,Math.max(Y.value.prHigh[t]-Y.value.prLow[t],0)]):[]),tt=p(()=>fe(z.value)),pt=p(()=>fe(ue.value)),Ze=p(()=>pe.value?C.value.reduce((e,t)=>{const l=t.recall-t.fpr;return l>e.j?K(Z({},t),{j:l}):e},{threshold:.5,fpr:1,recall:0,j:-1}):{threshold:.5,fpr:.22,recall:.78,j:.56}),vt=p(()=>pe.value?C.value.reduce((e,t)=>t.f1>e.f1?t:e,C.value[0]||{threshold:.5,recall:0,precision:0,f1:0}):{threshold:.5,recall:.74,precision:.78,f1:.76}),It=p(()=>{if(!V.value.length)return .25;const e=V.value.reduce((t,l)=>t+Zt(l.p-l.y,2),0);return h(e/V.value.length,0,1)}),nt=p(()=>{if(!pe.value)return{centers:[.1,.22,.34,.46,.58,.7,.82,.94],pred:[.11,.23,.36,.45,.57,.69,.8,.9],obs:[.14,.2,.31,.49,.55,.63,.78,.89],lower:[.04,.08,.19,.31,.39,.47,.63,.74],band:[.2,.24,.24,.18,.16,.16,.15,.15],count:[4,6,8,11,12,10,7,5],ece:.043};const e=8,t=Array.from({length:e+1},(m,D)=>D/e),l=Array.from({length:e},()=>0),i=Array.from({length:e},()=>0),d=Array.from({length:e},()=>0);for(const m of V.value){const D=Math.min(e-1,Math.floor(m.p*e));l[D]+=1,i[D]+=m.p,d[D]+=m.y}const _=[],F=[],E=[],G=[],T=[],N=[];for(let m=0;m<e;m+=1){if(l[m]<=0)continue;const D=i[m]/l[m],se=d[m]/l[m],Q=1.96*Math.sqrt(y(se*(1-se),l[m],0)),L=h(se-Q,0,1),$e=h(se+Q,0,1);_.push((t[m]+t[m+1])/2),F.push(D),E.push(se),G.push(L),T.push($e-L),N.push(l[m])}const B=Math.max(V.value.length,1),ae=F.reduce((m,D,se)=>m+Math.abs(D-E[se])*N[se],0)/B;return{centers:_,pred:F,obs:E,lower:G,band:T,count:N,ece:ae}}),De=p(()=>{var l,i,d;const e=U((l=x.evaluation)==null?void 0:l.auc,NaN);if(!Number.isNaN(e)&&e>0)return h(e,.5,1);const t=U((d=(i=x.result)==null?void 0:i.kpi)==null?void 0:d.auc,NaN);return!Number.isNaN(t)&&t>0?h(t,.5,1):h(tt.value,.5,1)}),Ee=p(()=>{var t;const e=U((t=x.evaluation)==null?void 0:t.pr_auc,NaN);return!Number.isNaN(e)&&e>0?h(e,.4,1):h(pt.value,.4,1)}),$t=p(()=>{var l,i,d;const e=U((l=x.evaluation)==null?void 0:l.brier,NaN);if(!Number.isNaN(e)&&e>=0)return h(e,0,1);const t=U((d=(i=x.result)==null?void 0:i.kpi)==null?void 0:d.brier_score,NaN);return!Number.isNaN(t)&&t>=0?h(t,0,1):h(It.value,0,1)}),yt=p(()=>{var t;const e=U((t=x.evaluation)==null?void 0:t.ece,NaN);return!Number.isNaN(e)&&e>=0?h(e,0,1):h(nt.value.ece,0,1)}),ft=p(()=>{var l;const e=(l=x.evaluation)==null?void 0:l.confusion_matrix;if(e&&["tp","tn","fp","fn"].every(i=>Number.isFinite(Number(e[i]))))return{tp:Number(e.tp),tn:Number(e.tn),fp:Number(e.fp),fn:Number(e.fn)};const t=C.value.find(i=>Math.abs(i.threshold-.5)<1e-9);return t?{tp:t.tp,tn:t.tn,fp:t.fp,fn:t.fn}:{tp:13,tn:31,fp:6,fn:8}}),ht=p(()=>{const e=ft.value,t=y(e.tp+e.tn,e.tp+e.tn+e.fp+e.fn,0),l=y(e.tp,e.tp+e.fp,0),i=y(e.tp,e.tp+e.fn,0),d=y(e.tn,e.tn+e.fp,0);return{accuracy:t,precision:l,recall:i,specificity:d}}),gt=p(()=>{var N,B,ae;const e=U((ae=(B=(N=x.result)==null?void 0:N.modules)==null?void 0:B.rsi)==null?void 0:ae.value,62),t=["伪顶","直接顶","老顶Ⅰ","老顶Ⅱ","关键层A","关键层B","关键层C","覆岩"],l=[0,-4,-2,1,3,4,2,1],i=t.map((m,D)=>h(e+l[D]*3+Math.sin(D*1.2)*2.2,24,96)),d=t.map((m,D)=>h(9-D*.7+(100-e)*.03,3,12)),_=i.map((m,D)=>h(m-d[D],0,100)),E=i.map((m,D)=>h(m+d[D],0,100)).map((m,D)=>s(m-_[D],4)),G=i.map(m=>h(102-m,4,90)),T=i.reduce((m,D,se,Q)=>D<Q[m]?se:m,0);return{layers:t,stability:i,lower:_,band:E,damage:G,minIdx:T}}),bt=p(()=>{var N,B,ae,m,D,se;const e=Array.from({length:12},(Q,L)=>`T${String(L+1).padStart(2,"0")}`),t=U((ae=(B=(N=x.result)==null?void 0:N.modules)==null?void 0:B.bri)==null?void 0:ae.event_count,20),l=U((se=(D=(m=x.result)==null?void 0:m.modules)==null?void 0:D.bri)==null?void 0:se.avg_magnitude,2.6),i=e.map((Q,L)=>Math.max(1,Math.round(t/e.length*(.8+.6*Math.sin((L+1)/1.7))))),d=i.map((Q,L)=>s(Q*(18+l*6)*(.85+.25*Math.cos((L+2)/2.3)))),_=d.map((Q,L)=>s((d[Math.max(0,L-1)]+d[L]+d[Math.min(d.length-1,L+1)])/3,2));let F=0;const E=d.reduce((Q,L)=>Q+L,0)||1,G=d.map(Q=>(F+=Q,s(F/E*100,2))),T=d.reduce((Q,L,$e,Mt)=>L>Mt[Q]?$e:Q,0);return{windows:e,energy:d,smooth:_,eventRate:i,cumulativeRisk:G,peakIdx:T}}),xt=p(()=>{var E,G,T;const e=U((T=(G=(E=x.result)==null?void 0:E.modules)==null?void 0:G.asi)==null?void 0:T.value,58),t=[2.5,3,3.5,4,5,6,7,8,9,10],l=t.map(N=>s(h(6.5+e*.06+10/Math.max(N,1),4,34),3)),i=t.map(N=>s(h(12+e*.16+18/Math.max(N-1.5,1),8,48),3)),d=t.map((N,B)=>s(h(y(i[B],l[B],1),1,4.5),3)),_=i.reduce((N,B,ae,m)=>B>m[N]?ae:N,0),F=t.find((N,B)=>d[B]<2)||t[t.length-1];return{dist:t,radial:l,tangential:i,kt:d,peakIdx:_,riskRadius:F}}),Te=p(()=>{var N,B,ae;const e=(ae=(B=(N=x.result)==null?void 0:N.figures)==null?void 0:B.fig5_dbn)==null?void 0:ae.posterior,t=[{t:"t-4",high_risk_prob:.31},{t:"t-3",high_risk_prob:.35},{t:"t-2",high_risk_prob:.42},{t:"t-1",high_risk_prob:.48},{t:"t",high_risk_prob:.56}],l=Array.isArray(e)&&e.length?e:t,i=l.map(m=>String(m.t)),d=l.map(m=>h(U(m.high_risk_prob,0),0,1)),_=h(.22-Math.sqrt(Math.max(j.value,1))/22,.06,.2),F=d.map(m=>h(m-_,0,1)),G=d.map(m=>h(m+_,0,1)).map((m,D)=>s(m-F[D],4)),T=d.filter(m=>m>=.6).length;return{labels:i,p:d,lower:F,band:G,alertCount:T}}),Me=p(()=>{var T,N,B,ae,m;const e=h(U((N=(T=x.result)==null?void 0:T.fusion)==null?void 0:N.mpi,52),0,100),t=h(U((m=(ae=(B=x.result)==null?void 0:B.fusion)==null?void 0:ae.baseline)==null?void 0:m.mpi,e-4.5),0,100),l=h(De.value,.5,1),i=h(Ee.value,.4,1),d=h($t.value,0,1),_=["MPI","AUC×100","PR-AUC×100","(1-Brier)×100"],F=[s(e,2),s(l*100,2),s(i*100,2),s((1-d)*100,2)],E=[s(t,2),s(h((l-.05)*100,0,100),2),s(h((i-.06)*100,0,100),2),s(h((1-(d+.05))*100,0,100),2)],G=F.map((D,se)=>s(D-E[se],2));return{categories:_,newScores:F,baseScores:E,gain:G}}),ot=p(()=>{var N,B;const e=s(h(De.value*100,45,99),2),t=((B=(N=x.result)==null?void 0:N.fusion)==null?void 0:B.dynamic_weights)||{rsi:.4,bri:.35,asi:.25},l=s(2.5+U(t.rsi,.4)*16,2),i=s(2.5+U(t.bri,.35)*16,2),d=s(2.5+U(t.asi,.25)*16,2),_=["全模型","去RSI","去BRI","去ASI"],F=[e,s(h(e-l,40,99),2),s(h(e-i,40,99),2),s(h(e-d,40,99),2)],E=[0,l,i,d],G=l+i+d||1,T=[0,s(l/G*100,1),s(i/G*100,1),s(d/G*100,1)];return{categories:_,score:F,drop:E,contribution:T}}),at=p(()=>{const e=gt.value,t=e.layers[e.minIdx],l=e.stability[e.minIdx];return`关键结论：最低稳定层位为 ${t}（${l.toFixed(1)}%），${l<60?"低于":"高于"}60%预警阈值。`}),wt=p(()=>{const e=bt.value;return`关键结论：峰值窗口 ${e.windows[e.peakIdx]}，能量 ${e.energy[e.peakIdx].toFixed(1)} a.u.，累计风险在后半段快速抬升。`}),Rt=p(()=>{const e=xt.value;return`关键结论：切向应力峰值出现在 r=${e.dist[e.peakIdx]} m，Kt>2 高风险圈带约在 r≤${e.riskRadius.toFixed(1)} m。`}),Ft=p(()=>{const e=Te.value;return`关键结论：最新后验概率 ${e.p[e.p.length-1].toFixed(3)}，达到0.6报警阈值的时间片数量为 ${e.alertCount}。`}),lt=p(()=>{const e=Me.value,t=e.gain.reduce((l,i,d,_)=>i>_[l]?d:l,0);return`关键结论：最大增益指标为 ${e.categories[t]}（+${e.gain[t].toFixed(2)}）。`}),Ve=p(()=>{const e=ot.value,t=e.drop.reduce((l,i,d,_)=>i>_[l]?d:l,0);return`关键结论：${e.categories[t]} 对整体性能贡献最大（移除后下降 ${e.drop[t].toFixed(2)} 分）。`}),We=p(()=>`关键结论：ECE=${yt.value.toFixed(4)}，有效分箱 ${nt.value.centers.length} 个。`),st=p(()=>{const e=Ze.value,t=Y.value,l=t?`，95%CI=[${t.aucLow.toFixed(3)}, ${t.aucHigh.toFixed(3)}]`:"";return`关键结论：AUC=${De.value.toFixed(3)}${l}，最优阈值≈${e.threshold.toFixed(3)}（TPR=${e.recall.toFixed(2)}, FPR=${e.fpr.toFixed(2)}）。`}),Pt=p(()=>{const e=vt.value,t=Y.value,l=t?`，95%CI=[${t.prAucLow.toFixed(3)}, ${t.prAucHigh.toFixed(3)}]`:"";return`关键结论：PR-AUC=${Ee.value.toFixed(3)}${l}，最佳F1=${e.f1.toFixed(3)} 对应阈值≈${e.threshold.toFixed(3)}。`}),Be=p(()=>{const e=ht.value;return`关键结论：Accuracy=${(e.accuracy*100).toFixed(1)}%，Precision=${(e.precision*100).toFixed(1)}%，Recall=${(e.recall*100).toFixed(1)}%。`}),Ke=e=>{var l;const t=String(((l=e==null?void 0:e.data)==null?void 0:l.label)||(e==null?void 0:e.name)||"").toUpperCase();(t==="TP"||t==="TN"||t==="FP"||t==="FN")&&ke("matrix-select",t.toLowerCase())},St=p(()=>{const e=gt.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.orange,v.red],animationDuration:350,grid:ce,legend:A,toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("层位",!1)),{data:e.layers,nameGap:30}),yAxis:[K(Z({},u("稳定度 / 置信区间 (%)",!0)),{min:0,max:100}),K(Z({},u("损伤占比 (%)",!0)),{min:0,max:100})],series:[{name:"CI下界",type:"line",stack:"rsi_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"rsi_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.14)"}},{name:"稳定度",type:"line",data:e.stability,smooth:!0,symbolSize:7,lineStyle:{width:2.5,color:v.blue},itemStyle:{color:v.blue},markLine:{symbol:"none",label:{formatter:"预警阈值 60%",color:"#7f1d1d",fontFamily:ge,fontSize:10},lineStyle:{type:"dashed",color:"#b91c1c",width:1.2},data:[{yAxis:60}]},markPoint:{symbol:"circle",symbolSize:44,label:{color:"#111827",fontFamily:ge,fontSize:10,formatter:"最低层"},itemStyle:{color:"#fee2e2",borderColor:"#b91c1c",borderWidth:1.2},data:[{coord:[e.minIdx,e.stability[e.minIdx]]}]}},{name:"损伤占比",type:"bar",yAxisIndex:1,data:e.damage,barWidth:14,itemStyle:{color:v.orange,opacity:.75}}]}}),_t=p(()=>{const e=bt.value;return{color:[v.orange,v.cyan,v.red],animationDuration:350,grid:ce,legend:A,toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("时间窗",!1)),{data:e.windows,nameGap:30}),yAxis:[K(Z({},u("能量释放 / 平滑能量 (a.u.)",!0)),{min:0}),K(Z({},u("事件频次 / 累计风险 (%)",!0)),{min:0,max:110})],series:[{name:"能量释放",type:"bar",data:e.energy,barWidth:14,itemStyle:{color:v.orange,opacity:.82},markPoint:{symbol:"pin",symbolSize:34,data:[{name:"峰值",coord:[e.peakIdx,e.energy[e.peakIdx]]}],label:{formatter:"峰值",fontSize:10,color:"#111827"}}},{name:"平滑能量",type:"line",data:e.smooth,smooth:!0,symbolSize:5,lineStyle:{width:2,color:v.cyan}},{name:"事件频次",type:"line",yAxisIndex:1,data:e.eventRate,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.slate}},{name:"累计风险",type:"line",yAxisIndex:1,data:e.cumulativeRisk,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red}}]}}),Tt=p(()=>{const e=xt.value;return{color:[v.blue,v.red,v.purple],animationDuration:350,grid:{left:64,right:54,top:46,bottom:62},legend:A,toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("径向距离 r (m)",!0)),{min:2,max:10}),yAxis:[K(Z({},u("应力 (MPa)",!0)),{min:0,max:50}),K(Z({},u("应力集中系数 Kt",!0)),{min:1,max:4.5,position:"right"})],series:[{name:"径向应力 σr",type:"line",data:e.dist.map((t,l)=>[t,e.radial[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.2,color:v.blue}},{name:"切向应力 σθ",type:"line",data:e.dist.map((t,l)=>[t,e.tangential[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.4,color:v.red},markPoint:{symbol:"circle",symbolSize:40,itemStyle:{color:"#fee2e2",borderColor:v.red,borderWidth:1.2},label:{formatter:"峰值",fontSize:10,color:"#111827"},data:[{coord:[e.dist[e.peakIdx],e.tangential[e.peakIdx]]}]}},{name:"Kt=σθ/σr",type:"line",yAxisIndex:1,data:e.dist.map((t,l)=>[t,e.kt[l]]),smooth:!0,symbolSize:5,lineStyle:{width:1.9,type:"dashed",color:v.purple},markLine:{symbol:"none",label:{formatter:"Kt=2",color:v.purple,fontFamily:ge,fontSize:10},lineStyle:{color:v.purple,width:1.1,type:"dashed"},data:[{yAxis:2}]}}]}}),kt=p(()=>{const e=Te.value;return{color:[v.blue,"rgba(29,78,216,0.18)",v.red],animationDuration:350,grid:ce,legend:A,toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("时间片",!1)),{data:e.labels,nameGap:30}),yAxis:K(Z({},u("高风险后验概率",!0)),{min:0,max:1}),series:[{name:"CI下界",type:"line",stack:"dbn_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"dbn_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.18)"}},{name:"后验概率",type:"line",data:e.p,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:v.red},itemStyle:{color:v.red},markLine:{symbol:"none",lineStyle:{type:"dashed",width:1.15},data:[{yAxis:.3,name:"关注阈值",lineStyle:{color:v.orange}},{yAxis:.6,name:"报警阈值",lineStyle:{color:v.red}}]}}]}}),rt=p(()=>{const e=Me.value;return{color:[v.cyan,v.slate,v.red],animationDuration:350,grid:{left:74,right:54,top:46,bottom:66},legend:A,toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("指标",!1)),{data:e.categories,nameGap:30}),yAxis:[K(Z({},u("归一化分数",!0)),{min:0,max:100}),K(Z({},u("增益(新-基线)",!0)),{min:Math.min(...e.gain)-2,max:Math.max(...e.gain)+2,position:"right"})],series:[{name:"新算法",type:"bar",data:e.newScores,barWidth:14,itemStyle:{color:v.cyan}},{name:"基线算法",type:"bar",data:e.baseScores,barWidth:14,itemStyle:{color:v.slate,opacity:.85}},{name:"增益",type:"line",yAxisIndex:1,data:e.gain,symbol:"diamond",symbolSize:8,lineStyle:{width:2.2,color:v.red},label:{show:!0,position:"top",color:v.red,fontFamily:ge,fontSize:10,formatter:({value:t})=>`+${Number(t).toFixed(2)}`}}]}}),He=p(()=>{const e=ot.value,t=e.drop.reduce((l,i,d,_)=>i>_[l]?d:l,0);return{color:[v.green,v.red,v.orange],animationDuration:350,grid:{left:66,right:52,top:46,bottom:64},legend:A,toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("模型版本",!1)),{data:e.categories,nameGap:30}),yAxis:[K(Z({},u("性能分数 (AUC×100)",!0)),{min:40,max:100}),K(Z({},u("下降分数 / 贡献(%)",!0)),{min:0,max:Math.max(...e.drop,...e.contribution)+8,position:"right"})],series:[{name:"性能分数",type:"bar",data:e.score,barWidth:16,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,formatter:({value:l})=>Number(l).toFixed(1)}},{name:"下降分数",type:"line",yAxisIndex:1,data:e.drop,symbolSize:8,lineStyle:{width:2,color:v.red},itemStyle:{color:v.red},markPoint:{symbol:"pin",symbolSize:34,data:[{coord:[t,e.drop[t]],name:"最大下降"}],label:{formatter:"最大下降",fontSize:10,color:"#111827"}}},{name:"贡献率(%)",type:"line",yAxisIndex:1,data:e.contribution,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:v.orange}}]}}),Ge=p(()=>{const e=nt.value,t=Math.max(...e.count,1);return{color:[v.blue,"rgba(29,78,216,0.2)","#94a3b8",v.cyan],animationDuration:350,grid:{left:66,right:54,top:46,bottom:62},legend:A,toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("预测概率",!0)),{min:0,max:1,interval:.1}),yAxis:[K(Z({},u("真实频率",!0)),{min:0,max:1,interval:.1}),K(Z({},u("样本数",!0)),{min:0,max:t+2,position:"right"})],series:[{name:"理想校准线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.4,type:"dashed",color:"#94a3b8"}},{name:"CI下界",type:"line",stack:"cal_ci",data:e.centers.map((l,i)=>[l,e.lower[i]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"cal_ci",data:e.centers.map((l,i)=>[l,e.band[i]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.15)"}},{name:"校准曲线",type:"line",data:e.centers.map((l,i)=>[l,e.obs[i]]),smooth:!0,symbolSize:7,lineStyle:{width:2.4,color:v.blue},itemStyle:{color:v.blue}},{name:"分箱样本数",type:"bar",yAxisIndex:1,data:e.centers.map((l,i)=>[l,e.count[i]]),barWidth:18,itemStyle:{color:"#cbd5e1",opacity:.6}}],graphic:[{type:"text",right:26,top:18,style:{text:`ECE=${yt.value.toFixed(4)}`,font:`600 12px ${ge}`,fill:"#0f172a"}}]}}),it=p(()=>{const e=Ze.value,t=qe.value,l=he.value,i=Y.value,d=`ROC 曲线 (AUC=${De.value.toFixed(3)})`,_=i?`AUC 95%CI [${i.aucLow.toFixed(3)}, ${i.aucHigh.toFixed(3)}]`:"AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.blue,v.red],animationDuration:350,grid:ce,legend:K(Z({},A),{data:["随机参考线",d,"最优阈值点"]}),toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("假阳性率 FPR",!0)),{min:0,max:1,interval:.1}),yAxis:K(Z({},u("真阳性率 TPR",!0)),{min:0,max:1,interval:.1}),series:[{name:"随机参考线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__roc_ci_low__",type:"line",stack:"roc_ci",data:t.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__roc_ci_band__",type:"line",stack:"roc_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"ROC 95%CI下界",type:"line",data:t.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"ROC 95%CI上界",type:"line",data:t.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:d,type:"line",smooth:!0,data:z.value,symbolSize:5,lineStyle:{width:2.6,color:v.blue},areaStyle:{color:"rgba(29,78,216,0.12)"}},{name:"最优阈值点",type:"scatter",data:[[e.fpr,e.recall]],symbolSize:12,itemStyle:{color:v.red},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:v.red,formatter:`thr=${e.threshold.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:_,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),ut=p(()=>{const t=[];for(let l=1;l<=99;l+=1){const i=l/100,d=2*i-.6;if(d<=0)continue;const _=h(.6*i/d,0,1);_>0&&_<=1&&t.push([i,_])}return t}),At=p(()=>{const e=vt.value,t=Xe.value,l=et.value,i=Y.value,d=`PR 曲线 (PR-AUC=${Ee.value.toFixed(3)})`,_=i?`PR-AUC 95%CI [${i.prAucLow.toFixed(3)}, ${i.prAucHigh.toFixed(3)}]`:"PR-AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",v.orange,v.red,v.green],animationDuration:350,grid:ce,legend:K(Z({},A),{data:["基线(阳性占比)","F1=0.6 等值线",d,"最佳F1点"]}),toolbox:O,dataZoom:k,tooltip:{trigger:"axis"},xAxis:K(Z({},u("召回率 Recall",!0)),{min:0,max:1,interval:.1}),yAxis:K(Z({},u("精确率 Precision",!0)),{min:0,max:1,interval:.1}),series:[{name:"基线(阳性占比)",type:"line",data:[[0,oe.value],[1,oe.value]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__pr_ci_low__",type:"line",stack:"pr_ci",data:t.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__pr_ci_band__",type:"line",stack:"pr_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"PR 95%CI下界",type:"line",data:t.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"PR 95%CI上界",type:"line",data:t.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"F1=0.6 等值线",type:"line",data:ut.value,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:v.orange}},{name:d,type:"line",smooth:!0,data:ue.value,symbolSize:5,lineStyle:{width:2.6,color:v.red}},{name:"最佳F1点",type:"scatter",data:[[e.recall,e.precision]],symbolSize:12,itemStyle:{color:v.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:v.green,formatter:`F1=${e.f1.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:_,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),Ue=p(()=>{const e=ft.value,t=Math.max(e.tp+e.tn+e.fp+e.fn,1),l=[{value:[0,0,e.tn,e.tn/t],label:"TN"},{value:[1,0,e.fp,e.fp/t],label:"FP"},{value:[0,1,e.fn,e.fn/t],label:"FN"},{value:[1,1,e.tp,e.tp/t],label:"TP"}],i=ht.value;return{animationDuration:350,grid:{left:76,right:120,top:38,bottom:66},toolbox:K(Z({},O),{feature:{restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}}),tooltip:{trigger:"item",formatter:({data:d})=>`${d.label}：${d.value[2]} (${(d.value[3]*100).toFixed(1)}%)`},xAxis:K(Z({},u("预测类别",!1)),{data:["低风险","高风险"],nameGap:34,splitLine:{show:!1}}),yAxis:K(Z({},u("真实类别",!1)),{data:["低风险","高风险"],nameGap:54,splitLine:{show:!1}}),visualMap:{min:0,max:Math.max(e.tp,e.tn,e.fp,e.fn,1),orient:"vertical",right:18,top:"middle",text:["高","低"],textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"},inRange:{color:["#ecfeff","#67e8f9","#0e7490"]}},series:[{name:"混淆矩阵",type:"heatmap",data:l,label:{show:!0,color:"#0f172a",fontFamily:ge,fontSize:11,formatter:({data:d})=>`${d.label}
${d.value[2]}
${(d.value[3]*100).toFixed(1)}%`},itemStyle:{borderWidth:1,borderColor:"#e2e8f0"}}],graphic:[{type:"group",right:10,bottom:8,children:[{type:"text",top:0,style:{text:`Acc ${(i.accuracy*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:16,style:{text:`Prec ${(i.precision*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:32,style:{text:`Rec ${(i.recall*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:48,style:{text:`Spec ${(i.specificity*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}}]}]}});return(e,t)=>(te(),ne("section",Kn,[o("header",Jn,[t[0]||(t[0]=o("div",{class:"head-title"},[o("h4",null,"SCI 配图增强版（图2-图11）"),o("p",null,"统一采用期刊风格坐标系、阈值注记、置信区间和关键决策点标注。")],-1)),o("div",Qn,[o("span",eo,"样本 n="+f(j.value),1),o("span",to,"正样本占比 "+f(P(oe.value)),1),Y.value?(te(),ne("span",no,"Bootstrap "+f(Y.value.iterations)+"次",1)):xe("",!0),o("span",{class:Qe(["metric-chip",{warn:M.value!=="real_label_stream"}])},"评估源 "+f(le.value),3),H.value?(te(),ne("span",oo,"标签文件 "+f(H.value),1)):xe("",!0)])]),o("article",ao,[t[1]||(t[1]=o("h4",null,"图2 | RSI 机制剖面图（稳定度-损伤-置信带）",-1)),Ne(Pe,{option:St.value,height:336},null,8,["option"]),t[2]||(t[2]=o("p",{class:"caption"},"怎么看：稳定度实线越高越好，误差带越窄代表层位响应更稳定，损伤柱越低越好。",-1)),o("p",lo,f(at.value),1)]),o("article",so,[t[3]||(t[3]=o("h4",null,"图3 | BRI 微震能量释放、事件频次与累计风险",-1)),Ne(Pe,{option:_t.value,height:336},null,8,["option"]),t[4]||(t[4]=o("p",{class:"caption"},"怎么看：能量柱与事件频次线共同识别冲击窗口，累计风险线反映风险积聚过程。",-1)),o("p",ro,f(wt.value),1)]),o("article",io,[t[5]||(t[5]=o("h4",null,"图4 | ASI 径向/切向应力与应力集中系数 Kt",-1)),Ne(Pe,{option:Tt.value,height:336},null,8,["option"]),t[6]||(t[6]=o("p",{class:"caption"},"怎么看：切向应力峰值与 Kt>2 区段对应高风险圈带，径向应力反映卸压后衰减。",-1)),o("p",uo,f(Rt.value),1)]),o("article",co,[t[7]||(t[7]=o("h4",null,"图5 | DBN 后验概率时序（95% CI + 预警阈值）",-1)),Ne(Pe,{option:kt.value,height:336},null,8,["option"]),t[8]||(t[8]=o("p",{class:"caption"},"怎么看：后验概率曲线跨过 0.6 报警阈值时需触发强化巡检，CI 带越窄越可信。",-1)),o("p",mo,f(Ft.value),1)]),o("article",po,[t[9]||(t[9]=o("h4",null,"图6 | 新旧算法多指标对比（分数 + 增益）",-1)),Ne(Pe,{option:rt.value,height:336},null,8,["option"]),t[10]||(t[10]=o("p",{class:"caption"},"怎么看：柱形给出绝对分数，增益折线给出替代旧算法的实际收益幅度。",-1)),o("p",vo,f(lt.value),1)]),o("article",yo,[t[11]||(t[11]=o("h4",null,"图7 | 消融实验（模块贡献与性能下降）",-1)),Ne(Pe,{option:He.value,height:336},null,8,["option"]),t[12]||(t[12]=o("p",{class:"caption"},"怎么看：去除模块后的性能下降越大，说明该模块对总体性能贡献越关键。",-1)),o("p",fo,f(Ve.value),1)]),o("article",ho,[t[13]||(t[13]=o("h4",null,"图8 | 校准曲线（含样本直方图与置信区间）",-1)),Ne(Pe,{option:Ge.value,height:336},null,8,["option"]),t[14]||(t[14]=o("p",{class:"caption"},"怎么看：曲线贴近对角线且 ECE 越低，模型概率输出越可直接用于阈值决策。",-1)),o("p",go,f(We.value),1)]),o("article",bo,[t[15]||(t[15]=o("h4",null,"图9 | ROC 曲线（最优阈值点与 AUC）",-1)),Ne(Pe,{option:it.value,height:336},null,8,["option"]),t[16]||(t[16]=o("p",{class:"caption"},"怎么看：曲线越靠左上角越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，红点为 Youden 最优阈值。",-1)),o("p",xo,f(st.value),1)]),o("article",wo,[t[17]||(t[17]=o("h4",null,"图10 | PR 曲线（基线、F1 等值线与最优点）",-1)),Ne(Pe,{option:At.value,height:336},null,8,["option"]),t[18]||(t[18]=o("p",{class:"caption"},"怎么看：PR 曲线整体越高越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，绿点为最佳F1运行点。",-1)),o("p",So,f(Pt.value),1)]),o("article",_o,[t[19]||(t[19]=o("h4",null,"图11 | 混淆矩阵热图（计数 + 占比 + 诊断指标）",-1)),Ne(Pe,{option:Ue.value,height:336,onChartClick:Ke},null,8,["option"]),t[20]||(t[20]=o("p",{class:"caption"},"怎么看：对角线高、非对角低为理想状态；右侧指标用于误报/漏报成本权衡。",-1)),o("p",ko,f(Be.value),1)])]))}},Mo=Et(Ao,[["__scopeId","data-v-f81ec0ce"]]),Co={class:"top-nav"},No={class:"nav-left"},Io={class:"seam-select"},$o=["value"],Ro={key:0,class:"mini-stats"},Fo={class:"danger"},Po={class:"nav-right"},To=["disabled"],Lo=["disabled"],zo={class:"metric-dashboard"},Do=["onClick"],Eo={class:"head"},Bo={class:"value"},Uo={class:"meta"},Oo={class:"main-layout"},Vo={class:"main-canvas-card"},Wo={class:"canvas-head"},Ho={class:"canvas-controls"},Go={class:"check"},jo={class:"check"},Yo={key:0,class:"trust-banner"},qo={class:"trust-chip warn"},Xo={key:0,class:"trust-chip link"},Zo={key:1,class:"trust-meta"},Ko={class:"trust-meta"},Jo={key:0,class:"loading-mask"},Qo={class:"legend-wrap"},ea={class:"legend-labels"},ta={class:"thumb-list"},na=["onClick","onMouseenter","onMousemove"],oa={class:"thumb-meta"},aa={key:0,class:"floating-panel"},la={class:"weight-row"},sa={class:"weight-row"},ra={class:"weight-row"},ia={key:0,class:"eval-drawer"},ua={class:"actions"},ca={key:0,class:"panel-empty"},da={key:1,class:"panel-empty"},ma={class:"eval-grid"},pa={class:"metric"},va={class:"metric"},ya={class:"metric"},fa={class:"metric"},ha={class:"metric"},ga={class:"eval-content"},ba={class:"cm-card"},xa={class:"cm-grid"},wa={class:"cm-cell"},Sa={class:"cm-cell warn"},_a={class:"cm-cell warn"},ka={class:"cm-cell"},Aa={class:"baseline-card"},Ma={viewBox:"0 0 560 170",class:"baseline-svg"},Ca=["width"],Na={x:"485",y:"26"},Ia=["width"],$a={x:"485",y:"90"},Ra={key:0,class:"science-section"},Fa={class:"data-note"},Pa={key:1,class:"export-note"},Ta={class:"risk"},La={__name:"AlgorithmValidation",setup(g){const X=Bn(),x=En(),{workspaceState:ke,setSelectedSeam:v,markStepDone:ce}=Hn(),h=[{key:"mpi",label:"MPI",desc:"综合指标"},{key:"rsi",label:"RSI",desc:"顶板稳定"},{key:"bri",label:"BRI",desc:"冲击风险"},{key:"asi",label:"ASI",desc:"支承应力"}],U={tp:{label:"TP 真阳性",color:"#15803d"},tn:{label:"TN 真阴性",color:"#1d4ed8"},fp:{label:"FP 假阳性",color:"#d97706"},fn:{label:"FN 假阴性",color:"#b91c1c"}},P=ee(null),s=ee(null),y=ee(null),u=ee(null),A=ee(null),O=ee([]),k=ee(""),I=ee(50),M=ee(9),H=ee("idw"),le=ee(!0),V=ee(!0),j=ee("mpi"),de=ee(!1),me=ee(!1),oe=ee(!1),pe=ee(!0),be=ee(!1),W=Nt({rsi:.4,bri:.35,asi:.25}),C=Dn(null),z=ee(null),ue=ee(!1),fe=ee(""),re=ee(!1),we=ee(""),J=ee(null),Ie=Nt({x:0,y:0}),ye=Nt({visible:!1,metric:"",x:0,y:0}),Y=ee("pseudo_threshold"),qe=ee(""),he=ee("all"),Xe=ee(!1),et={},tt=new Map,{viewport:pt,worldToScreen:Ze,screenToWorld:vt,fitToBounds:It,startDrag:nt,dragTo:De,endDrag:Ee,zoomAt:$t}=jn(),{getLegendGradient:yt,drawGrid:ft,drawBoreholes:ht,pickNearestBorehole:gt,sampleGridValue:bt,drawMiniHeatmap:xt}=Xn(),Te=p(()=>{const a=W.rsi+W.bri+W.asi||1;return{rsi:W.rsi/a,bri:W.bri/a,asi:W.asi/a}}),Me=p(()=>{var a,n,c;return!!((a=C.value)!=null&&a.grids&&((n=C.value)!=null&&n.statistics)&&((c=C.value)!=null&&c.boreholes))}),ot=p(()=>{var a,n;return((n=(a=C.value)==null?void 0:a.statistics)==null?void 0:n[j.value])||{}}),at=p(()=>{var a,n,c;return Number(((c=(n=(a=C.value)==null?void 0:a.statistics)==null?void 0:n.mpi)==null?void 0:c.mean)||0)}),wt=p(()=>Math.max(0,at.value-4.5)),Rt=p(()=>F(j.value)),Ft=p(()=>Y.value==="real_label_stream"?"真实标签流":Y.value==="pseudo_threshold"?"伪标签估计（阈值构造）":Y.value==="none"?"无可评估样本":"未知来源"),lt=p(()=>{var a,n;return V.value?{min:0,mean:50,max:100}:((n=(a=C.value)==null?void 0:a.statistics)==null?void 0:n[j.value])||{min:0,mean:0,max:0}}),Ve=p(()=>{var n,c,b,r;const a={};for(const S of h){const w=((c=(n=C.value)==null?void 0:n.statistics)==null?void 0:c[S.key])||{},R=(r=(b=C.value)==null?void 0:b.grids)==null?void 0:r[S.key];let $=0,ie=0,ve=0,q=Number.POSITIVE_INFINITY,Se=Number.NEGATIVE_INFINITY;if(Array.isArray(R))for(const je of R)for(const Je of je||[]){const _e=Number(Je);Number.isFinite(_e)&&($+=1,ie+=_e,ve+=_e*_e,_e<q&&(q=_e),_e>Se&&(Se=_e))}const Ae=$?ie/$:Number(w.mean||0),Re=$?Math.max(ve/$-Ae*Ae,0):0;a[S.key]={min:Number.isFinite(Number(w.min))?Number(w.min):$?q:0,max:Number.isFinite(Number(w.max))?Number(w.max):$?Se:0,mean:Ae,std:Math.sqrt(Re)}}return a}),We=p(()=>Ve.value[ye.metric]||null),st=p(()=>{var q,Se,Ae,Re,je,Je,_e,ct;if(!Me.value)return null;const a=Ve.value,n=((q=C.value)==null?void 0:q.boreholes)||[],c=Mt(),b=Number(((Se=a.mpi)==null?void 0:Se.mean)||0),r=Math.max(0,b-4.5),S=r>0?(b-r)/r*100:0,w=n.length||1,R=F("mpi")/w,$=i(1-b/100,0,1),ie=i(Number(((Ae=z.value)==null?void 0:Ae.auc)||.7)-.5,0,.45),ve=["t-4","t-3","t-2","t-1","t"].map((Oe,Lt)=>({t:Oe,high_risk_prob:i($+(Lt-2)*.05+ie*.2,.05,.95)}));return{modules:{rsi:{value:Number(((Re=a.rsi)==null?void 0:Re.mean)||0),input_layers:6},bri:{value:Number(((je=a.bri)==null?void 0:je.mean)||0),event_count:n.length,avg_magnitude:2.6},asi:{value:Number(((Je=a.asi)==null?void 0:Je.mean)||0),avg_friction_angle:31.2}},fusion:{mpi:b,baseline:{mpi:r},dynamic_weights:Te.value},kpi:{mpi_mean:b,high_risk_ratio:R,auc:Number(((_e=z.value)==null?void 0:_e.auc)||.7),brier_score:Number(((ct=z.value)==null?void 0:ct.brier)||.24),improvement_vs_baseline_pct:S},figures:{fig5_dbn:{posterior:ve}},evaluation_inputs:c}}),Pt=a=>{var n;return((n=U[String(a||"").toLowerCase()])==null?void 0:n.label)||"全部"},Be=p(()=>{var w,R;const a=((w=C.value)==null?void 0:w.boreholes)||[],n=((R=st.value)==null?void 0:R.evaluation_inputs)||{},c=Array.isArray(n.y_true)?n.y_true:Array.isArray(n.yTrue)?n.yTrue:[],b=Array.isArray(n.y_prob)?n.y_prob:Array.isArray(n.yProb)?n.yProb:[];if(!a.length||c.length!==a.length||b.length!==a.length)return{available:!1,roles:[],counts:{tp:0,tn:0,fp:0,fn:0}};const r=[],S={tp:0,tn:0,fp:0,fn:0};for(let $=0;$<a.length;$+=1){const ie=Number(c[$])>=1?1:0,ve=Number(b[$])>=.5?1:0,q=ie===1?ve===1?"tp":"fn":ve===1?"fp":"tn";r.push(q),S[q]+=1}return{available:!0,roles:r,counts:S}}),Ke=p(()=>Be.value.available),St=p(()=>{var n;if(he.value==="all")return 0;const a=String(he.value).toLowerCase();return Number(((n=Be.value.counts)==null?void 0:n[a])||0)}),_t=p(()=>{const a=String(he.value||"").toLowerCase();if(!Be.value.available||!["tp","tn","fp","fn"].includes(a))return[];const n=[];for(let c=0;c<Be.value.roles.length;c+=1)Be.value.roles[c]===a&&n.push(c);return n}),Tt=p(()=>new Set(_t.value)),kt=p(()=>{var n;const a=String(he.value||"").toLowerCase();return["tp","tn","fp","fn"].includes(a)?{active:!0,indexSet:Tt.value,accent:((n=U[a])==null?void 0:n.color)||"#111827"}:null}),rt=p(()=>he.value!=="all"&&Ke.value&&!Xe.value);let He=0,Ge=0,it=null,ut=null;const At=()=>{window.clearTimeout(it),it=window.setTimeout(()=>{ae(),m(),L(),$e()},80)},Ue=a=>{var n;return((n=h.find(c=>c.key===a))==null?void 0:n.label)||a.toUpperCase()},e=a=>yt(a),t=(a,n=2)=>a==null||Number.isNaN(Number(a))?"--":Number(a).toFixed(n),l=a=>`${(Number(a||0)*100).toFixed(0)}%`,i=(a,n,c)=>Math.max(n,Math.min(c,a)),d=a=>{const n=String(a||"").toLowerCase();return n.includes("high")||n.includes("高")?"高风险":n.includes("medium")||n.includes("中")?"中风险":n.includes("low")||n.includes("低")?"低风险":"未知"},_=a=>`${i(Number(a||0),0,100)*3.6}`,F=a=>{var n;return(((n=C.value)==null?void 0:n.boreholes)||[]).filter(c=>Number(c[a])<50).length},E=a=>{var n,c;return V.value?{min:0,mean:50,max:100}:((c=(n=C.value)==null?void 0:n.statistics)==null?void 0:c[a])||{min:0,mean:0,max:0}},G=()=>{const a=Number(M.value);M.value=Number.isFinite(a)?Math.max(5,Math.min(24,Math.round(a))):9},T=(a,n,c)=>{if(!Array.isArray(c)||c.length===0)return{borehole:null,distance:null};let b=null,r=Number.POSITIVE_INFINITY;for(const S of c){const w=Number(S.x)-a,R=Number(S.y)-n,$=Math.hypot(w,R);$<r&&(r=$,b=S)}return{borehole:b,distance:Number.isFinite(r)?r:null}},N=()=>{const a=Te.value;return[k.value,I.value,H.value,a.rsi.toFixed(3),a.bri.toFixed(3),a.asi.toFixed(3)].join("|")},B=a=>n=>{n?(et[a]=n,$e()):delete et[a]},ae=()=>{if(!s.value||!u.value||!A.value)return;const a=s.value.getBoundingClientRect(),n=window.devicePixelRatio||1,c=Math.max(1,Math.floor(a.width*n)),b=Math.max(1,Math.floor(a.height*n));for(const r of[u.value,A.value])r.width=c,r.height=b},m=()=>{var n;const a=(n=C.value)==null?void 0:n.bounds;!a||!u.value||(It(a,u.value.width,u.value.height,62),L())},D=(a,n,c)=>{const b=String(he.value||"").toLowerCase();if(!["tp","tn","fp","fn"].includes(b)||!Be.value.available)return;const r=U[b],S=_t.value;S.length&&(a.save(),a.fillStyle="rgba(15, 23, 42, 0.88)",a.fillRect(12,10,250,28),a.fillStyle="#f8fafc",a.font="600 12px 'Noto Sans SC', 'Segoe UI', sans-serif",a.fillText(`联动筛选: ${r.label} (${S.length})  Esc清除`,22,29),a.restore())},se=()=>{var w,R,$;if(He=0,!u.value||!A.value)return;const a=C.value,n=u.value.getContext("2d"),c=A.value.getContext("2d");if(n.clearRect(0,0,u.value.width,u.value.height),c.clearRect(0,0,A.value.width,A.value.height),!a)return;const b=j.value,r=E(b);ft(n,(w=a.grids)==null?void 0:w[b],a.bounds,pt,b,r,Ze,{showContours:le.value,contourLevels:M.value});const S=kt.value?K(Z({},kt.value),{animate:rt.value,pulseT:performance.now()/1e3}):null;ht(c,a.boreholes,b,r,a.bounds,Ze,(($=(R=J.value)==null?void 0:R.borehole)==null?void 0:$.borehole_name)||"",S),D(c,a.boreholes||[],a.bounds),J.value&&(c.strokeStyle="rgba(15, 23, 42, 0.55)",c.lineWidth=1.1,c.setLineDash([5,4]),c.beginPath(),c.moveTo(J.value.sx,0),c.lineTo(J.value.sx,A.value.height),c.moveTo(0,J.value.sy),c.lineTo(A.value.width,J.value.sy),c.stroke(),c.setLineDash([])),rt.value&&L()},Q=()=>{var n;Ge=0;const a=C.value;if(a)for(const c of h){const b=et[c.key];b&&xt(b,(n=a.grids)==null?void 0:n[c.key],c.key,E(c.key))}},L=()=>{He||(He=window.requestAnimationFrame(se))},$e=()=>{Ge||(Ge=window.requestAnimationFrame(Q))},Mt=()=>{var r,S;const a=(r=C.value)==null?void 0:r.evaluation_inputs;if((a==null?void 0:a.mode)==="real_label_stream"){const w=Array.isArray(a.y_true)?a.y_true:[],R=Array.isArray(a.y_prob)?a.y_prob:[];if(w.length===R.length&&w.length>=2){const $=w.map(q=>Number(q)>=1?1:0),ie=R.map(q=>i(Number(q),0,1));if(ie.every(q=>Number.isFinite(q))&&new Set($).size>1)return{mode:"real_label_stream",source:String(a.source||""),sourceFile:String(a.source||""),y_true:$,y_prob:ie,yTrue:$,yProb:ie}}}const n=((S=C.value)==null?void 0:S.boreholes)||[];if(n.length<4)return null;let c=n.map(w=>w.rsi<50||w.bri<50||w.asi<50?1:0);const b=n.map(w=>i(1-Number(w.mpi||0)/100,0,1));if(new Set(c).size<2){const w=n.map($=>Number($.mpi||0)).sort(($,ie)=>$-ie),R=w[Math.floor(w.length/2)];c=n.map($=>Number($.mpi||0)<=R?1:0)}return{mode:"pseudo_threshold",source:"",sourceFile:"",y_true:c,y_prob:b,yTrue:c,yProb:b}},sn=()=>Ce(this,null,function*(){var n,c;const a=Mt();if(!a){Y.value="none",qe.value="",z.value=null,fe.value="当前煤层钻孔点不足，无法计算评估指标。";return}Y.value=a.mode||"pseudo_threshold",qe.value=a.sourceFile||"",ue.value=!0,fe.value="";try{const b=yield Wn({y_true:a.y_true||a.yTrue,y_prob:a.y_prob||a.yProb});z.value=b.data}catch(b){z.value=null,fe.value=((c=(n=b==null?void 0:b.response)==null?void 0:n.data)==null?void 0:c.detail)||"评估指标计算失败"}finally{ue.value=!1}}),Bt=a=>Ce(this,null,function*(){C.value=a,J.value=null,he.value="all",yield an(),ae(),m(),L(),$e(),sn()}),Ct=(...n)=>Ce(this,[...n],function*({force:a=!1}={}){var b,r;if(!k.value)return;const c=N();if(!a&&tt.has(c)){yield Bt(tt.get(c));return}de.value=!0;try{const w=(yield Vn(k.value,I.value,H.value,Te.value)).data;tt.set(c,w),yield Bt(w),ce("AlgorithmValidation",{validationReady:!0})}catch(S){fe.value=((r=(b=S==null?void 0:S.response)==null?void 0:b.data)==null?void 0:r.detail)||"空间总览加载失败"}finally{de.value=!1}}),rn=a=>{const n=String(a||"").toLowerCase();["tp","tn","fp","fn"].includes(n)&&Ke.value&&(he.value=he.value===n?"all":n,L())},Ut=()=>{he.value="all",L()},Ot=a=>{a.key==="Escape"&&he.value!=="all"&&Ut()},un=a=>{Me.value&&nt(a.clientX,a.clientY)},cn=a=>{var ve,q,Se,Ae,Re;if(!A.value||!Me.value)return;const n=A.value.getBoundingClientRect(),c=window.devicePixelRatio||1,b=(a.clientX-n.left)*c,r=(a.clientY-n.top)*c;if(Ie.x=a.clientX-n.left,Ie.y=a.clientY-n.top,pt.isDragging){De(a.clientX,a.clientY),L();return}const S=(ve=C.value)==null?void 0:ve.bounds,w=vt(b,r,S),R=j.value,$=T(w.x,w.y,((q=C.value)==null?void 0:q.boreholes)||[]),ie=gt(b,r,((Se=C.value)==null?void 0:Se.boreholes)||[],S,Ze);J.value={sx:b,sy:r,worldX:w.x,worldY:w.y,gridValue:bt((Re=(Ae=C.value)==null?void 0:Ae.grids)==null?void 0:Re[R],S,w.x,w.y),borehole:ie,nearestBorehole:$.borehole,nearestDistance:$.distance},L()},dn=()=>Ee(),mn=()=>{Ee(),J.value=null,L()},pn=a=>{var S;if(!A.value||!Me.value)return;const n=A.value.getBoundingClientRect(),c=window.devicePixelRatio||1,b=(a.clientX-n.left)*c,r=(a.clientY-n.top)*c;$t(a.deltaY<0?1.14:.88,b,r,(S=C.value)==null?void 0:S.bounds),L()},vn=(a,n)=>{ye.metric=a,Vt(a,n)},Vt=(a,n)=>{if(!y.value)return;const c=y.value.getBoundingClientRect();ye.visible=!0,ye.metric=a,ye.x=n.clientX-c.left,ye.y=n.clientY-c.top},yn=()=>{ye.visible=!1},Wt=a=>String(a||"figure").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),Ht=(a,n="image/png",c=1)=>new Promise((b,r)=>{a.toBlob(S=>{S?b(S):r(new Error("Canvas 导出失败"))},n,c)}),fn=a=>{const n=a.cloneNode(!0);return n.getAttribute("xmlns")||n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.getAttribute("xmlns:xlink")||n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),new XMLSerializer().serializeToString(n)},hn=(a,n,c,b=3)=>Ce(this,null,function*(){const r=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),S=URL.createObjectURL(r);try{const w=yield new Promise((ie,ve)=>{const q=new Image;q.onload=()=>ie(q),q.onerror=()=>ve(new Error("SVG 转 PNG 失败")),q.src=S}),R=document.createElement("canvas");R.width=Math.max(1,Math.round(n*b)),R.height=Math.max(1,Math.round(c*b));const $=R.getContext("2d");return $.fillStyle="#ffffff",$.fillRect(0,0,R.width,R.height),$.drawImage(w,0,0,R.width,R.height),yield Ht(R,"image/png",1)}finally{URL.revokeObjectURL(S)}}),gn=()=>new Promise(a=>window.requestAnimationFrame(a)),Gt=a=>Ce(this,null,function*(){const n=Xe.value;Xe.value=!0,se(),yield gn();try{return yield a()}finally{Xe.value=n,se(),rt.value&&L()}}),bn=()=>Ce(this,null,function*(){!u.value||!A.value||(yield Gt(()=>Ce(this,null,function*(){const n=u.value.width,c=u.value.height,b=document.createElement("canvas");b.width=Math.round(n*3),b.height=Math.round(c*3);const r=b.getContext("2d");r.scale(3,3),r.fillStyle="#ffffff",r.fillRect(0,0,n,c),r.drawImage(u.value,0,0),r.drawImage(A.value,0,0),r.fillStyle="rgba(15, 23, 42, 0.92)",r.font="14px 'Times New Roman', 'Noto Serif SC', serif",r.fillText(`煤层：${k.value||"--"} | 指标：${Ue(j.value)} | 分辨率：${I.value}`,16,26);const S=document.createElement("a");S.href=b.toDataURL("image/png",1),S.download=`algorithm_validation_${k.value||"seam"}_${j.value}_hd.png`,S.click()})))}),xn=()=>Ce(this,null,function*(){if(!(!P.value||!Me.value||re.value)){re.value=!0,we.value="";try{yield Gt(()=>Ce(this,null,function*(){var Se,Ae,Re;const a=new Un,n=new Date().toISOString().replace(/[:.]/g,"-"),c=document.createElement("canvas"),b=3,r=u.value.width,S=u.value.height;c.width=Math.round(r*b),c.height=Math.round(S*b);const w=c.getContext("2d");w.scale(b,b),w.fillStyle="#ffffff",w.fillRect(0,0,r,S),w.drawImage(u.value,0,0),w.drawImage(A.value,0,0),w.fillStyle="rgba(15, 23, 42, 0.92)",w.font="14px 'Times New Roman', 'Noto Serif SC', serif",w.fillText(`煤层：${k.value||"--"} | 指标：${Ue(j.value)} | 分辨率：${I.value}`,16,26),a.file("figures/main_heatmap_hd.png",yield Ht(c,"image/png",1));const R=P.value.querySelectorAll(".science-section .figure-card");let $=0;for(const je of R){$+=1;const Je=((Ae=(Se=je.querySelector("h4"))==null?void 0:Se.textContent)==null?void 0:Ae.trim())||`图${$}`,_e=je.querySelector(".science-chart svg");if(!_e)continue;const ct=_e.getBoundingClientRect(),Oe=(Re=_e.viewBox)==null?void 0:Re.baseVal,Lt=(Oe==null?void 0:Oe.width)||ct.width||960,Mn=(Oe==null?void 0:Oe.height)||ct.height||540,jt=fn(_e),Yt=Wt(`${String($).padStart(2,"0")}_${Je}`);a.file(`figures/${Yt}.svg`,jt),a.file(`figures/${Yt}.png`,yield hn(jt,Lt,Mn,3))}a.file("data/spatial_statistics.json",JSON.stringify(Ve.value,null,2)),a.file("data/evaluation.json",JSON.stringify(z.value||{},null,2)),a.file("data/science_result.json",JSON.stringify(st.value||{},null,2)),a.file("README.txt",["新算法实证图组导出包",`时间: ${new Date().toLocaleString()}`,`煤层: ${k.value||"--"}`,`主图指标: ${Ue(j.value)}`,"","内容说明:","- figures/: 主热力图和图2-图11（SVG+PNG）","- data/: 统计与评估原始数据"].join(`
`));const ie=yield a.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),ve=URL.createObjectURL(ie),q=document.createElement("a");q.href=ve,q.download=`新算法实证图组_${Wt(k.value||"seam")}_${n}.zip`,q.click(),URL.revokeObjectURL(ve)})),we.value="图组包导出完成。"}catch(a){we.value=(a==null?void 0:a.message)||"图组包导出失败"}finally{re.value=!1}}}),wn=()=>{if(!C.value)return;const a=new Blob([JSON.stringify(C.value,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),c=document.createElement("a");c.href=n,c.download=`algorithm_validation_${k.value||"seam"}_spatial.json`,c.click(),URL.revokeObjectURL(n)},Sn=()=>Ce(this,null,function*(){P.value&&(document.fullscreenElement?yield document.exitFullscreen():yield P.value.requestFullscreen())}),_n=a=>Array.isArray(a)?a[0]||"":typeof a=="string"?a:"",kn=()=>{x.push({name:"Report",query:k.value?{seam:k.value}:void 0})},An=()=>Ce(this,null,function*(){var a,n,c,b;try{const r=yield On(),S=((a=r==null?void 0:r.data)==null?void 0:a.seams)||[];if(O.value=S,S.length===0)return;const w=_n((n=X.query)==null?void 0:n.seam)||ke.selectedSeam||"16-3煤",R=S.find($=>$.name===w);k.value=(R==null?void 0:R.name)||S[0].name,v(k.value)}catch(r){fe.value=((b=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:b.detail)||"煤层列表加载失败"}});return ze(j,()=>L()),ze(le,()=>L()),ze(M,()=>{G(),L()}),ze(V,()=>{L(),$e()}),ze([I,H],()=>{me.value&&Ct({force:!1})}),ze(k,()=>{v(k.value||""),me.value&&Ct({force:!1})}),ze(Ke,a=>{!a&&he.value!=="all"&&(he.value="all",L())}),ze(()=>[W.rsi,W.bri,W.asi],()=>{me.value&&(window.clearTimeout(ut),ut=window.setTimeout(()=>Ct({force:!1}),300))}),on(()=>Ce(this,null,function*(){G(),yield An(),k.value&&(yield Ct({force:!0})),me.value=!0,window.addEventListener("resize",At),window.addEventListener("keydown",Ot)})),ln(()=>{window.clearTimeout(ut),window.clearTimeout(it),He&&window.cancelAnimationFrame(He),Ge&&window.cancelAnimationFrame(Ge),window.removeEventListener("resize",At),window.removeEventListener("keydown",Ot)}),(a,n)=>{var c,b;return te(),ne("div",{ref_key:"pageRoot",ref:P,class:"validation-page"},[o("nav",Co,[o("div",No,[o("button",{class:"icon-btn",type:"button",title:"返回",onClick:n[0]||(n[0]=r=>Ln(x).back())},[...n[15]||(n[15]=[o("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{d:"M19 12H5m0 0 6-6m-6 6 6 6"})],-1)])]),n[20]||(n[20]=o("h1",null,"新算法实证",-1)),n[21]||(n[21]=o("span",{class:"divider"},null,-1)),o("label",Io,[n[16]||(n[16]=o("span",null,"煤层",-1)),Le(o("select",{"onUpdate:modelValue":n[1]||(n[1]=r=>k.value=r)},[(te(!0),ne(Ye,null,zt(O.value,r=>(te(),ne("option",{key:r.name,value:r.name},f(r.name),9,$o))),128))],512),[[Kt,k.value]])]),Me.value?(te(),ne("div",Ro,[o("span",null,[n[17]||(n[17]=Fe("均值 ",-1)),o("b",null,f(t(ot.value.mean)),1)]),o("span",null,[n[18]||(n[18]=Fe("最低 ",-1)),o("b",null,f(t(ot.value.min)),1)]),o("span",Fo,[n[19]||(n[19]=Fe("高风险点 ",-1)),o("b",null,f(Rt.value),1)])])):xe("",!0)]),o("div",Po,[o("button",{class:Qe(["tool-btn",{active:oe.value}]),type:"button",onClick:n[2]||(n[2]=r=>oe.value=!oe.value)},"权重",2),o("button",{class:Qe(["tool-btn",{active:pe.value}]),type:"button",onClick:n[3]||(n[3]=r=>pe.value=!pe.value)},"评估",2),o("button",{class:"tool-btn",type:"button",onClick:bn},"导出高清图"),o("button",{class:"tool-btn",type:"button",disabled:re.value||!Me.value,onClick:xn},f(re.value?"打包中...":"导出图组包"),9,To),o("button",{class:"tool-btn",type:"button",disabled:!Me.value,onClick:kn},"下一步：结果报告",8,Lo),o("button",{class:"tool-btn",type:"button",onClick:Sn},"全屏")])]),o("section",zo,[(te(),ne(Ye,null,zt(h,r=>{var S,w,R,$,ie,ve,q,Se,Ae;return o("button",{key:r.key,class:Qe(["metric-card",{active:j.value===r.key}]),type:"button",onClick:Re=>j.value=r.key},[o("div",Eo,[o("strong",null,f(r.label),1),o("span",null,f(r.desc),1)]),o("div",Bo,f(t((R=(w=(S=C.value)==null?void 0:S.statistics)==null?void 0:w[r.key])==null?void 0:R.mean)),1),o("div",Uo,[o("span",null,"最低 "+f(t((ve=(ie=($=C.value)==null?void 0:$.statistics)==null?void 0:ie[r.key])==null?void 0:ve.min)),1),o("span",null,"最高 "+f(t((Ae=(Se=(q=C.value)==null?void 0:q.statistics)==null?void 0:Se[r.key])==null?void 0:Ae.max)),1)]),o("div",{class:"risk-bar",style:mt({background:e(r.key)})},null,4)],10,Do)}),64))]),o("section",Oo,[o("div",Vo,[o("header",Wo,[o("div",null,[o("h2",null,f(Ue(j.value))+"全矿区插值热力图",1),n[22]||(n[22]=o("p",null,"双击适配视图，拖拽平移，滚轮缩放",-1))]),o("div",Ho,[o("label",null,[n[23]||(n[23]=Fe("分辨率",-1)),Le(o("input",{"onUpdate:modelValue":n[4]||(n[4]=r=>I.value=r),type:"number",min:"20",max:"120",step:"5"},null,512),[[dt,I.value,void 0,{number:!0}]])]),o("label",null,[n[24]||(n[24]=Fe("线级",-1)),Le(o("input",{"onUpdate:modelValue":n[5]||(n[5]=r=>M.value=r),type:"number",min:"5",max:"24",step:"1"},null,512),[[dt,M.value,void 0,{number:!0}]])]),o("label",null,[n[26]||(n[26]=Fe("插值 ",-1)),Le(o("select",{"onUpdate:modelValue":n[6]||(n[6]=r=>H.value=r)},[...n[25]||(n[25]=[o("option",{value:"idw"},"反距离权重",-1),o("option",{value:"linear"},"线性插值",-1),o("option",{value:"nearest"},"最近邻",-1),o("option",{value:"kriging"},"克里金",-1)])],512),[[Kt,H.value]])]),o("label",Go,[Le(o("input",{"onUpdate:modelValue":n[7]||(n[7]=r=>le.value=r),type:"checkbox"},null,512),[[Jt,le.value]]),n[27]||(n[27]=Fe("等值线",-1))]),o("label",jo,[Le(o("input",{"onUpdate:modelValue":n[8]||(n[8]=r=>V.value=r),type:"checkbox"},null,512),[[Jt,V.value]]),n[28]||(n[28]=Fe("固定量程(0-100)",-1))])])]),Me.value?(te(),ne("div",Yo,[n[29]||(n[29]=o("span",{class:"trust-chip real"},"空间图：真实钻孔与坐标数据",-1)),o("span",qo,"评估："+f(Ft.value),1),he.value!=="all"&&St.value>0?(te(),ne("span",Xo," 联动高亮 "+f(Pt(he.value))+" · "+f(St.value)+"点 ",1)):xe("",!0),qe.value?(te(),ne("span",Zo,"标签源 "+f(qe.value),1)):xe("",!0),o("span",Ko,"钻孔 "+f(((c=C.value)==null?void 0:c.borehole_count)||0)+" 个 · 坐标源 zuobiao.csv",1)])):xe("",!0),o("div",{ref_key:"stageContainer",ref:s,class:"stage",onMousedown:un,onMousemove:cn,onMouseup:dn,onMouseleave:mn,onWheel:zn(pn,["prevent"]),onDblclick:m},[o("canvas",{ref_key:"heatmapCanvas",ref:u,class:"layer"},null,512),o("canvas",{ref_key:"overlayCanvas",ref:A,class:"layer"},null,512),de.value?(te(),ne("div",Jo,[n[30]||(n[30]=o("div",{class:"skeleton"},null,-1)),n[31]||(n[31]=o("div",{class:"skeleton"},null,-1)),o("p",null,"正在计算 "+f(k.value||"目标煤层")+" 空间指标...",1)])):xe("",!0)],544),o("footer",Qo,[o("div",{class:"legend-track",style:mt({background:e(j.value)})},null,4),o("div",ea,[o("span",null,f(t(lt.value.min)),1),o("span",null,f(t(lt.value.mean)),1),o("span",null,f(t(lt.value.max)),1)])])]),o("aside",{ref_key:"thumbPanelRef",ref:y,class:Qe(["thumb-panel",{collapsed:be.value}])},[o("header",null,[n[32]||(n[32]=o("h3",null,"指标缩略图",-1)),o("button",{class:"icon-btn mini",type:"button",onClick:n[9]||(n[9]=r=>be.value=!be.value)},f(be.value?"展开":"收起"),1)]),o("div",ta,[(te(),ne(Ye,null,zt(h,r=>{var S,w;return o("button",{key:`thumb-${r.key}`,class:Qe(["thumb-item",{active:j.value===r.key}]),type:"button",onClick:R=>j.value=r.key,onMouseenter:R=>vn(r.key,R),onMousemove:R=>Vt(r.key,R),onMouseleave:yn},[o("canvas",{ref_for:!0,ref:B(r.key),class:"thumb-canvas"},null,512),o("div",oa,[o("strong",null,f(r.label),1),o("span",null,"均值 "+f(t((S=Ve.value[r.key])==null?void 0:S.mean)),1),o("span",null,"σ "+f(t((w=Ve.value[r.key])==null?void 0:w.std)),1)])],42,na)}),64))]),ye.visible&&We.value?(te(),ne("div",{key:0,class:"thumb-tooltip",style:mt({left:`${ye.x+12}px`,top:`${ye.y+12}px`})},[o("p",null,[o("strong",null,f(Ue(ye.metric))+"统计",1)]),o("p",null,"最小值 "+f(t(We.value.min)),1),o("p",null,"最大值 "+f(t(We.value.max)),1),o("p",null,"均值 "+f(t(We.value.mean)),1),o("p",null,"标准差 "+f(t(We.value.std)),1)],4)):xe("",!0)],2)]),Ne(en,{name:"fade-up"},{default:Qt(()=>[oe.value?(te(),ne("aside",aa,[o("header",null,[n[33]||(n[33]=o("h3",null,"权重配置",-1)),o("button",{type:"button",class:"close-btn",onClick:n[10]||(n[10]=r=>oe.value=!1)},"×")]),n[37]||(n[37]=o("p",null,"RSI / BRI / ASI 自动归一化。调整后 300ms 内自动重算。",-1)),o("label",la,[n[34]||(n[34]=o("span",null,"RSI",-1)),Le(o("input",{"onUpdate:modelValue":n[11]||(n[11]=r=>W.rsi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[dt,W.rsi,void 0,{number:!0}]]),o("strong",null,f(l(Te.value.rsi)),1)]),o("label",sa,[n[35]||(n[35]=o("span",null,"BRI",-1)),Le(o("input",{"onUpdate:modelValue":n[12]||(n[12]=r=>W.bri=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[dt,W.bri,void 0,{number:!0}]]),o("strong",null,f(l(Te.value.bri)),1)]),o("label",ra,[n[36]||(n[36]=o("span",null,"ASI",-1)),Le(o("input",{"onUpdate:modelValue":n[13]||(n[13]=r=>W.asi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[dt,W.asi,void 0,{number:!0}]]),o("strong",null,f(l(Te.value.asi)),1)])])):xe("",!0)]),_:1}),Ne(en,{name:"drawer-up"},{default:Qt(()=>{var r,S,w,R,$,ie,ve,q;return[pe.value?(te(),ne("section",ia,[o("header",null,[n[38]||(n[38]=o("h3",null,"算法评估面板（当前煤层批量结果）",-1)),o("div",ua,[o("button",{type:"button",class:"tool-btn small",onClick:wn},"导出数据"),o("button",{type:"button",class:"close-btn",onClick:n[14]||(n[14]=Se=>pe.value=!1)},"×")])]),ue.value?(te(),ne("div",ca,"正在计算评估指标...")):z.value?(te(),ne(Ye,{key:2},[o("div",ma,[o("div",pa,[n[39]||(n[39]=o("span",null,"AUC",-1)),o("strong",null,f(t(z.value.auc,4)),1)]),o("div",va,[n[40]||(n[40]=o("span",null,"PR-AUC",-1)),o("strong",null,f(t(z.value.pr_auc,4)),1)]),o("div",ya,[n[41]||(n[41]=o("span",null,"F1",-1)),o("strong",null,f(t(z.value.f1,4)),1)]),o("div",fa,[n[42]||(n[42]=o("span",null,"Brier",-1)),o("strong",null,f(t(z.value.brier,4)),1)]),o("div",ha,[n[43]||(n[43]=o("span",null,"ECE",-1)),o("strong",null,f(t(z.value.ece,4)),1)])]),o("div",ga,[o("div",ba,[n[48]||(n[48]=o("h4",null,"混淆矩阵",-1)),o("div",xa,[o("div",wa,[n[44]||(n[44]=o("span",null,"TN",-1)),o("b",null,f((S=(r=z.value.confusion_matrix)==null?void 0:r.tn)!=null?S:0),1)]),o("div",Sa,[n[45]||(n[45]=o("span",null,"FP",-1)),o("b",null,f((R=(w=z.value.confusion_matrix)==null?void 0:w.fp)!=null?R:0),1)]),o("div",_a,[n[46]||(n[46]=o("span",null,"FN",-1)),o("b",null,f((ie=($=z.value.confusion_matrix)==null?void 0:$.fn)!=null?ie:0),1)]),o("div",ka,[n[47]||(n[47]=o("span",null,"TP",-1)),o("b",null,f((q=(ve=z.value.confusion_matrix)==null?void 0:ve.tp)!=null?q:0),1)])])]),o("div",Aa,[n[55]||(n[55]=o("h4",null,"基线对比（SVG）",-1)),(te(),ne("svg",Ma,[n[49]||(n[49]=o("rect",{x:"0",y:"0",width:"560",height:"170",fill:"#fff"},null,-1)),n[50]||(n[50]=o("text",{x:"14",y:"26"},"基线 MPI",-1)),n[51]||(n[51]=o("rect",{x:"112",y:"12",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"12",width:_(wt.value),height:"18",rx:"9",fill:"#64748b"},null,8,Ca),o("text",Na,f(t(wt.value,3)),1),n[52]||(n[52]=o("text",{x:"14",y:"90"},"新算法 MPI",-1)),n[53]||(n[53]=o("rect",{x:"112",y:"76",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"76",width:_(at.value),height:"18",rx:"9",fill:"#0f766e"},null,8,Ia),o("text",$a,f(t(at.value,3)),1),n[54]||(n[54]=o("text",{x:"14",y:"148",fill:"#64748b"},"注：基于当前煤层批量钻孔的空间实证均值。",-1))]))])])],64)):(te(),ne("div",da,f(fe.value||"暂无评估数据"),1))])):xe("",!0)]}),_:1}),Me.value?(te(),ne("section",Ra,[o("header",null,[n[57]||(n[57]=o("h3",null,"期刊级图组（自动生成）",-1)),n[58]||(n[58]=o("p",null,"全部图件已直接展示，满足对比、消融、校准、判别与机制解释需求。",-1)),n[59]||(n[59]=o("p",{class:"data-note"},"说明：评估与部分机制曲线目前为模型推导/示意，不等同于真实标签实验结果。",-1)),o("p",Fa,[n[56]||(n[56]=Fe(" 图11支持点击 TP/TN/FP/FN 联动主图高亮。 ",-1)),he.value!=="all"?(te(),ne(Ye,{key:0},[Fe("可按 Esc 快速清除筛选。")],64)):xe("",!0),Ke.value?xe("",!0):(te(),ne(Ye,{key:1},[Fe("当前样本与钻孔点未一一对齐，联动高亮不可用。")],64))]),n[60]||(n[60]=o("p",{class:"data-note"},"导出高清图与图组包时会自动冻结脉冲动画，保证稿件图件为静态一致版。",-1)),he.value!=="all"?(te(),ne("button",{key:0,type:"button",class:"tool-btn small",onClick:Ut},"清除联动高亮")):xe("",!0),we.value?(te(),ne("p",Pa,f(we.value),1)):xe("",!0)]),Ne(Mo,{result:st.value,evaluation:z.value,onMatrixSelect:rn},null,8,["result","evaluation"])])):xe("",!0),J.value&&Me.value?(te(),ne("div",{key:1,class:"hover-tooltip",style:mt({left:`${Ie.x+14}px`,top:`${Ie.y+14}px`})},[o("p",null,"坐标："+f(t(J.value.worldX,2))+", "+f(t(J.value.worldY,2)),1),o("p",null,f(Ue(j.value))+"插值："+f(t(J.value.gridValue,3)),1),o("p",null,"最近钻孔："+f(((b=J.value.nearestBorehole)==null?void 0:b.borehole_name)||"--")+"（"+f(t(J.value.nearestDistance,1))+" m）",1),J.value.borehole?(te(),ne(Ye,{key:0},[o("p",null,[o("strong",null,f(J.value.borehole.borehole_name),1)]),o("p",null,"RSI "+f(t(J.value.borehole.rsi,2))+" | BRI "+f(t(J.value.borehole.bri,2)),1),o("p",null,"ASI "+f(t(J.value.borehole.asi,2))+" | MPI "+f(t(J.value.borehole.mpi,2)),1),o("p",Ta,f(d(J.value.borehole.risk_label)),1)],64)):xe("",!0)],4)):xe("",!0)],512)}}},Ga=Et(La,[["__scopeId","data-v-3e5c0c44"]]);export{Ga as default};
