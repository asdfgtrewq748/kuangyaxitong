var Ln=Object.defineProperty,zn=Object.defineProperties;var Dn=Object.getOwnPropertyDescriptors;var Qt=Object.getOwnPropertySymbols;var En=Object.prototype.hasOwnProperty,Bn=Object.prototype.propertyIsEnumerable;var tn=Math.pow,en=(g,q,w)=>q in g?Ln(g,q,{enumerable:!0,configurable:!0,writable:!0,value:w}):g[q]=w,Z=(g,q)=>{for(var w in q||(q={}))En.call(q,w)&&en(g,w,q[w]);if(Qt)for(var w of Qt(q))Bn.call(q,w)&&en(g,w,q[w]);return g},X=(g,q)=>zn(g,Dn(q));var Ce=(g,q,w)=>new Promise((Ae,p)=>{var ce=F=>{try{W(w.next(F))}catch(s){p(s)}},y=F=>{try{W(w.throw(F))}catch(s){p(s)}},W=F=>F.done?Ae(F.value):Promise.resolve(F.value).then(ce,y);W((w=w.apply(g,q)).next())});import{_ as Vt,u as On,b as Un}from"./index-D1RuNWc2.js";import{r as Rt,bB as Vn,bC as Wn,bA as Hn,bf as cn,n as Ut,w as ze,b4 as dn,b5 as ee,b8 as te,bn as pt,b as K,c as v,b7 as o,bb as h,bi as _e,ba as ot,bj as $e,u as jn,br as De,bv as nn,bc as Ke,b9 as Bt,bo as Te,bs as mt,bt as on,bm as an,bh as ln,bx as sn,a as Gn}from"./vendor-CA5Q5CdR.js";import{a as qn,u as Yn}from"./vue-router-D9BXaJFq.js";import{g as Zn,v as Xn,n as Jn}from"./api-BcwPnB85.js";import"./echarts-CG3_94Cz.js";import{i as Kn}from"./echarts-Dy-VGqd_.js";import"./network-T6nY3V_4.js";function Qn(){const g=Rt({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),q=(F,s,f)=>{if(!f)return{x:0,y:0};const c=F-f.min_x,M=f.max_y-s;return{x:c*g.scale+g.x,y:M*g.scale+g.y}},w=(F,s,f)=>{if(!f||g.scale===0)return{x:0,y:0};const c=(F-g.x)/g.scale,M=(s-g.y)/g.scale;return{x:f.min_x+c,y:f.max_y-M}};return{viewport:g,worldToScreen:q,screenToWorld:w,fitToBounds:(F,s,f,c=56)=>{if(!F||!s||!f)return;const M=Math.max(F.max_x-F.min_x,1e-6),L=Math.max(F.max_y-F.min_y,1e-6),C=Math.min((s-c*2)/M,(f-c*2)/L),R=(F.min_x+F.max_x)/2,N=(F.min_y+F.max_y)/2;g.scale=Math.max(.01,C),g.x=s/2-(R-F.min_x)*g.scale,g.y=f/2-(F.max_y-N)*g.scale},startDrag:(F,s)=>{g.isDragging=!0,g.lastX=F,g.lastY=s},dragTo:(F,s)=>{g.isDragging&&(g.x+=F-g.lastX,g.y+=s-g.lastY,g.lastX=F,g.lastY=s)},endDrag:()=>{g.isDragging=!1},zoomAt:(F,s,f,c,M=.1,L=50)=>{if(!c)return;const C=Math.max(M,Math.min(L,g.scale*F));if(C===g.scale)return;const R=w(s,f,c);g.scale=C,g.x=s-(R.x-c.min_x)*g.scale,g.y=f-(c.max_y-R.y)*g.scale}}}const rn={mpi:["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],rsi:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],bri:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],asi:["#3b82f6","#6366f1","#8b5cf6","#ec4899","#dc2626"]},Ot=g=>Math.max(0,Math.min(1,g)),eo=g=>{const w=String(g||"").match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return w?{r:Number(w[1]),g:Number(w[2]),b:Number(w[3])}:null},to=(g,q=.8)=>{const w=eo(g);if(!w)return"#94a3b8";const Ae=Math.round(w.r*.299+w.g*.587+w.b*.114),p=Math.round(Ae*q+235*(1-q));return`rgb(${p},${p},${p})`},un=g=>{var Ae,p;const q=Number((Ae=g==null?void 0:g.min)!=null?Ae:0),w=Number((p=g==null?void 0:g.max)!=null?p:100);return!Number.isFinite(q)||!Number.isFinite(w)||q===w?{min:0,max:100}:{min:q,max:w}};function no(){const g=s=>rn[s]||rn.mpi,q=s=>`linear-gradient(90deg, ${g(s).join(",")})`,w=(s,f,c)=>{const{min:M,max:L}=un(c),C=Ot((Number(f)-M)/(L-M));return Vn(g(s))(C)},Ae=(s,f,c,M,L,C,R={})=>{var $;const N=f.length,H=(($=f[0])==null?void 0:$.length)||0;if(N<2||H<2)return;const le=new Array(N*H);let U=0;for(let z=0;z<N;z+=1)for(let ue=0;ue<H;ue+=1)le[U]=Number(f[z][ue]||0),U+=1;const{min:j,max:de}=un(L),me=Math.max(5,Number(R.contourLevels||9)),ne=Wn(j,de,me).slice(1,-1);if(!ne.length)return;const pe=Hn().size([H,N]).thresholds(ne)(le),xe=Math.max(c.max_x-c.min_x,1e-6),V=Math.max(c.max_y-c.min_y,1e-6);s.save(),s.strokeStyle=R.contourColor||"rgba(15,23,42,0.32)",s.lineWidth=M.scale>2?1.2:.9,s.globalAlpha=M.scale<.65?.45:.7;for(const z of pe)for(const ue of z.coordinates)for(const he of ue)if(!(!Array.isArray(he)||he.length<2)){s.beginPath();for(let re=0;re<he.length;re+=1){const ke=he[re],J=c.min_x+ke[0]/Math.max(H-1,1)*xe,Re=c.max_y-ke[1]/Math.max(N-1,1)*V,ve=C(J,Re,c);re===0?s.moveTo(ve.x,ve.y):s.lineTo(ve.x,ve.y)}s.closePath(),s.stroke()}s.restore()};return{getLegendGradient:q,drawGrid:(s,f,c,M,L,C,R,N={})=>{var xe;if(!s||!Array.isArray(f)||f.length===0||!c)return;const H=f.length,le=((xe=f[0])==null?void 0:xe.length)||0;if(!le)return;const U=c.max_x-c.min_x,j=c.max_y-c.min_y,de=U/le,me=j/H,ne=s.canvas.width,pe=s.canvas.height;for(let V=0;V<H;V+=1){const $=f[V],z=c.max_y-V*me;for(let ue=0;ue<le;ue+=1){const he=c.min_x+ue*de,re=R(he,z,c),ke=R(he+de,z-me,c),J=Math.min(re.x,ke.x),Re=Math.min(re.y,ke.y),ve=Math.abs(ke.x-re.x)+.8,G=Math.abs(ke.y-re.y)+.8;J>ne||J+ve<0||Re>pe||Re+G<0||(s.fillStyle=w(L,Number($[ue]||0),C),s.fillRect(J,Re,ve,G))}}if(N.showContours!==!1&&Ae(s,f,c,M,C,R,N),M.scale>3.2){s.strokeStyle="rgba(255,255,255,0.18)",s.lineWidth=1,s.beginPath();for(let V=0;V<=H;V+=1){const $=c.max_y-V*me,z=R(c.min_x,$,c),ue=R(c.max_x,$,c);s.moveTo(z.x,z.y),s.lineTo(ue.x,ue.y)}for(let V=0;V<=le;V+=1){const $=c.min_x+V*de,z=R($,c.min_y,c),ue=R($,c.max_y,c);s.moveTo(z.x,z.y),s.lineTo(ue.x,ue.y)}s.stroke()}},drawBoreholes:(s,f,c,M,L,C,R="",N=null)=>{if(!s||!Array.isArray(f)||!L)return;const H=!!(N!=null&&N.active&&(N==null?void 0:N.indexSet)instanceof Set&&N.indexSet.size>0),le=String((N==null?void 0:N.accent)||"#111827"),U=!!(N!=null&&N.animate),j=Number((N==null?void 0:N.pulseT)||0);for(let de=0;de<f.length;de+=1){const me=f[de],ne=C(me.x,me.y,L),pe=R&&R===me.borehole_name,xe=!H||N.indexSet.has(de),V=U&&H&&xe?(Math.sin(j*5+de*.35)+1)/2:0,$=pe?7.5:xe&&H?6.6:5.8;s.save();const z=w(c,me[c],M);s.globalAlpha=H&&!xe?.24:1,s.fillStyle=H&&!xe?to(z,.84):z,s.strokeStyle=pe?"#111827":xe&&H?le:"rgba(255,255,255,0.95)",s.lineWidth=pe?2.4:1.8,s.beginPath(),s.arc(ne.x,ne.y,$,0,Math.PI*2),s.fill(),s.stroke(),xe&&H&&!pe&&(s.globalAlpha=.95,s.strokeStyle=le,s.lineWidth=2,s.beginPath(),s.arc(ne.x,ne.y,$+3.6,0,Math.PI*2),s.stroke(),U&&(s.globalAlpha=.35+V*.45,s.lineWidth=1.6+V*.9,s.beginPath(),s.arc(ne.x,ne.y,$+6+V*5.5,0,Math.PI*2),s.stroke())),s.restore()}},pickNearestBorehole:(s,f,c,M,L,C=14)=>{if(!Array.isArray(c)||!M)return null;let R=null,N=Number.POSITIVE_INFINITY;for(const H of c){const le=L(H.x,H.y,M),U=Math.hypot(s-le.x,f-le.y);U<N&&(N=U,R=H)}return N<=C?R:null},sampleGridValue:(s,f,c,M)=>{var U;if(!Array.isArray(s)||s.length===0||!f)return null;const L=s.length,C=((U=s[0])==null?void 0:U.length)||0;if(!C)return null;const R=Ot((c-f.min_x)/Math.max(f.max_x-f.min_x,1e-6)),N=Ot((f.max_y-M)/Math.max(f.max_y-f.min_y,1e-6)),H=Math.max(0,Math.min(C-1,Math.floor(R*(C-1)))),le=Math.max(0,Math.min(L-1,Math.floor(N*(L-1))));return Number(s[le][H])},drawMiniHeatmap:(s,f,c,M)=>{var de;if(!s||!Array.isArray(f)||f.length===0)return;const L=window.devicePixelRatio||1,C=s.clientWidth||150,R=s.clientHeight||110;s.width=Math.round(C*L),s.height=Math.round(R*L);const N=s.getContext("2d");N.setTransform(L,0,0,L,0,0),N.clearRect(0,0,C,R);const H=f.length,le=((de=f[0])==null?void 0:de.length)||0;if(!le)return;const U=C/le,j=R/H;for(let me=0;me<H;me+=1)for(let ne=0;ne<le;ne+=1)N.fillStyle=w(c,Number(f[me][ne]||0),M),N.fillRect(ne*U,me*j,U+.4,j+.4);N.strokeStyle="rgba(255,255,255,0.35)",N.strokeRect(0,0,C,R)}}}const oo={__name:"ScienceChart",props:{option:{type:Object,required:!0},height:{type:[String,Number],default:320}},emits:["chart-click"],setup(g,{emit:q}){const w=g,Ae=q,p=K(null);let ce=null,y=null;const W=v(()=>typeof w.height=="number"?`${w.height}px`:w.height),F=()=>{ce&&ce.setOption(w.option||{},{notMerge:!0,lazyUpdate:!0,silent:!0})},s=()=>{ce&&ce.resize()},f=L=>{Ae("chart-click",L)},c=()=>{if(p.value){if(typeof ResizeObserver!="undefined"){y=new ResizeObserver(()=>{s()}),y.observe(p.value);return}window.addEventListener("resize",s)}},M=()=>{y?(y.disconnect(),y=null):window.removeEventListener("resize",s)};return cn(()=>Ce(this,null,function*(){yield Ut(),p.value&&(ce=Kn(p.value,null,{renderer:"canvas"}),ce.on("click",f),F(),c())})),ze(()=>w.option,()=>{F()}),ze(()=>w.height,()=>Ce(this,null,function*(){yield Ut(),s()})),dn(()=>{M(),ce&&(ce.off("click",f),ce.dispose(),ce=null)}),(L,C)=>(ee(),te("div",{ref_key:"container",ref:p,class:"science-chart",style:pt({height:W.value})},null,4))}},Le=Vt(oo,[["__scopeId","data-v-40fa2a4e"]]),ao={class:"science-gallery"},lo={class:"gallery-head"},so={class:"head-metrics"},ro={class:"metric-chip"},io={class:"metric-chip"},uo={key:0,class:"metric-chip"},co={key:1,class:"metric-chip"},mo={class:"figure-card"},po={class:"caption meta"},vo={class:"figure-card"},fo={class:"caption meta"},yo={class:"figure-card"},ho={class:"caption meta"},bo={class:"figure-card"},go={class:"caption meta"},xo={class:"figure-card"},wo={class:"caption meta"},So={class:"figure-card"},_o={class:"caption meta"},ko={class:"figure-card"},Co={class:"caption meta"},Ao={class:"figure-card"},Mo={class:"caption meta"},No={class:"figure-card"},Io={class:"caption meta"},$o={class:"figure-card"},Ro={class:"caption meta"},ge="'Times New Roman', 'Noto Serif SC', 'Source Han Serif SC', serif",Po={__name:"ValidationScienceFigures",props:{result:{type:Object,default:null},evaluation:{type:Object,default:null}},emits:["matrix-select"],setup(g,{emit:q}){const w=g,Ae=q,p={blue:"#1d4ed8",cyan:"#0891b2",green:"#15803d",orange:"#d97706",red:"#b91c1c",purple:"#7c3aed",slate:"#475569"},ce={left:66,right:26,top:46,bottom:62},y=(e,n,l)=>Math.max(n,Math.min(l,e)),W=(e,n=0)=>{const l=Number(e);return Number.isFinite(l)?l:n},F=e=>`${(y(W(e,0),0,1)*100).toFixed(1)}%`,s=(e,n=3)=>Number(W(e,0).toFixed(n)),f=(e,n,l=0)=>n>0?e/n:l,c=(e,n=!0)=>({type:n?"value":"category",name:e,nameLocation:"middle",nameGap:38,nameTextStyle:{fontFamily:ge,fontSize:12,color:"#0f172a"},axisLabel:{fontFamily:ge,fontSize:11,color:"#0f172a"},axisLine:{lineStyle:{color:"#0f172a",width:1.15}},axisTick:{lineStyle:{color:"#334155",width:1}},splitLine:{show:!0,lineStyle:{color:"#e2e8f0",width:.8,type:"dashed"}}}),M={top:6,textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"}},L={right:8,top:6,itemSize:14,iconStyle:{borderColor:"#334155"},feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"框选缩放",back:"还原缩放"}},restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}},C=[{type:"inside",xAxisIndex:0,filterMode:"none",zoomOnMouseWheel:"ctrl",moveOnMouseMove:!0}],R=v(()=>{var e;return((e=w.result)==null?void 0:e.evaluation_inputs)||{}}),N=v(()=>{var n,l;const e=((n=R.value)==null?void 0:n.mode)||((l=R.value)==null?void 0:l.source)||"pseudo_threshold";return String(e)}),H=v(()=>{var e,n;return String(((e=R.value)==null?void 0:e.source)||((n=R.value)==null?void 0:n.sourceFile)||"")}),le=v(()=>N.value==="real_label_stream"?"真实标签流":N.value==="pseudo_threshold"?"伪标签估计":"未知"),U=v(()=>{var d,k,b,D;const e=Array.isArray((d=R.value)==null?void 0:d.y_true)?R.value.y_true:Array.isArray((k=R.value)==null?void 0:k.yTrue)?R.value.yTrue:[],n=Array.isArray((b=R.value)==null?void 0:b.y_prob)?R.value.y_prob:Array.isArray((D=R.value)==null?void 0:D.yProb)?R.value.yProb:[],l=Math.min(e.length,n.length),u=[];for(let E=0;E<l;E+=1){const T=W(e[E],0)>=1?1:0,I=y(W(n[E],0),0,1);u.push({y:T,p:I})}return u}),j=v(()=>U.value.length),de=v(()=>U.value.filter(e=>e.y===1).length),me=v(()=>j.value-de.value),ne=v(()=>f(de.value,Math.max(j.value,1),0)),pe=v(()=>j.value>=6&&de.value>0&&me.value>0),xe=v(()=>{const e=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const n of U.value)e.push(Number(n.p.toFixed(3)));return Array.from(new Set(e.map(n=>y(n,0,1)))).sort((n,l)=>l-n)}),V=e=>{let n=0,l=0,u=0,d=0;for(const O of U.value){const oe=O.p>=e?1:0;O.y===1&&oe===1?n+=1:O.y===1&&oe===0?d+=1:O.y===0&&oe===1?l+=1:u+=1}const k=f(n,n+d,0),b=f(n,n+l,0),D=f(u,u+l,0),E=f(l,l+u,0),T=f(n+u,n+u+l+d,0),I=f(2*b*k,b+k,0);return{threshold:e,tp:n,fp:l,tn:u,fn:d,recall:k,precision:b,specificity:D,fpr:E,accuracy:T,f1:I}},$=v(()=>xe.value.map(e=>V(e))),z=v(()=>{if(!pe.value)return[[0,0],[.06,.28],[.15,.54],[.33,.75],[.56,.89],[1,1]];const e=$.value.map(n=>[n.fpr,n.recall]);return e.push([0,0],[1,1]),e.sort((n,l)=>n[0]-l[0]||n[1]-l[1]),e}),ue=v(()=>{if(!pe.value)return[[0,1],[.15,.9],[.35,.82],[.55,.73],[.75,.61],[1,.5]];const e=$.value.map(n=>[n.recall,n.precision]);return e.push([0,1],[1,ne.value]),e.sort((n,l)=>n[0]-l[0]||l[1]-n[1]),e}),he=e=>{let n=0;for(let l=1;l<e.length;l+=1){const[u,d]=e[l-1],[k,b]=e[l];n+=(k-u)*((d+b)/2)}return y(n,0,1)},re=(e,n,l=0)=>{const u=e.filter(E=>Number.isFinite(E)).slice().sort((E,T)=>E-T);if(!u.length)return l;const d=y(n,0,1)*(u.length-1),k=Math.floor(d),b=Math.min(u.length-1,k+1),D=d-k;return u[k]*(1-D)+u[b]*D},ke=(e,n)=>{if(!Array.isArray(e)||e.length===0)return 0;if(e.length===1||n<=e[0][0])return y(W(e[0][1],0),0,1);for(let l=1;l<e.length;l+=1){const[u,d]=e[l-1],[k,b]=e[l];if(n<=k){if(Math.abs(k-u)<1e-12)return y(Math.max(d,b),0,1);const D=(n-u)/(k-u);return y(d+(b-d)*D,0,1)}}return y(W(e[e.length-1][1],0),0,1)},J=e=>{const n=e.length,l=e.reduce((T,I)=>T+(I.y>=1?1:0),0),u=n-l;if(n<2||l<=0||u<=0)return{roc:[[0,0],[1,1]],pr:[[0,1],[1,y(f(l,Math.max(n,1),0),0,1)]],auc:.5,prAuc:.5};const d=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const T of e)d.push(Number(T.p.toFixed(3)));const k=Array.from(new Set(d.map(T=>y(T,0,1)))).sort((T,I)=>I-T),b=[],D=[];for(const T of k){let I=0,O=0,oe=0,m=0;for(const ae of e){const Pe=ae.p>=T?1:0;ae.y===1&&Pe===1?I+=1:ae.y===1&&Pe===0?m+=1:ae.y===0&&Pe===1?O+=1:oe+=1}const B=f(I,I+m,0),ie=f(I,I+O,0),Q=f(O,O+oe,0);b.push([Q,B]),D.push([B,ie])}b.push([0,0],[1,1]),b.sort((T,I)=>T[0]-I[0]||T[1]-I[1]);const E=y(f(l,n,0),0,1);return D.push([0,1],[1,E]),D.sort((T,I)=>T[0]-I[0]||I[1]-T[1]),{roc:b,pr:D,auc:he(b),prAuc:he(D)}},Re=v(()=>{let e=2166136261;for(let n=0;n<U.value.length;n+=1){const l=U.value[n],u=l.y>=1?1:0,d=Math.round(y(l.p,0,1)*1e3);e^=u*733+d*31+n*131>>>0,e=Math.imul(e,16777619)>>>0}return e||1315423911}),ve=v(()=>pe.value?j.value<=60?240:j.value<=180?180:120:0),G=v(()=>{if(!pe.value)return null;const e=U.value.length,n=ve.value;if(n<=0||e<6)return null;const l=Array.from({length:21},(m,B)=>B/20),u=l.map(()=>[]),d=l.map(()=>[]),k=[],b=[];let D=Re.value>>>0;const E=()=>{D+=1831565813;let m=D;return m=Math.imul(m^m>>>15,m|1),m^=m+Math.imul(m^m>>>7,m|61),((m^m>>>14)>>>0)/4294967296};for(let m=0;m<n;m+=1){const B=[];for(let Q=0;Q<e;Q+=1)B.push(U.value[Math.floor(E()*e)]);const ie=J(B);k.push(ie.auc),b.push(ie.prAuc);for(let Q=0;Q<l.length;Q+=1){const ae=l[Q];u[Q].push(ke(ie.roc,ae)),d[Q].push(ke(ie.pr,ae))}}const T=u.map(m=>re(m,.025,0)),I=u.map(m=>re(m,.975,1)),O=d.map(m=>re(m,.025,0)),oe=d.map(m=>re(m,.975,1));return{iterations:n,grid:l,rocLow:T,rocHigh:I,prLow:O,prHigh:oe,aucLow:y(re(k,.025,Be.value),0,1),aucHigh:y(re(k,.975,Be.value),0,1),prAucLow:y(re(b,.025,He.value),0,1),prAucHigh:y(re(b,.975,He.value),0,1)}}),Qe=v(()=>G.value?{low:G.value.grid.map((e,n)=>[e,G.value.rocLow[n]]),high:G.value.grid.map((e,n)=>[e,G.value.rocHigh[n]])}:{low:[],high:[]}),be=v(()=>G.value?G.value.grid.map((e,n)=>[e,Math.max(G.value.rocHigh[n]-G.value.rocLow[n],0)]):[]),ye=v(()=>G.value?{low:G.value.grid.map((e,n)=>[e,G.value.prLow[n]]),high:G.value.grid.map((e,n)=>[e,G.value.prHigh[n]])}:{low:[],high:[]}),et=v(()=>G.value?G.value.grid.map((e,n)=>[e,Math.max(G.value.prHigh[n]-G.value.prLow[n],0)]):[]),at=v(()=>he(z.value)),lt=v(()=>he(ue.value)),Ee=v(()=>pe.value?$.value.reduce((e,n)=>{const l=n.recall-n.fpr;return l>e.j?X(Z({},n),{j:l}):e},{threshold:.5,fpr:1,recall:0,j:-1}):{threshold:.5,fpr:.22,recall:.78,j:.56}),vt=v(()=>pe.value?$.value.reduce((e,n)=>n.f1>e.f1?n:e,$.value[0]||{threshold:.5,recall:0,precision:0,f1:0}):{threshold:.5,recall:.74,precision:.78,f1:.76}),st=v(()=>{if(!U.value.length)return .25;const e=U.value.reduce((n,l)=>n+tn(l.p-l.y,2),0);return y(e/U.value.length,0,1)}),We=v(()=>{if(!pe.value)return{centers:[.1,.22,.34,.46,.58,.7,.82,.94],pred:[.11,.23,.36,.45,.57,.69,.8,.9],obs:[.14,.2,.31,.49,.55,.63,.78,.89],lower:[.04,.08,.19,.31,.39,.47,.63,.74],band:[.2,.24,.24,.18,.16,.16,.15,.15],count:[4,6,8,11,12,10,7,5],ece:.043};const e=8,n=Array.from({length:e+1},(m,B)=>B/e),l=Array.from({length:e},()=>0),u=Array.from({length:e},()=>0),d=Array.from({length:e},()=>0);for(const m of U.value){const B=Math.min(e-1,Math.floor(m.p*e));l[B]+=1,u[B]+=m.p,d[B]+=m.y}const k=[],b=[],D=[],E=[],T=[],I=[];for(let m=0;m<e;m+=1){if(l[m]<=0)continue;const B=u[m]/l[m],ie=d[m]/l[m],Q=1.96*Math.sqrt(f(ie*(1-ie),l[m],0)),ae=y(ie-Q,0,1),Pe=y(ie+Q,0,1);k.push((n[m]+n[m+1])/2),b.push(B),D.push(ie),E.push(ae),T.push(Pe-ae),I.push(l[m])}const O=Math.max(U.value.length,1),oe=b.reduce((m,B,ie)=>m+Math.abs(B-D[ie])*I[ie],0)/O;return{centers:k,pred:b,obs:D,lower:E,band:T,count:I,ece:oe}}),Be=v(()=>{var l,u,d;const e=W((l=w.evaluation)==null?void 0:l.auc,NaN);if(!Number.isNaN(e)&&e>0)return y(e,.5,1);const n=W((d=(u=w.result)==null?void 0:u.kpi)==null?void 0:d.auc,NaN);return!Number.isNaN(n)&&n>0?y(n,.5,1):y(at.value,.5,1)}),He=v(()=>{var n;const e=W((n=w.evaluation)==null?void 0:n.pr_auc,NaN);return!Number.isNaN(e)&&e>0?y(e,.4,1):y(lt.value,.4,1)}),Pt=v(()=>{var l,u,d;const e=W((l=w.evaluation)==null?void 0:l.brier,NaN);if(!Number.isNaN(e)&&e>=0)return y(e,0,1);const n=W((d=(u=w.result)==null?void 0:u.kpi)==null?void 0:d.brier_score,NaN);return!Number.isNaN(n)&&n>=0?y(n,0,1):y(st.value,0,1)}),ft=v(()=>{var n;const e=W((n=w.evaluation)==null?void 0:n.ece,NaN);return!Number.isNaN(e)&&e>=0?y(e,0,1):y(We.value.ece,0,1)}),tt=v(()=>{var l;const e=(l=w.evaluation)==null?void 0:l.confusion_matrix;if(e&&["tp","tn","fp","fn"].every(u=>Number.isFinite(Number(e[u]))))return{tp:Number(e.tp),tn:Number(e.tn),fp:Number(e.fp),fn:Number(e.fn)};const n=$.value.find(u=>Math.abs(u.threshold-.5)<1e-9);return n?{tp:n.tp,tn:n.tn,fp:n.fp,fn:n.fn}:{tp:13,tn:31,fp:6,fn:8}}),yt=v(()=>{const e=tt.value,n=f(e.tp+e.tn,e.tp+e.tn+e.fp+e.fn,0),l=f(e.tp,e.tp+e.fp,0),u=f(e.tp,e.tp+e.fn,0),d=f(e.tn,e.tn+e.fp,0);return{accuracy:n,precision:l,recall:u,specificity:d}}),ht=v(()=>{var I,O,oe;const e=W((oe=(O=(I=w.result)==null?void 0:I.modules)==null?void 0:O.rsi)==null?void 0:oe.value,62),n=["伪顶","直接顶","老顶Ⅰ","老顶Ⅱ","关键层A","关键层B","关键层C","覆岩"],l=[0,-4,-2,1,3,4,2,1],u=n.map((m,B)=>y(e+l[B]*3+Math.sin(B*1.2)*2.2,24,96)),d=n.map((m,B)=>y(9-B*.7+(100-e)*.03,3,12)),k=u.map((m,B)=>y(m-d[B],0,100)),D=u.map((m,B)=>y(m+d[B],0,100)).map((m,B)=>s(m-k[B],4)),E=u.map(m=>y(102-m,4,90)),T=u.reduce((m,B,ie,Q)=>B<Q[m]?ie:m,0);return{layers:n,stability:u,lower:k,band:D,damage:E,minIdx:T}}),bt=v(()=>{var I,O,oe,m,B,ie;const e=Array.from({length:12},(Q,ae)=>`T${String(ae+1).padStart(2,"0")}`),n=W((oe=(O=(I=w.result)==null?void 0:I.modules)==null?void 0:O.bri)==null?void 0:oe.event_count,20),l=W((ie=(B=(m=w.result)==null?void 0:m.modules)==null?void 0:B.bri)==null?void 0:ie.avg_magnitude,2.6),u=e.map((Q,ae)=>Math.max(1,Math.round(n/e.length*(.8+.6*Math.sin((ae+1)/1.7))))),d=u.map((Q,ae)=>s(Q*(18+l*6)*(.85+.25*Math.cos((ae+2)/2.3)))),k=d.map((Q,ae)=>s((d[Math.max(0,ae-1)]+d[ae]+d[Math.min(d.length-1,ae+1)])/3,2));let b=0;const D=d.reduce((Q,ae)=>Q+ae,0)||1,E=d.map(Q=>(b+=Q,s(b/D*100,2))),T=d.reduce((Q,ae,Pe,Dt)=>ae>Dt[Q]?Pe:Q,0);return{windows:e,energy:d,smooth:k,eventRate:u,cumulativeRisk:E,peakIdx:T}}),gt=v(()=>{var D,E,T;const e=W((T=(E=(D=w.result)==null?void 0:D.modules)==null?void 0:E.asi)==null?void 0:T.value,58),n=[2.5,3,3.5,4,5,6,7,8,9,10],l=n.map(I=>s(y(6.5+e*.06+10/Math.max(I,1),4,34),3)),u=n.map(I=>s(y(12+e*.16+18/Math.max(I-1.5,1),8,48),3)),d=n.map((I,O)=>s(y(f(u[O],l[O],1),1,4.5),3)),k=u.reduce((I,O,oe,m)=>O>m[I]?oe:I,0),b=n.find((I,O)=>d[O]<2)||n[n.length-1];return{dist:n,radial:l,tangential:u,kt:d,peakIdx:k,riskRadius:b}}),xt=v(()=>{var I,O,oe;const e=(oe=(O=(I=w.result)==null?void 0:I.figures)==null?void 0:O.fig5_dbn)==null?void 0:oe.posterior,n=[{t:"t-4",high_risk_prob:.31},{t:"t-3",high_risk_prob:.35},{t:"t-2",high_risk_prob:.42},{t:"t-1",high_risk_prob:.48},{t:"t",high_risk_prob:.56}],l=Array.isArray(e)&&e.length?e:n,u=l.map(m=>String(m.t)),d=l.map(m=>y(W(m.high_risk_prob,0),0,1)),k=y(.22-Math.sqrt(Math.max(j.value,1))/22,.06,.2),b=d.map(m=>y(m-k,0,1)),E=d.map(m=>y(m+k,0,1)).map((m,B)=>s(m-b[B],4)),T=d.filter(m=>m>=.6).length;return{labels:u,p:d,lower:b,band:E,alertCount:T}}),wt=v(()=>{var T,I,O,oe,m;const e=y(W((I=(T=w.result)==null?void 0:T.fusion)==null?void 0:I.mpi,52),0,100),n=y(W((m=(oe=(O=w.result)==null?void 0:O.fusion)==null?void 0:oe.baseline)==null?void 0:m.mpi,e-4.5),0,100),l=y(Be.value,.5,1),u=y(He.value,.4,1),d=y(Pt.value,0,1),k=["MPI","AUC×100","PR-AUC×100","(1-Brier)×100"],b=[s(e,2),s(l*100,2),s(u*100,2),s((1-d)*100,2)],D=[s(n,2),s(y((l-.05)*100,0,100),2),s(y((u-.06)*100,0,100),2),s(y((1-(d+.05))*100,0,100),2)],E=b.map((B,ie)=>s(B-D[ie],2));return{categories:k,newScores:b,baseScores:D,gain:E}}),St=v(()=>{var I,O;const e=s(y(Be.value*100,45,99),2),n=((O=(I=w.result)==null?void 0:I.fusion)==null?void 0:O.dynamic_weights)||{rsi:.4,bri:.35,asi:.25},l=s(2.5+W(n.rsi,.4)*16,2),u=s(2.5+W(n.bri,.35)*16,2),d=s(2.5+W(n.asi,.25)*16,2),k=["全模型","去RSI","去BRI","去ASI"],b=[e,s(y(e-l,40,99),2),s(y(e-u,40,99),2),s(y(e-d,40,99),2)],D=[0,l,u,d],E=l+u+d||1,T=[0,s(l/E*100,1),s(u/E*100,1),s(d/E*100,1)];return{categories:k,score:b,drop:D,contribution:T}}),Oe=v(()=>{const e=ht.value,n=e.layers[e.minIdx],l=e.stability[e.minIdx];return`关键结论：最低稳定层位为 ${n}（${l.toFixed(1)}%），${l<60?"低于":"高于"}60%预警阈值。`}),Ne=v(()=>{const e=bt.value;return`关键结论：峰值窗口 ${e.windows[e.peakIdx]}，能量 ${e.energy[e.peakIdx].toFixed(1)} a.u.，累计风险在后半段快速抬升。`}),_t=v(()=>{const e=gt.value;return`关键结论：切向应力峰值出现在 r=${e.dist[e.peakIdx]} m，Kt>2 高风险圈带约在 r≤${e.riskRadius.toFixed(1)} m。`}),rt=v(()=>{const e=xt.value;return`关键结论：最新后验概率 ${e.p[e.p.length-1].toFixed(3)}，达到0.6报警阈值的时间片数量为 ${e.alertCount}。`}),kt=v(()=>{const e=wt.value,n=e.gain.reduce((l,u,d,k)=>u>k[l]?d:l,0);return`关键结论：最大增益指标为 ${e.categories[n]}（+${e.gain[n].toFixed(2)}）。`}),Ft=v(()=>{const e=St.value,n=e.drop.reduce((l,u,d,k)=>u>k[l]?d:l,0);return`关键结论：${e.categories[n]} 对整体性能贡献最大（移除后下降 ${e.drop[n].toFixed(2)} 分）。`}),Tt=v(()=>`关键结论：ECE=${ft.value.toFixed(4)}，有效分箱 ${We.value.centers.length} 个。`),it=v(()=>{const e=Ee.value,n=G.value,l=n?`，95%CI=[${n.aucLow.toFixed(3)}, ${n.aucHigh.toFixed(3)}]`:"";return`关键结论：AUC=${Be.value.toFixed(3)}${l}，最优阈值≈${e.threshold.toFixed(3)}（TPR=${e.recall.toFixed(2)}, FPR=${e.fpr.toFixed(2)}）。`}),je=v(()=>{const e=vt.value,n=G.value,l=n?`，95%CI=[${n.prAucLow.toFixed(3)}, ${n.prAucHigh.toFixed(3)}]`:"";return`关键结论：PR-AUC=${He.value.toFixed(3)}${l}，最佳F1=${e.f1.toFixed(3)} 对应阈值≈${e.threshold.toFixed(3)}。`}),Ge=v(()=>{const e=yt.value;return`关键结论：Accuracy=${(e.accuracy*100).toFixed(1)}%，Precision=${(e.precision*100).toFixed(1)}%，Recall=${(e.recall*100).toFixed(1)}%。`}),ut=e=>{var l;const n=String(((l=e==null?void 0:e.data)==null?void 0:l.label)||(e==null?void 0:e.name)||"").toUpperCase();(n==="TP"||n==="TN"||n==="FP"||n==="FN")&&Ae("matrix-select",n.toLowerCase())},Lt=v(()=>{const e=ht.value;return{color:[p.blue,"rgba(29,78,216,0.18)",p.orange,p.red],animationDuration:350,grid:ce,legend:M,toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("层位",!1)),{data:e.layers,nameGap:30}),yAxis:[X(Z({},c("稳定度 / 置信区间 (%)",!0)),{min:0,max:100}),X(Z({},c("损伤占比 (%)",!0)),{min:0,max:100})],series:[{name:"CI下界",type:"line",stack:"rsi_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"rsi_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.14)"}},{name:"稳定度",type:"line",data:e.stability,smooth:!0,symbolSize:7,lineStyle:{width:2.5,color:p.blue},itemStyle:{color:p.blue},markLine:{symbol:"none",label:{formatter:"预警阈值 60%",color:"#7f1d1d",fontFamily:ge,fontSize:10},lineStyle:{type:"dashed",color:"#b91c1c",width:1.2},data:[{yAxis:60}]},markPoint:{symbol:"circle",symbolSize:44,label:{color:"#111827",fontFamily:ge,fontSize:10,formatter:"最低层"},itemStyle:{color:"#fee2e2",borderColor:"#b91c1c",borderWidth:1.2},data:[{coord:[e.minIdx,e.stability[e.minIdx]]}]}},{name:"损伤占比",type:"bar",yAxisIndex:1,data:e.damage,barWidth:14,itemStyle:{color:p.orange,opacity:.75}}]}}),Ue=v(()=>{const e=bt.value;return{color:[p.orange,p.cyan,p.red],animationDuration:350,grid:ce,legend:M,toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("时间窗",!1)),{data:e.windows,nameGap:30}),yAxis:[X(Z({},c("能量释放 / 平滑能量 (a.u.)",!0)),{min:0}),X(Z({},c("事件频次 / 累计风险 (%)",!0)),{min:0,max:110})],series:[{name:"能量释放",type:"bar",data:e.energy,barWidth:14,itemStyle:{color:p.orange,opacity:.82},markPoint:{symbol:"pin",symbolSize:34,data:[{name:"峰值",coord:[e.peakIdx,e.energy[e.peakIdx]]}],label:{formatter:"峰值",fontSize:10,color:"#111827"}}},{name:"平滑能量",type:"line",data:e.smooth,smooth:!0,symbolSize:5,lineStyle:{width:2,color:p.cyan}},{name:"事件频次",type:"line",yAxisIndex:1,data:e.eventRate,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:p.slate}},{name:"累计风险",type:"line",yAxisIndex:1,data:e.cumulativeRisk,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:p.red},itemStyle:{color:p.red}}]}}),nt=v(()=>{const e=gt.value;return{color:[p.blue,p.red,p.purple],animationDuration:350,grid:{left:64,right:54,top:46,bottom:62},legend:M,toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("径向距离 r (m)",!0)),{min:2,max:10}),yAxis:[X(Z({},c("应力 (MPa)",!0)),{min:0,max:50}),X(Z({},c("应力集中系数 Kt",!0)),{min:1,max:4.5,position:"right"})],series:[{name:"径向应力 σr",type:"line",data:e.dist.map((n,l)=>[n,e.radial[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.2,color:p.blue}},{name:"切向应力 σθ",type:"line",data:e.dist.map((n,l)=>[n,e.tangential[l]]),smooth:!0,symbolSize:6,lineStyle:{width:2.4,color:p.red},markPoint:{symbol:"circle",symbolSize:40,itemStyle:{color:"#fee2e2",borderColor:p.red,borderWidth:1.2},label:{formatter:"峰值",fontSize:10,color:"#111827"},data:[{coord:[e.dist[e.peakIdx],e.tangential[e.peakIdx]]}]}},{name:"Kt=σθ/σr",type:"line",yAxisIndex:1,data:e.dist.map((n,l)=>[n,e.kt[l]]),smooth:!0,symbolSize:5,lineStyle:{width:1.9,type:"dashed",color:p.purple},markLine:{symbol:"none",label:{formatter:"Kt=2",color:p.purple,fontFamily:ge,fontSize:10},lineStyle:{color:p.purple,width:1.1,type:"dashed"},data:[{yAxis:2}]}}]}}),Ct=v(()=>{const e=xt.value;return{color:[p.blue,"rgba(29,78,216,0.18)",p.red],animationDuration:350,grid:ce,legend:M,toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("时间片",!1)),{data:e.labels,nameGap:30}),yAxis:X(Z({},c("高风险后验概率",!0)),{min:0,max:1}),series:[{name:"CI下界",type:"line",stack:"dbn_ci",data:e.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"dbn_ci",data:e.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.18)"}},{name:"后验概率",type:"line",data:e.p,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:p.red},itemStyle:{color:p.red},markLine:{symbol:"none",lineStyle:{type:"dashed",width:1.15},data:[{yAxis:.3,name:"关注阈值",lineStyle:{color:p.orange}},{yAxis:.6,name:"报警阈值",lineStyle:{color:p.red}}]}}]}}),At=v(()=>{const e=wt.value;return{color:[p.cyan,p.slate,p.red],animationDuration:350,grid:{left:74,right:54,top:46,bottom:66},legend:M,toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("指标",!1)),{data:e.categories,nameGap:30}),yAxis:[X(Z({},c("归一化分数",!0)),{min:0,max:100}),X(Z({},c("增益(新-基线)",!0)),{min:Math.min(...e.gain)-2,max:Math.max(...e.gain)+2,position:"right"})],series:[{name:"新算法",type:"bar",data:e.newScores,barWidth:14,itemStyle:{color:p.cyan}},{name:"基线算法",type:"bar",data:e.baseScores,barWidth:14,itemStyle:{color:p.slate,opacity:.85}},{name:"增益",type:"line",yAxisIndex:1,data:e.gain,symbol:"diamond",symbolSize:8,lineStyle:{width:2.2,color:p.red},label:{show:!0,position:"top",color:p.red,fontFamily:ge,fontSize:10,formatter:({value:n})=>`+${Number(n).toFixed(2)}`}}]}}),zt=v(()=>{const e=St.value,n=e.drop.reduce((l,u,d,k)=>u>k[l]?d:l,0);return{color:[p.green,p.red,p.orange],animationDuration:350,grid:{left:66,right:52,top:46,bottom:64},legend:M,toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("模型版本",!1)),{data:e.categories,nameGap:30}),yAxis:[X(Z({},c("性能分数 (AUC×100)",!0)),{min:40,max:100}),X(Z({},c("下降分数 / 贡献(%)",!0)),{min:0,max:Math.max(...e.drop,...e.contribution)+8,position:"right"})],series:[{name:"性能分数",type:"bar",data:e.score,barWidth:16,itemStyle:{color:p.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,formatter:({value:l})=>Number(l).toFixed(1)}},{name:"下降分数",type:"line",yAxisIndex:1,data:e.drop,symbolSize:8,lineStyle:{width:2,color:p.red},itemStyle:{color:p.red},markPoint:{symbol:"pin",symbolSize:34,data:[{coord:[n,e.drop[n]],name:"最大下降"}],label:{formatter:"最大下降",fontSize:10,color:"#111827"}}},{name:"贡献率(%)",type:"line",yAxisIndex:1,data:e.contribution,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:p.orange}}]}}),Mt=v(()=>{const e=We.value,n=Math.max(...e.count,1);return{color:[p.blue,"rgba(29,78,216,0.2)","#94a3b8",p.cyan],animationDuration:350,grid:{left:66,right:54,top:46,bottom:62},legend:M,toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("预测概率",!0)),{min:0,max:1,interval:.1}),yAxis:[X(Z({},c("真实频率",!0)),{min:0,max:1,interval:.1}),X(Z({},c("样本数",!0)),{min:0,max:n+2,position:"right"})],series:[{name:"理想校准线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.4,type:"dashed",color:"#94a3b8"}},{name:"CI下界",type:"line",stack:"cal_ci",data:e.centers.map((l,u)=>[l,e.lower[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"cal_ci",data:e.centers.map((l,u)=>[l,e.band[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.15)"}},{name:"校准曲线",type:"line",data:e.centers.map((l,u)=>[l,e.obs[u]]),smooth:!0,symbolSize:7,lineStyle:{width:2.4,color:p.blue},itemStyle:{color:p.blue}},{name:"分箱样本数",type:"bar",yAxisIndex:1,data:e.centers.map((l,u)=>[l,e.count[u]]),barWidth:18,itemStyle:{color:"#cbd5e1",opacity:.6}}],graphic:[{type:"text",right:26,top:18,style:{text:`ECE=${ft.value.toFixed(4)}`,font:`600 12px ${ge}`,fill:"#0f172a"}}]}}),ct=v(()=>{const e=Ee.value,n=Qe.value,l=be.value,u=G.value,d=`ROC 曲线 (AUC=${Be.value.toFixed(3)})`,k=u?`AUC 95%CI [${u.aucLow.toFixed(3)}, ${u.aucHigh.toFixed(3)}]`:"AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",p.blue,p.red],animationDuration:350,grid:ce,legend:X(Z({},M),{data:["随机参考线",d,"最优阈值点"]}),toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("假阳性率 FPR",!0)),{min:0,max:1,interval:.1}),yAxis:X(Z({},c("真阳性率 TPR",!0)),{min:0,max:1,interval:.1}),series:[{name:"随机参考线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__roc_ci_low__",type:"line",stack:"roc_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__roc_ci_band__",type:"line",stack:"roc_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"ROC 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"ROC 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:d,type:"line",smooth:!0,data:z.value,symbolSize:5,lineStyle:{width:2.6,color:p.blue},areaStyle:{color:"rgba(29,78,216,0.12)"}},{name:"最优阈值点",type:"scatter",data:[[e.fpr,e.recall]],symbolSize:12,itemStyle:{color:p.red},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:p.red,formatter:`thr=${e.threshold.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:k,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),qe=v(()=>{const n=[];for(let l=1;l<=99;l+=1){const u=l/100,d=2*u-.6;if(d<=0)continue;const k=y(.6*u/d,0,1);k>0&&k<=1&&n.push([u,k])}return n}),Ye=v(()=>{const e=vt.value,n=ye.value,l=et.value,u=G.value,d=`PR 曲线 (PR-AUC=${He.value.toFixed(3)})`,k=u?`PR-AUC 95%CI [${u.prAucLow.toFixed(3)}, ${u.prAucHigh.toFixed(3)}]`:"PR-AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",p.orange,p.red,p.green],animationDuration:350,grid:ce,legend:X(Z({},M),{data:["基线(阳性占比)","F1=0.6 等值线",d,"最佳F1点"]}),toolbox:L,dataZoom:C,tooltip:{trigger:"axis"},xAxis:X(Z({},c("召回率 Recall",!0)),{min:0,max:1,interval:.1}),yAxis:X(Z({},c("精确率 Precision",!0)),{min:0,max:1,interval:.1}),series:[{name:"基线(阳性占比)",type:"line",data:[[0,ne.value],[1,ne.value]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__pr_ci_low__",type:"line",stack:"pr_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__pr_ci_band__",type:"line",stack:"pr_ci",data:l,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"PR 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"PR 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"F1=0.6 等值线",type:"line",data:qe.value,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:p.orange}},{name:d,type:"line",smooth:!0,data:ue.value,symbolSize:5,lineStyle:{width:2.6,color:p.red}},{name:"最佳F1点",type:"scatter",data:[[e.recall,e.precision]],symbolSize:12,itemStyle:{color:p.green},label:{show:!0,position:"top",fontFamily:ge,fontSize:10,color:p.green,formatter:`F1=${e.f1.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:k,font:`600 11px ${ge}`,fill:"#0f172a"}}]}}),dt=v(()=>{const e=tt.value,n=Math.max(e.tp+e.tn+e.fp+e.fn,1),l=[{value:[0,0,e.tn,e.tn/n],label:"TN"},{value:[1,0,e.fp,e.fp/n],label:"FP"},{value:[0,1,e.fn,e.fn/n],label:"FN"},{value:[1,1,e.tp,e.tp/n],label:"TP"}],u=yt.value;return{animationDuration:350,grid:{left:76,right:120,top:38,bottom:66},toolbox:X(Z({},L),{feature:{restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}}),tooltip:{trigger:"item",formatter:({data:d})=>`${d.label}：${d.value[2]} (${(d.value[3]*100).toFixed(1)}%)`},xAxis:X(Z({},c("预测类别",!1)),{data:["低风险","高风险"],nameGap:34,splitLine:{show:!1}}),yAxis:X(Z({},c("真实类别",!1)),{data:["低风险","高风险"],nameGap:54,splitLine:{show:!1}}),visualMap:{min:0,max:Math.max(e.tp,e.tn,e.fp,e.fn,1),orient:"vertical",right:18,top:"middle",text:["高","低"],textStyle:{fontFamily:ge,fontSize:11,color:"#0f172a"},inRange:{color:["#ecfeff","#67e8f9","#0e7490"]}},series:[{name:"混淆矩阵",type:"heatmap",data:l,label:{show:!0,color:"#0f172a",fontFamily:ge,fontSize:11,formatter:({data:d})=>`${d.label}
${d.value[2]}
${(d.value[3]*100).toFixed(1)}%`},itemStyle:{borderWidth:1,borderColor:"#e2e8f0"}}],graphic:[{type:"group",right:10,bottom:8,children:[{type:"text",top:0,style:{text:`Acc ${(u.accuracy*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:16,style:{text:`Prec ${(u.precision*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:32,style:{text:`Rec ${(u.recall*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}},{type:"text",top:48,style:{text:`Spec ${(u.specificity*100).toFixed(1)}%`,font:`600 11px ${ge}`,fill:"#0f172a"}}]}]}});return(e,n)=>(ee(),te("section",ao,[o("header",lo,[n[0]||(n[0]=o("div",{class:"head-title"},[o("h4",null,"SCI 配图增强版（图2-图11）"),o("p",null,"统一采用期刊风格坐标系、阈值注记、置信区间和关键决策点标注。")],-1)),o("div",so,[o("span",ro,"样本 n="+h(j.value),1),o("span",io,"正样本占比 "+h(F(ne.value)),1),G.value?(ee(),te("span",uo,"Bootstrap "+h(G.value.iterations)+"次",1)):_e("",!0),o("span",{class:ot(["metric-chip",{warn:N.value!=="real_label_stream"}])},"评估源 "+h(le.value),3),H.value?(ee(),te("span",co,"标签文件 "+h(H.value),1)):_e("",!0)])]),o("article",mo,[n[1]||(n[1]=o("h4",null,"图2 | RSI 机制剖面图（稳定度-损伤-置信带）",-1)),$e(Le,{option:Lt.value,height:336},null,8,["option"]),n[2]||(n[2]=o("p",{class:"caption"},"怎么看：稳定度实线越高越好，误差带越窄代表层位响应更稳定，损伤柱越低越好。",-1)),o("p",po,h(Oe.value),1)]),o("article",vo,[n[3]||(n[3]=o("h4",null,"图3 | BRI 微震能量释放、事件频次与累计风险",-1)),$e(Le,{option:Ue.value,height:336},null,8,["option"]),n[4]||(n[4]=o("p",{class:"caption"},"怎么看：能量柱与事件频次线共同识别冲击窗口，累计风险线反映风险积聚过程。",-1)),o("p",fo,h(Ne.value),1)]),o("article",yo,[n[5]||(n[5]=o("h4",null,"图4 | ASI 径向/切向应力与应力集中系数 Kt",-1)),$e(Le,{option:nt.value,height:336},null,8,["option"]),n[6]||(n[6]=o("p",{class:"caption"},"怎么看：切向应力峰值与 Kt>2 区段对应高风险圈带，径向应力反映卸压后衰减。",-1)),o("p",ho,h(_t.value),1)]),o("article",bo,[n[7]||(n[7]=o("h4",null,"图5 | DBN 后验概率时序（95% CI + 预警阈值）",-1)),$e(Le,{option:Ct.value,height:336},null,8,["option"]),n[8]||(n[8]=o("p",{class:"caption"},"怎么看：后验概率曲线跨过 0.6 报警阈值时需触发强化巡检，CI 带越窄越可信。",-1)),o("p",go,h(rt.value),1)]),o("article",xo,[n[9]||(n[9]=o("h4",null,"图6 | 新旧算法多指标对比（分数 + 增益）",-1)),$e(Le,{option:At.value,height:336},null,8,["option"]),n[10]||(n[10]=o("p",{class:"caption"},"怎么看：柱形给出绝对分数，增益折线给出替代旧算法的实际收益幅度。",-1)),o("p",wo,h(kt.value),1)]),o("article",So,[n[11]||(n[11]=o("h4",null,"图7 | 消融实验（模块贡献与性能下降）",-1)),$e(Le,{option:zt.value,height:336},null,8,["option"]),n[12]||(n[12]=o("p",{class:"caption"},"怎么看：去除模块后的性能下降越大，说明该模块对总体性能贡献越关键。",-1)),o("p",_o,h(Ft.value),1)]),o("article",ko,[n[13]||(n[13]=o("h4",null,"图8 | 校准曲线（含样本直方图与置信区间）",-1)),$e(Le,{option:Mt.value,height:336},null,8,["option"]),n[14]||(n[14]=o("p",{class:"caption"},"怎么看：曲线贴近对角线且 ECE 越低，模型概率输出越可直接用于阈值决策。",-1)),o("p",Co,h(Tt.value),1)]),o("article",Ao,[n[15]||(n[15]=o("h4",null,"图9 | ROC 曲线（最优阈值点与 AUC）",-1)),$e(Le,{option:ct.value,height:336},null,8,["option"]),n[16]||(n[16]=o("p",{class:"caption"},"怎么看：曲线越靠左上角越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，红点为 Youden 最优阈值。",-1)),o("p",Mo,h(it.value),1)]),o("article",No,[n[17]||(n[17]=o("h4",null,"图10 | PR 曲线（基线、F1 等值线与最优点）",-1)),$e(Le,{option:Ye.value,height:336},null,8,["option"]),n[18]||(n[18]=o("p",{class:"caption"},"怎么看：PR 曲线整体越高越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，绿点为最佳F1运行点。",-1)),o("p",Io,h(je.value),1)]),o("article",$o,[n[19]||(n[19]=o("h4",null,"图11 | 混淆矩阵热图（计数 + 占比 + 诊断指标）",-1)),$e(Le,{option:dt.value,height:336,onChartClick:ut},null,8,["option"]),n[20]||(n[20]=o("p",{class:"caption"},"怎么看：对角线高、非对角低为理想状态；右侧指标用于误报/漏报成本权衡。",-1)),o("p",Ro,h(Ge.value),1)])]))}},Fo=Vt(Po,[["__scopeId","data-v-f81ec0ce"]]),To={class:"top-nav"},Lo={class:"nav-left"},zo={class:"seam-select"},Do=["value"],Eo={key:0,class:"mini-stats"},Bo={class:"danger"},Oo={class:"nav-right"},Uo=["disabled"],Vo=["disabled"],Wo={class:"metric-dashboard"},Ho=["onClick"],jo={class:"head"},Go={class:"value"},qo={class:"meta"},Yo={class:"main-layout"},Zo={class:"main-canvas-card"},Xo={class:"canvas-head"},Jo={class:"canvas-controls"},Ko={class:"check"},Qo={class:"check"},ea={key:0,class:"trust-banner"},ta={class:"trust-chip warn"},na={key:0,class:"trust-chip link"},oa={key:1,class:"trust-meta"},aa={class:"trust-meta"},la={key:0,class:"loading-mask"},sa={class:"legend-wrap"},ra={class:"legend-labels"},ia={class:"thumb-list"},ua=["onClick","onMouseenter","onMousemove"],ca={class:"thumb-meta"},da={key:0,class:"floating-panel"},ma={class:"weight-row"},pa={class:"weight-row"},va={class:"weight-row"},fa={key:0,class:"eval-drawer"},ya={class:"actions"},ha={key:0,class:"panel-empty"},ba={key:1,class:"panel-empty"},ga={class:"eval-grid"},xa={class:"metric"},wa={class:"metric"},Sa={class:"metric"},_a={class:"metric"},ka={class:"metric"},Ca={class:"eval-content"},Aa={class:"cm-card"},Ma={class:"cm-grid"},Na={class:"cm-cell"},Ia={class:"cm-cell warn"},$a={class:"cm-cell warn"},Ra={class:"cm-cell"},Pa={class:"baseline-card"},Fa={viewBox:"0 0 560 170",class:"baseline-svg"},Ta=["width"],La={x:"485",y:"26"},za=["width"],Da={x:"485",y:"90"},Ea={key:0,class:"science-section"},Ba={class:"data-note"},Oa={key:1,class:"export-note"},Ua={class:"risk"},Va={__name:"AlgorithmValidation",setup(g){const q=Yn(),w=qn(),{workspaceState:Ae,setSelectedSeam:p,markStepDone:ce}=On(),y=[{key:"mpi",label:"MPI",desc:"综合指标"},{key:"rsi",label:"RSI",desc:"顶板稳定"},{key:"bri",label:"BRI",desc:"冲击风险"},{key:"asi",label:"ASI",desc:"支承应力"}],W={tp:{label:"TP 真阳性",color:"#15803d"},tn:{label:"TN 真阴性",color:"#1d4ed8"},fp:{label:"FP 假阳性",color:"#d97706"},fn:{label:"FN 假阴性",color:"#b91c1c"}},F=K(null),s=K(null),f=K(null),c=K(null),M=K(null),L=K([]),C=K(""),R=K(50),N=K(9),H=K("idw"),le=K(!0),U=K(!0),j=K("mpi"),de=K(!1),me=K(!1),ne=K(!1),pe=K(!0),xe=K(!1),V=Rt({rsi:.4,bri:.35,asi:.25}),$=Gn(null),z=K(null),ue=K(!1),he=K(""),re=K(!1),ke=K(""),J=K(null),Re=Rt({x:0,y:0}),ve=Rt({visible:!1,metric:"",x:0,y:0}),G=K("pseudo_threshold"),Qe=K(""),be=K("all"),ye=K(null),et=K(!1),at={},lt=new Map;let Ee=null;const vt=()=>Ce(this,null,function*(){if(Ee)return Ee;const a=yield Un(()=>import("./jszip-CsMIhXuR.js").then(t=>t.j),[]);if(Ee=(a==null?void 0:a.default)||(a==null?void 0:a.JSZip)||window.JSZip||null,!Ee)throw new Error("JSZip 加载失败");return Ee}),{viewport:st,worldToScreen:We,screenToWorld:Be,fitToBounds:He,startDrag:Pt,dragTo:ft,endDrag:tt,zoomAt:yt}=Qn(),{getLegendGradient:ht,drawGrid:bt,drawBoreholes:gt,pickNearestBorehole:xt,sampleGridValue:wt,drawMiniHeatmap:St}=no(),Oe=v(()=>{const a=V.rsi+V.bri+V.asi||1;return{rsi:V.rsi/a,bri:V.bri/a,asi:V.asi/a}}),Ne=v(()=>{var a,t,i;return!!((a=$.value)!=null&&a.grids&&((t=$.value)!=null&&t.statistics)&&((i=$.value)!=null&&i.boreholes))}),_t=v(()=>{var a,t;return((t=(a=$.value)==null?void 0:a.statistics)==null?void 0:t[j.value])||{}}),rt=v(()=>{var a,t,i;return Number(((i=(t=(a=$.value)==null?void 0:a.statistics)==null?void 0:t.mpi)==null?void 0:i.mean)||0)}),kt=v(()=>Math.max(0,rt.value-4.5)),Ft=v(()=>O(j.value)),Tt=v(()=>G.value==="real_label_stream"?"真实标签流":G.value==="pseudo_threshold"?"伪标签估计（阈值构造）":G.value==="none"?"无可评估样本":"未知来源"),it=v(()=>{var a,t;return U.value?{min:0,mean:50,max:100}:((t=(a=$.value)==null?void 0:a.statistics)==null?void 0:t[j.value])||{min:0,mean:0,max:0}}),je=v(()=>{var t,i,x,r;const a={};for(const S of y){const _=((i=(t=$.value)==null?void 0:t.statistics)==null?void 0:i[S.key])||{},A=(r=(x=$.value)==null?void 0:x.grids)==null?void 0:r[S.key];let P=0,se=0,fe=0,Y=Number.POSITIVE_INFINITY,Se=Number.NEGATIVE_INFINITY;if(Array.isArray(A))for(const Ze of A)for(const Xe of Ze||[]){const Ie=Number(Xe);Number.isFinite(Ie)&&(P+=1,se+=Ie,fe+=Ie*Ie,Ie<Y&&(Y=Ie),Ie>Se&&(Se=Ie))}const Me=P?se/P:Number(_.mean||0),Fe=P?Math.max(fe/P-Me*Me,0):0;a[S.key]={min:Number.isFinite(Number(_.min))?Number(_.min):P?Y:0,max:Number.isFinite(Number(_.max))?Number(_.max):P?Se:0,mean:Me,std:Math.sqrt(Fe)}}return a}),Ge=v(()=>je.value[ve.metric]||null),ut=v(()=>{var Y,Se,Me,Fe,Ze,Xe,Ie,Je;if(!Ne.value)return null;const a=je.value,t=((Y=$.value)==null?void 0:Y.boreholes)||[],i=Wt(),x=Number(((Se=a.mpi)==null?void 0:Se.mean)||0),r=Math.max(0,x-4.5),S=r>0?(x-r)/r*100:0,_=t.length||1,A=O("mpi")/_,P=E(1-x/100,0,1),se=E(Number(((Me=z.value)==null?void 0:Me.auc)||.7)-.5,0,.45),fe=["t-4","t-3","t-2","t-1","t"].map(($t,Ve)=>({t:$t,high_risk_prob:E(P+(Ve-2)*.05+se*.2,.05,.95)}));return{modules:{rsi:{value:Number(((Fe=a.rsi)==null?void 0:Fe.mean)||0),input_layers:6},bri:{value:Number(((Ze=a.bri)==null?void 0:Ze.mean)||0),event_count:t.length,avg_magnitude:2.6},asi:{value:Number(((Xe=a.asi)==null?void 0:Xe.mean)||0),avg_friction_angle:31.2}},fusion:{mpi:x,baseline:{mpi:r},dynamic_weights:Oe.value},kpi:{mpi_mean:x,high_risk_ratio:A,auc:Number(((Ie=z.value)==null?void 0:Ie.auc)||.7),brier_score:Number(((Je=z.value)==null?void 0:Je.brier)||.24),improvement_vs_baseline_pct:S},figures:{fig5_dbn:{posterior:fe}},evaluation_inputs:i}}),Lt=a=>{var t;return((t=W[String(a||"").toLowerCase()])==null?void 0:t.label)||"全部"},Ue=v(()=>{var _,A;const a=((_=$.value)==null?void 0:_.boreholes)||[],t=((A=ut.value)==null?void 0:A.evaluation_inputs)||{},i=Array.isArray(t.y_true)?t.y_true:Array.isArray(t.yTrue)?t.yTrue:[],x=Array.isArray(t.y_prob)?t.y_prob:Array.isArray(t.yProb)?t.yProb:[];if(!a.length||i.length!==a.length||x.length!==a.length)return{available:!1,roles:[],counts:{tp:0,tn:0,fp:0,fn:0}};const r=[],S={tp:0,tn:0,fp:0,fn:0};for(let P=0;P<a.length;P+=1){const se=Number(i[P])>=1?1:0,fe=Number(x[P])>=.5?1:0,Y=se===1?fe===1?"tp":"fn":fe===1?"fp":"tn";r.push(Y),S[Y]+=1}return{available:!0,roles:r,counts:S}}),nt=v(()=>Ue.value.available),Ct=v(()=>{var t;if(be.value==="all")return 0;const a=String(be.value).toLowerCase();return Number(((t=Ue.value.counts)==null?void 0:t[a])||0)}),At=v(()=>{const a=String(be.value||"").toLowerCase();if(!Ue.value.available||!["tp","tn","fp","fn"].includes(a))return[];const t=[];for(let i=0;i<Ue.value.roles.length;i+=1)Ue.value.roles[i]===a&&t.push(i);return t}),zt=v(()=>new Set(At.value)),Mt=v(()=>{var t;const a=String(be.value||"").toLowerCase();return["tp","tn","fp","fn"].includes(a)?{active:!0,indexSet:zt.value,accent:((t=W[a])==null?void 0:t.color)||"#111827"}:null}),ct=v(()=>be.value!=="all"&&nt.value&&!et.value);let qe=0,Ye=0,dt=null,e=null,n=0,l=0;const u=()=>{window.clearTimeout(dt),dt=window.setTimeout(()=>{ae(),Pe(),we(),Nt()},80)},d=a=>{var t;return((t=y.find(i=>i.key===a))==null?void 0:t.label)||a.toUpperCase()},k=a=>ht(a),b=(a,t=2)=>a==null||Number.isNaN(Number(a))?"--":Number(a).toFixed(t),D=a=>`${(Number(a||0)*100).toFixed(0)}%`,E=(a,t,i)=>Math.max(t,Math.min(i,a)),T=a=>{const t=String(a||"").toLowerCase();return t.includes("high")||t.includes("高")?"高风险":t.includes("medium")||t.includes("中")?"中风险":t.includes("low")||t.includes("低")?"低风险":"未知"},I=a=>`${E(Number(a||0),0,100)*3.6}`,O=a=>{var t;return(((t=$.value)==null?void 0:t.boreholes)||[]).filter(i=>Number(i[a])<50).length},oe=a=>{var t,i;return U.value?{min:0,mean:50,max:100}:((i=(t=$.value)==null?void 0:t.statistics)==null?void 0:i[a])||{min:0,mean:0,max:0}},m=()=>{const a=Number(N.value);N.value=Number.isFinite(a)?Math.max(5,Math.min(24,Math.round(a))):9},B=(a,t,i)=>{if(!Array.isArray(i)||i.length===0)return{borehole:null,distance:null};let x=null,r=Number.POSITIVE_INFINITY;for(const S of i){const _=Number(S.x)-a,A=Number(S.y)-t,P=Math.hypot(_,A);P<r&&(r=P,x=S)}return{borehole:x,distance:Number.isFinite(r)?r:null}},ie=()=>{const a=Oe.value;return[C.value,R.value,H.value,a.rsi.toFixed(3),a.bri.toFixed(3),a.asi.toFixed(3)].join("|")},Q=a=>t=>{t?(at[a]=t,Nt()):delete at[a]},ae=()=>{if(!s.value||!c.value||!M.value)return;const a=s.value.getBoundingClientRect(),t=window.devicePixelRatio||1,i=Math.max(1,Math.floor(a.width*t)),x=Math.max(1,Math.floor(a.height*t));for(const r of[c.value,M.value])r.width=i,r.height=x},Pe=()=>{var t;const a=(t=$.value)==null?void 0:t.bounds;!a||!c.value||(He(a,c.value.width,c.value.height,62),we())},Dt=(a,t,i)=>{const x=String(be.value||"").toLowerCase();if(!["tp","tn","fp","fn"].includes(x)||!Ue.value.available)return;const r=W[x],S=At.value;S.length&&(a.save(),a.fillStyle="rgba(15, 23, 42, 0.88)",a.fillRect(12,10,250,28),a.fillStyle="#f8fafc",a.font="600 12px 'Noto Sans SC', 'Segoe UI', sans-serif",a.fillText(`联动筛选: ${r.label} (${S.length})  Esc清除`,22,29),a.restore())},Et=()=>{var _,A,P;if(qe=0,!c.value||!M.value)return;const a=$.value,t=c.value.getContext("2d"),i=M.value.getContext("2d");if(t.clearRect(0,0,c.value.width,c.value.height),i.clearRect(0,0,M.value.width,M.value.height),!a)return;const x=j.value,r=oe(x);bt(t,(_=a.grids)==null?void 0:_[x],a.bounds,st,x,r,We,{showContours:le.value,contourLevels:N.value});const S=Mt.value?X(Z({},Mt.value),{animate:ct.value,pulseT:performance.now()/1e3}):null;gt(i,a.boreholes,x,r,a.bounds,We,((P=(A=J.value)==null?void 0:A.borehole)==null?void 0:P.borehole_name)||"",S),Dt(i,a.boreholes||[],a.bounds),J.value&&(i.strokeStyle="rgba(15, 23, 42, 0.55)",i.lineWidth=1.1,i.setLineDash([5,4]),i.beginPath(),i.moveTo(J.value.sx,0),i.lineTo(J.value.sx,M.value.height),i.moveTo(0,J.value.sy),i.lineTo(M.value.width,J.value.sy),i.stroke(),i.setLineDash([])),ct.value&&we()},mn=()=>{var t;Ye=0;const a=$.value;if(a)for(const i of y){const x=at[i.key];x&&St(x,(t=a.grids)==null?void 0:t[i.key],i.key,oe(i.key))}},we=()=>{qe||(qe=window.requestAnimationFrame(Et))},Nt=()=>{Ye||(Ye=window.requestAnimationFrame(mn))},Wt=()=>{var r,S;const a=(r=$.value)==null?void 0:r.evaluation_inputs;if((a==null?void 0:a.mode)==="real_label_stream"){const _=Array.isArray(a.y_true)?a.y_true:[],A=Array.isArray(a.y_prob)?a.y_prob:[];if(_.length===A.length&&_.length>=2){const P=_.map(Y=>Number(Y)>=1?1:0),se=A.map(Y=>E(Number(Y),0,1));if(se.every(Y=>Number.isFinite(Y))&&new Set(P).size>1)return{mode:"real_label_stream",source:String(a.source||""),sourceFile:String(a.source||""),y_true:P,y_prob:se,yTrue:P,yProb:se}}}const t=((S=$.value)==null?void 0:S.boreholes)||[];if(t.length<4)return null;let i=t.map(_=>_.rsi<50||_.bri<50||_.asi<50?1:0);const x=t.map(_=>E(1-Number(_.mpi||0)/100,0,1));if(new Set(i).size<2){const _=t.map(P=>Number(P.mpi||0)).sort((P,se)=>P-se),A=_[Math.floor(_.length/2)];i=t.map(P=>Number(P.mpi||0)<=A?1:0)}return{mode:"pseudo_threshold",source:"",sourceFile:"",y_true:i,y_prob:x,yTrue:i,yProb:x}},pn=()=>Ce(this,null,function*(){var i,x;const a=++l,t=Wt();if(!t){if(a!==l)return;G.value="none",Qe.value="",z.value=null,he.value="当前煤层钻孔点不足，无法计算评估指标。";return}if(a===l){G.value=t.mode||"pseudo_threshold",Qe.value=t.sourceFile||"",ue.value=!0,he.value="";try{const r=yield Jn({y_true:t.y_true||t.yTrue,y_prob:t.y_prob||t.yProb});if(a!==l)return;z.value=r.data}catch(r){if(a!==l)return;z.value=null,he.value=((x=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:x.detail)||"评估指标计算失败"}finally{a===l&&(ue.value=!1)}}}),Ht=a=>Ce(this,null,function*(){$.value=a,J.value=null,be.value="all",yield Ut(),ae(),Pe(),we(),Nt(),pn()}),It=(...t)=>Ce(this,[...t],function*({force:a=!1}={}){var r,S;if(!C.value)return;const i=++n,x=ie();if(!a&&lt.has(x)){if(i!==n)return;yield Ht(lt.get(x));return}de.value=!0;try{const _=yield Xn(C.value,R.value,H.value,Oe.value);if(i!==n)return;const A=_.data;lt.set(x,A),yield Ht(A),ce("AlgorithmValidation",{validationReady:!0})}catch(_){if(i!==n)return;he.value=((S=(r=_==null?void 0:_.response)==null?void 0:r.data)==null?void 0:S.detail)||"空间总览加载失败"}finally{i===n&&(de.value=!1)}}),vn=a=>{const t=String(a||"").toLowerCase();["tp","tn","fp","fn"].includes(t)&&nt.value&&(be.value=be.value===t?"all":t,we())},jt=()=>{be.value="all",we()},Gt=a=>{a.key==="Escape"&&be.value!=="all"&&jt()},fn=a=>{var t,i;!Ne.value||!s.value||a.pointerType==="mouse"&&a.button!==0||ye.value!==null&&ye.value!==a.pointerId||(ye.value=a.pointerId,(i=(t=s.value).setPointerCapture)==null||i.call(t,a.pointerId),Pt(a.clientX,a.clientY))},yn=a=>{var fe,Y,Se,Me,Fe;if(ye.value!==null&&a.pointerId!==ye.value||!M.value||!Ne.value)return;const t=M.value.getBoundingClientRect(),i=window.devicePixelRatio||1,x=(a.clientX-t.left)*i,r=(a.clientY-t.top)*i;if(Re.x=a.clientX-t.left,Re.y=a.clientY-t.top,st.isDragging){ft(a.clientX,a.clientY),we();return}const S=(fe=$.value)==null?void 0:fe.bounds,_=Be(x,r,S),A=j.value,P=B(_.x,_.y,((Y=$.value)==null?void 0:Y.boreholes)||[]),se=xt(x,r,((Se=$.value)==null?void 0:Se.boreholes)||[],S,We);J.value={sx:x,sy:r,worldX:_.x,worldY:_.y,gridValue:wt((Fe=(Me=$.value)==null?void 0:Me.grids)==null?void 0:Fe[A],S,_.x,_.y),borehole:se,nearestBorehole:P.borehole,nearestDistance:P.distance},we()},hn=a=>{var t,i;ye.value!==null&&a.pointerId!==ye.value||((i=(t=s.value)==null?void 0:t.hasPointerCapture)!=null&&i.call(t,a.pointerId)&&s.value.releasePointerCapture(a.pointerId),ye.value=null,tt())},bn=a=>{var t,i;ye.value!==null&&a.pointerId!==ye.value||((i=(t=s.value)==null?void 0:t.hasPointerCapture)!=null&&i.call(t,a.pointerId)&&s.value.releasePointerCapture(a.pointerId),ye.value=null,tt(),J.value=null,we())},gn=a=>{var t,i;if(ye.value!==null&&a.pointerId===ye.value){if((i=(t=s.value)==null?void 0:t.hasPointerCapture)==null?void 0:i.call(t,a.pointerId))return;ye.value=null,tt()}st.isDragging||(J.value=null,we())},xn=a=>{var S;if(!M.value||!Ne.value)return;const t=M.value.getBoundingClientRect(),i=window.devicePixelRatio||1,x=(a.clientX-t.left)*i,r=(a.clientY-t.top)*i;yt(a.deltaY<0?1.14:.88,x,r,(S=$.value)==null?void 0:S.bounds),we()},wn=(a,t)=>{ve.metric=a,qt(a,t)},qt=(a,t)=>{if(!f.value)return;const i=f.value.getBoundingClientRect();ve.visible=!0,ve.metric=a,ve.x=t.clientX-i.left,ve.y=t.clientY-i.top},Sn=()=>{ve.visible=!1},Yt=a=>String(a||"figure").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),Zt=(a,t="image/png",i=1)=>new Promise((x,r)=>{a.toBlob(S=>{S?x(S):r(new Error("Canvas 导出失败"))},t,i)}),_n=a=>{const t=a.cloneNode(!0);return t.getAttribute("xmlns")||t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.getAttribute("xmlns:xlink")||t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),new XMLSerializer().serializeToString(t)},kn=(a,t,i,x=3)=>Ce(this,null,function*(){const r=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),S=URL.createObjectURL(r);try{const _=yield new Promise((se,fe)=>{const Y=new Image;Y.onload=()=>se(Y),Y.onerror=()=>fe(new Error("SVG 转 PNG 失败")),Y.src=S}),A=document.createElement("canvas");A.width=Math.max(1,Math.round(t*x)),A.height=Math.max(1,Math.round(i*x));const P=A.getContext("2d");return P.fillStyle="#ffffff",P.fillRect(0,0,A.width,A.height),P.drawImage(_,0,0,A.width,A.height),yield Zt(A,"image/png",1)}finally{URL.revokeObjectURL(S)}}),Cn=()=>new Promise(a=>window.requestAnimationFrame(a)),Xt=a=>Ce(this,null,function*(){const t=et.value;et.value=!0,Et(),yield Cn();try{return yield a()}finally{et.value=t,Et(),ct.value&&we()}}),An=()=>Ce(this,null,function*(){!c.value||!M.value||(yield Xt(()=>Ce(this,null,function*(){const t=c.value.width,i=c.value.height,x=document.createElement("canvas");x.width=Math.round(t*3),x.height=Math.round(i*3);const r=x.getContext("2d");r.scale(3,3),r.fillStyle="#ffffff",r.fillRect(0,0,t,i),r.drawImage(c.value,0,0),r.drawImage(M.value,0,0),r.fillStyle="rgba(15, 23, 42, 0.92)",r.font="14px 'Times New Roman', 'Noto Serif SC', serif",r.fillText(`煤层：${C.value||"--"} | 指标：${d(j.value)} | 分辨率：${R.value}`,16,26);const S=document.createElement("a");S.href=x.toDataURL("image/png",1),S.download=`algorithm_validation_${C.value||"seam"}_${j.value}_hd.png`,S.click()})))}),Mn=()=>Ce(this,null,function*(){if(!(!F.value||!Ne.value||re.value)){re.value=!0,ke.value="";try{yield Xt(()=>Ce(this,null,function*(){var Me,Fe,Ze;const a=yield vt(),t=new a,i=new Date().toISOString().replace(/[:.]/g,"-"),x=document.createElement("canvas"),r=3,S=c.value.width,_=c.value.height;x.width=Math.round(S*r),x.height=Math.round(_*r);const A=x.getContext("2d");A.scale(r,r),A.fillStyle="#ffffff",A.fillRect(0,0,S,_),A.drawImage(c.value,0,0),A.drawImage(M.value,0,0),A.fillStyle="rgba(15, 23, 42, 0.92)",A.font="14px 'Times New Roman', 'Noto Serif SC', serif",A.fillText(`煤层：${C.value||"--"} | 指标：${d(j.value)} | 分辨率：${R.value}`,16,26),t.file("figures/main_heatmap_hd.png",yield Zt(x,"image/png",1));const P=F.value.querySelectorAll(".science-section .figure-card");let se=0;for(const Xe of P){se+=1;const Ie=((Fe=(Me=Xe.querySelector("h4"))==null?void 0:Me.textContent)==null?void 0:Fe.trim())||`图${se}`,Je=Xe.querySelector(".science-chart svg");if(!Je)continue;const $t=Je.getBoundingClientRect(),Ve=(Ze=Je.viewBox)==null?void 0:Ze.baseVal,Fn=(Ve==null?void 0:Ve.width)||$t.width||960,Tn=(Ve==null?void 0:Ve.height)||$t.height||540,Jt=_n(Je),Kt=Yt(`${String(se).padStart(2,"0")}_${Ie}`);t.file(`figures/${Kt}.svg`,Jt),t.file(`figures/${Kt}.png`,yield kn(Jt,Fn,Tn,3))}t.file("data/spatial_statistics.json",JSON.stringify(je.value,null,2)),t.file("data/evaluation.json",JSON.stringify(z.value||{},null,2)),t.file("data/science_result.json",JSON.stringify(ut.value||{},null,2)),t.file("README.txt",["新算法实证图组导出包",`时间: ${new Date().toLocaleString()}`,`煤层: ${C.value||"--"}`,`主图指标: ${d(j.value)}`,"","内容说明:","- figures/: 主热力图和图2-图11（SVG+PNG）","- data/: 统计与评估原始数据"].join(`
`));const fe=yield t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),Y=URL.createObjectURL(fe),Se=document.createElement("a");Se.href=Y,Se.download=`新算法实证图组_${Yt(C.value||"seam")}_${i}.zip`,Se.click(),URL.revokeObjectURL(Y)})),ke.value="图组包导出完成。"}catch(a){ke.value=(a==null?void 0:a.message)||"图组包导出失败"}finally{re.value=!1}}}),Nn=()=>{if(!$.value)return;const a=new Blob([JSON.stringify($.value,null,2)],{type:"application/json"}),t=URL.createObjectURL(a),i=document.createElement("a");i.href=t,i.download=`algorithm_validation_${C.value||"seam"}_spatial.json`,i.click(),URL.revokeObjectURL(t)},In=()=>Ce(this,null,function*(){F.value&&(document.fullscreenElement?yield document.exitFullscreen():yield F.value.requestFullscreen())}),$n=a=>Array.isArray(a)?a[0]||"":typeof a=="string"?a:"",Rn=()=>{w.push({name:"Report",query:C.value?{seam:C.value}:void 0})},Pn=()=>Ce(this,null,function*(){var a,t,i,x;try{const r=yield Zn(),S=((a=r==null?void 0:r.data)==null?void 0:a.seams)||[];if(L.value=S,S.length===0)return;const _=$n((t=q.query)==null?void 0:t.seam)||Ae.selectedSeam||"16-3煤",A=S.find(P=>P.name===_);C.value=(A==null?void 0:A.name)||S[0].name,p(C.value)}catch(r){he.value=((x=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:x.detail)||"煤层列表加载失败"}});return ze(j,()=>we()),ze(le,()=>we()),ze(N,()=>{m(),we()}),ze(U,()=>{we(),Nt()}),ze([R,H],()=>{me.value&&It({force:!1})}),ze(C,()=>{p(C.value||""),me.value&&It({force:!1})}),ze(nt,a=>{!a&&be.value!=="all"&&(be.value="all",we())}),ze(()=>[V.rsi,V.bri,V.asi],()=>{me.value&&(window.clearTimeout(e),e=window.setTimeout(()=>It({force:!1}),300))}),cn(()=>Ce(this,null,function*(){m(),yield Pn(),C.value&&(yield It({force:!0})),me.value=!0,window.addEventListener("resize",u),window.addEventListener("keydown",Gt)})),dn(()=>{var a,t;window.clearTimeout(e),window.clearTimeout(dt),qe&&window.cancelAnimationFrame(qe),Ye&&window.cancelAnimationFrame(Ye),s.value&&ye.value!==null&&((t=(a=s.value).hasPointerCapture)!=null&&t.call(a,ye.value))&&s.value.releasePointerCapture(ye.value),ye.value=null,window.removeEventListener("resize",u),window.removeEventListener("keydown",Gt)}),(a,t)=>{var i,x;return ee(),te("div",{ref_key:"pageRoot",ref:F,class:"validation-page"},[o("nav",To,[o("div",Lo,[o("button",{class:"icon-btn",type:"button",title:"返回",onClick:t[0]||(t[0]=r=>jn(w).back())},[...t[16]||(t[16]=[o("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{d:"M19 12H5m0 0 6-6m-6 6 6 6"})],-1)])]),t[21]||(t[21]=o("h1",null,"新算法实证",-1)),t[22]||(t[22]=o("span",{class:"divider"},null,-1)),o("label",zo,[t[17]||(t[17]=o("span",null,"煤层",-1)),De(o("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>C.value=r)},[(ee(!0),te(Ke,null,Bt(L.value,r=>(ee(),te("option",{key:r.name,value:r.name},h(r.name),9,Do))),128))],512),[[nn,C.value]])]),Ne.value?(ee(),te("div",Eo,[o("span",null,[t[18]||(t[18]=Te("均值 ",-1)),o("b",null,h(b(_t.value.mean)),1)]),o("span",null,[t[19]||(t[19]=Te("最低 ",-1)),o("b",null,h(b(_t.value.min)),1)]),o("span",Bo,[t[20]||(t[20]=Te("高风险点 ",-1)),o("b",null,h(Ft.value),1)])])):_e("",!0)]),o("div",Oo,[o("button",{class:ot(["tool-btn",{active:ne.value}]),type:"button",onClick:t[2]||(t[2]=r=>ne.value=!ne.value)},"权重",2),o("button",{class:ot(["tool-btn",{active:pe.value}]),type:"button",onClick:t[3]||(t[3]=r=>pe.value=!pe.value)},"评估",2),o("button",{class:"tool-btn",type:"button",onClick:An},"导出高清图"),o("button",{class:"tool-btn",type:"button",disabled:re.value||!Ne.value,onClick:Mn},h(re.value?"打包中...":"导出图组包"),9,Uo),o("button",{class:"tool-btn",type:"button",disabled:!Ne.value,onClick:Rn},"下一步：结果报告",8,Vo),o("button",{class:"tool-btn",type:"button",onClick:In},"全屏")])]),o("section",Wo,[(ee(),te(Ke,null,Bt(y,r=>{var S,_,A,P,se,fe,Y,Se,Me;return o("button",{key:r.key,class:ot(["metric-card",{active:j.value===r.key}]),type:"button",onClick:Fe=>j.value=r.key},[o("div",jo,[o("strong",null,h(r.label),1),o("span",null,h(r.desc),1)]),o("div",Go,h(b((A=(_=(S=$.value)==null?void 0:S.statistics)==null?void 0:_[r.key])==null?void 0:A.mean)),1),o("div",qo,[o("span",null,"最低 "+h(b((fe=(se=(P=$.value)==null?void 0:P.statistics)==null?void 0:se[r.key])==null?void 0:fe.min)),1),o("span",null,"最高 "+h(b((Me=(Se=(Y=$.value)==null?void 0:Y.statistics)==null?void 0:Se[r.key])==null?void 0:Me.max)),1)]),o("div",{class:"risk-bar",style:pt({background:k(r.key)})},null,4)],10,Ho)}),64))]),o("section",Yo,[o("div",Zo,[o("header",Xo,[o("div",null,[o("h2",null,h(d(j.value))+"全矿区插值热力图",1),t[23]||(t[23]=o("p",null,"双击适配视图，拖拽平移，滚轮缩放",-1))]),o("div",Jo,[o("label",null,[t[24]||(t[24]=Te("分辨率",-1)),De(o("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>R.value=r),type:"number",min:"20",max:"120",step:"5"},null,512),[[mt,R.value,void 0,{number:!0}]])]),o("label",null,[t[25]||(t[25]=Te("线级",-1)),De(o("input",{"onUpdate:modelValue":t[5]||(t[5]=r=>N.value=r),type:"number",min:"5",max:"24",step:"1"},null,512),[[mt,N.value,void 0,{number:!0}]])]),o("label",null,[t[27]||(t[27]=Te("插值 ",-1)),De(o("select",{"onUpdate:modelValue":t[6]||(t[6]=r=>H.value=r)},[...t[26]||(t[26]=[o("option",{value:"idw"},"反距离权重",-1),o("option",{value:"linear"},"线性插值",-1),o("option",{value:"nearest"},"最近邻",-1),o("option",{value:"kriging"},"克里金",-1)])],512),[[nn,H.value]])]),o("label",Ko,[De(o("input",{"onUpdate:modelValue":t[7]||(t[7]=r=>le.value=r),type:"checkbox"},null,512),[[on,le.value]]),t[28]||(t[28]=Te("等值线",-1))]),o("label",Qo,[De(o("input",{"onUpdate:modelValue":t[8]||(t[8]=r=>U.value=r),type:"checkbox"},null,512),[[on,U.value]]),t[29]||(t[29]=Te("固定量程(0-100)",-1))])])]),Ne.value?(ee(),te("div",ea,[t[30]||(t[30]=o("span",{class:"trust-chip real"},"空间图：真实钻孔与坐标数据",-1)),o("span",ta,"评估："+h(Tt.value),1),be.value!=="all"&&Ct.value>0?(ee(),te("span",na," 联动高亮 "+h(Lt(be.value))+" · "+h(Ct.value)+"点 ",1)):_e("",!0),Qe.value?(ee(),te("span",oa,"标签源 "+h(Qe.value),1)):_e("",!0),o("span",aa,"钻孔 "+h(((i=$.value)==null?void 0:i.borehole_count)||0)+" 个 · 坐标源 zuobiao.csv",1)])):_e("",!0),o("div",{ref_key:"stageContainer",ref:s,class:"stage",onPointerdown:fn,onPointermove:yn,onPointerup:hn,onPointercancel:bn,onPointerleave:gn,onWheel:an(xn,["prevent"]),onContextmenu:t[9]||(t[9]=an(()=>{},["prevent"])),onDblclick:Pe},[o("canvas",{ref_key:"heatmapCanvas",ref:c,class:"layer"},null,512),o("canvas",{ref_key:"overlayCanvas",ref:M,class:"layer"},null,512),de.value?(ee(),te("div",la,[t[31]||(t[31]=o("div",{class:"skeleton"},null,-1)),t[32]||(t[32]=o("div",{class:"skeleton"},null,-1)),o("p",null,"正在计算 "+h(C.value||"目标煤层")+" 空间指标...",1)])):_e("",!0)],544),o("footer",sa,[o("div",{class:"legend-track",style:pt({background:k(j.value)})},null,4),o("div",ra,[o("span",null,h(b(it.value.min)),1),o("span",null,h(b(it.value.mean)),1),o("span",null,h(b(it.value.max)),1)])])]),o("aside",{ref_key:"thumbPanelRef",ref:f,class:ot(["thumb-panel",{collapsed:xe.value}])},[o("header",null,[t[33]||(t[33]=o("h3",null,"指标缩略图",-1)),o("button",{class:"icon-btn mini",type:"button",onClick:t[10]||(t[10]=r=>xe.value=!xe.value)},h(xe.value?"展开":"收起"),1)]),o("div",ia,[(ee(),te(Ke,null,Bt(y,r=>{var S,_;return o("button",{key:`thumb-${r.key}`,class:ot(["thumb-item",{active:j.value===r.key}]),type:"button",onClick:A=>j.value=r.key,onMouseenter:A=>wn(r.key,A),onMousemove:A=>qt(r.key,A),onMouseleave:Sn},[o("canvas",{ref_for:!0,ref:Q(r.key),class:"thumb-canvas"},null,512),o("div",ca,[o("strong",null,h(r.label),1),o("span",null,"均值 "+h(b((S=je.value[r.key])==null?void 0:S.mean)),1),o("span",null,"σ "+h(b((_=je.value[r.key])==null?void 0:_.std)),1)])],42,ua)}),64))]),ve.visible&&Ge.value?(ee(),te("div",{key:0,class:"thumb-tooltip",style:pt({left:`${ve.x+12}px`,top:`${ve.y+12}px`})},[o("p",null,[o("strong",null,h(d(ve.metric))+"统计",1)]),o("p",null,"最小值 "+h(b(Ge.value.min)),1),o("p",null,"最大值 "+h(b(Ge.value.max)),1),o("p",null,"均值 "+h(b(Ge.value.mean)),1),o("p",null,"标准差 "+h(b(Ge.value.std)),1)],4)):_e("",!0)],2)]),$e(sn,{name:"fade-up"},{default:ln(()=>[ne.value?(ee(),te("aside",da,[o("header",null,[t[34]||(t[34]=o("h3",null,"权重配置",-1)),o("button",{type:"button",class:"close-btn",onClick:t[11]||(t[11]=r=>ne.value=!1)},"×")]),t[38]||(t[38]=o("p",null,"RSI / BRI / ASI 自动归一化。调整后 300ms 内自动重算。",-1)),o("label",ma,[t[35]||(t[35]=o("span",null,"RSI",-1)),De(o("input",{"onUpdate:modelValue":t[12]||(t[12]=r=>V.rsi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[mt,V.rsi,void 0,{number:!0}]]),o("strong",null,h(D(Oe.value.rsi)),1)]),o("label",pa,[t[36]||(t[36]=o("span",null,"BRI",-1)),De(o("input",{"onUpdate:modelValue":t[13]||(t[13]=r=>V.bri=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[mt,V.bri,void 0,{number:!0}]]),o("strong",null,h(D(Oe.value.bri)),1)]),o("label",va,[t[37]||(t[37]=o("span",null,"ASI",-1)),De(o("input",{"onUpdate:modelValue":t[14]||(t[14]=r=>V.asi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[mt,V.asi,void 0,{number:!0}]]),o("strong",null,h(D(Oe.value.asi)),1)])])):_e("",!0)]),_:1}),$e(sn,{name:"drawer-up"},{default:ln(()=>{var r,S,_,A,P,se,fe,Y;return[pe.value?(ee(),te("section",fa,[o("header",null,[t[39]||(t[39]=o("h3",null,"算法评估面板（当前煤层批量结果）",-1)),o("div",ya,[o("button",{type:"button",class:"tool-btn small",onClick:Nn},"导出数据"),o("button",{type:"button",class:"close-btn",onClick:t[15]||(t[15]=Se=>pe.value=!1)},"×")])]),ue.value?(ee(),te("div",ha,"正在计算评估指标...")):z.value?(ee(),te(Ke,{key:2},[o("div",ga,[o("div",xa,[t[40]||(t[40]=o("span",null,"AUC",-1)),o("strong",null,h(b(z.value.auc,4)),1)]),o("div",wa,[t[41]||(t[41]=o("span",null,"PR-AUC",-1)),o("strong",null,h(b(z.value.pr_auc,4)),1)]),o("div",Sa,[t[42]||(t[42]=o("span",null,"F1",-1)),o("strong",null,h(b(z.value.f1,4)),1)]),o("div",_a,[t[43]||(t[43]=o("span",null,"Brier",-1)),o("strong",null,h(b(z.value.brier,4)),1)]),o("div",ka,[t[44]||(t[44]=o("span",null,"ECE",-1)),o("strong",null,h(b(z.value.ece,4)),1)])]),o("div",Ca,[o("div",Aa,[t[49]||(t[49]=o("h4",null,"混淆矩阵",-1)),o("div",Ma,[o("div",Na,[t[45]||(t[45]=o("span",null,"TN",-1)),o("b",null,h((S=(r=z.value.confusion_matrix)==null?void 0:r.tn)!=null?S:0),1)]),o("div",Ia,[t[46]||(t[46]=o("span",null,"FP",-1)),o("b",null,h((A=(_=z.value.confusion_matrix)==null?void 0:_.fp)!=null?A:0),1)]),o("div",$a,[t[47]||(t[47]=o("span",null,"FN",-1)),o("b",null,h((se=(P=z.value.confusion_matrix)==null?void 0:P.fn)!=null?se:0),1)]),o("div",Ra,[t[48]||(t[48]=o("span",null,"TP",-1)),o("b",null,h((Y=(fe=z.value.confusion_matrix)==null?void 0:fe.tp)!=null?Y:0),1)])])]),o("div",Pa,[t[56]||(t[56]=o("h4",null,"基线对比（SVG）",-1)),(ee(),te("svg",Fa,[t[50]||(t[50]=o("rect",{x:"0",y:"0",width:"560",height:"170",fill:"#fff"},null,-1)),t[51]||(t[51]=o("text",{x:"14",y:"26"},"基线 MPI",-1)),t[52]||(t[52]=o("rect",{x:"112",y:"12",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"12",width:I(kt.value),height:"18",rx:"9",fill:"#64748b"},null,8,Ta),o("text",La,h(b(kt.value,3)),1),t[53]||(t[53]=o("text",{x:"14",y:"90"},"新算法 MPI",-1)),t[54]||(t[54]=o("rect",{x:"112",y:"76",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"76",width:I(rt.value),height:"18",rx:"9",fill:"#0f766e"},null,8,za),o("text",Da,h(b(rt.value,3)),1),t[55]||(t[55]=o("text",{x:"14",y:"148",fill:"#64748b"},"注：基于当前煤层批量钻孔的空间实证均值。",-1))]))])])],64)):(ee(),te("div",ba,h(he.value||"暂无评估数据"),1))])):_e("",!0)]}),_:1}),Ne.value?(ee(),te("section",Ea,[o("header",null,[t[58]||(t[58]=o("h3",null,"期刊级图组（自动生成）",-1)),t[59]||(t[59]=o("p",null,"全部图件已直接展示，满足对比、消融、校准、判别与机制解释需求。",-1)),t[60]||(t[60]=o("p",{class:"data-note"},"说明：评估与部分机制曲线目前为模型推导/示意，不等同于真实标签实验结果。",-1)),o("p",Ba,[t[57]||(t[57]=Te(" 图11支持点击 TP/TN/FP/FN 联动主图高亮。 ",-1)),be.value!=="all"?(ee(),te(Ke,{key:0},[Te("可按 Esc 快速清除筛选。")],64)):_e("",!0),nt.value?_e("",!0):(ee(),te(Ke,{key:1},[Te("当前样本与钻孔点未一一对齐，联动高亮不可用。")],64))]),t[61]||(t[61]=o("p",{class:"data-note"},"导出高清图与图组包时会自动冻结脉冲动画，保证稿件图件为静态一致版。",-1)),be.value!=="all"?(ee(),te("button",{key:0,type:"button",class:"tool-btn small",onClick:jt},"清除联动高亮")):_e("",!0),ke.value?(ee(),te("p",Oa,h(ke.value),1)):_e("",!0)]),$e(Fo,{result:ut.value,evaluation:z.value,onMatrixSelect:vn},null,8,["result","evaluation"])])):_e("",!0),J.value&&Ne.value?(ee(),te("div",{key:1,class:"hover-tooltip",style:pt({left:`${Re.x+14}px`,top:`${Re.y+14}px`})},[o("p",null,"坐标："+h(b(J.value.worldX,2))+", "+h(b(J.value.worldY,2)),1),o("p",null,h(d(j.value))+"插值："+h(b(J.value.gridValue,3)),1),o("p",null,"最近钻孔："+h(((x=J.value.nearestBorehole)==null?void 0:x.borehole_name)||"--")+"（"+h(b(J.value.nearestDistance,1))+" m）",1),J.value.borehole?(ee(),te(Ke,{key:0},[o("p",null,[o("strong",null,h(J.value.borehole.borehole_name),1)]),o("p",null,"RSI "+h(b(J.value.borehole.rsi,2))+" | BRI "+h(b(J.value.borehole.bri,2)),1),o("p",null,"ASI "+h(b(J.value.borehole.asi,2))+" | MPI "+h(b(J.value.borehole.mpi,2)),1),o("p",Ua,h(T(J.value.borehole.risk_label)),1)],64)):_e("",!0)],4)):_e("",!0)],512)}}},Ja=Vt(Va,[["__scopeId","data-v-2befd017"]]);export{Ja as default};
