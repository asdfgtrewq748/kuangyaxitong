import{_ as V}from"./index-DAAno9XI.js";import{bf as I,w as z,b4 as $,b5 as k,b8 as A,b7 as b,bb as R,bi as q,b as v}from"./vendor-CcQzWQKD.js";const D={class:"heatmap-wrapper"},L=["width","height"],X={key:0,class:"color-scale"},Y={class:"scale-label"},j={class:"scale-label"},U={__name:"HeatmapCanvas",props:{grid:{type:Array,default:()=>[]},size:{type:Number,default:420},colorScale:{type:Boolean,default:!0}},emits:["select"],setup(g,{emit:B}){const t=g,E=B,l=v(null),_=v(null),x=v(null);let d=0;const p=v({rows:0,cols:0}),S=c=>{const a=[{r:30,g:64,b:175},{r:37,g:99,b:235},{r:59,g:130,b:246},{r:6,g:182,b:212},{r:16,g:185,b:129},{r:245,g:158,b:11}],o=c*(a.length-1),n=Math.floor(o),i=o-n,e=a[Math.min(n,a.length-1)],r=a[Math.min(n+1,a.length-1)];return`rgb(${Math.round(e.r+(r.r-e.r)*i)}, ${Math.round(e.g+(r.g-e.g)*i)}, ${Math.round(e.b+(r.b-e.b)*i)})`},H=()=>{var h;if(!l.value||t.grid.length===0)return;const c=l.value.getContext("2d"),a=t.grid.length,o=((h=t.grid[0])==null?void 0:h.length)||0;if(a===0||o===0)return;p.value={rows:a,cols:o};const n=t.size/o,i=t.size/a;let e=1/0,r=-1/0;t.grid.forEach(u=>{u.forEach(s=>{Number.isFinite(Number(s))&&(s<e&&(e=s),s>r&&(r=s))})}),(!Number.isFinite(e)||!Number.isFinite(r))&&(e=0,r=1);const y=r-e||1;_.value=e,x.value=r,c.clearRect(0,0,t.size,t.size);for(let u=0;u<a;u++)for(let s=0;s<o;s++){const m=t.grid[u][s];if(!Number.isFinite(Number(m)))continue;const f=(m-e)/y;c.fillStyle=S(f),c.fillRect(s*n,u*i,n+.5,i+.5)}},w=()=>{d||(d=requestAnimationFrame(()=>{d=0,H()}))},M=c=>{var N,C,F;if(!l.value)return;const a=Array.isArray(t.grid)?t.grid.length:0,o=Array.isArray((N=t.grid)==null?void 0:N[0])?t.grid[0].length:0,n=p.value.rows||a,i=p.value.cols||o;if(!n||!i)return;const e=l.value.getBoundingClientRect(),r=c.clientX-e.left,y=c.clientY-e.top,h=r/e.width,u=y/e.height,s=Math.max(0,Math.min(i-1,Math.floor(h*i))),m=Math.max(0,Math.min(n-1,Math.floor(u*n))),f=(F=(C=t.grid)==null?void 0:C[m])==null?void 0:F[s];E("select",{row:m,col:s,rows:n,cols:i,value:Number.isFinite(Number(f))?Number(f):null})};return I(()=>{w(),l.value&&l.value.addEventListener("click",M)}),z(()=>t.grid,w),z(()=>t.size,w),$(()=>{l.value&&l.value.removeEventListener("click",M),d&&(cancelAnimationFrame(d),d=0)}),(c,a)=>{var o,n;return k(),A("div",D,[b("canvas",{ref_key:"canvas",ref:l,width:g.size,height:g.size,class:"heatmap-canvas"},null,8,L),g.colorScale?(k(),A("div",X,[b("span",Y,R((o=_.value)==null?void 0:o.toFixed(2)),1),a[0]||(a[0]=b("div",{class:"scale-bar"},null,-1)),b("span",j,R((n=x.value)==null?void 0:n.toFixed(2)),1)])):q("",!0)])}}},J=V(U,[["__scopeId","data-v-7ee4a011"]]);export{J as H};
