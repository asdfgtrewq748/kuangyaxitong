import{_ as ct,w as nt,o as vt,z as ht,b as g,c as h,d as e,F as lt,k as it,j as O,A as ft,t as b,h as X,f as V,l as pt,B as yt,T as bt,s as kt,r as y,i as z,g as mt,n as tt,e as rt,m as A,y as dt,v as xt,p as ut,u as wt}from"./index-tY8q6Zf3.js";import{g as _t,j as Mt,c as Ct,m as It,k as $t,l as Pt}from"./api-ChvzGBUD.js";const St={class:"mpi-heatmap-viewer"},Rt={key:0,class:"heatmap-skeleton"},Bt={class:"skeleton-grid"},jt=["src"],Ut={key:1,class:"empty-state"},Et={class:"empty-text"},Ft={key:3,class:"empty-state"},Vt=["aria-label"],Nt={class:"tooltip-body"},Tt={class:"tooltip-row"},Lt={class:"tooltip-value"},Ot={class:"tooltip-row"},Ht={class:"tooltip-value"},Wt={class:"tooltip-row tooltip-row-highlight"},Dt={class:"tooltip-value tooltip-value-primary"},zt={class:"tooltip-row"},At={__name:"MpiHeatmapViewer",props:{mode:{type:String,default:"image"},imageUrl:{type:String,default:""},grid:{type:Array,default:()=>[]},bounds:{type:Object,default:null},workface:{type:Object,default:null},showBoundary:{type:Boolean,default:!0},showMask:{type:Boolean,default:!0},palette:{type:Array,default:()=>[]},size:{type:Number,default:560},loading:{type:Boolean,default:!1}},emits:["hover","imageError","retry","export","fullscreen"],setup(B,{emit:I}){const a=B,w=I,j=y(null),N=y(null),_=y(null),k=y(null),x=y(null),T=y({x:0,y:0}),F=y(""),S=z(()=>({left:`${T.value.x+16}px`,top:`${T.value.y+16}px`})),H=z(()=>!a.grid||a.grid.length===0),R=["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],L=z(()=>a.palette&&a.palette.length?a.palette:R),U={left:.1,top:.1,width:.85,height:.8},Y=o=>o==null?"未知":o>=.7?"低风险":o>=.4?"中等风险":"高风险",W=o=>o==null?"risk-unknown":o>=.7?"risk-low":o>=.4?"risk-medium":"risk-high",J=()=>{if(a.mode==="image"&&a.imageUrl){const o=document.createElement("a");o.href=a.imageUrl,o.download=`MPI热力图_${new Date().toISOString().slice(0,10)}.png`,o.click()}else if(a.mode==="canvas"&&_.value){const o=document.createElement("a");o.download=`MPI热力图_${new Date().toISOString().slice(0,10)}.png`,o.href=_.value.toDataURL("image/png"),o.click()}w("export")},et=()=>{j.value&&(document.fullscreenElement?document.exitFullscreen():j.value.requestFullscreen()),w("fullscreen")},E=async()=>{await kt();const o=j.value;if(!o)return;const s=o.getBoundingClientRect(),l=Math.floor(s.width),u=Math.floor(s.height),i=window.devicePixelRatio||1,c=k.value;c&&(c.width=l*i,c.height=u*i,c.style.width=`${l}px`,c.style.height=`${u}px`,c.getContext("2d").setTransform(i,0,0,i,0,0));const n=_.value;n&&a.mode==="canvas"&&(n.width=l*i,n.height=u*i,n.style.width=`${l}px`,n.style.height=`${u}px`,n.getContext("2d").setTransform(i,0,0,i,0,0)),Z(),ot()},M=()=>{F.value="热力图图片加载失败",w("imageError")},D=()=>{const o=j.value;if(!o)return null;const s=o.getBoundingClientRect();let l=0,u=0,i=s.width,c=s.height;if(a.mode==="image"&&N.value){const n=N.value.getBoundingClientRect();l=n.left-s.left,u=n.top-s.top,i=n.width,c=n.height}return{x:l+i*U.left,y:u+c*U.top,width:i*U.width,height:c*U.height}},G=(o,s)=>{if(!a.bounds)return{x:0,y:0};const l=D();if(!l)return{x:0,y:0};const u=a.bounds.max_x-a.bounds.min_x,i=a.bounds.max_y-a.bounds.min_y,c=(o-a.bounds.min_x)/(u||1),n=(a.bounds.max_y-s)/(i||1);return{x:l.x+c*l.width,y:l.y+n*l.height}},K=(o,s)=>{if(!a.bounds)return null;const l=D();if(!l||o<l.x||s<l.y||o>l.x+l.width||s>l.y+l.height)return null;const u=(o-l.x)/l.width,i=(s-l.y)/l.height;return{x:a.bounds.min_x+u*(a.bounds.max_x-a.bounds.min_x),y:a.bounds.max_y-i*(a.bounds.max_y-a.bounds.min_y)}},at=o=>{var r,f;if(!o||!a.grid||a.grid.length===0)return null;const s=a.grid.length,l=((r=a.grid[0])==null?void 0:r.length)||0;if(s===0||l===0)return null;const u=a.bounds.max_x-a.bounds.min_x,i=a.bounds.max_y-a.bounds.min_y,c=Math.min(l-1,Math.max(0,Math.round((o.x-a.bounds.min_x)/(u||1)*(l-1)))),n=Math.min(s-1,Math.max(0,Math.round((o.y-a.bounds.min_y)/(i||1)*(s-1)))),t=(f=a.grid[n])==null?void 0:f[c];return Number.isFinite(t)?t:null},st=o=>{var t;const s=(t=j.value)==null?void 0:t.getBoundingClientRect();if(!s)return;const l=o.clientX-s.left,u=o.clientY-s.top;T.value={x:l,y:u};const i=K(l,u);if(!i){x.value=null,w("hover",null);return}const c=at(i);if(c==null){x.value=null,w("hover",null);return}const n={x:i.x,y:i.y,value:c};x.value=n,w("hover",n)},q=()=>{x.value=null,w("hover",null)},Q=o=>{const s=L.value,l=o*(s.length-1),u=Math.floor(l),i=l-u,c=s[Math.min(u,s.length-1)],n=s[Math.min(u+1,s.length-1)],t=P=>{const d=P.replace("#",""),C=parseInt(d.slice(0,2),16),v=parseInt(d.slice(2,4),16),gt=parseInt(d.slice(4,6),16);return{r:C,g:v,b:gt}},r=t(c),f=t(n),m=Math.round(r.r+(f.r-r.r)*i),p=Math.round(r.g+(f.g-r.g)*i),$=Math.round(r.b+(f.b-r.b)*i);return`rgb(${m}, ${p}, ${$})`},Z=()=>{var f;if(a.mode!=="canvas"||!_.value||!a.grid||a.grid.length===0)return;const o=_.value.getContext("2d"),s=D();if(!s)return;o.clearRect(0,0,_.value.width,_.value.height);const l=a.grid.length,u=((f=a.grid[0])==null?void 0:f.length)||0;let i=1/0,c=-1/0;for(const m of a.grid)for(const p of m)Number.isFinite(p)&&(p<i&&(i=p),p>c&&(c=p));const n=c-i||1,t=s.width/u,r=s.height/l;for(let m=0;m<l;m++)for(let p=0;p<u;p++){const $=a.grid[m][p];if(!Number.isFinite($))continue;const P=($-i)/n;o.fillStyle=Q(P),o.fillRect(s.x+p*t,s.y+m*r,t+.5,r+.5)}},ot=()=>{if(!k.value)return;const o=k.value.getContext("2d"),s=k.value.getBoundingClientRect();if(o.clearRect(0,0,s.width,s.height),!a.workface||!a.bounds)return;const l=a.workface.type==="polygon"?a.workface.points:[[a.workface.bounds.min_x,a.workface.bounds.min_y],[a.workface.bounds.max_x,a.workface.bounds.min_y],[a.workface.bounds.max_x,a.workface.bounds.max_y],[a.workface.bounds.min_x,a.workface.bounds.max_y]];!l||l.length<3||(o.save(),o.beginPath(),l.forEach((u,i)=>{const c=G(u[0],u[1]);i===0?o.moveTo(c.x,c.y):o.lineTo(c.x,c.y)}),o.closePath(),a.showMask&&(o.fillStyle="rgba(37, 99, 235, 0.18)",o.fill()),a.showBoundary&&(o.strokeStyle="rgba(30, 64, 175, 0.9)",o.lineWidth=2,o.setLineDash([6,4]),o.stroke(),o.setLineDash([])),o.restore())};return nt(()=>[a.mode,a.grid,a.bounds,a.workface,a.showBoundary,a.showMask,a.imageUrl],()=>{a.imageUrl&&(F.value=""),E()},{deep:!0}),vt(()=>{window.addEventListener("resize",E),E()}),ht(()=>{window.removeEventListener("resize",E)}),(o,s)=>(g(),h("div",St,[B.loading?(g(),h("div",Rt,[s[1]||(s[1]=e("div",{class:"skeleton-header"},[e("div",{class:"skeleton-title"}),e("div",{class:"skeleton-subtitle"})],-1)),e("div",Bt,[(g(),h(lt,null,it(9,l=>e("div",{key:l,class:"skeleton-cell"})),64))]),s[2]||(s[2]=O('<div class="skeleton-spinner" data-v-6a30ffca><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-6a30ffca><circle cx="12" cy="12" r="10" opacity="0.25" data-v-6a30ffca></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round" data-v-6a30ffca><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite" data-v-6a30ffca></animateTransform></path></svg></div>',1))])):(g(),h("div",{key:1,ref_key:"stageRef",ref:j,class:"heatmap-stage",onMousemove:st,onMouseleave:q,tabindex:"0",onKeydown:ft(q,["esc"])},[B.mode==="image"&&B.imageUrl?(g(),h("img",{key:0,ref_key:"imageRef",ref:N,src:B.imageUrl,class:"heatmap-image",onLoad:E,onError:M,alt:"MPI热力图"},null,40,jt)):B.mode==="image"&&!B.imageUrl?(g(),h("div",Ut,[s[4]||(s[4]=O('<div class="empty-icon" data-v-6a30ffca><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-6a30ffca><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-6a30ffca></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-6a30ffca></circle><polyline points="21 15 16 10 5 21" data-v-6a30ffca></polyline></svg></div>',1)),e("p",Et,b(F.value||"暂无热力图图片"),1),F.value?(g(),h("button",{key:0,class:"btn-retry",onClick:s[0]||(s[0]=l=>o.$emit("retry"))},[...s[3]||(s[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"})],-1),X(" 重试 ",-1)])])):V("",!0)])):V("",!0),B.mode==="canvas"?(g(),h("canvas",{key:2,ref_key:"heatmapCanvas",ref:_,class:"heatmap-canvas"},null,512)):V("",!0),B.mode==="canvas"&&H.value?(g(),h("div",Ft,[...s[5]||(s[5]=[O('<div class="empty-icon" data-v-6a30ffca><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-6a30ffca><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-6a30ffca></rect><line x1="3" y1="9" x2="21" y2="9" data-v-6a30ffca></line><line x1="9" y1="21" x2="9" y2="9" data-v-6a30ffca></line></svg></div><p class="empty-text" data-v-6a30ffca>暂无MPI网格数据</p>',2)])])):V("",!0),e("canvas",{ref_key:"overlayCanvas",ref:k,class:"overlay-canvas"},null,512),pt(bt,{name:"tooltip-fade"},{default:yt(()=>{var l,u;return[x.value?(g(),h("div",{key:0,class:"hover-tooltip",style:mt(S.value),role:"tooltip","aria-label":`MPI值: ${(l=x.value.value)==null?void 0:l.toFixed(2)}`},[s[11]||(s[11]=e("div",{class:"tooltip-header"},[e("svg",{class:"tooltip-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"}),e("path",{d:"M12 6v6l4 2"})]),e("span",{class:"tooltip-title"},"MPI综合指标")],-1)),e("div",Nt,[e("div",Tt,[s[6]||(s[6]=e("span",{class:"tooltip-label"},"X坐标",-1)),e("span",Lt,b(x.value.x.toFixed(1))+" m",1)]),e("div",Ot,[s[7]||(s[7]=e("span",{class:"tooltip-label"},"Y坐标",-1)),e("span",Ht,b(x.value.y.toFixed(1))+" m",1)]),s[10]||(s[10]=e("div",{class:"tooltip-divider"},null,-1)),e("div",Wt,[s[8]||(s[8]=e("span",{class:"tooltip-label"},"MPI值",-1)),e("span",Dt,b((u=x.value.value)==null?void 0:u.toFixed(3)),1)]),e("div",zt,[s[9]||(s[9]=e("span",{class:"tooltip-label"},"风险等级",-1)),e("span",{class:tt(["tooltip-badge",W(x.value.value)])},b(Y(x.value.value)),3)])])],12,Vt)):V("",!0)]}),_:1}),e("div",{class:"export-actions"},[e("button",{class:"btn-export",onClick:J,title:"导出热力图"},[...s[12]||(s[12]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])]),e("button",{class:"btn-export",onClick:et,title:"全屏显示"},[...s[13]||(s[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})],-1)])])])],544))]))}},Xt=ct(At,[["__scopeId","data-v-6a30ffca"]]),Yt={class:"page mpi-heatmap-page"},Jt={class:"mpi-layout"},Gt={class:"left-panel"},Kt={class:"card"},qt={class:"sample-actions"},Qt={key:0,class:"workface-list"},Zt={class:"workface-header"},te={class:"workface-items"},ee=["onClick"],ae={class:"workface-type"},se={key:1,class:"empty-tip"},oe={class:"card"},ne={class:"param-group"},le=["value"],ie={class:"param-group"},re={class:"param-group"},de={class:"action-buttons"},ue=["disabled"],ce={key:0,class:"spinner sm"},ve=["disabled"],fe={class:"card"},pe={class:"toggle-row"},me={class:"toggle-item"},ge={class:"toggle-item"},he={class:"param-group"},ye={class:"mode-tabs"},be={class:"right-panel"},ke={class:"card"},xe={class:"heatmap-header"},we={class:"heatmap-actions"},_e={key:0,class:"tag"},Me={key:1,class:"tag ghost"},Ce={key:0,class:"workface-bounds"},Ie={key:1,class:"legend"},$e={key:2,class:"stats-grid"},Pe={class:"stat-item"},Se={class:"stat-value"},Re={class:"stat-item"},Be={class:"stat-value"},je={class:"stat-item"},Ue={class:"stat-value"},Ee={class:"stat-item"},Fe={class:"stat-value"},Ve={key:3,class:"empty-state"},Ne={__name:"MpiHeatmap",setup(B){const I=wt(),a=y([]),w=y(""),j=y("idw"),N=y(80),_=y(!1),k=y([]),x=y(0),T=y(!0),F=y(!0),S=y("image"),H=y(""),R=y(null),L=y(null),U=y({}),Y=y(null),W=new Map,J=["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],et=z(()=>`linear-gradient(90deg, ${J.join(", ")})`),E=z(()=>Array.isArray(R.value)&&R.value.length>0),M=z(()=>k.value.length&&k.value[Math.min(x.value,k.value.length-1)]||null),D=()=>{var n;(n=G.value)==null||n.click()},G=y(null),K=()=>{localStorage.setItem("mpi-workfaces",JSON.stringify(k.value))},at=()=>{const n=localStorage.getItem("mpi-workfaces");if(n)try{k.value=JSON.parse(n)||[]}catch{k.value=[]}},st=()=>{k.value=[],x.value=0,K()},q=async n=>{var r,f,m;const t=(r=n.target.files)==null?void 0:r[0];if(t)try{const{data:p}=await Mt(t);k.value=p.workfaces||[],x.value=0,K(),I.add(`已导入 ${k.value.length} 个工作面`,"success")}catch(p){I.add(((m=(f=p.response)==null?void 0:f.data)==null?void 0:m.detail)||"工作面解析失败","error")}},Q=n=>{if(n==="csv"){Z(`name,xmin,xmax,ymin,ymax
工作面A,100,400,200,600
工作面B,450,750,150,500
`,"workfaces_example.csv","text/csv");return}Z(JSON.stringify({workfaces:[{name:"工作面A",bounds:{min_x:100,max_x:400,min_y:200,max_y:600}},{name:"工作面B",points:[[450,150],[750,150],[720,500],[480,520]]}]},null,2),"workfaces_example.json","application/json")},Z=(n,t,r)=>{const f=new Blob([n],{type:r}),m=URL.createObjectURL(f),p=document.createElement("a");p.href=m,p.download=t,p.click(),URL.revokeObjectURL(m)},ot=async()=>{try{const{data:n}=await _t();a.value=n.seams||[],!w.value&&a.value.length&&(w.value=a.value[0].name)}catch{I.add("加载煤层失败","error")}},o=async n=>{if(!n)return null;if(W.has(n))return W.get(n);try{const{data:t}=await Pt(n);return W.set(n,t),t}catch{return W.set(n,null),null}},s=async(n=[])=>{const t=[];for(const r of n){const f=r.layers||[],m=f.find(C=>C.name===w.value),p=f.filter(C=>C.name!==w.value),$=[];for(const C of p){const v=await o(C.name);$.push({thickness:C.thickness||0,name:C.name||"",density:v==null?void 0:v.density,bulk_modulus:v==null?void 0:v.bulk_modulus,shear_modulus:v==null?void 0:v.shear_modulus,cohesion:v==null?void 0:v.cohesion,friction_angle:v==null?void 0:v.friction_angle,tensile_strength:v==null?void 0:v.tensile_strength,compressive_strength:v==null?void 0:v.compressive_strength,elastic_modulus:v==null?void 0:v.elastic_modulus,poisson_ratio:v==null?void 0:v.poisson_ratio})}const P=r.seam_top_depth??r.total_overburden_thickness??0,d=(m==null?void 0:m.thickness)||0;t.push({x:r.x,y:r.y,borehole:r.name,thickness:d,burial_depth:P,z_top:P,z_bottom:P+d,strata:$})}return t},l=async()=>{var n,t,r,f;if(w.value){_.value=!0;try{const{data:m}=await Ct(w.value),p=m.boreholes||[];if(!p.length){I.add("当前煤层无可用钻孔数据","error");return}const $=await s(p),P=((n=M.value)==null?void 0:n.bounds)||null,{data:d}=await It($,N.value,j.value,null,P);R.value=d.grid,L.value=d.bounds,U.value=d.statistics||{},(t=M.value)!=null&&t.bounds&&u(M.value.bounds,d.bounds),S.value==="image"&&await i(),I.add("MPI热力图计算完成","success")}catch(m){I.add(((f=(r=m.response)==null?void 0:r.data)==null?void 0:f.detail)||"MPI计算失败","error")}finally{_.value=!1}}},u=(n,t)=>{if(!n||!t)return;const r=n.min_x<t.min_x||n.max_x>t.max_x,f=n.min_y<t.min_y||n.max_y>t.max_y;(r||f)&&I.add("工作面范围超出MPI网格边界，显示可能被裁剪","warning")},i=async()=>{var n,t,r;if(!(!R.value||!L.value))try{const f=(n=M.value)!=null&&n.name?`MPI热力图 - ${M.value.name}`:"MPI热力图",{data:m}=await $t({grid:R.value,bounds:L.value,title:f,property_name:"MPI",num_levels:12,dpi:200,smooth_sigma:1,colormap:"odi"});H.value=`data:image/png;base64,${m.image}`}catch(f){I.add(((r=(t=f.response)==null?void 0:t.data)==null?void 0:r.detail)||"热力图图像生成失败","error")}},c=()=>{S.value==="image"&&(S.value="canvas",I.add("图像加载失败，已切换到Canvas模式","warning"))};return nt(S,async n=>{n==="image"&&R.value&&!H.value&&await i()}),nt(x,()=>{R.value&&(R.value=null,L.value=null,H.value="",U.value={},I.add("工作面已切换，请重新计算MPI热力图","info"))}),vt(()=>{ot(),at()}),(n,t)=>{var r,f,m,p,$,P;return g(),h("div",Yt,[t[32]||(t[32]=O('<div class="page-header" data-v-f42dfab5><div class="page-header-content" data-v-f42dfab5><div class="page-header-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" data-v-f42dfab5></path><path d="M12 6v6l4 2" data-v-f42dfab5></path></svg></div><div data-v-f42dfab5><h1 class="page-title" data-v-f42dfab5>MPI热力图分析</h1><p class="page-subtitle" data-v-f42dfab5>独立展示MPI综合指标分布，支持多工作面上传、切换与热力图渲染</p></div></div></div>',1)),e("div",Jt,[e("div",Gt,[e("div",Kt,[t[12]||(t[12]=e("h3",{class:"section-title"},"工作面坐标文件",-1)),t[13]||(t[13]=e("p",{class:"section-desc"},"上传多工作面坐标文件（矩形为主，多边形可选）",-1)),e("div",{class:"upload-box",onClick:D,tabindex:"0",onKeydown:ft(D,["enter"])},[e("input",{ref_key:"workfaceInput",ref:G,type:"file",accept:".csv,.json,.txt",onChange:q,style:{display:"none"}},null,544),t[10]||(t[10]=O('<div class="upload-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-f42dfab5></path><polyline points="17 8 12 3 7 8" data-v-f42dfab5></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-f42dfab5></line></svg></div><div class="upload-text" data-v-f42dfab5>上传工作面坐标文件</div><div class="upload-hint" data-v-f42dfab5>支持 CSV / JSON / TXT</div>',3))],32),t[14]||(t[14]=e("div",{class:"helper-text"}," 未上传工作面时，将使用全部网格边界进行渲染。 ",-1)),e("div",qt,[e("button",{class:"btn ghost",onClick:t[0]||(t[0]=rt(d=>Q("csv"),["stop"]))},"下载CSV示例"),e("button",{class:"btn ghost",onClick:t[1]||(t[1]=rt(d=>Q("json"),["stop"]))},"下载JSON示例")]),k.value.length?(g(),h("div",Qt,[e("div",Zt,[e("span",null,"已解析 "+b(k.value.length)+" 个工作面",1),e("button",{class:"btn small ghost",onClick:st},"清空")]),e("div",te,[(g(!0),h(lt,null,it(k.value,(d,C)=>(g(),h("button",{key:d.name+C,class:tt(["workface-btn",{active:x.value===C}]),onClick:v=>x.value=C},[X(b(d.name||`工作面 ${C+1}`)+" ",1),e("span",ae,b(d.type==="polygon"?"多边形":"矩形"),1)],10,ee))),128))])])):(g(),h("div",se,[...t[11]||(t[11]=[O('<div class="empty-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-f42dfab5></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-f42dfab5></circle><polyline points="21 15 16 10 5 21" data-v-f42dfab5></polyline></svg></div><p data-v-f42dfab5>请上传工作面坐标文件</p>',2)])]))]),e("div",oe,[t[19]||(t[19]=e("h3",{class:"section-title"},"MPI计算设置",-1)),e("div",ne,[t[15]||(t[15]=e("label",{class:"param-label"},"煤层",-1)),A(e("select",{"onUpdate:modelValue":t[2]||(t[2]=d=>w.value=d),class:"param-select"},[(g(!0),h(lt,null,it(a.value,d=>(g(),h("option",{key:d.name,value:d.name},b(d.name),9,le))),128))],512),[[dt,w.value]])]),e("div",ie,[t[17]||(t[17]=e("label",{class:"param-label"},"插值方法",-1)),A(e("select",{"onUpdate:modelValue":t[3]||(t[3]=d=>j.value=d),class:"param-select"},[...t[16]||(t[16]=[e("option",{value:"idw"},"IDW",-1),e("option",{value:"linear"},"Linear",-1),e("option",{value:"nearest"},"Nearest",-1)])],512),[[dt,j.value]])]),e("div",re,[t[18]||(t[18]=e("label",{class:"param-label"},"网格分辨率",-1)),A(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>N.value=d),type:"number",min:"20",max:"200",class:"param-input"},null,512),[[xt,N.value,void 0,{number:!0}]])]),e("div",de,[e("button",{class:"btn primary",onClick:l,disabled:_.value||!w.value},[_.value?(g(),h("span",ce)):V("",!0),X(" "+b(_.value?"计算中...":"计算MPI热力图"),1)],8,ue),e("button",{class:"btn secondary",onClick:i,disabled:_.value||!E.value}," 刷新图像 ",8,ve)])]),e("div",fe,[t[23]||(t[23]=e("h3",{class:"section-title"},"显示设置",-1)),e("div",pe,[e("label",me,[A(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=d=>T.value=d)},null,512),[[ut,T.value]]),t[20]||(t[20]=X(" 显示边界 ",-1))]),e("label",ge,[A(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=d=>F.value=d)},null,512),[[ut,F.value]]),t[21]||(t[21]=X(" 显示遮罩 ",-1))])]),e("div",he,[t[22]||(t[22]=e("label",{class:"param-label"},"渲染模式",-1)),e("div",ye,[e("button",{class:tt(["mode-tab",{active:S.value==="image"}]),onClick:t[7]||(t[7]=d=>S.value="image")},"图像",2),e("button",{class:tt(["mode-tab",{active:S.value==="canvas"}]),onClick:t[8]||(t[8]=d=>S.value="canvas")},"Canvas",2)])])])]),e("div",be,[e("div",ke,[e("div",xe,[t[24]||(t[24]=e("h3",{class:"section-title"},"MPI综合指标分布",-1)),e("div",we,[M.value?(g(),h("span",_e,"当前："+b(M.value.name),1)):(g(),h("span",Me,"未选择工作面"))])]),(r=M.value)!=null&&r.bounds?(g(),h("div",Ce," 范围：X "+b(M.value.bounds.min_x)+" ~ "+b(M.value.bounds.max_x)+"， Y "+b(M.value.bounds.min_y)+" ~ "+b(M.value.bounds.max_y),1)):V("",!0),pt(Xt,{mode:S.value,"image-url":H.value,grid:R.value||[],bounds:L.value,workface:M.value,"show-boundary":T.value,"show-mask":F.value,palette:J,onHover:t[9]||(t[9]=d=>Y.value=d),onImageError:c},null,8,["mode","image-url","grid","bounds","workface","show-boundary","show-mask"]),E.value?(g(),h("div",Ie,[t[25]||(t[25]=e("div",{class:"legend-label"},"MPI风险渐变（ODI色盘）",-1)),e("div",{class:"legend-bar",style:mt({background:et.value})},null,4),t[26]||(t[26]=e("div",{class:"legend-scale"},[e("span",null,"高风险（低MPI）"),e("span",null,"低风险（高MPI）")],-1))])):V("",!0),E.value?(g(),h("div",$e,[e("div",Pe,[t[27]||(t[27]=e("span",{class:"stat-label"},"最小值",-1)),e("span",Se,b(((f=U.value.min)==null?void 0:f.toFixed(2))||"-"),1)]),e("div",Re,[t[28]||(t[28]=e("span",{class:"stat-label"},"最大值",-1)),e("span",Be,b(((m=U.value.max)==null?void 0:m.toFixed(2))||"-"),1)]),e("div",je,[t[29]||(t[29]=e("span",{class:"stat-label"},"平均值",-1)),e("span",Ue,b(((p=U.value.mean)==null?void 0:p.toFixed(2))||"-"),1)]),e("div",Ee,[t[30]||(t[30]=e("span",{class:"stat-label"},"悬停值",-1)),e("span",Fe,b(((P=($=Y.value)==null?void 0:$.value)==null?void 0:P.toFixed(2))||"-"),1)])])):(g(),h("div",Ve,[...t[31]||(t[31]=[O('<div class="empty-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-f42dfab5></rect><line x1="3" y1="9" x2="21" y2="9" data-v-f42dfab5></line><line x1="9" y1="21" x2="9" y2="9" data-v-f42dfab5></line></svg></div><p data-v-f42dfab5>请选择煤层并计算MPI热力图</p>',2)])]))])])])])}}},Oe=ct(Ne,[["__scopeId","data-v-f42dfab5"]]);export{Oe as default};
