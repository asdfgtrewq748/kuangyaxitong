var R=(O,w,k)=>new Promise((F,l)=>{var I=f=>{try{M(k.next(f))}catch(S){l(S)}},j=f=>{try{M(k.throw(f))}catch(S){l(S)}},M=f=>f.done?F(f.value):Promise.resolve(f.value).then(I,j);M((k=k.apply(O,w)).next())});import{_ as T,u as E}from"./index-BQuJNExo.js";import{x as U,y as V,z as W,A as $,g as q,c as G,B as H,l as J}from"./api-BlLoGSss.js";import{b as _,a as s,y as B,A as K,t as n,F as D,r as C,d as L,o as y}from"./vue-vendor-uHJg9g_5.js";import"./index-T6nY3V_4.js";const Q={class:"page"},X={class:"card"},Y={class:"action-buttons"},Z=["disabled"],ss={key:0,class:"spinner sm"},ts={key:0,class:"report-content"},es={class:"summary-cards"},as={class:"card-title"},ns={class:"card-stats"},os={class:"card-stat"},ls={class:"stat-value"},is={class:"card-stat"},ds={class:"stat-value"},rs={class:"card-stat"},cs={class:"stat-value"},us={class:"card-additional"},ms={key:0,class:"card"},ps={class:"section-title"},vs={class:"mpi-summary-grid"},_s={class:"mpi-summary-item"},ys={class:"stat-value"},bs={class:"mpi-summary-item"},hs={class:"stat-value"},xs={class:"mpi-summary-item"},gs={class:"stat-value"},ks={class:"mpi-summary-item"},fs={class:"stat-value"},Fs={class:"mpi-summary-item"},Ps={class:"stat-value"},Is={class:"mpi-summary-item"},ws={class:"stat-value"},Ms={class:"mpi-markers"},Ss={class:"mpi-marker"},Rs={class:"mpi-marker"},zs={class:"card"},Ds={class:"table-wrapper"},Cs={class:"table"},js={key:1,class:"empty-state"},Bs={__name:"Report",setup(O){const w=E(),k=L(!1),F=L(null),l=L(null),I=new Map,j=()=>R(this,null,function*(){var i,t;k.value=!0;try{const b="idw",m="x",r="ascending",p="decrease",o="fixed",c="initial",[e,h,P,z]=yield Promise.all([U(b,60),V({method:b,grid_size:60,axis:m,count:3,direction:r,mode:p,decay:.08,elastic_modulus:.4,density:.3,tensile_strength:.3}),W(o,c,60),$({model:o,target:c,grid_size:60,axis:m,count:3,direction:r,mode:p,decay:.08})]);F.value=[{name:"çŸ¿å‹æŒ‡æ ‡",stats:e.data.grid},{name:"çŸ¿å‹æŒ‡æ ‡-å·¥ä½œé¢",stats:h.data.grid},{name:"æ¥å‹æ­¥è·",stats:P.data.grid},{name:"æ¥å‹æ­¥è·-å·¥ä½œé¢",stats:z.data.grid}],l.value=yield S(),w.add("æŠ¥å‘Šç”Ÿæˆå®Œæˆ","success")}catch(b){w.add(((t=(i=b.response)==null?void 0:i.data)==null?void 0:t.detail)||"ç”Ÿæˆå¤±è´¥","error")}finally{k.value=!1}}),M=i=>R(this,null,function*(){if(!i)return null;if(I.has(i))return I.get(i);try{const{data:t}=yield J(i);return I.set(i,t),t}catch(t){return I.set(i,null),null}}),f=(...b)=>R(this,[...b],function*(i=[],t=""){var m,g;const x=[];for(const r of i){const p=r.layers||[],a=p.find(d=>d.name===t),o=p.filter(d=>d.name!==t),c=[];for(const d of o){const e=yield M(d.name);c.push({thickness:d.thickness||0,name:d.name||"",density:e==null?void 0:e.density,bulk_modulus:e==null?void 0:e.bulk_modulus,shear_modulus:e==null?void 0:e.shear_modulus,cohesion:e==null?void 0:e.cohesion,friction_angle:e==null?void 0:e.friction_angle,tensile_strength:e==null?void 0:e.tensile_strength,compressive_strength:e==null?void 0:e.compressive_strength,elastic_modulus:e==null?void 0:e.elastic_modulus,poisson_ratio:e==null?void 0:e.poisson_ratio})}const u=(g=(m=r.seam_top_depth)!=null?m:r.total_overburden_thickness)!=null?g:0,v=(a==null?void 0:a.thickness)||0;x.push({x:r.x,y:r.y,borehole:r.name,thickness:v,burial_depth:u,z_top:u,z_bottom:u+v,strata:c})}return x}),S=()=>R(this,null,function*(){try{const{data:i}=yield q(),t=i.seams||[];if(t.length===0)return null;const b=t[0].name,{data:x}=yield G(b),m=x.boreholes||[];if(m.length===0)return null;const g=yield f(m,b),{data:r}=yield H(g),p=r.results||[],a=p.reduce((e,h)=>{var P,z,A;return e.rsi+=((P=h.breakdown)==null?void 0:P.rsi)||0,e.bri+=((z=h.breakdown)==null?void 0:z.bri)||0,e.asi+=((A=h.breakdown)==null?void 0:A.asi)||0,e},{rsi:0,bri:0,asi:0}),o=p.length||1,c={rsi:a.rsi/o,bri:a.bri/o,asi:a.asi/o},u=[...p].sort((e,h)=>e.mpi-h.mpi),v=u.slice(0,3),d=u.slice(-3).reverse();return{seamName:b,stats:r.summary||{},breakdown:c,high:d,low:v}}catch(i){return null}}),N=()=>{var g,r,p,a;const i=F.value.map(o=>{var c,u,v,d,e,h,P;return{æŒ‡æ ‡:o.name,æœ€å°å€¼:(c=o.stats.min)==null?void 0:c.toFixed(3),æœ€å¤§å€¼:(u=o.stats.max)==null?void 0:u.toFixed(3),å¹³å‡å€¼:(v=o.stats.mean)==null?void 0:v.toFixed(3),æ ‡å‡†å·®:(d=o.stats.std)==null?void 0:d.toFixed(3),P10:(e=o.stats.p10)==null?void 0:e.toFixed(3),P50:(h=o.stats.p50)==null?void 0:h.toFixed(3),P90:(P=o.stats.p90)==null?void 0:P.toFixed(3)}});l.value&&i.push({æŒ‡æ ‡:`MPIç»¼åˆæŒ‡æ ‡ï¼ˆ${l.value.seamName}ï¼‰`,æœ€å°å€¼:(g=l.value.stats.min)==null?void 0:g.toFixed(3),æœ€å¤§å€¼:(r=l.value.stats.max)==null?void 0:r.toFixed(3),å¹³å‡å€¼:(p=l.value.stats.mean)==null?void 0:p.toFixed(3),æ ‡å‡†å·®:(a=l.value.stats.std)==null?void 0:a.toFixed(3),P10:"",P50:"",P90:""});const t=[Object.keys(i[0]).join(","),...i.map(o=>Object.values(o).join(","))].join(`
`),b=new Blob([t],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(b),m=document.createElement("a");m.href=x,m.download=`pressure_report_${new Date().toISOString().slice(0,10)}.csv`,m.click(),URL.revokeObjectURL(x),w.add("æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ","success")};return(i,t)=>{var b,x,m,g,r,p;return y(),_("div",Q,[t[17]||(t[17]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"ğŸ“‘ ç»“æœæŠ¥å‘Š"),s("p",{class:"page-subtitle"},"ç”Ÿæˆç»¼åˆåˆ†ææŠ¥å‘Šï¼Œæ±‡æ€»æ‰€æœ‰è®¡ç®—ç»“æœ")],-1)),s("div",X,[t[0]||(t[0]=s("h3",{class:"section-title"},"ç”ŸæˆæŠ¥å‘Š",-1)),t[1]||(t[1]=s("p",{class:"section-desc"},"ç‚¹å‡»ç”ŸæˆæŒ‰é’®è·å–å®Œæ•´çš„åˆ†ææŠ¥å‘Š",-1)),s("div",Y,[s("button",{class:"btn primary",onClick:j,disabled:k.value},[k.value?(y(),_("span",ss)):B("",!0),K(" "+n(k.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆç»¼åˆæŠ¥å‘Š"),1)],8,Z),F.value?(y(),_("button",{key:0,class:"btn secondary",onClick:N}," å¯¼å‡ºæŠ¥å‘Š ")):B("",!0)])]),F.value?(y(),_("div",ts,[s("div",es,[(y(!0),_(D,null,C(F.value,a=>{var o,c,u,v,d;return y(),_("div",{key:a.name,class:"summary-card"},[s("div",as,n(a.name),1),s("div",ns,[s("div",os,[t[2]||(t[2]=s("span",{class:"stat-label"},"æœ€å°å€¼",-1)),s("span",ls,n(((o=a.stats.min)==null?void 0:o.toFixed(3))||"-"),1)]),s("div",is,[t[3]||(t[3]=s("span",{class:"stat-label"},"æœ€å¤§å€¼",-1)),s("span",ds,n(((c=a.stats.max)==null?void 0:c.toFixed(3))||"-"),1)]),s("div",rs,[t[4]||(t[4]=s("span",{class:"stat-label"},"å¹³å‡å€¼",-1)),s("span",cs,n(((u=a.stats.mean)==null?void 0:u.toFixed(3))||"-"),1)])]),s("div",us,[s("span",null,"æ ‡å‡†å·®: "+n(((v=a.stats.std)==null?void 0:v.toFixed(3))||"-"),1),s("span",null,"P50: "+n(((d=a.stats.p50)==null?void 0:d.toFixed(3))||"-"),1)])])}),128))]),l.value?(y(),_("div",ms,[s("h3",ps,"MPIä¸“é¢˜åˆ†æï¼ˆ"+n(l.value.seamName)+"ï¼‰",1),t[13]||(t[13]=s("p",{class:"section-desc"},"ç»¼åˆMPIä¸åˆ†é¡¹æŒ‡æ ‡ç»Ÿè®¡ï¼Œå¹¶æ ‡æ³¨é«˜/ä½MPIåŒºåŸŸ",-1)),s("div",vs,[s("div",_s,[t[5]||(t[5]=s("span",{class:"stat-label"},"MPIæœ€å°å€¼",-1)),s("span",ys,n(((b=l.value.stats.min)==null?void 0:b.toFixed(2))||"-"),1)]),s("div",bs,[t[6]||(t[6]=s("span",{class:"stat-label"},"MPIæœ€å¤§å€¼",-1)),s("span",hs,n(((x=l.value.stats.max)==null?void 0:x.toFixed(2))||"-"),1)]),s("div",xs,[t[7]||(t[7]=s("span",{class:"stat-label"},"MPIå¹³å‡å€¼",-1)),s("span",gs,n(((m=l.value.stats.mean)==null?void 0:m.toFixed(2))||"-"),1)]),s("div",ks,[t[8]||(t[8]=s("span",{class:"stat-label"},"RSIå¹³å‡å€¼",-1)),s("span",fs,n(((g=l.value.breakdown.rsi)==null?void 0:g.toFixed(2))||"-"),1)]),s("div",Fs,[t[9]||(t[9]=s("span",{class:"stat-label"},"BRIå¹³å‡å€¼",-1)),s("span",Ps,n(((r=l.value.breakdown.bri)==null?void 0:r.toFixed(2))||"-"),1)]),s("div",Is,[t[10]||(t[10]=s("span",{class:"stat-label"},"ASIå¹³å‡å€¼",-1)),s("span",ws,n(((p=l.value.breakdown.asi)==null?void 0:p.toFixed(2))||"-"),1)])]),s("div",Ms,[s("div",Ss,[t[11]||(t[11]=s("div",{class:"mpi-marker-title"},"é«˜MPIåŒºåŸŸï¼ˆä½é£é™©ï¼‰",-1)),s("ul",null,[(y(!0),_(D,null,C(l.value.high,a=>(y(),_("li",{key:a.id},n(a.id)+"ï¼šMPI "+n(a.mpi.toFixed(2)),1))),128))])]),s("div",Rs,[t[12]||(t[12]=s("div",{class:"mpi-marker-title"},"ä½MPIåŒºåŸŸï¼ˆé«˜é£é™©ï¼‰",-1)),s("ul",null,[(y(!0),_(D,null,C(l.value.low,a=>(y(),_("li",{key:a.id},n(a.id)+"ï¼šMPI "+n(a.mpi.toFixed(2)),1))),128))])])])])):B("",!0),s("div",zs,[t[15]||(t[15]=s("h3",{class:"section-title"},"è¯¦ç»†ç»Ÿè®¡æ•°æ®",-1)),s("div",Ds,[s("table",Cs,[t[14]||(t[14]=s("thead",null,[s("tr",null,[s("th",null,"æŒ‡æ ‡"),s("th",null,"æœ€å°å€¼"),s("th",null,"æœ€å¤§å€¼"),s("th",null,"å¹³å‡å€¼"),s("th",null,"æ ‡å‡†å·®"),s("th",null,"P10"),s("th",null,"P50"),s("th",null,"P90")])],-1)),s("tbody",null,[(y(!0),_(D,null,C(F.value,a=>{var o,c,u,v,d,e,h;return y(),_("tr",{key:a.name},[s("td",null,[s("strong",null,n(a.name),1)]),s("td",null,n(((o=a.stats.min)==null?void 0:o.toFixed(3))||"-"),1),s("td",null,n(((c=a.stats.max)==null?void 0:c.toFixed(3))||"-"),1),s("td",null,n(((u=a.stats.mean)==null?void 0:u.toFixed(3))||"-"),1),s("td",null,n(((v=a.stats.std)==null?void 0:v.toFixed(3))||"-"),1),s("td",null,n(((d=a.stats.p10)==null?void 0:d.toFixed(3))||"-"),1),s("td",null,n(((e=a.stats.p50)==null?void 0:e.toFixed(3))||"-"),1),s("td",null,n(((h=a.stats.p90)==null?void 0:h.toFixed(3))||"-"),1)])}),128))])])])])])):(y(),_("div",js,[...t[16]||(t[16]=[s("div",{class:"empty-icon"},"ğŸ“Š",-1),s("p",null,"æš‚æ— æŠ¥å‘Šæ•°æ®",-1),s("p",{class:"empty-hint"},"è¯·å…ˆå®Œæˆæ•°æ®åˆ†æåå†ç”ŸæˆæŠ¥å‘Š",-1)])]))])}}},Es=T(Bs,[["__scopeId","data-v-be0e28da"]]);export{Es as default};
