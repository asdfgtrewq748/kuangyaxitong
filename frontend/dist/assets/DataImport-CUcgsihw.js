var te=Math.pow;var ce=(z,N,f)=>new Promise((D,h)=>{var y=F=>{try{I(f.next(F))}catch(X){h(X)}},T=F=>{try{I(f.throw(F))}catch(X){h(X)}},I=F=>F.done?D(F.value):Promise.resolve(F.value).then(y,T);I((f=f.apply(z,N)).next())});import{bf as $e,bl as Pe,w as ue,b5 as C,b8 as w,b7 as t,ba as E,bm as U,bi as j,bn as ve,bo as le,bb as b,b as $,c as H,b4 as Ne,bc as ae,b9 as fe,bp as Le,bq as K,bj as Xe,br as re,bs as de,bh as Ve}from"./vendor-CcQzWQKD.js";import{_ as Ce,u as Re,a as De}from"./index-DAAno9XI.js";import{u as He,s as Be,p as ze}from"./api-PFloj90e.js";import"./vue-router-4_hPxHr_.js";import"./network-T6nY3V_4.js";const Oe={class:"borehole-map-container"},We={class:"map-controls"},Ae=["width","height"],Ue={key:0,class:"map-empty"},je={class:"tooltip-header"},qe={class:"tooltip-row"},Ee={class:"tooltip-value"},Ge={class:"tooltip-row"},Je={class:"tooltip-value"},Ke={key:1,class:"selection-info"},Qe={class:"selection-coords"},Ze={key:2,class:"map-stats"},et={class:"stat-item"},tt={key:0,class:"stat-item"},Z=40,lt={__name:"BoreholeMap",props:{boreholes:{type:Array,default:()=>[]},size:{type:Number,default:350}},emits:["select"],setup(z,{emit:N}){const f=z,D=N,h=$(null),y=$(null),T=$(null),I=$({x:0,y:0}),F=$(!0),X=$(1),P=$(0),O=$(0),d=$(!1),V=$({x:0,y:0});let S=0;const x=H(()=>f.size),M=H(()=>{if(f.boreholes.length===0)return null;let e=1/0,n=-1/0,i=1/0,Y=-1/0;return f.boreholes.forEach(u=>{u.x<e&&(e=u.x),u.x>n&&(n=u.x),u.y<i&&(i=u.y),u.y>Y&&(Y=u.y)}),{minX:e,maxX:n,minY:i,maxY:Y,rangeX:n-e,rangeY:Y-i}}),W=H(()=>({left:I.value.x+12+"px",top:I.value.y+12+"px"})),G=e=>{if(e.length<3)return e;const n=[...e].sort((m,B)=>m.y-B.y||m.x-B.x),i=n[0],Y=m=>Math.atan2(m.y-i.y,m.x-i.x),u=n.slice(1).sort((m,B)=>{const a=Y(m),l=Y(B);if(a!==l)return a-l;const c=Math.hypot(m.x-i.x,m.y-i.y),v=Math.hypot(B.x-i.x,B.y-i.y);return c-v}),L=(m,B,a)=>(B.x-m.x)*(a.y-m.y)-(B.y-m.y)*(a.x-m.x),g=[i];for(const m of u){for(;g.length>1&&L(g[g.length-2],g[g.length-1],m)<=0;)g.pop();g.push(m)}return g},Q=(e,n)=>{const i=M.value;if(!i)return{x:0,y:0};const Y=x.value/2,u=x.value/2,g=Math.min((x.value-Z*2)/(i.rangeX||1),(x.value-Z*2)/(i.rangeY||1))*X.value,m=(i.minX+i.maxX)/2,B=(i.minY+i.maxY)/2;return{x:Y+(e-m)*g+P.value,y:u+(B-n)*g+O.value}},R=()=>{S||(S=requestAnimationFrame(()=>{S=0,se()}))},se=()=>{if(!h.value)return;const e=h.value.getContext("2d"),{width:n,height:i}=h.value;e.clearRect(0,0,n,i);const Y=e.createLinearGradient(0,0,n,i);if(Y.addColorStop(0,"#f8fafc"),Y.addColorStop(1,"#f1f5f9"),e.fillStyle=Y,e.fillRect(0,0,n,i),f.boreholes.length===0)return;const u=M.value,L=50*X.value,g=Math.min(.3,L/100);e.strokeStyle=`rgba(148, 163, 184, ${g})`,e.lineWidth=1;const m=oe(0,0),B=oe(n,i),a=Math.floor(m.x/50)*50,l=Math.floor(B.y/50)*50;for(let s=a;s<=B.x;s+=50){const r=Q(s,0);e.beginPath(),e.moveTo(r.x,0),e.lineTo(r.x,i),e.stroke()}for(let s=l;s<=m.y;s+=50){const r=Q(0,s);e.beginPath(),e.moveTo(0,r.y),e.lineTo(n,r.y),e.stroke()}e.strokeStyle="#cbd5e1",e.lineWidth=1.5;const c=Q(0,0);if(c.y>=0&&c.y<=i&&(e.beginPath(),e.moveTo(0,c.y),e.lineTo(n,c.y),e.stroke()),c.x>=0&&c.x<=n&&(e.beginPath(),e.moveTo(c.x,0),e.lineTo(c.x,i),e.stroke()),h.value.scaledBoreholes=f.boreholes.map((s,r)=>{const k=Q(s.x,s.y);return{index:r,name:s.name,x:s.x,y:s.y,canvasX:k.x,canvasY:k.y}}),F.value&&h.value.scaledBoreholes.length>=3){const s=G(h.value.scaledBoreholes);e.beginPath(),s.forEach((o,p)=>{p===0?e.moveTo(o.canvasX,o.canvasY):e.lineTo(o.canvasX,o.canvasY)}),e.closePath();const r=s.reduce((o,p)=>({minX:Math.min(o.minX,p.canvasX),maxX:Math.max(o.maxX,p.canvasX),minY:Math.min(o.minY,p.canvasY),maxY:Math.max(o.maxY,p.canvasY)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),k=e.createRadialGradient((r.minX+r.maxX)/2,(r.minY+r.maxY)/2,0,(r.minX+r.maxX)/2,(r.minY+r.maxY)/2,Math.max(r.maxX-r.minX,r.maxY-r.minY)/2);k.addColorStop(0,"rgba(59, 130, 246, 0.15)"),k.addColorStop(1,"rgba(59, 130, 246, 0.05)"),e.fillStyle=k,e.fill(),e.strokeStyle="rgba(59, 130, 246, 0.5)",e.lineWidth=2,e.setLineDash([8,4]),e.stroke(),e.setLineDash([]),s.forEach((o,p)=>{e.beginPath(),e.arc(o.canvasX,o.canvasY,5,0,Math.PI*2),e.fillStyle="rgba(59, 130, 246, 0.3)",e.fill(),e.strokeStyle="rgba(59, 130, 246, 0.6)",e.lineWidth=1.5,e.stroke()})}e.strokeStyle="rgba(99, 102, 241, 0.2)",e.lineWidth=1.5,e.setLineDash([4,4]),e.beginPath(),h.value.scaledBoreholes.forEach((s,r)=>{r===0?e.moveTo(s.canvasX,s.canvasY):e.lineTo(s.canvasX,s.canvasY)}),e.stroke(),e.setLineDash([]),h.value.scaledBoreholes.forEach((s,r)=>{var Se;const k=T.value===r,o=((Se=y.value)==null?void 0:Se.index)===r;if(k||o){const Ye=k?20:16,J=e.createRadialGradient(s.canvasX,s.canvasY,0,s.canvasX,s.canvasY,Ye);k?(J.addColorStop(0,"rgba(245, 158, 11, 0.4)"),J.addColorStop(.5,"rgba(245, 158, 11, 0.15)"),J.addColorStop(1,"rgba(245, 158, 11, 0)")):(J.addColorStop(0,"rgba(59, 130, 246, 0.3)"),J.addColorStop(.5,"rgba(59, 130, 246, 0.1)"),J.addColorStop(1,"rgba(59, 130, 246, 0)")),e.beginPath(),e.arc(s.canvasX,s.canvasY,Ye,0,Math.PI*2),e.fillStyle=J,e.fill()}const p=k?8:6;e.beginPath(),e.arc(s.canvasX,s.canvasY,p,0,Math.PI*2);const _=e.createRadialGradient(s.canvasX-p*.3,s.canvasY-p*.3,0,s.canvasX,s.canvasY,p);k?(_.addColorStop(0,"#fcd34d"),_.addColorStop(.5,"#f59e0b"),_.addColorStop(1,"#d97706")):(_.addColorStop(0,"#93c5fd"),_.addColorStop(.5,"#3b82f6"),_.addColorStop(1,"#2563eb")),e.fillStyle=_,e.fill(),e.strokeStyle=k?"#b45309":"#1d4ed8",e.lineWidth=k?2.5:2,e.stroke(),e.shadowColor=k?"rgba(245, 158, 11, 0.4)":"rgba(59, 130, 246, 0.3)",e.shadowBlur=6,e.shadowOffsetX=0,e.shadowOffsetY=2,e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;const A=s.name||`#${r+1}`,q=s.canvasY-p-6;e.font=k?"bold 11px sans-serif":"10px sans-serif";const we=e.measureText(A),_e=4,Me=s.canvasX-we.width/2-_e,Fe=q-10,Ie=we.width+_e*2,Te=14;k?e.fillStyle="rgba(245, 158, 11, 0.9)":e.fillStyle="rgba(255, 255, 255, 0.85)",e.beginPath(),e.roundRect(Me,Fe,Ie,Te,4),e.fill(),e.fillStyle=k?"#fff":"#1e40af",e.textAlign="center",e.textBaseline="middle",e.fillText(A,s.canvasX,q-3)});const v=60*X.value;if(v>30&&v<180){const s=i-18,r=16;e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.roundRect(r-4,s-10,v+8,20,4),e.fill(),e.strokeStyle="#475569",e.lineWidth=2,e.beginPath(),e.moveTo(r,s),e.lineTo(r+v,s),e.stroke(),e.beginPath(),e.moveTo(r,s-5),e.lineTo(r,s+5),e.stroke(),e.beginPath(),e.moveTo(r+v,s-5),e.lineTo(r+v,s+5),e.stroke();const k=Math.min((x.value-Z*2)/(u.rangeX||1),(x.value-Z*2)/(u.rangeY||1)),o=Math.round(60/X.value/k);e.fillStyle="#475569",e.font="10px sans-serif",e.textAlign="center",e.fillText(`${o}m`,r+v/2,s-10)}},oe=(e,n)=>{const i=M.value;if(!i)return{x:0,y:0};const Y=x.value/2,u=x.value/2,g=Math.min((x.value-Z*2)/(i.rangeX||1),(x.value-Z*2)/(i.rangeY||1))*X.value,m=(i.minX+i.maxX)/2,B=(i.minY+i.maxY)/2;return{x:m+(e-Y-P.value)/g,y:B-(n-u-O.value)/g}},pe=()=>{X.value=Math.min(X.value*1.3,5),R()},he=()=>{X.value=Math.max(X.value/1.3,.2),R()},ne=()=>{X.value=1,P.value=0,O.value=0,R()},me=()=>{F.value=!F.value,R()},ie=e=>{var n,i;h.value&&(e.pointerType==="mouse"&&e.button!==0||(d.value=!0,(i=(n=h.value).setPointerCapture)==null||i.call(n,e.pointerId),V.value={x:e.clientX-P.value,y:e.clientY-O.value}))},ee=e=>{var n,i;h.value&&(e==null?void 0:e.pointerId)!==void 0&&((i=(n=h.value).hasPointerCapture)!=null&&i.call(n,e.pointerId))&&h.value.releasePointerCapture(e.pointerId),d.value=!1,h.value&&(h.value.style.cursor=y.value?"pointer":"grab")},ye=e=>{var m,B,a,l;if(!((m=h.value)!=null&&m.scaledBoreholes))return;const n=h.value.getBoundingClientRect(),i=e.clientX-n.left,Y=e.clientY-n.top;if(d.value){P.value=e.clientX-V.value.x,O.value=e.clientY-V.value.y,R();return}let u=null;for(const c of h.value.scaledBoreholes)if(Math.sqrt(te(i-c.canvasX,2)+te(Y-c.canvasY,2))<12){u=c;break}const L=(a=(B=y.value)==null?void 0:B.index)!=null?a:-1,g=(l=u==null?void 0:u.index)!=null?l:-1;L!==g?(y.value=u,R()):y.value=u,I.value={x:e.clientX,y:e.clientY},h.value.style.cursor=u?"pointer":"grab"},xe=e=>{const n=e.deltaY>0?.9:1.1;X.value=Math.max(.2,Math.min(5,X.value*n)),R()},ge=e=>{var L;if(!((L=h.value)!=null&&L.scaledBoreholes))return;const n=h.value.getBoundingClientRect(),i=e.clientX-n.left,Y=e.clientY-n.top;let u=null;for(const g of h.value.scaledBoreholes)if(Math.sqrt(te(i-g.canvasX,2)+te(Y-g.canvasY,2))<12){u=g.index;break}u!==null?(T.value=u,D("select",u)):T.value=null,R()},be=e=>{ee(e),y.value&&(y.value=null,R())},ke=e=>{ee(e),y.value&&(y.value=null,R())};return $e(()=>{se(),h.value&&(h.value.style.cursor="grab")}),Pe(()=>{S&&(cancelAnimationFrame(S),S=0)}),ue(()=>f.boreholes,()=>{ne()},{deep:!0}),ue(()=>f.size,()=>{R()}),ue(F,R),(e,n)=>{var i,Y,u,L,g,m,B;return C(),w("div",Oe,[t("div",We,[t("button",{class:"control-btn",onClick:pe,title:"æ”¾å¤§"},[...n[2]||(n[2]=[t("span",null,"+",-1)])]),t("button",{class:"control-btn",onClick:he,title:"ç¼©å°"},[...n[3]||(n[3]=[t("span",null,"âˆ’",-1)])]),t("button",{class:"control-btn",onClick:ne,title:"é‡ç½®"},[...n[4]||(n[4]=[t("span",null,"âŸ²",-1)])]),t("button",{class:E(["control-btn",{active:F.value}]),onClick:me,title:"è¾¹ç•Œ"},[...n[5]||(n[5]=[t("span",null,"â¬¡",-1)])],2)]),t("div",{class:E(["map-wrapper",{dragging:d.value}])},[t("canvas",{ref_key:"canvas",ref:h,width:x.value,height:x.value,onPointerdown:ie,onPointermove:ye,onPointerup:ee,onPointerleave:be,onPointercancel:ke,onWheel:U(xe,["prevent"]),onClick:ge,onContextmenu:n[0]||(n[0]=U(()=>{},["prevent"]))},null,40,Ae),z.boreholes.length===0?(C(),w("div",Ue,[...n[6]||(n[6]=[t("div",{class:"empty-icon"},"ğŸ“",-1),t("p",null,"æš‚æ— é’»å­”æ•°æ®",-1)])])):j("",!0)],2),y.value?(C(),w("div",{key:0,class:"tooltip",style:ve(W.value)},[t("div",je,[n[7]||(n[7]=t("span",{class:"tooltip-icon"},"ğŸ“",-1)),le(" "+b(y.value.name||`é’»å­” #${y.value.index+1}`),1)]),t("div",qe,[n[8]||(n[8]=t("span",{class:"tooltip-label"},"X åæ ‡:",-1)),t("span",Ee,b(y.value.x.toFixed(2))+" m",1)]),t("div",Ge,[n[9]||(n[9]=t("span",{class:"tooltip-label"},"Y åæ ‡:",-1)),t("span",Je,b(y.value.y.toFixed(2))+" m",1)])],4)):j("",!0),T.value!==null?(C(),w("div",Ke,[n[10]||(n[10]=t("span",{class:"selection-icon"},"ğŸ¯",-1)),t("strong",null,b(((i=z.boreholes[T.value])==null?void 0:i.name)||`é’»å­” #${T.value+1}`),1),t("span",Qe,"("+b((u=(Y=z.boreholes[T.value])==null?void 0:Y.x)==null?void 0:u.toFixed(1))+", "+b((g=(L=z.boreholes[T.value])==null?void 0:L.y)==null?void 0:g.toFixed(1))+")",1),t("button",{class:"clear-btn",onClick:n[1]||(n[1]=a=>T.value=null),title:"å–æ¶ˆé€‰æ‹©"},"Ã—")])):(C(),w("div",Ze,[t("span",et,"ğŸ“ "+b(z.boreholes.length)+" ä¸ªé’»å­”",1),M.value?(C(),w("span",tt," ğŸ“ "+b((m=M.value.rangeX)==null?void 0:m.toFixed(0))+"m Ã— "+b((B=M.value.rangeY)==null?void 0:B.toFixed(0))+"m ",1)):j("",!0)]))])}}},at=Ce(lt,[["__scopeId","data-v-53a8707d"]]),st={__name:"VirtualList",props:{items:{type:Array,required:!0},itemHeight:{type:Number,required:!0},height:{type:Number,required:!0},buffer:{type:Number,default:5},keyField:{type:String,default:"id"},itemClass:{type:String,default:""}},setup(z,{expose:N}){const f=z,D=$(null),h=$(0),y=H(()=>({height:`${f.height}px`,overflow:"auto",position:"relative"})),T=H(()=>f.items.length*f.itemHeight),I=H(()=>({height:`${T.value}px`,position:"relative"})),F=S=>({height:`${f.itemHeight}px`,position:"absolute",top:`${S*f.itemHeight}px`,left:0,right:0,boxSizing:"border-box"}),X=H(()=>{const S=Math.floor(h.value/f.itemHeight),x=Math.ceil(f.height/f.itemHeight),M=Math.max(0,S-f.buffer),W=Math.min(f.items.length,S+x+f.buffer);return{start:M,end:W}}),P=H(()=>{const{start:S,end:x}=X.value,M=[];for(let W=S;W<x;W++)W>=0&&W<f.items.length&&M.push({data:f.items[W],index:W});return M}),O=S=>{if(!S)return"virtual-item";const x=S.data,M=S.index;return f.keyField&&(x==null?void 0:x[f.keyField])!==void 0&&(x==null?void 0:x[f.keyField])!==null?`${String(x[f.keyField])}_${M}`:`index_${M}`};let d=null;const V=()=>{d||(d=requestAnimationFrame(()=>{var S,x;h.value=(x=(S=D.value)==null?void 0:S.scrollTop)!=null?x:0,d=null}))};return N({scrollTo:S=>{if(D.value){const x=Math.max(0,Math.min(f.items.length-1,Number(S)||0));D.value.scrollTop=x*f.itemHeight}},scrollToTop:()=>{D.value&&(D.value.scrollTop=0)}}),Ne(()=>{d&&(cancelAnimationFrame(d),d=null)}),(S,x)=>(C(),w("div",{ref_key:"containerRef",ref:D,class:"virtual-list-container",style:ve(y.value),onScroll:V},[t("div",{class:"virtual-list-spacer",style:ve(I.value)},[(C(!0),w(ae,null,fe(P.value,M=>(C(),w("div",{key:O(M),class:E(z.itemClass),style:ve(F(M.index))},[Le(S.$slots,"default",{item:M.data,index:M.index},void 0)],6))),128))],4)],36))}},ot=Ce(st,[["__scopeId","data-v-44ca9fbc"]]),nt={class:"page"},it={class:"grid grid-2"},ct={class:"card upload-card"},rt={key:0,class:"file-list"},dt={class:"file-list-header"},ut={class:"file-items"},vt={class:"file-name"},ft={class:"file-size"},pt=["onClick"],ht={class:"action-buttons"},mt=["disabled"],yt={key:0,class:"spinner sm"},xt=["disabled"],gt={key:1,class:"result-box success"},bt={class:"result-content"},kt={class:"result-desc"},Ct={key:2,class:"extracted-coords"},wt={class:"subsection-desc"},_t={class:"card upload-card"},St={class:"tab-buttons"},Yt={key:0,class:"coord-input"},Xt={class:"coord-list"},Bt={class:"coord-num"},$t=["onUpdate:modelValue"],Mt=["onUpdate:modelValue"],Ft=["onUpdate:modelValue"],It=["onClick"],Tt={class:"coord-actions"},Pt=["disabled"],Nt={key:1,class:"coord-file"},Lt={key:2,class:"coord-stats"},Vt={class:"stat-badge"},Rt={class:"stat-range"},Dt={key:0,class:"card preview-card"},Ht={class:"preview-header"},zt={class:"section-desc"},Ot={class:"preview-grid"},Wt={class:"map-section"},At={class:"table-section"},Ut={class:"table-header"},jt={class:"table-wrapper"},qt=["onClick"],Et={class:"virtual-cell",style:{width:"50px"}},Gt={class:"virtual-cell"},Jt={class:"virtual-cell",style:{width:"80px"}},Kt={class:"virtual-cell",style:{width:"80px"}},Qt={class:"virtual-cell",style:{width:"120px"}},Zt=["onClick"],el=["onClick"],tl={key:1,class:"table compact"},ll=["onClick"],al=["onClick"],sl=["onClick"],ol={key:2,class:"table-empty"},nl={key:1,class:"card"},il={__name:"DataImport",setup(z){const N=De(),{markStepDone:f}=Re(),D=$(null),h=$(null),y=$([]),T=$(!1),I=$(!1),F=$(null),X=$("manual"),P=$(null),O=$(""),d=$([]),V=$([]),S=H(()=>d.value.length?Math.min(...d.value.map(a=>a.x)):null),x=H(()=>d.value.length?Math.max(...d.value.map(a=>a.x)):null),M=H(()=>d.value.length?Math.min(...d.value.map(a=>a.y)):null),W=H(()=>d.value.length?Math.max(...d.value.map(a=>a.y)):null),G=H(()=>{if(!O.value)return d.value;const a=O.value.toLowerCase();return d.value.filter(l=>{var c,v;return l.name&&l.name.toLowerCase().includes(a)||((c=l.x)==null?void 0:c.toString().includes(a))||((v=l.y)==null?void 0:v.toString().includes(a))})});ue(P,a=>{});const Q=()=>{try{const a=localStorage.getItem("borehole_coordinates");a&&(d.value=JSON.parse(a))}catch(a){console.error("Failed to load coordinates:",a)}},R=()=>{var a;(a=D.value)==null||a.click()},se=()=>{var a;(a=h.value)==null||a.click()},oe=a=>{const l=Array.from(a.target.files||[]).filter(c=>c.name.endsWith(".csv"));y.value=[...y.value,...l]},pe=a=>{T.value=!1;const l=Array.from(a.dataTransfer.files||[]).filter(c=>c.name.endsWith(".csv"));y.value=[...y.value,...l]},he=a=>{y.value.splice(a,1)},ne=()=>{y.value=[]},me=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",ie=()=>ce(this,null,function*(){V.value=[];const a=[];for(const l of y.value)try{const{data:c}=yield ze(l.name,100);if(c.data&&c.data.length>0){const v=Object.keys(c.data[0]).map(o=>o.toLowerCase()),s=Object.keys(c.data[0]).find(o=>o.toLowerCase().includes("x")||o==="åæ ‡x"||o==="xåæ ‡"),r=Object.keys(c.data[0]).find(o=>o.toLowerCase().includes("y")||o==="åæ ‡y"||o==="yåæ ‡"),k=Object.keys(c.data[0]).find(o=>o.toLowerCase().includes("name")||o.toLowerCase().includes("é’»å­”")||o==="é’»å­”å·"||o==="å­”å·");if(s&&r){const o=c.data[0],p=parseFloat(o[s]),_=parseFloat(o[r]);!isNaN(p)&&!isNaN(_)&&a.push({name:k?o[k]:l.name.replace(".csv",""),x:p,y:_,file:l.name})}}}catch(c){}V.value=a}),ee=()=>ce(this,null,function*(){var a,l;I.value=!0;try{yield He(y.value);const{data:c}=yield Be();F.value=c,f("DataImport"),N.add(`å·²ä¸Šä¼  ${y.value.length} ä¸ªæ–‡ä»¶`,"success"),yield ie()}catch(c){N.add(((l=(a=c.response)==null?void 0:a.data)==null?void 0:l.detail)||"ä¸Šä¼ å¤±è´¥","error")}finally{I.value=!1}}),ye=()=>ce(this,null,function*(){var a,l;I.value=!0;try{const{data:c}=yield Be();F.value=c,N.add("æ‰«æå®Œæˆ","success"),yield ie()}catch(c){N.add(((l=(a=c.response)==null?void 0:a.data)==null?void 0:l.detail)||"æ‰«æå¤±è´¥","error")}finally{I.value=!1}}),xe=()=>{V.value.length>0&&(d.value=[...V.value],g(),N.add(`å·²å¯¼å…¥ ${V.value.length} ä¸ªé’»å­”åæ ‡`,"success"),V.value=[])},ge=a=>{var v;const l=(v=a.target.files)==null?void 0:v[0];if(!l)return;const c=new FileReader;c.onload=s=>{const r=s.target.result;be(r,l.name)},c.readAsText(l)},be=(a,l)=>{var c;try{let v=[];if(l.endsWith(".json"))v=JSON.parse(a);else{const s=a.split(`
`),r=s[0].toLowerCase().includes("name")||s[0].toLowerCase().includes("åç§°")?1:0;for(let k=r;k<s.length;k++){const o=s[k].trim();if(!o)continue;const p=o.split(/[,\t\s]+/);if(p.length>=3){const _=parseFloat(p[1]),A=parseFloat(p[2]);!isNaN(_)&&!isNaN(A)&&v.push({name:(c=p[0])==null?void 0:c.trim(),x:_,y:A})}}}v=v.filter(s=>!isNaN(s.x)&&!isNaN(s.y)),v.length>0?(d.value=v,g(),N.add(`å·²å¯¼å…¥ ${v.length} ä¸ªé’»å­”åæ ‡`,"success")):N.add("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®","error")}catch(v){N.add("æ–‡ä»¶è§£æå¤±è´¥","error")}},ke=()=>{d.value.push({name:`BH-${d.value.length+1}`,x:0,y:0})},e=a=>{const l=d.value[a];d.value.splice(a,1),g(),(P.value===a||P.value===l)&&(P.value=null)},n=a=>{const l=d.value[a],c=prompt("é’»å­”åç§°:",l.name||""),v=prompt("X åæ ‡:",l.x),s=prompt("Y åæ ‡:",l.y);c!==null&&(l.name=c),v!==null&&!isNaN(parseFloat(v))&&(l.x=parseFloat(v)),s!==null&&!isNaN(parseFloat(s))&&(l.y=parseFloat(s)),g()},i=a=>typeof a=="number"?a:d.value.indexOf(a),Y=a=>{const l=i(a);l!==-1&&e(l)},u=a=>{const l=i(a);l!==-1&&n(l)},L=a=>{var l;P.value=(l=d.value[a])!=null?l:null},g=()=>{localStorage.setItem("borehole_coordinates",JSON.stringify(d.value)),f("DataImport",{boreholes:d.value.length||0}),N.add("åæ ‡å·²ä¿å­˜","success")},m=()=>{const l=`name,x,y
`+d.value.map(r=>`${r.name||""},${r.x},${r.y}`).join(`
`),c=new Blob([l],{type:"text/csv"}),v=URL.createObjectURL(c),s=document.createElement("a");s.href=v,s.download="borehole_coordinates.csv",s.click(),URL.revokeObjectURL(v),N.add("åæ ‡å·²å¯¼å‡º","success")},B=()=>{confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰åæ ‡å—ï¼Ÿ")&&(d.value=[],P.value=null,localStorage.removeItem("borehole_coordinates"),N.add("åæ ‡å·²æ¸…ç©º","success"))};return $e(()=>{Q()}),(a,l)=>{var c,v,s,r,k;return C(),w("div",nt,[t("div",it,[t("div",ct,[l[11]||(l[11]=t("h3",{class:"section-title"},[t("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})]),le(" ä¸Šä¼ é’»å­”æ•°æ®æ–‡ä»¶ ")],-1)),l[12]||(l[12]=t("p",{class:"section-desc"},"ä¸Šä¼ åŒ…å«å²©æ€§å‚æ•°ï¼ˆå¼¹æ€§æ¨¡é‡ã€å®¹é‡ã€æŠ—æ‹‰å¼ºåº¦ã€åšåº¦ï¼‰çš„ CSV æ–‡ä»¶",-1)),t("div",{class:E(["upload-area",{"drag-over":T.value}]),onDrop:U(pe,["prevent"]),onDragover:l[0]||(l[0]=U(o=>T.value=!0,["prevent"])),onDragleave:l[1]||(l[1]=U(o=>T.value=!1,["prevent"])),onClick:R},[t("input",{ref_key:"fileInput",ref:D,type:"file",multiple:"",accept:".csv",onChange:oe,style:{display:"none"}},null,544),l[5]||(l[5]=K('<div class="upload-icon" data-v-b74f63cc><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-b74f63cc><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-b74f63cc></path><polyline points="14 2 14 8 20 8" data-v-b74f63cc></polyline><line x1="12" y1="18" x2="12" y2="12" data-v-b74f63cc></line><line x1="9" y1="15" x2="15" y2="15" data-v-b74f63cc></line></svg></div><p class="upload-text" data-v-b74f63cc>ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p><p class="upload-hint" data-v-b74f63cc>æ”¯æŒ .csv æ ¼å¼ï¼Œå¯å¤šé€‰</p>',3))],34),y.value.length>0?(C(),w("div",rt,[t("div",dt,[t("span",null,"å·²é€‰æ‹© "+b(y.value.length)+" ä¸ªæ–‡ä»¶",1),t("button",{class:"text-btn",onClick:ne},"æ¸…ç©º")]),t("div",ut,[(C(!0),w(ae,null,fe(y.value,(o,p)=>(C(),w("div",{key:p,class:"file-item"},[l[7]||(l[7]=t("svg",{class:"file-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),t("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),t("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1)),t("span",vt,b(o.name),1),t("span",ft,b(me(o.size)),1),t("button",{class:"file-remove",onClick:_=>he(p)},[...l[6]||(l[6]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,pt)]))),128))])])):j("",!0),t("div",ht,[t("button",{class:"btn primary",onClick:ee,disabled:I.value||y.value.length===0},[I.value?(C(),w("span",yt)):j("",!0),le(" "+b(I.value?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ æ•°æ®"),1)],8,mt),t("button",{class:"btn secondary",onClick:ye,disabled:I.value}," æ‰«ææ–‡ä»¶ ",8,xt)]),F.value?(C(),w("div",gt,[l[9]||(l[9]=t("div",{class:"result-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[t("polyline",{points:"20 6 9 17 4 12"})])],-1)),t("div",bt,[l[8]||(l[8]=t("div",{class:"result-title"},"æ‰«æå®Œæˆ",-1)),t("div",kt,"æ£€æµ‹åˆ° "+b(((c=F.value.files)==null?void 0:c.length)||0)+" ä¸ª CSV æ–‡ä»¶",1)])])):j("",!0),V.value.length>0?(C(),w("div",Ct,[l[10]||(l[10]=t("h4",{class:"subsection-title"},"ä»æ–‡ä»¶ä¸­æå–çš„åæ ‡",-1)),t("p",wt,"å‘ç° "+b(V.value.length)+" ä¸ªé’»å­”åŒ…å«åæ ‡ä¿¡æ¯",1),t("button",{class:"btn outline small",onClick:xe}," ä½¿ç”¨è¿™äº›åæ ‡ ")])):j("",!0)]),t("div",_t,[l[18]||(l[18]=K('<h3 class="section-title" data-v-b74f63cc><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b74f63cc><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" data-v-b74f63cc></path><circle cx="12" cy="10" r="3" data-v-b74f63cc></circle></svg> é’»å­”åæ ‡ </h3><p class="section-desc" data-v-b74f63cc>è®¾ç½®é’»å­”çš„å¹³é¢ä½ç½®åæ ‡ï¼ˆX, Yï¼‰</p>',2)),t("div",St,[t("button",{class:E(["tab-btn",{active:X.value==="manual"}]),onClick:l[2]||(l[2]=o=>X.value="manual")}," æ‰‹åŠ¨è¾“å…¥ ",2),t("button",{class:E(["tab-btn",{active:X.value==="file"}]),onClick:l[3]||(l[3]=o=>X.value="file")}," æ–‡ä»¶ä¸Šä¼  ",2)]),X.value==="manual"?(C(),w("div",Yt,[t("div",Xt,[(C(!0),w(ae,null,fe(d.value,(o,p)=>(C(),w("div",{key:p,class:"coord-item"},[t("span",Bt,"#"+b(p+1),1),re(t("input",{type:"text","onUpdate:modelValue":_=>o.name=_,placeholder:"åç§°",class:"coord-name-input"},null,8,$t),[[de,o.name]]),re(t("input",{type:"number","onUpdate:modelValue":_=>o.x=_,placeholder:"X (m)",class:"coord-value-input"},null,8,Mt),[[de,o.x,void 0,{number:!0}]]),re(t("input",{type:"number","onUpdate:modelValue":_=>o.y=_,placeholder:"Y (m)",class:"coord-value-input"},null,8,Ft),[[de,o.y,void 0,{number:!0}]]),t("button",{class:"coord-remove",onClick:_=>e(p),title:"åˆ é™¤"},[...l[13]||(l[13]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,It)]))),128))]),t("div",Tt,[t("button",{class:"btn outline small",onClick:ke}," + æ·»åŠ  "),t("button",{class:"btn primary small",onClick:g,disabled:I.value||d.value.length===0}," ä¿å­˜åæ ‡ ",8,Pt)])])):(C(),w("div",Nt,[t("div",{class:"upload-area compact",onClick:se},[t("input",{ref_key:"coordInput",ref:h,type:"file",accept:".csv,.json,.txt",onChange:ge,style:{display:"none"}},null,544),l[14]||(l[14]=K('<div class="upload-icon" data-v-b74f63cc><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-b74f63cc><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" data-v-b74f63cc></path><circle cx="12" cy="10" r="3" data-v-b74f63cc></circle></svg></div><p class="upload-text" data-v-b74f63cc>ä¸Šä¼ åæ ‡æ–‡ä»¶</p><p class="upload-hint" data-v-b74f63cc>æ”¯æŒ CSV/JSON/TXT æ ¼å¼</p>',3))]),l[15]||(l[15]=t("div",{class:"coord-format-hint"},[t("strong",null,"CSV æ ¼å¼ç¤ºä¾‹ï¼š"),t("br"),t("code",null,"name,x,y"),t("br"),t("code",null,"ZK01,100,200")],-1))])),d.value.length>0?(C(),w("div",Lt,[t("div",Vt,[l[16]||(l[16]=le(" å·²è®¾ç½® ",-1)),t("strong",null,b(d.value.length),1),l[17]||(l[17]=le(" ä¸ªé’»å­”åæ ‡ ",-1))]),t("div",Rt," èŒƒå›´: X "+b((v=S.value)==null?void 0:v.toFixed(0))+"~"+b((s=x.value)==null?void 0:s.toFixed(0))+"m, Y "+b((r=M.value)==null?void 0:r.toFixed(0))+"~"+b((k=W.value)==null?void 0:k.toFixed(0))+"m ",1)])):j("",!0)])]),d.value.length>0?(C(),w("div",Dt,[t("div",Ht,[t("div",null,[l[19]||(l[19]=K('<h3 class="section-title" data-v-b74f63cc><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b74f63cc><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" data-v-b74f63cc></polygon><line x1="8" y1="2" x2="8" y2="18" data-v-b74f63cc></line><line x1="16" y1="6" x2="16" y2="22" data-v-b74f63cc></line></svg> é’»å­”ä½ç½®é¢„è§ˆ </h3>',1)),t("p",zt,b(d.value.length)+" ä¸ªé’»å­” Â· å¯æ‹–æ‹½å¹³ç§» Â· æ»šè½®ç¼©æ”¾ Â· ç‚¹å‡»é€‰æ‹©",1)]),t("div",{class:"preview-actions"},[t("button",{class:"icon-btn",onClick:m,title:"å¯¼å‡ºåæ ‡"},[...l[20]||(l[20]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t("polyline",{points:"7 10 12 15 17 10"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])]),t("button",{class:"icon-btn danger",onClick:B,title:"æ¸…ç©ºåæ ‡"},[...l[21]||(l[21]=[K('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b74f63cc><polyline points="3 6 5 6 21 6" data-v-b74f63cc></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-b74f63cc></path><line x1="10" y1="11" x2="10" y2="17" data-v-b74f63cc></line><line x1="14" y1="11" x2="14" y2="17" data-v-b74f63cc></line></svg>',1)])])])]),t("div",Ot,[t("div",Wt,[Xe(at,{boreholes:d.value,size:320,onSelect:L},null,8,["boreholes"])]),t("div",At,[t("div",Ut,[t("h4",null,"åæ ‡åˆ—è¡¨ ("+b(G.value.length)+")",1),re(t("input",{"onUpdate:modelValue":l[4]||(l[4]=o=>O.value=o),placeholder:"æœç´¢...",class:"search-input"},null,512),[[de,O.value]])]),t("div",jt,[G.value.length>100?(C(),w(ae,{key:0},[l[22]||(l[22]=K('<div class="virtual-table-header" data-v-b74f63cc><div class="virtual-row virtual-header" data-v-b74f63cc><div class="virtual-cell" style="width:50px;" data-v-b74f63cc>åºå·</div><div class="virtual-cell" data-v-b74f63cc>åç§°</div><div class="virtual-cell" style="width:80px;" data-v-b74f63cc>X (m)</div><div class="virtual-cell" style="width:80px;" data-v-b74f63cc>Y (m)</div><div class="virtual-cell" style="width:120px;" data-v-b74f63cc>æ“ä½œ</div></div></div>',1)),Xe(ot,{items:G.value,"item-height":44,height:320,buffer:5,"key-field":"name","item-class":"virtual-row"},{default:Ve(({item:o,index:p})=>{var _,A;return[t("div",{class:E({selected:P.value===o}),onClick:q=>P.value=o,style:{display:"flex",width:"100%",height:"100%","align-items":"center"}},[t("div",Et,b(p+1),1),t("div",Gt,b(o.name||`BH-${p+1}`),1),t("div",Jt,b(((_=o.x)==null?void 0:_.toFixed(1))||"-"),1),t("div",Kt,b(((A=o.y)==null?void 0:A.toFixed(1))||"-"),1),t("div",Qt,[t("button",{class:"table-btn",onClick:U(q=>u(o),["stop"])},"ç¼–è¾‘",8,Zt),t("button",{class:"table-btn danger",onClick:U(q=>Y(o),["stop"])},"åˆ é™¤",8,el)])],10,qt)]}),_:1},8,["items"])],64)):(C(),w("table",tl,[l[23]||(l[23]=t("thead",null,[t("tr",null,[t("th",null,"åºå·"),t("th",null,"åç§°"),t("th",null,"X (m)"),t("th",null,"Y (m)"),t("th",null,"æ“ä½œ")])],-1)),t("tbody",null,[(C(!0),w(ae,null,fe(G.value,(o,p)=>{var _,A;return C(),w("tr",{key:p,class:E({selected:P.value===o}),onClick:q=>P.value=o},[t("td",null,b(p+1),1),t("td",null,b(o.name||`BH-${p+1}`),1),t("td",null,b(((_=o.x)==null?void 0:_.toFixed(1))||"-"),1),t("td",null,b(((A=o.y)==null?void 0:A.toFixed(1))||"-"),1),t("td",null,[t("button",{class:"table-btn",onClick:U(q=>u(o),["stop"])},"ç¼–è¾‘",8,al),t("button",{class:"table-btn danger",onClick:U(q=>Y(o),["stop"])},"åˆ é™¤",8,sl)])],10,ll)}),128))])])),G.value.length===0?(C(),w("div",ol," æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é’»å­” ")):j("",!0)])])])])):(C(),w("div",nl,[...l[24]||(l[24]=[K('<div class="empty-state" data-v-b74f63cc><div class="empty-icon" data-v-b74f63cc><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-b74f63cc><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" data-v-b74f63cc></polygon><line x1="8" y1="2" x2="8" y2="18" data-v-b74f63cc></line><line x1="16" y1="6" x2="16" y2="22" data-v-b74f63cc></line></svg></div><p data-v-b74f63cc>æš‚æ— é’»å­”ä½ç½®æ•°æ®</p><p class="empty-hint" data-v-b74f63cc>è¯·å…ˆä¸Šä¼ æ•°æ®æ–‡ä»¶æˆ–æ‰‹åŠ¨è¾“å…¥åæ ‡</p></div>',1)])]))])}}},pl=Ce(il,[["__scopeId","data-v-b74f63cc"]]);export{pl as default};
