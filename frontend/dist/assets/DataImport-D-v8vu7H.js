var se=Math.pow;var re=(O,T,v)=>new Promise((z,d)=>{var L=X=>{try{P(v.next(X))}catch(x){d(x)}},_=X=>{try{P(v.throw(X))}catch(x){d(x)}},P=X=>X.done?z(X.value):Promise.resolve(X.value).then(L,_);P((v=v.apply(O,T)).next())});import{e as Ye,s as $e,v as be,o as g,b,a as l,n as G,x as E,y as j,z as ue,A as ae,t as m,d as S,k as D,F as oe,r as ve,B as Fe,g as Q,i as _e,C as ce,D as de,w as Te}from"./vue-vendor-uHJg9g_5.js";import{_ as ke,u as Ie}from"./index-BQuJNExo.js";import{u as Ne,s as Se,p as Le}from"./api-BlLoGSss.js";import"./index-T6nY3V_4.js";const Ve={class:"borehole-map-container"},Pe={class:"map-controls"},Re=["width","height"],ze={key:0,class:"map-empty"},He={class:"tooltip-header"},De={class:"tooltip-row"},Oe={class:"tooltip-value"},We={class:"tooltip-row"},Ae={class:"tooltip-value"},Ue={key:1,class:"selection-info"},je={class:"selection-coords"},Ee={key:2,class:"map-stats"},Ge={class:"stat-item"},qe={key:0,class:"stat-item"},te=40,Je={__name:"BoreholeMap",props:{boreholes:{type:Array,default:()=>[]},size:{type:Number,default:350}},emits:["select"],setup(O,{emit:T}){const v=O,z=T,d=S(null),L=S(null),_=S(null),P=S({x:0,y:0}),X=S(!0),x=S(1),H=S(0),u=S(0),$=S(!1),q=S({x:0,y:0}),p=D(()=>v.size),M=D(()=>{if(v.boreholes.length===0)return null;let t=1/0,n=-1/0,i=1/0,C=-1/0;return v.boreholes.forEach(f=>{f.x<t&&(t=f.x),f.x>n&&(n=f.x),f.y<i&&(i=f.y),f.y>C&&(C=f.y)}),{minX:t,maxX:n,minY:i,maxY:C,rangeX:n-t,rangeY:C-i}}),V=D(()=>({left:P.value.x+12+"px",top:P.value.y+12+"px"})),F=t=>{if(t.length<3)return t;const n=[...t].sort((h,B)=>h.y-B.y||h.x-B.x),i=n[0],C=h=>Math.atan2(h.y-i.y,h.x-i.x),f=n.slice(1).sort((h,B)=>{const R=C(h),ee=C(B);if(R!==ee)return R-ee;const W=Math.hypot(h.x-i.x,h.y-i.y),s=Math.hypot(B.x-i.x,B.y-i.y);return W-s}),I=(h,B,R)=>(B.x-h.x)*(R.y-h.y)-(B.y-h.y)*(R.x-h.x),y=[i];for(const h of f){for(;y.length>1&&I(y[y.length-2],y[y.length-1],h)<=0;)y.pop();y.push(h)}return y},Z=(t,n)=>{const i=M.value;if(!i)return{x:0,y:0};const C=p.value/2,f=p.value/2,y=Math.min((p.value-te*2)/(i.rangeX||1),(p.value-te*2)/(i.rangeY||1))*x.value,h=(i.minX+i.maxX)/2,B=(i.minY+i.maxY)/2;return{x:C+(t-h)*y+H.value,y:f+(B-n)*y+u.value}},A=()=>{if(!d.value)return;const t=d.value.getContext("2d"),{width:n,height:i}=d.value;t.clearRect(0,0,n,i);const C=t.createLinearGradient(0,0,n,i);if(C.addColorStop(0,"#f8fafc"),C.addColorStop(1,"#f1f5f9"),t.fillStyle=C,t.fillRect(0,0,n,i),v.boreholes.length===0)return;const f=M.value,I=50*x.value,y=Math.min(.3,I/100);t.strokeStyle=`rgba(148, 163, 184, ${y})`,t.lineWidth=1;const h=ne(0,0),B=ne(n,i),R=Math.floor(h.x/50)*50,ee=Math.floor(B.y/50)*50;for(let e=R;e<=B.x;e+=50){const a=Z(e,0);t.beginPath(),t.moveTo(a.x,0),t.lineTo(a.x,i),t.stroke()}for(let e=ee;e<=h.y;e+=50){const a=Z(0,e);t.beginPath(),t.moveTo(0,a.y),t.lineTo(n,a.y),t.stroke()}t.strokeStyle="#cbd5e1",t.lineWidth=1.5;const W=Z(0,0);if(W.y>=0&&W.y<=i&&(t.beginPath(),t.moveTo(0,W.y),t.lineTo(n,W.y),t.stroke()),W.x>=0&&W.x<=n&&(t.beginPath(),t.moveTo(W.x,0),t.lineTo(W.x,i),t.stroke()),d.value.scaledBoreholes=v.boreholes.map((e,a)=>{const r=Z(e.x,e.y);return{index:a,name:e.name,x:e.x,y:e.y,canvasX:r.x,canvasY:r.y}}),X.value&&d.value.scaledBoreholes.length>=3){const e=F(d.value.scaledBoreholes);t.beginPath(),e.forEach((c,k)=>{k===0?t.moveTo(c.canvasX,c.canvasY):t.lineTo(c.canvasX,c.canvasY)}),t.closePath();const a=e.reduce((c,k)=>({minX:Math.min(c.minX,k.canvasX),maxX:Math.max(c.maxX,k.canvasX),minY:Math.min(c.minY,k.canvasY),maxY:Math.max(c.maxY,k.canvasY)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),r=t.createRadialGradient((a.minX+a.maxX)/2,(a.minY+a.maxY)/2,0,(a.minX+a.maxX)/2,(a.minY+a.maxY)/2,Math.max(a.maxX-a.minX,a.maxY-a.minY)/2);r.addColorStop(0,"rgba(59, 130, 246, 0.15)"),r.addColorStop(1,"rgba(59, 130, 246, 0.05)"),t.fillStyle=r,t.fill(),t.strokeStyle="rgba(59, 130, 246, 0.5)",t.lineWidth=2,t.setLineDash([8,4]),t.stroke(),t.setLineDash([]),e.forEach((c,k)=>{t.beginPath(),t.arc(c.canvasX,c.canvasY,5,0,Math.PI*2),t.fillStyle="rgba(59, 130, 246, 0.3)",t.fill(),t.strokeStyle="rgba(59, 130, 246, 0.6)",t.lineWidth=1.5,t.stroke()})}t.strokeStyle="rgba(99, 102, 241, 0.2)",t.lineWidth=1.5,t.setLineDash([4,4]),t.beginPath(),d.value.scaledBoreholes.forEach((e,a)=>{a===0?t.moveTo(e.canvasX,e.canvasY):t.lineTo(e.canvasX,e.canvasY)}),t.stroke(),t.setLineDash([]),d.value.scaledBoreholes.forEach((e,a)=>{var Ce;const r=_.value===a,c=((Ce=L.value)==null?void 0:Ce.index)===a;if(r||c){const we=r?20:16,K=t.createRadialGradient(e.canvasX,e.canvasY,0,e.canvasX,e.canvasY,we);r?(K.addColorStop(0,"rgba(245, 158, 11, 0.4)"),K.addColorStop(.5,"rgba(245, 158, 11, 0.15)"),K.addColorStop(1,"rgba(245, 158, 11, 0)")):(K.addColorStop(0,"rgba(59, 130, 246, 0.3)"),K.addColorStop(.5,"rgba(59, 130, 246, 0.1)"),K.addColorStop(1,"rgba(59, 130, 246, 0)")),t.beginPath(),t.arc(e.canvasX,e.canvasY,we,0,Math.PI*2),t.fillStyle=K,t.fill()}const k=r?8:6;t.beginPath(),t.arc(e.canvasX,e.canvasY,k,0,Math.PI*2);const N=t.createRadialGradient(e.canvasX-k*.3,e.canvasY-k*.3,0,e.canvasX,e.canvasY,k);r?(N.addColorStop(0,"#fcd34d"),N.addColorStop(.5,"#f59e0b"),N.addColorStop(1,"#d97706")):(N.addColorStop(0,"#93c5fd"),N.addColorStop(.5,"#3b82f6"),N.addColorStop(1,"#2563eb")),t.fillStyle=N,t.fill(),t.strokeStyle=r?"#b45309":"#1d4ed8",t.lineWidth=r?2.5:2,t.stroke(),t.shadowColor=r?"rgba(245, 158, 11, 0.4)":"rgba(59, 130, 246, 0.3)",t.shadowBlur=6,t.shadowOffsetX=0,t.shadowOffsetY=2,t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;const o=e.name||`#${a+1}`,w=e.canvasY-k-6;t.font=r?"bold 11px sans-serif":"10px sans-serif";const Y=t.measureText(o),U=4,J=e.canvasX-Y.width/2-U,Xe=w-10,Be=Y.width+U*2,Me=14;r?t.fillStyle="rgba(245, 158, 11, 0.9)":t.fillStyle="rgba(255, 255, 255, 0.85)",t.beginPath(),t.roundRect(J,Xe,Be,Me,4),t.fill(),t.fillStyle=r?"#fff":"#1e40af",t.textAlign="center",t.textBaseline="middle",t.fillText(o,e.canvasX,w-3)});const s=60*x.value;if(s>30&&s<180){const e=i-18,a=16;t.fillStyle="rgba(255, 255, 255, 0.9)",t.beginPath(),t.roundRect(a-4,e-10,s+8,20,4),t.fill(),t.strokeStyle="#475569",t.lineWidth=2,t.beginPath(),t.moveTo(a,e),t.lineTo(a+s,e),t.stroke(),t.beginPath(),t.moveTo(a,e-5),t.lineTo(a,e+5),t.stroke(),t.beginPath(),t.moveTo(a+s,e-5),t.lineTo(a+s,e+5),t.stroke();const r=Math.min((p.value-te*2)/(f.rangeX||1),(p.value-te*2)/(f.rangeY||1)),c=Math.round(60/x.value/r);t.fillStyle="#475569",t.font="10px sans-serif",t.textAlign="center",t.fillText(`${c}m`,a+s/2,e-10)}},ne=(t,n)=>{const i=M.value;if(!i)return{x:0,y:0};const C=p.value/2,f=p.value/2,y=Math.min((p.value-te*2)/(i.rangeX||1),(p.value-te*2)/(i.rangeY||1))*x.value,h=(i.minX+i.maxX)/2,B=(i.minY+i.maxY)/2;return{x:h+(t-C-H.value)/y,y:B-(n-f-u.value)/y}},pe=()=>{x.value=Math.min(x.value*1.3,5),A()},he=()=>{x.value=Math.max(x.value/1.3,.2),A()},ie=()=>{x.value=1,H.value=0,u.value=0,A()},fe=()=>{X.value=!X.value,A()},me=t=>{$.value=!0,q.value={x:t.clientX-H.value,y:t.clientY-u.value}},le=()=>{$.value=!1},ye=t=>{var I;if(!((I=d.value)!=null&&I.scaledBoreholes))return;const n=d.value.getBoundingClientRect(),i=t.clientX-n.left,C=t.clientY-n.top;if($.value){H.value=t.clientX-q.value.x,u.value=t.clientY-q.value.y,A();return}let f=null;for(const y of d.value.scaledBoreholes)if(Math.sqrt(se(i-y.canvasX,2)+se(C-y.canvasY,2))<12){f=y;break}L.value=f,P.value={x:t.clientX,y:t.clientY},d.value.style.cursor=f?"pointer":$.value?"grabbing":"grab"},xe=t=>{const n=t.deltaY>0?.9:1.1;x.value=Math.max(.2,Math.min(5,x.value*n)),A()},ge=t=>{var I;if(!((I=d.value)!=null&&I.scaledBoreholes))return;const n=d.value.getBoundingClientRect(),i=t.clientX-n.left,C=t.clientY-n.top;let f=null;for(const y of d.value.scaledBoreholes)if(Math.sqrt(se(i-y.canvasX,2)+se(C-y.canvasY,2))<12){f=y.index;break}f!==null?(_.value=f,z("select",f)):_.value=null,A()};return Ye(()=>{A(),d.value&&(d.value.style.cursor="grab")}),$e(()=>{}),be(()=>v.boreholes,()=>{ie()},{deep:!0}),be(X,A),(t,n)=>{var i,C,f,I,y,h,B;return g(),b("div",Ve,[l("div",Pe,[l("button",{class:"control-btn",onClick:pe,title:"æ”¾å¤§"},[...n[1]||(n[1]=[l("span",null,"+",-1)])]),l("button",{class:"control-btn",onClick:he,title:"ç¼©å°"},[...n[2]||(n[2]=[l("span",null,"âˆ’",-1)])]),l("button",{class:"control-btn",onClick:ie,title:"é‡ç½®"},[...n[3]||(n[3]=[l("span",null,"âŸ²",-1)])]),l("button",{class:G(["control-btn",{active:X.value}]),onClick:fe,title:"è¾¹ç•Œ"},[...n[4]||(n[4]=[l("span",null,"â¬¡",-1)])],2)]),l("div",{class:G(["map-wrapper",{dragging:$.value}])},[l("canvas",{ref_key:"canvas",ref:d,width:p.value,height:p.value,onMousedown:me,onMousemove:ye,onMouseup:le,onMouseleave:le,onWheel:E(xe,["prevent"]),onClick:ge},null,40,Re),O.boreholes.length===0?(g(),b("div",ze,[...n[5]||(n[5]=[l("div",{class:"empty-icon"},"ğŸ“",-1),l("p",null,"æš‚æ— é’»å­”æ•°æ®",-1)])])):j("",!0)],2),L.value?(g(),b("div",{key:0,class:"tooltip",style:ue(V.value)},[l("div",He,[n[6]||(n[6]=l("span",{class:"tooltip-icon"},"ğŸ“",-1)),ae(" "+m(L.value.name||`é’»å­” #${L.value.index+1}`),1)]),l("div",De,[n[7]||(n[7]=l("span",{class:"tooltip-label"},"X åæ ‡:",-1)),l("span",Oe,m(L.value.x.toFixed(2))+" m",1)]),l("div",We,[n[8]||(n[8]=l("span",{class:"tooltip-label"},"Y åæ ‡:",-1)),l("span",Ae,m(L.value.y.toFixed(2))+" m",1)])],4)):j("",!0),_.value!==null?(g(),b("div",Ue,[n[9]||(n[9]=l("span",{class:"selection-icon"},"ğŸ¯",-1)),l("strong",null,m(((i=O.boreholes[_.value])==null?void 0:i.name)||`é’»å­” #${_.value+1}`),1),l("span",je,"("+m((f=(C=O.boreholes[_.value])==null?void 0:C.x)==null?void 0:f.toFixed(1))+", "+m((y=(I=O.boreholes[_.value])==null?void 0:I.y)==null?void 0:y.toFixed(1))+")",1),l("button",{class:"clear-btn",onClick:n[0]||(n[0]=R=>_.value=null),title:"å–æ¶ˆé€‰æ‹©"},"Ã—")])):(g(),b("div",Ee,[l("span",Ge,"ğŸ“ "+m(O.boreholes.length)+" ä¸ªé’»å­”",1),M.value?(g(),b("span",qe," ğŸ“ "+m((h=M.value.rangeX)==null?void 0:h.toFixed(0))+"m Ã— "+m((B=M.value.rangeY)==null?void 0:B.toFixed(0))+"m ",1)):j("",!0)]))])}}},Ke=ke(Je,[["__scopeId","data-v-8b1ba160"]]),Qe={__name:"VirtualList",props:{items:{type:Array,required:!0},itemHeight:{type:Number,required:!0},height:{type:Number,required:!0},buffer:{type:Number,default:5},keyField:{type:String,default:"id"},itemClass:{type:String,default:""}},setup(O,{expose:T}){const v=O,z=S(null),d=S(0),L=D(()=>({height:`${v.height}px`,overflow:"auto",position:"relative"})),_=D(()=>v.items.length*v.itemHeight),P=D(()=>({height:`${_.value}px`,position:"relative"})),X=p=>({height:`${v.itemHeight}px`,position:"absolute",top:`${p*v.itemHeight}px`,left:0,right:0,boxSizing:"border-box"}),x=D(()=>{const p=Math.floor(d.value/v.itemHeight),M=Math.ceil(v.height/v.itemHeight),V=Math.max(0,p-v.buffer),F=Math.min(v.items.length,p+M+v.buffer);return{start:V,end:F}}),H=D(()=>{const{start:p,end:M}=x.value,V=[];for(let F=p;F<M;F++)F>=0&&F<v.items.length&&V.push({data:v.items[F],index:F});return V}),u=p=>{var M,V;return v.keyField&&p[v.keyField]!==void 0?p[v.keyField]:(V=(M=H.value.find(F=>F.data===p))==null?void 0:M.index)!=null?V:Math.random()};let $=null;const q=()=>{$||($=requestAnimationFrame(()=>{var p,M;d.value=(M=(p=z.value)==null?void 0:p.scrollTop)!=null?M:0,$=null}))};return T({scrollTo:p=>{z.value&&(z.value.scrollTop=p*v.itemHeight)},scrollToTop:()=>{z.value&&(z.value.scrollTop=0)}}),(p,M)=>(g(),b("div",{ref_key:"containerRef",ref:z,class:"virtual-list-container",style:ue(L.value),onScroll:q},[l("div",{class:"virtual-list-spacer",style:ue(P.value)},[(g(!0),b(oe,null,ve(H.value,V=>(g(),b("div",{key:u(V.data),class:G(O.itemClass),style:ue(X(V.index))},[Fe(p.$slots,"default",{item:V.data,index:V.index},void 0)],6))),128))],4)],36))}},Ze=ke(Qe,[["__scopeId","data-v-225c5e01"]]),et={class:"page"},tt={class:"grid grid-2"},lt={class:"card upload-card"},st={key:0,class:"file-list"},at={class:"file-list-header"},ot={class:"file-items"},nt={class:"file-name"},it={class:"file-size"},rt=["onClick"],ct={class:"action-buttons"},dt=["disabled"],ut={key:0,class:"spinner sm"},vt=["disabled"],pt={key:1,class:"result-box success"},ht={class:"result-content"},ft={class:"result-desc"},mt={key:2,class:"extracted-coords"},yt={class:"subsection-desc"},xt={class:"card upload-card"},gt={class:"tab-buttons"},bt={key:0,class:"coord-input"},kt={class:"coord-list"},Ct={class:"coord-num"},wt=["onUpdate:modelValue"],_t=["onUpdate:modelValue"],St=["onUpdate:modelValue"],Yt=["onClick"],Xt={class:"coord-actions"},Bt=["disabled"],Mt={key:1,class:"coord-file"},$t={key:2,class:"coord-stats"},Ft={class:"stat-badge"},Tt={class:"stat-range"},It={key:0,class:"card preview-card"},Nt={class:"preview-header"},Lt={class:"section-desc"},Vt={class:"preview-grid"},Pt={class:"map-section"},Rt={class:"table-section"},zt={class:"table-header"},Ht={class:"table-wrapper"},Dt=["onClick"],Ot={class:"virtual-cell",style:{width:"50px"}},Wt={class:"virtual-cell"},At={class:"virtual-cell",style:{width:"80px"}},Ut={class:"virtual-cell",style:{width:"80px"}},jt={class:"virtual-cell",style:{width:"120px"}},Et=["onClick"],Gt=["onClick"],qt={key:1,class:"table compact"},Jt=["onClick"],Kt=["onClick"],Qt=["onClick"],Zt={key:2,class:"table-empty"},el={key:1,class:"card"},tl={__name:"DataImport",setup(O){const T=Ie(),v=S(null),z=S(null),d=S([]),L=S(!1),_=S(!1),P=S(null),X=S("manual"),x=S(null),H=S(""),u=S([]),$=S([]),q=D(()=>u.value.length?Math.min(...u.value.map(s=>s.x)):null),p=D(()=>u.value.length?Math.max(...u.value.map(s=>s.x)):null),M=D(()=>u.value.length?Math.min(...u.value.map(s=>s.y)):null),V=D(()=>u.value.length?Math.max(...u.value.map(s=>s.y)):null),F=D(()=>{if(!H.value)return u.value;const s=H.value.toLowerCase();return u.value.filter(e=>{var a,r;return e.name&&e.name.toLowerCase().includes(s)||((a=e.x)==null?void 0:a.toString().includes(s))||((r=e.y)==null?void 0:r.toString().includes(s))})});be(x,s=>{});const Z=()=>{try{const s=localStorage.getItem("borehole_coordinates");s&&(u.value=JSON.parse(s))}catch(s){console.error("Failed to load coordinates:",s)}},A=()=>{var s;(s=v.value)==null||s.click()},ne=()=>{var s;(s=z.value)==null||s.click()},pe=s=>{const e=Array.from(s.target.files||[]).filter(a=>a.name.endsWith(".csv"));d.value=[...d.value,...e]},he=s=>{L.value=!1;const e=Array.from(s.dataTransfer.files||[]).filter(a=>a.name.endsWith(".csv"));d.value=[...d.value,...e]},ie=s=>{d.value.splice(s,1)},fe=()=>{d.value=[]},me=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB",le=()=>re(this,null,function*(){$.value=[];const s=[];for(const e of d.value)try{const{data:a}=yield Le(e.name,100);if(a.data&&a.data.length>0){const r=Object.keys(a.data[0]).map(o=>o.toLowerCase()),c=Object.keys(a.data[0]).find(o=>o.toLowerCase().includes("x")||o==="åæ ‡x"||o==="xåæ ‡"),k=Object.keys(a.data[0]).find(o=>o.toLowerCase().includes("y")||o==="åæ ‡y"||o==="yåæ ‡"),N=Object.keys(a.data[0]).find(o=>o.toLowerCase().includes("name")||o.toLowerCase().includes("é’»å­”")||o==="é’»å­”å·"||o==="å­”å·");if(c&&k){const o=a.data[0],w=parseFloat(o[c]),Y=parseFloat(o[k]);!isNaN(w)&&!isNaN(Y)&&s.push({name:N?o[N]:e.name.replace(".csv",""),x:w,y:Y,file:e.name})}}}catch(a){console.log("æ— æ³•ä»",e.name,"æå–åæ ‡:",a.message)}$.value=s}),ye=()=>re(this,null,function*(){var s,e;_.value=!0;try{yield Ne(d.value);const{data:a}=yield Se();P.value=a,T.add(`å·²ä¸Šä¼  ${d.value.length} ä¸ªæ–‡ä»¶`,"success"),yield le()}catch(a){T.add(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.detail)||"ä¸Šä¼ å¤±è´¥","error")}finally{_.value=!1}}),xe=()=>re(this,null,function*(){var s,e;_.value=!0;try{const{data:a}=yield Se();P.value=a,T.add("æ‰«æå®Œæˆ","success"),yield le()}catch(a){T.add(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.detail)||"æ‰«æå¤±è´¥","error")}finally{_.value=!1}}),ge=()=>{$.value.length>0&&(u.value=[...$.value],R(),T.add(`å·²å¯¼å…¥ ${$.value.length} ä¸ªé’»å­”åæ ‡`,"success"),$.value=[])},t=s=>{var r;const e=(r=s.target.files)==null?void 0:r[0];if(!e)return;const a=new FileReader;a.onload=c=>{const k=c.target.result;n(k,e.name)},a.readAsText(e)},n=(s,e)=>{var a;try{let r=[];if(e.endsWith(".json"))r=JSON.parse(s);else{const c=s.split(`
`),k=c[0].toLowerCase().includes("name")||c[0].toLowerCase().includes("åç§°")?1:0;for(let N=k;N<c.length;N++){const o=c[N].trim();if(!o)continue;const w=o.split(/[,\t\s]+/);if(w.length>=3){const Y=parseFloat(w[1]),U=parseFloat(w[2]);!isNaN(Y)&&!isNaN(U)&&r.push({name:(a=w[0])==null?void 0:a.trim(),x:Y,y:U})}}}r=r.filter(c=>!isNaN(c.x)&&!isNaN(c.y)),r.length>0?(u.value=r,R(),T.add(`å·²å¯¼å…¥ ${r.length} ä¸ªé’»å­”åæ ‡`,"success")):T.add("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®","error")}catch(r){T.add("æ–‡ä»¶è§£æå¤±è´¥","error")}},i=()=>{u.value.push({name:`BH-${u.value.length+1}`,x:0,y:0})},C=s=>{const e=u.value[s];u.value.splice(s,1),R(),(x.value===s||x.value===e)&&(x.value=null)},f=s=>{const e=u.value[s],a=prompt("é’»å­”åç§°:",e.name||""),r=prompt("X åæ ‡:",e.x),c=prompt("Y åæ ‡:",e.y);a!==null&&(e.name=a),r!==null&&!isNaN(parseFloat(r))&&(e.x=parseFloat(r)),c!==null&&!isNaN(parseFloat(c))&&(e.y=parseFloat(c)),R()},I=s=>typeof s=="number"?s:u.value.indexOf(s),y=s=>{const e=I(s);e!==-1&&C(e)},h=s=>{const e=I(s);e!==-1&&f(e)},B=s=>{x.value=s},R=()=>{localStorage.setItem("borehole_coordinates",JSON.stringify(u.value)),T.add("åæ ‡å·²ä¿å­˜","success")},ee=()=>{const e=`name,x,y
`+u.value.map(k=>`${k.name||""},${k.x},${k.y}`).join(`
`),a=new Blob([e],{type:"text/csv"}),r=URL.createObjectURL(a),c=document.createElement("a");c.href=r,c.download="borehole_coordinates.csv",c.click(),URL.revokeObjectURL(r),T.add("åæ ‡å·²å¯¼å‡º","success")},W=()=>{confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰åæ ‡å—ï¼Ÿ")&&(u.value=[],x.value=null,localStorage.removeItem("borehole_coordinates"),T.add("åæ ‡å·²æ¸…ç©º","success"))};return Ye(()=>{Z()}),(s,e)=>{var a,r,c,k,N;return g(),b("div",et,[l("div",tt,[l("div",lt,[e[11]||(e[11]=l("h3",{class:"section-title"},[l("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})]),ae(" ä¸Šä¼ é’»å­”æ•°æ®æ–‡ä»¶ ")],-1)),e[12]||(e[12]=l("p",{class:"section-desc"},"ä¸Šä¼ åŒ…å«å²©æ€§å‚æ•°ï¼ˆå¼¹æ€§æ¨¡é‡ã€å®¹é‡ã€æŠ—æ‹‰å¼ºåº¦ã€åšåº¦ï¼‰çš„ CSV æ–‡ä»¶",-1)),l("div",{class:G(["upload-area",{"drag-over":L.value}]),onDrop:E(he,["prevent"]),onDragover:e[0]||(e[0]=E(o=>L.value=!0,["prevent"])),onDragleave:e[1]||(e[1]=E(o=>L.value=!1,["prevent"])),onClick:A},[l("input",{ref_key:"fileInput",ref:v,type:"file",multiple:"",accept:".csv",onChange:pe,style:{display:"none"}},null,544),e[5]||(e[5]=Q('<div class="upload-icon" data-v-68c61656><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-68c61656><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-68c61656></path><polyline points="14 2 14 8 20 8" data-v-68c61656></polyline><line x1="12" y1="18" x2="12" y2="12" data-v-68c61656></line><line x1="9" y1="15" x2="15" y2="15" data-v-68c61656></line></svg></div><p class="upload-text" data-v-68c61656>ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p><p class="upload-hint" data-v-68c61656>æ”¯æŒ .csv æ ¼å¼ï¼Œå¯å¤šé€‰</p>',3))],34),d.value.length>0?(g(),b("div",st,[l("div",at,[l("span",null,"å·²é€‰æ‹© "+m(d.value.length)+" ä¸ªæ–‡ä»¶",1),l("button",{class:"text-btn",onClick:fe},"æ¸…ç©º")]),l("div",ot,[(g(!0),b(oe,null,ve(d.value,(o,w)=>(g(),b("div",{key:w,class:"file-item"},[e[7]||(e[7]=l("svg",{class:"file-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),l("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),l("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1)),l("span",nt,m(o.name),1),l("span",it,m(me(o.size)),1),l("button",{class:"file-remove",onClick:Y=>ie(w)},[...e[6]||(e[6]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,rt)]))),128))])])):j("",!0),l("div",ct,[l("button",{class:"btn primary",onClick:ye,disabled:_.value||d.value.length===0},[_.value?(g(),b("span",ut)):j("",!0),ae(" "+m(_.value?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ æ•°æ®"),1)],8,dt),l("button",{class:"btn secondary",onClick:xe,disabled:_.value}," æ‰«ææ–‡ä»¶ ",8,vt)]),P.value?(g(),b("div",pt,[e[9]||(e[9]=l("div",{class:"result-icon"},[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5"},[l("polyline",{points:"20 6 9 17 4 12"})])],-1)),l("div",ht,[e[8]||(e[8]=l("div",{class:"result-title"},"æ‰«æå®Œæˆ",-1)),l("div",ft,"æ£€æµ‹åˆ° "+m(((a=P.value.files)==null?void 0:a.length)||0)+" ä¸ª CSV æ–‡ä»¶",1)])])):j("",!0),$.value.length>0?(g(),b("div",mt,[e[10]||(e[10]=l("h4",{class:"subsection-title"},"ä»æ–‡ä»¶ä¸­æå–çš„åæ ‡",-1)),l("p",yt,"å‘ç° "+m($.value.length)+" ä¸ªé’»å­”åŒ…å«åæ ‡ä¿¡æ¯",1),l("button",{class:"btn outline small",onClick:ge}," ä½¿ç”¨è¿™äº›åæ ‡ ")])):j("",!0)]),l("div",xt,[e[18]||(e[18]=Q('<h3 class="section-title" data-v-68c61656><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-68c61656><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" data-v-68c61656></path><circle cx="12" cy="10" r="3" data-v-68c61656></circle></svg> é’»å­”åæ ‡ </h3><p class="section-desc" data-v-68c61656>è®¾ç½®é’»å­”çš„å¹³é¢ä½ç½®åæ ‡ï¼ˆX, Yï¼‰</p>',2)),l("div",gt,[l("button",{class:G(["tab-btn",{active:X.value==="manual"}]),onClick:e[2]||(e[2]=o=>X.value="manual")}," æ‰‹åŠ¨è¾“å…¥ ",2),l("button",{class:G(["tab-btn",{active:X.value==="file"}]),onClick:e[3]||(e[3]=o=>X.value="file")}," æ–‡ä»¶ä¸Šä¼  ",2)]),X.value==="manual"?(g(),b("div",bt,[l("div",kt,[(g(!0),b(oe,null,ve(u.value,(o,w)=>(g(),b("div",{key:w,class:"coord-item"},[l("span",Ct,"#"+m(w+1),1),ce(l("input",{type:"text","onUpdate:modelValue":Y=>o.name=Y,placeholder:"åç§°",class:"coord-name-input"},null,8,wt),[[de,o.name]]),ce(l("input",{type:"number","onUpdate:modelValue":Y=>o.x=Y,placeholder:"X (m)",class:"coord-value-input"},null,8,_t),[[de,o.x,void 0,{number:!0}]]),ce(l("input",{type:"number","onUpdate:modelValue":Y=>o.y=Y,placeholder:"Y (m)",class:"coord-value-input"},null,8,St),[[de,o.y,void 0,{number:!0}]]),l("button",{class:"coord-remove",onClick:Y=>C(w),title:"åˆ é™¤"},[...e[13]||(e[13]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,Yt)]))),128))]),l("div",Xt,[l("button",{class:"btn outline small",onClick:i}," + æ·»åŠ  "),l("button",{class:"btn primary small",onClick:R,disabled:_.value||u.value.length===0}," ä¿å­˜åæ ‡ ",8,Bt)])])):(g(),b("div",Mt,[l("div",{class:"upload-area compact",onClick:ne},[l("input",{ref_key:"coordInput",ref:z,type:"file",accept:".csv,.json,.txt",onChange:t,style:{display:"none"}},null,544),e[14]||(e[14]=Q('<div class="upload-icon" data-v-68c61656><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-68c61656><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" data-v-68c61656></path><circle cx="12" cy="10" r="3" data-v-68c61656></circle></svg></div><p class="upload-text" data-v-68c61656>ä¸Šä¼ åæ ‡æ–‡ä»¶</p><p class="upload-hint" data-v-68c61656>æ”¯æŒ CSV/JSON/TXT æ ¼å¼</p>',3))]),e[15]||(e[15]=l("div",{class:"coord-format-hint"},[l("strong",null,"CSV æ ¼å¼ç¤ºä¾‹ï¼š"),l("br"),l("code",null,"name,x,y"),l("br"),l("code",null,"ZK01,100,200")],-1))])),u.value.length>0?(g(),b("div",$t,[l("div",Ft,[e[16]||(e[16]=ae(" å·²è®¾ç½® ",-1)),l("strong",null,m(u.value.length),1),e[17]||(e[17]=ae(" ä¸ªé’»å­”åæ ‡ ",-1))]),l("div",Tt," èŒƒå›´: X "+m((r=q.value)==null?void 0:r.toFixed(0))+"~"+m((c=p.value)==null?void 0:c.toFixed(0))+"m, Y "+m((k=M.value)==null?void 0:k.toFixed(0))+"~"+m((N=V.value)==null?void 0:N.toFixed(0))+"m ",1)])):j("",!0)])]),u.value.length>0?(g(),b("div",It,[l("div",Nt,[l("div",null,[e[19]||(e[19]=Q('<h3 class="section-title" data-v-68c61656><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-68c61656><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" data-v-68c61656></polygon><line x1="8" y1="2" x2="8" y2="18" data-v-68c61656></line><line x1="16" y1="6" x2="16" y2="22" data-v-68c61656></line></svg> é’»å­”ä½ç½®é¢„è§ˆ </h3>',1)),l("p",Lt,m(u.value.length)+" ä¸ªé’»å­” Â· å¯æ‹–æ‹½å¹³ç§» Â· æ»šè½®ç¼©æ”¾ Â· ç‚¹å‡»é€‰æ‹©",1)]),l("div",{class:"preview-actions"},[l("button",{class:"icon-btn",onClick:ee,title:"å¯¼å‡ºåæ ‡"},[...e[20]||(e[20]=[l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),l("polyline",{points:"7 10 12 15 17 10"}),l("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])]),l("button",{class:"icon-btn danger",onClick:W,title:"æ¸…ç©ºåæ ‡"},[...e[21]||(e[21]=[Q('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-68c61656><polyline points="3 6 5 6 21 6" data-v-68c61656></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-68c61656></path><line x1="10" y1="11" x2="10" y2="17" data-v-68c61656></line><line x1="14" y1="11" x2="14" y2="17" data-v-68c61656></line></svg>',1)])])])]),l("div",Vt,[l("div",Pt,[_e(Ke,{boreholes:u.value,size:320,onSelect:B},null,8,["boreholes"])]),l("div",Rt,[l("div",zt,[l("h4",null,"åæ ‡åˆ—è¡¨ ("+m(F.value.length)+")",1),ce(l("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>H.value=o),placeholder:"æœç´¢...",class:"search-input"},null,512),[[de,H.value]])]),l("div",Ht,[F.value.length>100?(g(),b(oe,{key:0},[e[22]||(e[22]=Q('<div class="virtual-table-header" data-v-68c61656><div class="virtual-row virtual-header" data-v-68c61656><div class="virtual-cell" style="width:50px;" data-v-68c61656>åºå·</div><div class="virtual-cell" data-v-68c61656>åç§°</div><div class="virtual-cell" style="width:80px;" data-v-68c61656>X (m)</div><div class="virtual-cell" style="width:80px;" data-v-68c61656>Y (m)</div><div class="virtual-cell" style="width:120px;" data-v-68c61656>æ“ä½œ</div></div></div>',1)),_e(Ze,{items:F.value,"item-height":44,height:320,buffer:5,"key-field":"name","item-class":"virtual-row"},{default:Te(({item:o,index:w})=>{var Y,U;return[l("div",{class:G({selected:x.value===o}),onClick:J=>x.value=o,style:{display:"flex",width:"100%",height:"100%","align-items":"center"}},[l("div",Ot,m(w+1),1),l("div",Wt,m(o.name||`BH-${w+1}`),1),l("div",At,m(((Y=o.x)==null?void 0:Y.toFixed(1))||"-"),1),l("div",Ut,m(((U=o.y)==null?void 0:U.toFixed(1))||"-"),1),l("div",jt,[l("button",{class:"table-btn",onClick:E(J=>h(o),["stop"])},"ç¼–è¾‘",8,Et),l("button",{class:"table-btn danger",onClick:E(J=>y(o),["stop"])},"åˆ é™¤",8,Gt)])],10,Dt)]}),_:1},8,["items"])],64)):(g(),b("table",qt,[e[23]||(e[23]=l("thead",null,[l("tr",null,[l("th",null,"åºå·"),l("th",null,"åç§°"),l("th",null,"X (m)"),l("th",null,"Y (m)"),l("th",null,"æ“ä½œ")])],-1)),l("tbody",null,[(g(!0),b(oe,null,ve(F.value,(o,w)=>{var Y,U;return g(),b("tr",{key:w,class:G({selected:x.value===o}),onClick:J=>x.value=o},[l("td",null,m(w+1),1),l("td",null,m(o.name||`BH-${w+1}`),1),l("td",null,m(((Y=o.x)==null?void 0:Y.toFixed(1))||"-"),1),l("td",null,m(((U=o.y)==null?void 0:U.toFixed(1))||"-"),1),l("td",null,[l("button",{class:"table-btn",onClick:E(J=>h(o),["stop"])},"ç¼–è¾‘",8,Kt),l("button",{class:"table-btn danger",onClick:E(J=>y(o),["stop"])},"åˆ é™¤",8,Qt)])],10,Jt)}),128))])])),F.value.length===0?(g(),b("div",Zt," æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é’»å­” ")):j("",!0)])])])])):(g(),b("div",el,[...e[24]||(e[24]=[Q('<div class="empty-state" data-v-68c61656><div class="empty-icon" data-v-68c61656><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-68c61656><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6" data-v-68c61656></polygon><line x1="8" y1="2" x2="8" y2="18" data-v-68c61656></line><line x1="16" y1="6" x2="16" y2="22" data-v-68c61656></line></svg></div><p data-v-68c61656>æš‚æ— é’»å­”ä½ç½®æ•°æ®</p><p class="empty-hint" data-v-68c61656>è¯·å…ˆä¸Šä¼ æ•°æ®æ–‡ä»¶æˆ–æ‰‹åŠ¨è¾“å…¥åæ ‡</p></div>',1)])]))])}}},il=ke(tl,[["__scopeId","data-v-68c61656"]]);export{il as default};
