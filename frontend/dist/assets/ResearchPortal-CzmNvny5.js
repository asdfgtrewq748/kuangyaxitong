var k=(P,C,b)=>new Promise((h,v)=>{var f=u=>{try{y(b.next(u))}catch(_){v(_)}},S=u=>{try{y(b.throw(u))}catch(_){v(_)}},y=u=>u.done?h(u.value):Promise.resolve(u.value).then(f,S);y((b=b.apply(P,C)).next())});import{bf as Q,b8 as o,b7 as t,bb as l,bq as Y,bo as g,br as Z,bv as J,bc as $,b9 as x,b as p,c as W,b5 as d,ba as V,bi as G,r as X}from"./vendor-CA5Q5CdR.js";import{a as I}from"./vue-router-D9BXaJFq.js";import{r as tt,o as et,q as st,t as at}from"./api-CfsGh-st.js";import{_ as lt,a as nt}from"./index-C6WNepMi.js";import"./network-T6nY3V_4.js";const ot={class:"research-portal page"},dt={class:"portal-hero card"},it={class:"hero-stats"},rt={class:"stat"},ut={class:"stat"},ct={class:"stat"},bt={class:"quick-grid"},_t={class:"card quick-card"},pt={class:"quick-actions"},vt={class:"card leaderboard-panel"},mt={class:"panel-head"},ht={class:"leaderboard-actions"},yt=["value"],gt=["disabled"],ft={key:0,class:"state"},kt={key:1,class:"state error"},$t={key:2,class:"state"},xt={key:3,class:"leaderboard-grid"},Ct={class:"result-card"},St={class:"table compact"},At=["onClick"],Rt={class:"result-card"},Nt={class:"table compact"},wt=["disabled","onClick"],Dt={class:"card paper-panel"},Lt={class:"panel-head"},Mt=["disabled"],Pt={key:0,class:"state"},Bt={key:1,class:"state error"},Et={key:2,class:"paper-list"},Ut={class:"paper-head"},Tt={class:"paper-meta"},qt={key:0},Ft={key:1},Ot={class:"paper-actions"},Vt=["disabled","onClick"],Gt={class:"asset-table-wrap"},jt={class:"table compact"},zt=["disabled","onClick"],Ht={__name:"ResearchPortal",setup(P){const C=I(),b=nt(),h=p([]),v=p(!1),f=p(""),S=p(""),y=X({}),u=p("auc"),_=p(!1),A=p(""),N=p([]),B=p([]),j=["auc","pr_auc","f1","brier","ece","mae","rmse","paired_significance_p"],z=W(()=>h.value.filter(a=>{var s;return(s=a==null?void 0:a.gate_summary)==null?void 0:s.overall_pass}).length),w=a=>{if(!a)return"-";const s=new Date(a);return Number.isNaN(s.getTime())?a:`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`},R=(a,s,e)=>{const n=`${a}:${s}`;y[n]=e},E=(a,s)=>!!y[`${a}:${s}`],U=a=>!!y[`bundle:${a}`],D=(a,s=4)=>{const e=Number(a);return Number.isFinite(e)?e.toFixed(s):"-"},T=(a,s)=>{if(!a)return s;const e=/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i.exec(a);return decodeURIComponent((e==null?void 0:e[1])||(e==null?void 0:e[2])||"")||s},q=(a,s)=>{const e=URL.createObjectURL(a),n=document.createElement("a");n.href=e,n.download=s,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(e)},L=a=>{C.push(a)},F=a=>{a&&C.push({path:"/research-workbench",query:{exp_id:a}})},O=()=>k(this,null,function*(){var a,s;v.value=!0,f.value="";try{const{data:e}=yield tt();h.value=(e==null?void 0:e.papers)||[],S.value=w(e==null?void 0:e.generated_at_utc)}catch(e){f.value=((s=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:s.detail)||(e==null?void 0:e.message)||"科研资产同步失败"}finally{v.value=!1}}),M=()=>k(this,null,function*(){var a,s;_.value=!0,A.value="";try{const{data:e}=yield et(u.value,12);N.value=(e==null?void 0:e.rows)||[],B.value=(e==null?void 0:e.model_summary)||[]}catch(e){A.value=((s=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:s.detail)||(e==null?void 0:e.message)||"实验榜单读取失败"}finally{_.value=!1}}),H=(a,s,e)=>k(this,null,function*(){var n,i,m;R(a,s,!0);try{const c=yield at(a,s),r=T((n=c==null?void 0:c.headers)==null?void 0:n["content-disposition"],e||`${a}_${s}`);q(c.data,r),b.success(`已下载 ${r}`)}catch(c){b.error(((m=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:m.detail)||"下载失败")}finally{R(a,s,!1)}}),K=a=>k(this,null,function*(){var s,e,n;R("bundle",a,!0);try{const i=yield st(a),m=T((s=i==null?void 0:i.headers)==null?void 0:s["content-disposition"],`${a}_research_bundle.zip`);q(i.data,m),b.success(`已下载 ${m}`)}catch(i){b.error(((n=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:n.detail)||"投稿包下载失败")}finally{R("bundle",a,!1)}});return Q(()=>{O(),M()}),(a,s)=>(d(),o("div",ot,[t("header",dt,[s[7]||(s[7]=t("div",{class:"hero-copy"},[t("p",{class:"kicker"},"RESEARCH FRONTEND"),t("h1",null,"MPI Research Portal"),t("p",null," 独立科研入口：论文草稿、门禁报告、可复现实验三条线并行。 这个页面只面向科研产出，不承载生产流程配置。 ")],-1)),t("div",it,[t("div",rt,[s[4]||(s[4]=t("span",null,"Paper Drafts",-1)),t("strong",null,l(h.value.length),1)]),t("div",ut,[s[5]||(s[5]=t("span",null,"Gate Pass",-1)),t("strong",null,l(z.value)+"/"+l(h.value.length||0),1)]),t("div",ct,[s[6]||(s[6]=t("span",null,"Last Sync",-1)),t("strong",null,l(S.value||"-"),1)])])]),t("section",bt,[t("article",_t,[s[8]||(s[8]=t("h2",null,"Quick Actions",-1)),t("div",pt,[t("button",{class:"btn",type:"button",onClick:s[0]||(s[0]=e=>L("/research-workbench"))},"科研工作台"),t("button",{class:"btn secondary",type:"button",onClick:s[1]||(s[1]=e=>L("/algorithm-validation"))},"算法实证"),t("button",{class:"btn secondary",type:"button",onClick:s[2]||(s[2]=e=>L("/academic-algorithm"))},"新算法原理")])]),s[9]||(s[9]=Y('<article class="card quick-card timeline" data-v-a776f142><h2 data-v-a776f142>12-Month Track</h2><ol data-v-a776f142><li data-v-a776f142><b data-v-a776f142>A1-A2:</b> 数据治理与评估协议固化</li><li data-v-a776f142><b data-v-a776f142>A3-A6:</b> RSI 相场主论文实证</li><li data-v-a776f142><b data-v-a776f142>A5-A9:</b> ASI-UST 强度论文实证</li><li data-v-a776f142><b data-v-a776f142>A8-A10:</b> 图表脚本与复现实验材料包</li><li data-v-a776f142><b data-v-a776f142>A10-A12:</b> 双稿错峰投稿与返修准备</li></ol></article>',1))]),t("section",vt,[t("div",mt,[s[10]||(s[10]=t("div",null,[t("h2",null,"Experiment Leaderboard"),t("p",null,[g("基于 "),t("code",null,"data/research/experiments/*/result.json"),g(" 自动统计。")])],-1)),t("div",ht,[Z(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>u.value=e),onChange:M},[(d(),o($,null,x(j,e=>t("option",{key:e,value:e},l(e),9,yt)),64))],544),[[J,u.value]]),t("button",{class:"btn secondary",type:"button",disabled:_.value,onClick:M},l(_.value?"刷新中...":"刷新榜单"),9,gt)])]),_.value?(d(),o("div",ft,"正在计算实验榜单...")):A.value?(d(),o("div",kt,l(A.value),1)):N.value.length?(d(),o("div",xt,[t("article",Ct,[t("h3",null,"Top Runs ("+l(u.value)+")",1),t("table",St,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"exp_id"),t("th",null,"model"),t("th",null,"value"),t("th",null,"action")])],-1)),t("tbody",null,[(d(!0),o($,null,x(N.value,(e,n)=>(d(),o("tr",{key:e.exp_id},[t("td",null,l(n+1),1),t("td",null,[t("code",null,l(e.exp_id),1)]),t("td",null,l(e.model_type||"-"),1),t("td",null,l(D(e.value,6)),1),t("td",null,[t("button",{class:"btn secondary btn-mini",type:"button",onClick:i=>F(e.exp_id)}," 在工作台打开 ",8,At)])]))),128))])])]),t("article",Rt,[s[13]||(s[13]=t("h3",null,"Model Summary",-1)),t("table",Nt,[s[12]||(s[12]=t("thead",null,[t("tr",null,[t("th",null,"model"),t("th",null,"count"),t("th",null,"datasets"),t("th",null,"mean"),t("th",null,"best"),t("th",null,"best_exp")])],-1)),t("tbody",null,[(d(!0),o($,null,x(B.value,e=>{var n;return d(),o("tr",{key:e.model_type},[t("td",null,l(e.model_type),1),t("td",null,l(e.count),1),t("td",null,l((n=e.dataset_count)!=null?n:"-"),1),t("td",null,l(D(e.mean,6)),1),t("td",null,l(D(e.best,6)),1),t("td",null,[t("button",{class:"btn secondary btn-mini",type:"button",disabled:!e.best_exp_id,onClick:i=>F(e.best_exp_id)},l(e.best_exp_id?"打开":"-"),9,wt)])])}),128))])])])])):(d(),o("div",$t,"暂无实验结果，请先在科研工作台运行实验。"))]),t("section",Dt,[t("div",Lt,[s[14]||(s[14]=t("div",null,[t("h2",null,"Manuscripts & Gate Reports"),t("p",null,[g("后端读取 "),t("code",null,"docs/papers"),g("，直接展示当前稿件与门禁状态。")])],-1)),t("button",{class:"btn secondary",type:"button",disabled:v.value,onClick:O},l(v.value?"刷新中...":"刷新状态"),9,Mt)]),v.value?(d(),o("div",Pt,"正在同步科研资产...")):f.value?(d(),o("div",Bt,l(f.value),1)):(d(),o("div",Et,[(d(!0),o($,null,x(h.value,e=>{var n,i,m,c;return d(),o("article",{key:e.paper_id,class:"paper-card"},[t("header",Ut,[t("div",null,[t("h3",null,l(e.title),1),t("p",null,l(e.language.toUpperCase())+" · "+l(e.paper_id),1)]),t("span",{class:V(["gate-pill",(n=e.gate_summary)!=null&&n.overall_pass?"ok":"warn"])},l((i=e.gate_summary)!=null&&i.overall_pass?"Gates PASS":"Gates BLOCKED"),3)]),t("div",Tt,[t("span",null,[s[15]||(s[15]=g("manuscript: ",-1)),t("b",null,l((m=e.manuscript)!=null&&m.exists?"ready":"missing"),1)]),(c=e.manuscript)!=null&&c.updated_at?(d(),o("span",qt,[s[16]||(s[16]=g("updated: ",-1)),t("b",null,l(w(e.manuscript.updated_at)),1)])):G("",!0),e.gate_summary?(d(),o("span",Ft,[s[17]||(s[17]=g("passed: ",-1)),t("b",null,l(e.gate_summary.passed)+"/"+l(e.gate_summary.total_gates),1)])):G("",!0)]),t("div",Ot,[t("button",{class:"btn btn-mini",type:"button",disabled:U(e.paper_id),onClick:r=>K(e.paper_id)},l(U(e.paper_id)?"打包中...":"下载投稿包 ZIP"),9,Vt)]),t("div",Gt,[t("table",jt,[s[18]||(s[18]=t("thead",null,[t("tr",null,[t("th",null,"Asset"),t("th",null,"Status"),t("th",null,"Updated"),t("th",null,"Action")])],-1)),t("tbody",null,[(d(!0),o($,null,x(e.assets,r=>(d(),o("tr",{key:`${e.paper_id}-${r.kind}`},[t("td",null,l(r.kind),1),t("td",null,[t("span",{class:V(["tag",r.exists?"tag-ok":"tag-missing"])},l(r.exists?"ready":"missing"),3)]),t("td",null,l(r.updated_at?w(r.updated_at):"-"),1),t("td",null,[t("button",{class:"btn secondary btn-mini",type:"button",disabled:!r.exists||E(e.paper_id,r.kind),onClick:Kt=>H(e.paper_id,r.kind,r.name)},l(E(e.paper_id,r.kind)?"下载中...":"下载"),9,zt)])]))),128))])])])])}),128))]))])]))}},It=lt(Ht,[["__scopeId","data-v-a776f142"]]);export{It as default};
