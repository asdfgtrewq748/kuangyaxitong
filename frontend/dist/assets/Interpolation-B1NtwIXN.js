var ut=Object.defineProperty,ht=Object.defineProperties;var vt=Object.getOwnPropertyDescriptors;var lt=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable;var le=Math.pow,st=(L,Z,N)=>Z in L?ut(L,Z,{enumerable:!0,configurable:!0,writable:!0,value:N}):L[Z]=N,Ue=(L,Z)=>{for(var N in Z||(Z={}))gt.call(Z,N)&&st(L,N,Z[N]);if(lt)for(var N of lt(Z))ft.call(Z,N)&&st(L,N,Z[N]);return L},Ne=(L,Z)=>ht(L,vt(Z));var $e=(L,Z,N)=>new Promise((M,_e)=>{var xe=se=>{try{ie(N.next(se))}catch(he){_e(he)}},fe=se=>{try{ie(N.throw(se))}catch(he){_e(he)}},ie=se=>se.done?M(se.value):Promise.resolve(se.value).then(xe,fe);ie((N=N.apply(L,Z)).next())});import{be as ct,w as mt,b5 as w,b8 as B,b7 as o,bb as _,bm as Re,bl as pt,bh as ee,bc as Oe,b9 as qe,ba as et,b as C,c as Ce,bp as We,bq as Qe,br as nt,bs as yt,bn as Ve,b6 as at,n as it}from"./vendor-BiQoUjbf.js";import{u as xt,a as bt}from"./vue-router-Dfza_nYx.js";import{_ as dt,u as kt,a as _t}from"./index-D34UQVup.js";import{g as St,a as wt,b as Mt,c as Tt}from"./api-DtdLAmLC.js";import"./network-T6nY3V_4.js";const Ct={key:0,class:"error-placeholder"},Ft={class:"error-detail"},At={key:1,class:"loading-placeholder"},Pt=["src"],Bt=["viewBox"],$t={key:0},Wt=["x1","y1","x2","y2"],Rt=["cx","cy"],Dt=["x","y"],It=["cx","cy"],Et=["x","y"],Yt=["x","y"],Xt=["x1","y1","x2","y2"],zt=["transform","onMouseenter"],Lt=["fill"],Ht={class:"map-controls"},Ut={key:1,class:"legend"},Nt={class:"legend-title"},Vt={class:"legend-range"},Ot={class:"legend-min"},qt={class:"legend-bar"},jt={class:"legend-max"},Kt={key:0,class:"tooltip-borehole"},Jt={class:"tooltip-name"},Zt={class:"tooltip-coords"},Gt={class:"tooltip-value"},Qt={class:"tooltip-label"},eo={class:"tooltip-number"},to={__name:"ContourMap",props:{imageUrl:{type:String,default:""},boreholes:{type:Array,default:()=>[]},bounds:{type:Object,default:()=>({})},property:{type:String,default:"thickness"},propertyLabel:{type:String,default:"åšåº¦"},valueRange:{type:Object,default:()=>({min:0,max:10})},colormap:{type:String,default:"YlOrBr"},crossSectionMode:{type:Boolean,default:!1}},emits:["crossSectionChange","crossSectionComplete"],setup(L,{expose:Z,emit:N}){const M=L,_e=N,xe=C(null),fe=C(800),ie=C(600),se=C(!1),he=C(null),V=C(1),me=C(0),te=C(0),de=C(!1),E=C(!1),Se=C({x:0,y:0}),ne=C(null),be=C({x:0,y:0}),ke=C(!0),u=C({start:null,end:null,distance:null}),O=C(null),ve=Ce(()=>{if(M.bounds&&M.bounds.min_x!==void 0)return{minX:M.bounds.min_x,maxX:M.bounds.max_x,minY:M.bounds.min_y,maxY:M.bounds.max_y,rangeX:M.bounds.max_x-M.bounds.min_x,rangeY:M.bounds.max_y-M.bounds.min_y};if(M.boreholes.length===0)return null;let m=1/0,c=-1/0,x=1/0,T=-1/0;return M.boreholes.forEach($=>{$.x<m&&(m=$.x),$.x>c&&(c=$.x),$.y<x&&(x=$.y),$.y>T&&(T=$.y)}),{minX:m,maxX:c,minY:x,maxY:T,rangeX:c-m,rangeY:T-x}}),pe=Ce(()=>{if(!ve.value||M.boreholes.length===0)return[];if(!se.value||!M.imageUrl)return[];const m=ve.value,c=fe.value,x=ie.value,T=c*.1,$=c*(1-.1-.85),G=x*.1,oe=x*(1-.1-.8),re=c-T-$,q=x-G-oe;return console.log("Image dimensions:",c,"x",x),console.log("Plot area:",{leftPadding:T.toFixed(1),rightPadding:$.toFixed(1),topPadding:oe.toFixed(1),bottomPadding:G.toFixed(1),plotWidth:re.toFixed(1),plotHeight:q.toFixed(1)}),M.boreholes.map(t=>{var r,a;const e=(r=t.x)!=null?r:t.borehole_x,i=(a=t.y)!=null?a:t.borehole_y;if(e==null||i==null)return null;const n=(e-m.minX)/m.rangeX,h=(i-m.minY)/m.rangeY,l=T+n*re,s=x-G-h*q;return(t.borehole==="ZK101"||t.borehole==="ZK102")&&console.log(`Borehole ${t.borehole}:`,{world:{x:e.toFixed(1),y:i.toFixed(1)},relative:{x:n.toFixed(3),y:h.toFixed(3)},canvas:{x:l.toFixed(1),y:s.toFixed(1)}}),Ne(Ue({},t),{x:e,y:i,canvasX:Math.round(l*10)/10,canvasY:Math.round(s*10)/10,color:Fe(t[M.property]||t.thickness||t.burial_depth)})}).filter(t=>t!==null)}),Fe=m=>{var $,G;if(m==null)return"#3b82f6";const c=(($=M.valueRange)==null?void 0:$.min)||0,x=((G=M.valueRange)==null?void 0:G.max)||1,T=Math.max(0,Math.min(1,(m-c)/(x-c||1)));return M.colormap==="YlOrBr"?ye(T,[{t:0,r:255,g:255,b:204},{t:.25,r:255,g:230,b:153},{t:.5,r:255,g:190,b:121},{t:.75,r:230,g:140,b:80},{t:1,r:160,g:80,b:50}]):ye(T,[{t:0,r:68,g:1,b:84},{t:.25,r:59,g:82,b:139},{t:.5,r:33,g:154,b:141},{t:.75,r:94,g:201,b:98},{t:1,r:253,g:231,b:37}])},ye=(m,c)=>{let x=c[0],T=c[c.length-1];for(let q=0;q<c.length-1;q++)if(m>=c[q].t&&m<=c[q+1].t){x=c[q],T=c[q+1];break}const $=T.t!==x.t?(m-x.t)/(T.t-x.t):0,G=Math.round(x.r+(T.r-x.r)*$),oe=Math.round(x.g+(T.g-x.g)*$),re=Math.round(x.b+(T.b-x.b)*$);return`rgb(${G}, ${oe}, ${re})`},De=Ce(()=>({transform:`scale(${V.value}) translate(${me.value/V.value}px, ${te.value/V.value}px)`,transformOrigin:"center center",transition:de.value?"none":"transform 0.1s ease-out"})),Ie=Ce(()=>({position:"absolute",top:"50%",left:"50%",transform:`translate(-50%, -50%) scale(${V.value}) translate(${me.value/V.value}px, ${te.value/V.value}px)`,transformOrigin:"center center",pointerEvents:"none",transition:de.value?"none":"transform 0.1s ease-out",maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto"})),je=Ce(()=>({left:be.value.x+15+"px",top:be.value.y+15+"px"})),Ke=Ce(()=>M.colormap==="YlOrBr"?"background: linear-gradient(to right, #fffacc, #ffe699, #ffbe79, #e68c50, #a05032)":"background: linear-gradient(to right, #440154, #3b528b, #21918c, #5ec962, #fde725)"),Je=m=>{fe.value=m.target.naturalWidth,ie.value=m.target.naturalHeight,se.value=!0,he.value=null,console.log("Image loaded successfully:",fe.value,"x",ie.value),console.log("Bounds:",M.bounds),console.log("Boreholes count:",M.boreholes.length),M.boreholes.length>0&&console.log("First borehole:",{name:M.boreholes[0].borehole,x:M.boreholes[0].x,y:M.boreholes[0].y,thickness:M.boreholes[0].thickness})},Ee=m=>{var c;he.value="å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®",se.value=!1,console.error("Image load error:",m),console.log("ImageUrl:",((c=M.imageUrl)==null?void 0:c.substring(0,50))+"...")},Ae=()=>{V.value=Math.min(V.value*1.2,3)},Ye=()=>{V.value=Math.max(V.value/1.2,.5)},Pe=()=>{V.value=1,me.value=0,te.value=0},Xe=()=>{u.value={start:null,end:null,distance:null},O.value=null,_e("crossSectionChange",null)},ze=(m,c)=>{if(!xe.value)return null;const x=xe.value.getBoundingClientRect(),T=x.width/2,$=x.height/2,G=(m-T-me.value)/V.value+T,oe=(c-$-te.value)/V.value+$,re=(x.width-fe.value)/2,q=(x.height-ie.value)/2;return{x:G-re,y:oe-q}},Me=(m,c)=>{if(!ve.value)return null;const x=fe.value,T=ie.value,$=x*.1,G=x*(1-.1-.85),oe=T*.1,re=T*(1-.1-.8),q=x-$-G,t=T-oe-re,e=ve.value,i=e.minX+(m-$)/q*e.rangeX,n=e.minY+(T-c-oe)/t*e.rangeY;return{x:i,y:n}},Le=m=>{if(M.crossSectionMode){const c=ze(m.clientX,m.clientY);if(!c)return;if(!u.value.start)u.value.start=c,E.value=!0;else if(u.value.end)u.value={start:c,end:null,distance:null},E.value=!0;else{u.value.end=c,E.value=!1;const x=Me(c.x,c.y),T=Me(u.value.start.x,u.value.start.y);if(x&&T){const $=Math.sqrt(le(T.x-x.x,2)+le(T.y-x.y,2));u.value.distance=$}O.value=null,_e("crossSectionComplete",{start:Me(u.value.start.x,u.value.start.y),end:Me(u.value.end.x,u.value.end.y),startCanvas:u.value.start,endCanvas:u.value.end,distance:u.value.distance})}_e("crossSectionChange",u.value)}else de.value=!0,Se.value={x:m.clientX-me.value,y:m.clientY-te.value}},Be=()=>{de.value=!1},Ze=m=>{if(!xe.value)return;const c=xe.value.getBoundingClientRect();if(m.clientX-c.left,m.clientY-c.top,M.crossSectionMode&&E.value){const x=ze(m.clientX,m.clientY);x&&(O.value=x),be.value={x:m.clientX,y:m.clientY};return}if(de.value){me.value=m.clientX-Se.value.x,te.value=m.clientY-Se.value.y;return}be.value={x:m.clientX,y:m.clientY}},He=m=>{m.preventDefault();const c=m.deltaY>0?.9:1.1;V.value=Math.max(.5,Math.min(3,V.value*c))};return ct(()=>{}),mt(()=>M.imageUrl,m=>{Pe(),se.value=!1,he.value=null,console.log("ImageUrl changed:",m?m.substring(0,50)+"...":"null")}),Z({resetView:Pe,resetCrossSection:Xe,boreholes:pe,crossSectionLine:u}),(m,c)=>{var x,T,$,G,oe,re;return w(),B("div",{class:et(["contour-map-wrapper",{"cross-section-mode":L.crossSectionMode}])},[o("div",{ref_key:"imageContainer",ref:xe,class:"image-container",onMousedown:Le,onMousemove:Ze,onMouseup:Be,onMouseleave:Be,onWheel:pt(He,["prevent"])},[he.value?(w(),B("div",Ct,[c[2]||(c[2]=o("p",null,"âš ï¸ å›¾ç‰‡åŠ è½½å¤±è´¥",-1)),o("p",Ft,_(he.value),1),c[3]||(c[3]=o("p",{class:"error-hint"},"è¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ",-1))])):L.imageUrl?(w(),B("img",{key:2,src:L.imageUrl,class:"contour-image",style:Re(De.value),alt:"Contour Map",loading:"lazy",decoding:"async",onLoad:Je,onError:Ee},null,44,Pt)):(w(),B("div",At,[...c[4]||(c[4]=[o("div",{class:"spinner"},null,-1),o("p",null,"æ­£åœ¨ç”Ÿæˆç­‰å€¼çº¿å›¾...",-1)])]))],544),L.imageUrl?(w(),B("svg",{key:0,class:"borehole-overlay",viewBox:`0 0 ${fe.value} ${ie.value}`,style:Re(Ie.value),preserveAspectRatio:"xMidYMid meet"},[c[6]||(c[6]=o("defs",null,[o("filter",{id:"shadow",x:"-50%",y:"-50%",width:"200%",height:"200%"},[o("feDropShadow",{dx:"0",dy:"1",stdDeviation:"2","flood-opacity":"0.3"})]),o("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto"},[o("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#f59e0b"})])],-1)),u.value.start&&u.value.end?(w(),B("g",$t,[o("line",{x1:u.value.start.x,y1:u.value.start.y,x2:u.value.end.x,y2:u.value.end.y,stroke:"#f59e0b","stroke-width":"3","stroke-dasharray":"8,4","marker-end":"url(#arrowhead)",class:"cross-section-line"},null,8,Wt),o("circle",{cx:u.value.start.x,cy:u.value.start.y,r:"8",fill:"#f59e0b",stroke:"white","stroke-width":"2",class:"cross-section-marker"},null,8,Rt),o("text",{x:u.value.start.x,y:u.value.start.y-15,fill:"#f59e0b","font-size":"14","font-weight":"bold","text-anchor":"middle"},"A",8,Dt),o("circle",{cx:u.value.end.x,cy:u.value.end.y,r:"8",fill:"#f59e0b",stroke:"white","stroke-width":"2",class:"cross-section-marker"},null,8,It),o("text",{x:u.value.end.x,y:u.value.end.y-15,fill:"#f59e0b","font-size":"14","font-weight":"bold","text-anchor":"middle"},"A'",8,Et),o("text",{x:(u.value.start.x+u.value.end.x)/2,y:(u.value.start.y+u.value.end.y)/2-15,fill:"white","font-size":"12","text-anchor":"middle",class:"distance-label"},_((x=u.value.distance)==null?void 0:x.toFixed(0))+"m",9,Yt)])):ee("",!0),L.crossSectionMode&&u.value.start&&O.value?(w(),B("line",{key:1,x1:u.value.start.x,y1:u.value.start.y,x2:O.value.x,y2:O.value.y,stroke:"rgba(245, 158, 11, 0.5)","stroke-width":"2","stroke-dasharray":"4,4"},null,8,Xt)):ee("",!0),ke.value?(w(!0),B(Oe,{key:2},qe(pe.value,(q,t)=>(w(),B("g",{key:t,transform:`translate(${q.canvasX}, ${q.canvasY})`,class:"borehole-marker",onMouseenter:e=>ne.value=Ne(Ue({},q),{isBorehole:!0}),onMouseleave:c[0]||(c[0]=e=>ne.value=null)},[c[5]||(c[5]=o("circle",{r:"9",fill:"rgba(255,255,255,0.95)",filter:"url(#shadow)"},null,-1)),o("circle",{r:"6",fill:q.color||"#3b82f6",stroke:"#1e3a8a","stroke-width":"1.5"},null,8,Lt)],40,zt))),128)):ee("",!0)],12,Bt)):ee("",!0),o("div",Ht,[o("button",{class:"control-btn",onClick:Ae,title:"æ”¾å¤§"},[...c[7]||(c[7]=[o("span",null,"+",-1)])]),o("button",{class:"control-btn",onClick:Ye,title:"ç¼©å°"},[...c[8]||(c[8]=[o("span",null,"âˆ’",-1)])]),o("button",{class:"control-btn",onClick:Pe,title:"é‡ç½®"},[...c[9]||(c[9]=[o("span",null,"âŸ²",-1)])]),o("button",{class:et(["control-btn",{active:ke.value}]),onClick:c[1]||(c[1]=q=>ke.value=!ke.value),title:"é’»å­”ç‚¹"},[...c[10]||(c[10]=[o("span",null,"ğŸ“",-1)])],2)]),L.valueRange?(w(),B("div",Ut,[o("div",Nt,_(L.propertyLabel),1),o("div",Vt,[o("span",Ot,_((T=L.valueRange.min)==null?void 0:T.toFixed(2))+"m",1),o("div",qt,[o("div",{class:"legend-gradient",style:Re(Ke.value)},null,4)]),o("span",jt,_(($=L.valueRange.max)==null?void 0:$.toFixed(2))+"m",1)])])):ee("",!0),ne.value?(w(),B("div",{key:2,class:"hover-tooltip",style:Re(je.value)},[ne.value.isBorehole?(w(),B("div",Kt,[o("div",Jt,_(ne.value.name||ne.value.borehole),1),o("div",Zt,"("+_((G=ne.value.x)==null?void 0:G.toFixed(1))+", "+_((oe=ne.value.y)==null?void 0:oe.toFixed(1))+")",1),o("div",Gt,[o("span",Qt,_(L.propertyLabel)+":",1),o("span",eo,_((re=ne.value.value)==null?void 0:re.toFixed(2))+" m",1)])])):ee("",!0)],4)):ee("",!0)],2)}}},rt=dt(to,[["__scopeId","data-v-6673f721"]]),oo={class:"page"},lo={class:"header"},so={class:"muted"},no={key:0,class:"header-stats"},ao={class:"stat-badge"},io={class:"stat-badge primary"},ro={class:"stat-badge"},co={key:0,class:"card"},uo={class:"seam-selection-grid"},ho=["onClick"],vo={class:"seam-card-header"},go={class:"seam-name"},fo={class:"seam-count"},mo={class:"seam-card-stats"},po={class:"mini-stat"},yo={class:"mini-stat-value"},xo={class:"mini-stat"},bo={class:"mini-stat-value"},ko={key:1,class:"grid"},_o={class:"card params-card compact-card"},So={class:"param-row"},wo={class:"tab-buttons"},Mo=["onClick"],To={class:"param-row"},Co={class:"param-header"},Fo={class:"param-value"},Ao={class:"param-row"},Po={class:"param-header"},Bo={class:"param-value"},$o={key:0,class:"param-row"},Wo={class:"toggle-btn",style:{width:"100%"}},Ro={key:0,class:"hint-text"},Do={class:"action-buttons"},Io=["disabled"],Eo={key:0,class:"spinner sm"},Yo={class:"card compact-card"},Xo={key:0,class:"histogram-wrapper"},zo={key:1,class:"empty-state"},Lo={key:2,class:"stats-grid"},Ho={class:"stat-item"},Uo={class:"stat-value"},No={class:"stat-item"},Vo={class:"stat-value"},Oo={class:"stat-item"},qo={class:"stat-value"},jo={class:"stat-item"},Ko={class:"stat-value"},Jo={class:"stat-item"},Zo={class:"stat-value"},Go={class:"stat-item"},Qo={class:"stat-value"},el={class:"card compact-card"},tl={class:"stratigraphic-wrapper"},ol={class:"lithology-legend-compact"},ll={class:"legend-name"},sl={key:0,class:"map-row"},nl={key:0,class:"card map-card-large"},al={class:"map-header"},il={class:"section-desc"},rl={class:"map-wrapper"},cl={key:1,class:"empty-state"},dl={key:1,class:"card map-card-large"},ul={class:"map-header"},hl={class:"section-desc"},vl={class:"map-wrapper"},gl={key:1,class:"empty-state"},fl={key:1,class:"card map-card-full"},ml={class:"map-wrapper uncertainty-wrapper"},pl={key:2,class:"card map-card-full"},yl={class:"map-header"},xl={class:"section-title"},bl={class:"section-badge"},kl={class:"cross-section-wrapper"},_l={__name:"Interpolation",setup(L,{expose:Z}){const N=_t(),M=xt(),_e=bt(),{workspaceState:xe,setSelectedSeam:fe,markStepDone:ie}=kt(),se=C(!1),he=C(null),V=C(!1),me=C([]),te=C(null),de=C(null),E=C([]),Se=C([]),ne=C("kriging"),be=C(80),ke=C(10),u=C(null),O=C(null),ve=C(!1),pe=C({line:null,points:[],depthProfile:[],distance:null,hasData:!1}),Fe=C(null),ye=C(null),De=C(null),Ie=C(null),je=[{key:"kriging",label:"Kriging"},{key:"idw",label:"IDW"},{key:"linear",label:"Linear"},{key:"nearest",label:"Nearest"}],Ke={ç»†ç ‚å²©:"#FCEBB6",ç²‰ç ‚å²©:"#E0FFFF",æ³¥å²©:"#D3D3D3",ä¸­ç ‚å²©:"#FCEBB6",ç²—ç ‚å²©:"#F5DEB3",ç ¾å²©:"#DEB887",ç‚­è´¨æ³¥å²©:"#8B8B8B",ç ‚è´¨æ³¥å²©:"#D8D8D8",æ³¥è´¨ç ‚å²©:"#E8E8E8",çŸ³ç°å²©:"#B0E0E6",ç…¤:"#2F4F4F"},Je={ç»†ç ‚å²©:{facecolor:"#FCEBB6",hatch:"...",edgecolor:"#999999"},ç²‰ç ‚å²©:{facecolor:"#E0FFFF",hatch:"...",edgecolor:"#AAAAAA"},æ³¥å²©:{facecolor:"#D3D3D3",hatch:"---",edgecolor:"#666666"},ä¸­ç ‚å²©:{facecolor:"#FCEBB6",hatch:"...",edgecolor:"#999999"},ç²—ç ‚å²©:{facecolor:"#F5DEB3",hatch:"...",edgecolor:"#999999"},ç ¾å²©:{facecolor:"#DEB887",hatch:"ooo",edgecolor:"#8B4513"},ç‚­è´¨æ³¥å²©:{facecolor:"#8B8B8B",hatch:"---",edgecolor:"#444444"},ç ‚è´¨æ³¥å²©:{facecolor:"#D8D8D8",hatch:"-..",edgecolor:"#777777"},æ³¥è´¨ç ‚å²©:{facecolor:"#E8E8E8",hatch:".-.",edgecolor:"#888888"},çŸ³ç°å²©:{facecolor:"#B0E0E6",hatch:"+++",edgecolor:"#5F9EA0"},ç…¤:{facecolor:"#2F4F4F",hatch:"",edgecolor:"#1a1a1a"}},Ee=t=>({kriging:"Kriging",idw:"IDW",linear:"Linear",nearest:"Nearest"})[t]||t,Ae=()=>{const t=E.value.map(e=>e.thickness).filter(e=>e!=null);return t.length===0?0:t.reduce((e,i)=>e+i,0)/t.length},Ye=()=>{const t=E.value.map(n=>n.thickness).filter(n=>n!=null);if(t.length===0)return 0;const e=Ae(),i=t.reduce((n,h)=>n+le(h-e,2),0)/t.length;return Math.sqrt(i)},Pe=()=>{const t=Ae();return t===0?0:Ye()/t*100},Xe=()=>{const t=E.value.map(e=>e.thickness).filter(e=>e!=null);return t.length===0?{min:0,max:0}:{min:Math.min(...t),max:Math.max(...t)}},ze=()=>$e(this,null,function*(){se.value=!0;try{const{data:t}=yield St();me.value=t.seams||[]}catch(t){he.value="åŠ è½½ç…¤å±‚å¤±è´¥"}finally{se.value=!1}}),Me=(t=[])=>{let e=0;return t.map(i=>{var s,r;const n=Number((s=i.thickness)!=null?s:0)||0;let h=Number(i.z_top),l=Number(i.z_bottom);if(Number.isFinite(h)||(h=e),Number.isFinite(l)||(l=h+n),!Number.isFinite(n)||n===0){const a=Math.max((l||0)-(h||0),0);a>0&&(i.thickness=a)}return e=l,Ne(Ue({},i),{thickness:Number((r=i.thickness)!=null?r:n)||0,z_top:h,z_bottom:l})})},Le=t=>$e(this,null,function*(){var e,i,n;te.value=t,fe((t==null?void 0:t.name)||""),u.value=null,O.value=null;try{const{data:h}=yield wt(t.name);de.value=h,E.value=h.points||[];try{const l=yield Mt(t.name),s=((e=l==null?void 0:l.data)==null?void 0:e.boreholes)||[],r=s.reduce((d,k)=>{var F,R;const U=((F=d==null?void 0:d.layers)==null?void 0:F.length)||0;return(((R=k==null?void 0:k.layers)==null?void 0:R.length)||0)>U?k:d},s[0]),a=Me((r==null?void 0:r.layers)||[]);Se.value=a.sort((d,k)=>(d.z_top||0)-(k.z_top||0))}catch(l){Se.value=[]}yield Be(),yield it(),He(),ie("Interpolation",{interpolationPoints:E.value.length||0}),m()}catch(h){N.add("åŠ è½½ç…¤å±‚è¯¦æƒ…å¤±è´¥: "+(((n=(i=h.response)==null?void 0:i.data)==null?void 0:n.detail)||h.message),"error")}}),Be=()=>$e(this,null,function*(){var t,e,i,n,h,l,s,r,a,d,k,U,X,F,R;if(te.value){V.value=!0;try{const{data:f}=yield Tt(te.value.name,ne.value,be.value,ke.value);console.log("å®Œæ•´APIå“åº”:",f),console.log("data.thickness:",f.thickness),console.log("data.depth:",f.depth),f.thickness&&(console.log("thicknesså¯¹è±¡çš„keys:",Object.keys(f.thickness)),console.log("thickness.imageå­˜åœ¨å—?","image"in f.thickness),console.log("thicknessæ‰€æœ‰å±æ€§:",JSON.stringify(f.thickness,null,2))),f.depth&&(console.log("depthå¯¹è±¡çš„keys:",Object.keys(f.depth)),console.log("depth.imageå­˜åœ¨å—?","image"in f.depth)),console.log("API Response:",{hasThicknessImage:!!((t=f.thickness)!=null&&t.image),hasDepthImage:!!((e=f.depth)!=null&&e.image),thicknessImageLength:(n=(i=f.thickness)==null?void 0:i.image)==null?void 0:n.length,depthImageLength:(l=(h=f.depth)==null?void 0:h.image)==null?void 0:l.length,thicknessImagePrefix:(r=(s=f.thickness)==null?void 0:s.image)==null?void 0:r.substring(0,50),depthImagePrefix:(d=(a=f.depth)==null?void 0:a.image)==null?void 0:d.substring(0,50)}),E.value=f.boreholes||[],(k=f.thickness)!=null&&k.image?(u.value={imageUrl:`data:image/png;base64,${f.thickness.image}`,valueRange:f.thickness.value_range,bounds:f.bounds},console.log("Thickness imageUrl created:",u.value.imageUrl.substring(0,50)+"...")):console.error("âŒ åšåº¦å›¾ç‰‡æ•°æ®ç¼ºå¤±!"),(U=f.depth)!=null&&U.image?(O.value={imageUrl:`data:image/png;base64,${f.depth.image}`,valueRange:f.depth.value_range,bounds:f.bounds},console.log("Depth imageUrl created:",O.value.imageUrl.substring(0,50)+"...")):console.error("âŒ æ·±åº¦å›¾ç‰‡æ•°æ®ç¼ºå¤±!"),yield it(),Ze(),He(),ie("Interpolation",{interpolationPoints:E.value.length||0}),console.log("âœ“ All chartsç»˜åˆ¶å®Œæˆ"),N.add("ç­‰å€¼çº¿å›¾ç”Ÿæˆå®Œæˆ","success")}catch(f){console.error("Interpolate error:",f),console.error("Error response:",(X=f.response)==null?void 0:X.data),N.add(((R=(F=f.response)==null?void 0:F.data)==null?void 0:R.detail)||"ç”Ÿæˆç­‰å€¼çº¿å›¾å¤±è´¥","error")}finally{V.value=!1}}}),Ze=()=>{if(console.log("calculateUncertainty called"),console.log("seamPoints.value.length:",E.value.length),console.log("thicknessResult.value:",u.value),!E.value.length||!u.value){console.log("âŒ Missing data for uncertainty map");return}const t=Ie.value;if(console.log("uncertaintyCanvas.value:",t),!t){console.log("âŒ uncertaintyCanvas not found");return}console.log("âœ“ Starting uncertainty map calculation...");const e=t.getContext("2d"),i=t.width=900,n=t.height=550;console.log("Canvas size:",i,"x",n);const h=u.value.bounds,l=E.value.map(S=>({x:S.x,y:S.y}));console.log("Bounds:",h),console.log("Points count:",l.length),e.fillStyle="#ffffff",e.fillRect(0,0,i,n);const s={left:20,right:35,top:20,bottom:60},r=i-s.left-s.right-50,a=n-s.top-s.bottom,d=150,k=[],U=500;for(let S=0;S<d;S++){k[S]=[];for(let Y=0;Y<d;Y++){const D=h.min_x+Y/d*(h.max_x-h.min_x),ge=h.max_y-S/d*(h.max_y-h.min_y);let ue=1/0;for(const we of l){const Te=Math.sqrt(le(D-we.x,2)+le(ge-we.y,2));Te<ue&&(ue=Te)}k[S][Y]=Math.min(1.6,ue/U*1.6)}}const X=[],F=3;for(let S=0;S<d;S++){X[S]=[];for(let Y=0;Y<d;Y++){let D=0,ge=0;for(let ue=-F;ue<=F;ue++)for(let we=-F;we<=F;we++){const Te=S+ue,Ge=Y+we;if(Te>=0&&Te<d&&Ge>=0&&Ge<d){const tt=Math.sqrt(we*we+ue*ue),ot=Math.exp(-(tt*tt)/(2*F*F));D+=k[Te][Ge]*ot,ge+=ot}}X[S][Y]=D/ge}}const R=S=>{const Y=Math.min(1.5,Math.max(0,S))/1.5;if(Y<.5){const D=Y*2;return{r:Math.floor(49+206*D),g:Math.floor(130+125*D),b:Math.floor(189+-189*D)}}else{const D=(Y-.5)*2;return{r:Math.floor(255+-40*D),g:Math.floor(255+-207*D),b:Math.floor(0+48*D)}}},f=r/d,ae=a/d;for(let S=0;S<d;S++)for(let Y=0;Y<d;Y++){const D=X[S][Y],ge=R(D);e.fillStyle=`rgb(${ge.r}, ${ge.g}, ${ge.b})`,e.fillRect(s.left+Y*f,s.top+(d-1-S)*ae,f+1,ae+1)}const j=6;for(const S of l){const Y=s.left+(S.x-h.min_x)/(h.max_x-h.min_x)*r,D=s.top+(h.max_y-S.y)/(h.max_y-h.min_y)*a;e.beginPath(),e.arc(Y,D,j,0,Math.PI*2),e.fillStyle="#000000",e.fill()}e.strokeStyle="#000000",e.lineWidth=2,e.strokeRect(s.left,s.top,r,a);const I=s.left+20,H=s.top+a-80,K=120,y=50;e.fillStyle="#ffffff",e.strokeStyle="#000000",e.lineWidth=1.5,e.fillRect(I,H,K,y),e.strokeRect(I,H,K,y),e.fillStyle="#d73027",e.fillRect(I+10,H+28,15,15),e.strokeStyle="#000000",e.lineWidth=1,e.strokeRect(I+10,H+28,15,15),e.fillStyle="#000000",e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText("é«˜ä¸ç¡®å®šæ€§",I+32,H+40),e.beginPath(),e.arc(I+17,H+18,j,0,Math.PI*2),e.fillStyle="#000000",e.fill(),e.fillText("é’»å­”ä½ç½®",I+32,H+22);const z=s.left+r-150,W=H,J=130,g=35;e.fillStyle="#ffffff",e.strokeStyle="#000000",e.lineWidth=1.5,e.fillRect(z,W,J,g),e.strokeRect(z,W,J,g),e.fillStyle="#000000",e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText("0",z+10,W+22),e.textAlign="center",e.fillText("500",z+75,W+22),e.textAlign="right",e.fillText("1000 ç±³",z+120,W+22);const v=W+12;e.strokeStyle="#000000",e.lineWidth=2,e.beginPath(),e.moveTo(z+10,v),e.lineTo(z+120,v),e.stroke(),e.lineWidth=4,e.beginPath(),e.moveTo(z+10,v),e.lineTo(z+75,v),e.stroke();const b=s.left+r+20,A=s.top,Q=20,p=a;for(let S=0;S<p;S++){const Y=(1-S/p)*1.5,D=R(Y);e.fillStyle=`rgb(${D.r}, ${D.g}, ${D.b})`,e.fillRect(b,A+S,Q,1)}e.strokeStyle="#000000",e.lineWidth=1.5,e.strokeRect(b,A,Q,p),e.fillStyle="#000000",e.font="11px Arial, sans-serif",e.textAlign="left";const P=[0,.5,1,1.5],ce=["0","0.5","1.0","1.5+"];P.forEach((S,Y)=>{const D=A+p-S/1.5*p;e.beginPath(),e.moveTo(b+Q,D),e.lineTo(b+Q+4,D),e.strokeStyle="#000000",e.lineWidth=1,e.stroke(),e.fillText(ce[Y],b+Q+8,D+4)}),e.save(),e.translate(b+Q+35,A+p/2),e.rotate(-Math.PI/2),e.textAlign="center",e.font="12px Arial, sans-serif",e.fillText("æ–¹å·® (å½’ä¸€åŒ–)",0,0),e.restore(),e.fillStyle="#000000",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("æ’å€¼ä¸ç¡®å®šæ€§åˆ†å¸ƒå›¾",s.left+r/2,n-28),e.font="11px Arial, sans-serif",e.fillText("çº¢è‰²åŒºåŸŸè¡¨ç¤ºè¾ƒé«˜çš„ä¸ç¡®å®šæ€§ï¼›è“è‰²åŒºåŸŸæ›´åŠ å¯é ã€‚",s.left+r/2,n-12),console.log("âœ“ Uncertainty mapç»˜åˆ¶å®Œæˆ")},He=()=>{console.log("drawHistogram called"),console.log("histogramCanvas.value:",Fe.value),console.log("seamPoints.value.length:",E.value.length);const t=Fe.value;if(!t){console.log("âŒ histogramCanvas not found");return}if(E.value.length===0){console.log("âŒ No seam points data");return}console.log("âœ“ Starting histogram drawing...");const e=t.getContext("2d"),i=window.devicePixelRatio||1,n=t.parentElement,h=(n==null?void 0:n.clientWidth)||t.clientWidth||500,l=(n==null?void 0:n.clientHeight)||t.clientHeight||350;t.width=Math.round(h*i),t.height=Math.round(l*i),t.style.width=`${h}px`,t.style.height=`${l}px`,e.setTransform(i,0,0,i,0,0);const s=h,r=l,a=E.value.map(p=>p.thickness).filter(p=>p!=null);if(a.length===0)return;const d=Math.min(...a),k=Math.max(...a),U=a.reduce((p,P)=>p+P,0)/a.length,X=a.reduce((p,P)=>p+le(P-U,2),0)/a.length,F=Math.sqrt(X),R=20,f=(k-d)/R,ae=Array(R).fill(0);for(const p of a){const P=Math.min(Math.floor((p-d)/f),R-1);ae[P]++}const j=Math.max(...ae),I="#5D8AA8",H="#C8523C",K=.85;e.fillStyle="#ffffff",e.fillRect(0,0,s,r);const y={left:50,right:25,top:45,bottom:45},z=s-y.left-y.right,W=r-y.top-y.bottom,J=z/R,g=W/(j*1.1);e.fillStyle=I,e.globalAlpha=K;for(let p=0;p<R;p++){const P=ae[p]*g,ce=y.left+p*J,S=r-y.bottom-P;P>0&&(e.fillRect(ce,S,J-1,P),e.strokeStyle="white",e.lineWidth=.8,e.strokeRect(ce,S,J-1,P))}e.globalAlpha=1,e.strokeStyle=H,e.lineWidth=2,e.beginPath();for(let p=0;p<=100;p++){const P=y.left+p/100*z,ce=d+p/100*(k-d),Y=1/(F*Math.sqrt(2*Math.PI))*Math.exp(-.5*le((ce-U)/F,2))*a.length*f,D=r-y.bottom-Y*g;p===0?e.moveTo(P,D):e.lineTo(P,D)}e.stroke(),e.strokeStyle="#000000",e.lineWidth=1,e.beginPath(),e.moveTo(y.left,y.top),e.lineTo(y.left,r-y.bottom),e.stroke(),e.beginPath(),e.moveTo(y.left,r-y.bottom),e.lineTo(s-y.right,r-y.bottom),e.stroke();const v=4;e.strokeStyle="#000000",e.lineWidth=1;for(let p=0;p<=6;p++){const P=y.left+p/6*z;e.beginPath(),e.moveTo(P,r-y.bottom),e.lineTo(P,r-y.bottom+v),e.stroke()}for(let p=0;p<=5;p++){const P=r-y.bottom-p/5*W;e.beginPath(),e.moveTo(y.left,P),e.lineTo(y.left-v,P),e.stroke()}e.fillStyle="#000000",e.font="10px Arial, sans-serif",e.textAlign="center";for(let p=0;p<=6;p++){const P=d+p/6*(k-d),ce=y.left+p/6*z;e.fillText(P.toFixed(1),ce,r-y.bottom+15)}e.textAlign="right";for(let p=0;p<=5;p++){const P=Math.round(p/5*(j*1.1)),ce=r-y.bottom-p/5*W;e.fillText(P.toString(),y.left-6,ce+3)}e.fillStyle="#000000",e.font="11px Arial, sans-serif",e.textAlign="center",e.fillText("åšåº¦ (m)",y.left+z/2,r-8),e.save(),e.translate(12,y.top+W/2),e.rotate(-Math.PI/2),e.fillText("é¢‘æ•°",0,0),e.restore(),e.fillStyle="#000000",e.font="bold 12px Arial, sans-serif",e.textAlign="left",e.fillText("Figure 1 | é’»å­”åšåº¦åˆ†å¸ƒ (n="+a.length+")",y.left,18),e.fillStyle="#000000",e.font="10px Arial, sans-serif",e.textAlign="left";const b=s-y.right-120,A=y.top+10;e.fillStyle=I,e.globalAlpha=K,e.fillRect(b,A-4,12,10),e.globalAlpha=1,e.strokeStyle="white",e.lineWidth=.8,e.strokeRect(b,A-4,12,10),e.fillText("è§‚æµ‹å€¼",b+16,A+4),e.strokeStyle=H,e.lineWidth=2,e.beginPath(),e.moveTo(b,A+20),e.lineTo(b+12,A+20),e.stroke(),e.fillStyle="#000000",e.fillText("å¯†åº¦æ‹Ÿåˆ",b+16,A+24),e.fillStyle="#666666",e.font="9px Arial, sans-serif",e.textAlign="left";const Q=`Î¼=${U.toFixed(2)}  Ïƒ=${F.toFixed(2)}`;e.fillText(Q,b,A+42),console.log("âœ“ Histogramç»˜åˆ¶å®Œæˆ")},m=()=>{const t=De.value;if(!t||Se.value.length===0)return;const e=t.getContext("2d"),i=window.devicePixelRatio||1,n=t.parentElement,h=(n==null?void 0:n.clientWidth)||t.clientWidth||280,l=(n==null?void 0:n.clientHeight)||t.clientHeight||500;t.width=Math.round(h*i),t.height=Math.round(l*i),t.style.width=`${h}px`,t.style.height=`${l}px`,e.setTransform(i,0,0,i,0,0);const s=h,r=l;e.fillStyle="#FFFFFF",e.fillRect(0,0,s,r);const a=Se.value;let d=Math.max(...a.map(W=>W.z_bottom||0));if((!Number.isFinite(d)||d<=0)&&(d=a.reduce((W,J)=>W+(Number(J.thickness)||0),0)),!Number.isFinite(d)||d<=0)return;const k={top:24,bottom:22},U=(r-k.top-k.bottom)/d,X=k.top,F=14,R=Math.max(110,Math.min(160,s*.3)),f=Math.max(80,Math.min(140,s*.22)),ae=F+f+16+R,I=Math.max(16,(s-ae)/2),H=I+F,K=H+f+16;e.fillStyle="#0F172A",e.font="bold 12px Arial, sans-serif",e.textAlign="left",e.fillText("åœ°å±‚æŸ±çŠ¶å›¾",H,18);const y=4,z=Math.max(5,Math.ceil(d/6/5)*5)||10;e.strokeStyle="#E2E8F0",e.lineWidth=1,e.fillStyle="#64748B",e.font="10px Arial, sans-serif",e.textAlign="right",e.beginPath(),e.moveTo(I,X),e.lineTo(I,r-k.bottom),e.stroke();for(let W=0;W<=d;W+=z){const J=X+W*U;e.beginPath(),e.moveTo(I,J),e.lineTo(I+y,J),e.stroke(),e.fillText(`${Math.round(W)} m`,I-6,J+3)}e.save(),e.translate(I-28,X+(r-k.bottom-X)/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillStyle="#64748B",e.font="11px Arial, sans-serif",e.fillText("æ·±åº¦",0,0),e.restore(),a.forEach((W,J)=>{const g=X+(W.z_top||0)*U,v=W.thickness||0,b=Math.max(v*U,3),A=Je[W.name]||{facecolor:"#D3D3D3",hatch:"---",edgecolor:"#666666"};e.fillStyle=A.facecolor,e.fillRect(H,g,f,b),b>6&&A.hatch&&c(e,A.hatch,H,g,f,b,A.edgecolor),e.strokeStyle="#1a1a1a",e.lineWidth=.5,e.strokeRect(H,g,f,b),b>10&&(e.fillStyle="#475569",e.font="10px Arial, sans-serif",e.textAlign="left",e.fillText(W.name,K,g+b/2+3),e.fillStyle="#2563EB",e.font="9px SF Mono, monospace",e.fillText(`${v.toFixed(1)}ç±³`,K,g+b/2+14))}),e.strokeStyle="#94A3B8",e.lineWidth=1,e.strokeRect(H,X,f,r-X-k.bottom)},c=(t,e,i,n,h,l,s)=>{t.save(),t.beginPath(),t.rect(i,n,h,l),t.clip(),t.strokeStyle=s,t.globalAlpha=.4,t.lineWidth=.5;const r=6;switch(e){case"...":case"ooo":t.fillStyle=s,t.globalAlpha=.3;for(let a=r/2;a<h;a+=r)for(let d=r/2;d<l;d+=r)t.beginPath(),e==="ooo"?t.arc(i+a,n+d,2.5,0,Math.PI*2):t.arc(i+a,n+d,1,0,Math.PI*2),t.fill();break;case"---":t.globalAlpha=.5;for(let a=4;a<l;a+=r)t.beginPath(),t.moveTo(i,n+a),t.lineTo(i+h,n+a),t.stroke();break;case"+++":case"xx":t.globalAlpha=.3;for(let a=r/2;a<h;a+=r)for(let d=r/2;d<l;d+=r)t.beginPath(),t.moveTo(i+a-3,n+d),t.lineTo(i+a+3,n+d),t.stroke(),t.beginPath(),t.moveTo(i+a,n+d-3),t.lineTo(i+a,n+d+3),t.stroke();break;case"-..":case".-.":t.globalAlpha=.5;for(let a=r;a<l;a+=r*1.5)t.beginPath(),t.moveTo(i,n+a),t.lineTo(i+h/2,n+a),t.stroke(),t.fillStyle=s,t.beginPath(),t.arc(i+h*.75,n+a,1.5,0,Math.PI*2),t.fill();break;case"//":case"\\\\":t.globalAlpha=.4;for(let a=-l;a<h;a+=r)t.beginPath(),t.moveTo(i+a,n),t.lineTo(i+a+l,n+l),t.stroke();break}t.restore()},x=t=>{pe.value={line:{start:t.startCanvas,end:t.endCanvas},worldLine:{start:t.start,end:t.end},points:t.points||[],depthProfile:[],distance:t.distance,hasData:!0},T(t.start,t.end,t.distance)},T=(t,e,i)=>{if(!E.value.length||i===null)return;const n=ye.value;if(!n)return;n.getContext("2d");const h=n.width=n.offsetWidth||900,l=n.height=300,s=100,r=(e.x-t.x)/s,a=(e.y-t.y)/s,d=[];for(let k=0;k<=s;k++){const U=t.x+r*k,X=t.y+a*k,F=E.value.map(R=>{const f=Math.sqrt(le(U-R.x,2)+le(X-R.y,2));return{depth:R.burial_depth,distance:f}}).filter(R=>R.depth!=null&&R.distance<500);if(F.length>0){let R=0,f=0;for(const ae of F){const j=1/le(ae.distance+1,2);f+=ae.depth*j,R+=j}d.push({distance:k/s*i,depth:f/R})}}pe.value.depthProfile=d,$(d,i,h,l)},$=(t,e,i,n)=>{var W,J;const h=ye.value;if(!h)return;const l=h.getContext("2d");l.fillStyle="#FFFFFF",l.fillRect(0,0,i,n);const s={left:50,right:30,top:35,bottom:40},r=i-s.left-s.right,a=n-s.top-s.bottom,d=t.map(g=>g.depth),k=Math.min(...d),U=Math.max(...d),X=U-k||1,F={topSoil:"#8FBC8F",sandstone:"#F4A460",shale:"#778899",coal:"#2F2F2F",sandyShale:"#A9A9A9",limestone:"#B0C4DE"},f=a/6;[F.limestone,F.sandyShale,F.coal,F.shale,F.sandstone,F.topSoil].forEach((g,v)=>{const b=s.top+v*f;l.fillStyle=g,l.globalAlpha=.08,l.fillRect(s.left,b,r,f),l.globalAlpha=1}),l.strokeStyle="#E2E8F0",l.lineWidth=.8;const j=10;for(let g=0;g<=j;g++){const v=s.left+g/j*r;l.beginPath(),l.moveTo(v,s.top),l.lineTo(v,n-s.bottom),l.stroke()}const I=5;for(let g=0;g<=I;g++){const v=s.top+g/I*a;l.beginPath(),l.moveTo(s.left,v),l.lineTo(i-s.right,v),l.stroke()}l.strokeStyle="#94A3B8",l.lineWidth=1,l.beginPath(),l.moveTo(s.left,s.top),l.lineTo(s.left,n-s.bottom),l.stroke(),l.beginPath(),l.moveTo(s.left,n-s.bottom),l.lineTo(i-s.right,n-s.bottom),l.stroke();const H=4;l.strokeStyle="#CBD5E1",l.lineWidth=1;for(let g=0;g<=j;g++){const v=s.left+g/j*r;l.beginPath(),l.moveTo(v,n-s.bottom),l.lineTo(v,n-s.bottom+H),l.stroke()}for(let g=0;g<=I;g++){const v=n-s.bottom-g/I*a;l.beginPath(),l.moveTo(s.left,v),l.lineTo(s.left-H,v),l.stroke()}l.beginPath(),l.strokeStyle=F.sandstone,l.lineWidth=2.5,l.lineCap="round",l.lineJoin="round",t.forEach((g,v)=>{const b=s.left+g.distance/e*r,A=n-s.bottom-(g.depth-k)/X*a;v===0?l.moveTo(b,A):l.lineTo(b,A)}),l.stroke(),l.lineTo(s.left+r,n-s.bottom),l.lineTo(s.left,n-s.bottom),l.closePath(),l.fillStyle="rgba(244, 164, 96, 0.12)",l.fill();for(const g of E.value){if(g.burial_depth==null)continue;const v=g.x,b=g.y,A=((W=pe.value.worldLine)==null?void 0:W.start)||{x:0,y:0},Q=((J=pe.value.worldLine)==null?void 0:J.end)||{x:0,y:0},p=Math.sqrt(le(Q.x-A.x,2)+le(Q.y-A.y,2));if(p===0)continue;const P=((v-A.x)*(Q.x-A.x)+(b-A.y)*(Q.y-A.y))/le(p,2),ce=A.x+P*(Q.x-A.x),S=A.y+P*(Q.y-A.y);if(Math.sqrt(le(v-ce,2)+le(b-S,2))<50&&P>=0&&P<=1){const D=s.left+P*r,ge=n-s.bottom-(g.burial_depth-k)/X*a;l.beginPath(),l.arc(D,ge,4,0,Math.PI*2),l.fillStyle=F.coal,l.fill(),l.strokeStyle="#ffffff",l.lineWidth=1.5,l.stroke(),l.fillStyle="#64748B",l.font="10px Arial, sans-serif",l.textAlign="center";const ue=g.borehole||g.name||"";ue&&l.fillText(ue,D,ge-10)}}l.fillStyle="#64748B",l.font="11px Arial, sans-serif",l.textAlign="center";for(let g=0;g<=j;g++){const v=s.left+g/j*r,b=g/j*e;l.fillText(`${b.toFixed(0)}`,v,n-15)}l.textAlign="right";for(let g=0;g<=I;g++){const v=n-s.bottom-g/I*a,b=k+g/I*X;l.fillText(`${b.toFixed(0)}`,s.left-8,v+4)}l.fillStyle="#475569",l.font="12px Arial, sans-serif",l.textAlign="center",l.fillText("å‰–é¢è·ç¦» (ç±³)",s.left+r/2,n-5),l.save(),l.translate(12,s.top+a/2),l.rotate(-Math.PI/2),l.fillText("åŸ‹è—æ·±åº¦ (ç±³)",0,0),l.restore(),l.fillStyle="#0F172A",l.font="bold 13px Arial, sans-serif",l.textAlign="left",l.fillText(`å‰–é¢ A-A' | æ·±åº¦: ${k.toFixed(1)} - ${U.toFixed(1)} ç±³`,s.left,18);const K=i-s.right-80,y=n-s.bottom+12,z=60;l.strokeStyle="#475569",l.lineWidth=2,l.beginPath(),l.moveTo(K,y),l.lineTo(K+z,y),l.stroke(),l.beginPath(),l.moveTo(K,y-3),l.lineTo(K,y+3),l.stroke(),l.beginPath(),l.moveTo(K+z,y-3),l.lineTo(K+z,y+3),l.stroke(),l.fillStyle="#64748B",l.font="10px Arial, sans-serif",l.textAlign="center",l.fillText("æ¯”ä¾‹å°º: 60ç±³",K+z/2,y+12)},G=()=>{ve.value=!1,pe.value={line:null,points:[],depthProfile:[],distance:null,hasData:!1},ye.value&&ye.value.getContext("2d").clearRect(0,0,ye.value.width,ye.value.height)},oe=()=>{var t;_e.push({name:"AcademicAlgorithm",query:(t=te.value)!=null&&t.name?{seam:te.value.name}:void 0})},re=t=>Array.isArray(t)?t[0]||"":typeof t=="string"?t:"";return ct(()=>$e(this,null,function*(){var i;yield ze();const t=re((i=M.query)==null?void 0:i.seam)||xe.selectedSeam;if(!t)return;const e=me.value.find(n=>n.name===t);e&&(yield Le(e))})),Z({resetView:()=>{G()}}),(t,e)=>{var i,n,h,l,s,r,a,d,k,U,X,F,R,f,ae,j,I,H,K,y,z,W,J,g;return w(),B("div",oo,[o("div",lo,[o("div",null,[e[4]||(e[4]=o("h2",null,"æ’å€¼åˆ†æ",-1)),o("div",so,_(((i=te.value)==null?void 0:i.name)||"é€‰æ‹©ç…¤å±‚è¿›è¡Œç©ºé—´æ’å€¼åˆ†æ"),1)]),te.value&&de.value?(w(),B("div",no,[o("div",ao,[e[5]||(e[5]=o("span",{class:"stat-label"},"åšåº¦èŒƒå›´",-1)),o("strong",null,_(((l=(h=(n=de.value)==null?void 0:n.thickness)==null?void 0:h.min)==null?void 0:l.toFixed(2))||"-")+" - "+_(((a=(r=(s=de.value)==null?void 0:s.thickness)==null?void 0:r.max)==null?void 0:a.toFixed(2))||"-")+" m",1)]),o("div",io,[e[6]||(e[6]=o("span",{class:"stat-label"},"å¹³å‡åšåº¦",-1)),o("strong",null,_(((U=(k=(d=de.value)==null?void 0:d.thickness)==null?void 0:k.mean)==null?void 0:U.toFixed(2))||"-")+" m",1)]),o("div",ro,[e[7]||(e[7]=o("span",{class:"stat-label"},"é’»å­”æ•°é‡",-1)),o("strong",null,_(((X=de.value)==null?void 0:X.borehole_count)||E.value.length||"-"),1)])])):ee("",!0)]),te.value?(w(),B("div",ko,[o("div",_o,[e[17]||(e[17]=We('<h3 class="section-title" data-v-ead2c257><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-ead2c257><circle cx="12" cy="12" r="3" data-v-ead2c257></circle><path d="M12 1v6m0 6v6" data-v-ead2c257></path><path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24" data-v-ead2c257></path><path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24" data-v-ead2c257></path></svg> æ’å€¼å‚æ•° </h3>',1)),o("div",So,[e[11]||(e[11]=o("label",{class:"param-label"},"æ’å€¼æ–¹æ³•",-1)),o("div",wo,[(w(),B(Oe,null,qe(je,v=>o("button",{key:v.key,class:et(["tab-btn",{active:ne.value===v.key}]),onClick:b=>ne.value=v.key},_(v.label),11,Mo)),64))])]),o("div",To,[o("div",Co,[e[12]||(e[12]=o("label",{class:"param-label"},"ç½‘æ ¼å¯†åº¦",-1)),o("span",Fo,_(be.value),1)]),Qe(o("input",{"onUpdate:modelValue":e[0]||(e[0]=v=>be.value=v),type:"range",min:"30",max:"150",step:"10",class:"slider"},null,512),[[nt,be.value,void 0,{number:!0}]]),e[13]||(e[13]=o("div",{class:"slider-labels"},[o("span",null,"ç²—"),o("span",null,"ç»†")],-1))]),o("div",Ao,[o("div",Po,[e[14]||(e[14]=o("label",{class:"param-label"},"ç­‰å€¼çº¿çº§åˆ«",-1)),o("span",Bo,_(ke.value),1)]),Qe(o("input",{"onUpdate:modelValue":e[1]||(e[1]=v=>ke.value=v),type:"range",min:"5",max:"20",step:"1",class:"slider"},null,512),[[nt,ke.value,void 0,{number:!0}]]),e[15]||(e[15]=o("div",{class:"slider-labels"},[o("span",null,"å°‘"),o("span",null,"å¤š")],-1))]),u.value?(w(),B("div",$o,[o("label",Wo,[Qe(o("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=v=>ve.value=v)},null,512),[[yt,ve.value]]),e[16]||(e[16]=o("span",null,"ç»˜åˆ¶å‰–é¢çº¿",-1))]),ve.value?(w(),B("p",Ro,"åœ¨åœ°å›¾ä¸Šç‚¹å‡»ä¸¤ç‚¹ç»˜åˆ¶å‰–é¢çº¿")):ee("",!0)])):ee("",!0),o("div",Do,[o("button",{class:"btn primary",onClick:Be,disabled:V.value},[V.value?(w(),B("span",Eo)):ee("",!0),Ve(" "+_(V.value?"è®¡ç®—ä¸­...":"ç”Ÿæˆç­‰å€¼çº¿å›¾"),1)],8,Io),o("button",{class:"btn outline",onClick:e[3]||(e[3]=v=>{te.value=null,u.value=null,O.value=null})}," æ›´æ¢ç…¤å±‚ "),u.value||O.value?(w(),B("button",{key:0,class:"btn outline",onClick:oe}," ä¸‹ä¸€æ­¥ï¼šæ–°ç®—æ³•åŸç† ")):ee("",!0)])]),o("div",Yo,[e[25]||(e[25]=We('<h3 class="section-title" data-v-ead2c257><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-ead2c257><line x1="18" y1="20" x2="18" y2="10" data-v-ead2c257></line><line x1="12" y1="20" x2="12" y2="4" data-v-ead2c257></line><line x1="6" y1="20" x2="6" y2="14" data-v-ead2c257></line></svg> æ•°æ®åˆ†å¸ƒ </h3>',1)),E.value.length>0?(w(),B("div",Xo,[o("canvas",{ref_key:"histogramCanvas",ref:Fe,class:"histogram-canvas"},null,512)])):(w(),B("div",zo,[...e[18]||(e[18]=[o("p",null,"æš‚æ— æ•°æ®åˆ†å¸ƒ",-1)])])),E.value.length>0?(w(),B("div",Lo,[o("div",Ho,[e[19]||(e[19]=o("span",{class:"stat-label"},"æ ·æœ¬æ•°",-1)),o("span",Uo,_(E.value.length),1)]),o("div",No,[e[20]||(e[20]=o("span",{class:"stat-label"},"å‡å€¼",-1)),o("span",Vo,_(Ae().toFixed(2))+"m",1)]),o("div",Oo,[e[21]||(e[21]=o("span",{class:"stat-label"},"æ ‡å‡†å·®",-1)),o("span",qo,_(Ye().toFixed(2))+"m",1)]),o("div",jo,[e[22]||(e[22]=o("span",{class:"stat-label"},"å˜å¼‚ç³»æ•°",-1)),o("span",Ko,_(Pe().toFixed(2)),1)]),o("div",Jo,[e[23]||(e[23]=o("span",{class:"stat-label"},"æœ€å°å€¼",-1)),o("span",Zo,_(Xe().min.toFixed(2))+"m",1)]),o("div",Go,[e[24]||(e[24]=o("span",{class:"stat-label"},"æœ€å¤§å€¼",-1)),o("span",Qo,_(Xe().max.toFixed(2))+"m",1)])])):ee("",!0)]),o("div",el,[e[26]||(e[26]=We('<h3 class="section-title" data-v-ead2c257><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-ead2c257><path d="M12 2L2 7l10 5 10-5-10-5z" data-v-ead2c257></path><path d="m2 17 10 5 10-5" data-v-ead2c257></path><path d="m2 12 10 5 10-5" data-v-ead2c257></path></svg> åœ°å±‚æŸ±çŠ¶å›¾ </h3>',1)),o("div",tl,[o("canvas",{ref_key:"stratigraphicCanvas",ref:De,class:"stratigraphic-canvas"},null,512)]),o("div",ol,[(w(),B(Oe,null,qe(Ke,(v,b)=>o("div",{key:b,class:"legend-item-compact"},[o("div",{class:"legend-color",style:Re({background:v})},null,4),o("span",ll,_(b),1)])),64))])]),u.value||O.value?(w(),B("div",sl,[u.value?(w(),B("div",nl,[o("div",al,[o("div",null,[e[27]||(e[27]=o("h3",{class:"section-title"},[o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"})]),Ve(" ç…¤å±‚åšåº¦åˆ†å¸ƒ ")],-1)),o("p",il,_(Ee(ne.value))+" Â· "+_((f=(R=(F=u.value)==null?void 0:F.valueRange)==null?void 0:R.min)==null?void 0:f.toFixed(1))+" - "+_((I=(j=(ae=u.value)==null?void 0:ae.valueRange)==null?void 0:j.max)==null?void 0:I.toFixed(1))+" m",1)])]),o("div",rl,[u.value?(w(),at(rt,{key:0,"image-url":u.value.imageUrl,boreholes:E.value,bounds:u.value.bounds,property:"thickness","property-label":"åšåº¦","value-range":u.value.valueRange,colormap:"YlOrBr","cross-section-mode":ve.value,onCrossSectionComplete:x},null,8,["image-url","boreholes","bounds","value-range","cross-section-mode"])):(w(),B("div",cl,[...e[28]||(e[28]=[o("p",null,'è®¾ç½®å‚æ•°åç‚¹å‡»"ç”Ÿæˆç­‰å€¼çº¿å›¾"',-1)])]))])])):ee("",!0),O.value?(w(),B("div",dl,[o("div",ul,[o("div",null,[e[29]||(e[29]=o("h3",{class:"section-title"},[o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o("path",{d:"m2 17 10 5 10-5"})]),Ve(" ç…¤å±‚åŸ‹æ·±åˆ†å¸ƒ ")],-1)),o("p",hl,_(Ee(ne.value))+" Â· "+_((y=(K=(H=O.value)==null?void 0:H.valueRange)==null?void 0:K.min)==null?void 0:y.toFixed(1))+" - "+_((J=(W=(z=O.value)==null?void 0:z.valueRange)==null?void 0:W.max)==null?void 0:J.toFixed(1))+" m",1)])]),o("div",vl,[O.value?(w(),at(rt,{key:0,"image-url":O.value.imageUrl,boreholes:E.value,bounds:O.value.bounds,property:"burial_depth","property-label":"åŸ‹æ·±","value-range":O.value.valueRange,colormap:"viridis","cross-section-mode":ve.value,onCrossSectionComplete:x},null,8,["image-url","boreholes","bounds","value-range","cross-section-mode"])):(w(),B("div",gl,[...e[30]||(e[30]=[o("p",null,'è®¾ç½®å‚æ•°åç‚¹å‡»"ç”Ÿæˆç­‰å€¼çº¿å›¾"',-1)])]))])])):ee("",!0)])):ee("",!0),u.value?(w(),B("div",fl,[e[31]||(e[31]=We('<div class="map-header" data-v-ead2c257><div data-v-ead2c257><h3 class="section-title" data-v-ead2c257><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-ead2c257><circle cx="12" cy="12" r="10" data-v-ead2c257></circle><line x1="12" y1="8" x2="12" y2="12" data-v-ead2c257></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-ead2c257></line></svg> æ’å€¼ä¸ç¡®å®šæ€§åˆ†å¸ƒ </h3><p class="section-desc" data-v-ead2c257>çº¢è‰²åŒºåŸŸè¡¨ç¤ºé«˜ä¸ç¡®å®šæ€§ï¼Œè“è‰²åŒºåŸŸæ›´å¯é </p></div></div>',1)),o("div",ml,[o("canvas",{ref_key:"uncertaintyCanvas",ref:Ie,class:"uncertainty-canvas"},null,512)])])):ee("",!0),pe.value.hasData?(w(),B("div",pl,[o("div",yl,[o("div",null,[o("h3",xl,[e[32]||(e[32]=o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("path",{d:"M3 3v18h18"}),o("path",{d:"m19 9-5 5-4-4-3 3"})],-1)),e[33]||(e[33]=Ve(" å‰–é¢åˆ‡ç‰‡ (A-A') ",-1)),o("span",bl,_((g=pe.value.distance)==null?void 0:g.toFixed(0))+"m",1)])]),o("button",{class:"btn outline small",onClick:G},"é‡ç½®")]),o("div",kl,[o("canvas",{ref_key:"crossSectionCanvas",ref:ye,class:"cross-section-canvas"},null,512)])])):ee("",!0)])):(w(),B("div",co,[e[10]||(e[10]=We('<h3 class="section-title" data-v-ead2c257><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-ead2c257><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-ead2c257></rect><line x1="3" y1="9" x2="21" y2="9" data-v-ead2c257></line><line x1="9" y1="21" x2="9" y2="9" data-v-ead2c257></line></svg> é€‰æ‹©åˆ†æç…¤å±‚ </h3><p class="section-desc" data-v-ead2c257>ä»ä»¥ä¸‹å¯ç”¨ç…¤å±‚ä¸­é€‰æ‹©ä¸€ä¸ªè¿›è¡Œæ’å€¼åˆ†æ</p>',2)),o("div",uo,[(w(!0),B(Oe,null,qe(me.value,v=>{var b,A,Q,p,P;return w(),B("div",{key:v.name,class:"seam-selection-card",onClick:ce=>Le(v)},[o("div",vo,[o("span",go,_(v.name),1),o("span",fo,_(v.borehole_count)+" ä¸ªé’»å­”",1)]),o("div",mo,[o("div",po,[e[8]||(e[8]=o("span",{class:"mini-stat-label"},"å¹³å‡åšåº¦",-1)),o("span",yo,_((b=v.avg_thickness)==null?void 0:b.toFixed(2))+" m",1)]),o("div",xo,[e[9]||(e[9]=o("span",{class:"mini-stat-label"},"åšåº¦èŒƒå›´",-1)),o("span",bo,_((Q=(A=v.thickness_range)==null?void 0:A.min)==null?void 0:Q.toFixed(1))+"-"+_((P=(p=v.thickness_range)==null?void 0:p.max)==null?void 0:P.toFixed(1))+" m",1)])])],8,ho)}),128))])]))])}}},Al=dt(_l,[["__scopeId","data-v-ead2c257"]]);export{Al as default};
