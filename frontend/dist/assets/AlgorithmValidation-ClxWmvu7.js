var Xn=Object.defineProperty,Jn=Object.defineProperties;var Kn=Object.getOwnPropertyDescriptors;var un=Object.getOwnPropertySymbols;var Qn=Object.prototype.hasOwnProperty,eo=Object.prototype.propertyIsEnumerable;var dn=Math.pow,cn=(g,Q,w)=>Q in g?Xn(g,Q,{enumerable:!0,configurable:!0,writable:!0,value:w}):g[Q]=w,ee=(g,Q)=>{for(var w in Q||(Q={}))Qn.call(Q,w)&&cn(g,w,Q[w]);if(un)for(var w of un(Q))eo.call(Q,w)&&cn(g,w,Q[w]);return g},te=(g,Q)=>Jn(g,Kn(Q));var we=(g,Q,w)=>new Promise((Ne,f)=>{var ve=z=>{try{q(w.next(z))}catch(s){f(s)}},b=z=>{try{q(w.throw(z))}catch(s){f(s)}},q=z=>z.done?Ne(z.value):Promise.resolve(z.value).then(ve,b);q((w=w.apply(g,Q)).next())});import{_ as Ht,u as to,b as no}from"./index-DAAno9XI.js";import{r as Mt,bB as oo,bC as lo,bA as ao,bf as hn,n as jt,w as Be,b4 as bn,b5 as J,b8 as K,bn as vt,b as Z,c as p,b7 as o,bb as v,bi as pe,ba as Ke,bj as Re,u as so,br as De,bu as mn,bc as Je,b9 as Ut,bo as ze,bs as st,bt as pn,bm as vn,bh as Vt,bx as Gt,a as ro}from"./vendor-CcQzWQKD.js";import{a as io,u as uo}from"./vue-router-4_hPxHr_.js";import{a as co,v as mo,w as po,x as vo,d as fo,r as yo}from"./api-PFloj90e.js";import"./echarts-BS5jjEhw.js";import{i as ho}from"./echarts-GqT7NaNy.js";import"./network-T6nY3V_4.js";function bo(){const g=Mt({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),Q=(z,s,y)=>{if(!y)return{x:0,y:0};const c=z-y.min_x,A=y.max_y-s;return{x:c*g.scale+g.x,y:A*g.scale+g.y}},w=(z,s,y)=>{if(!y||g.scale===0)return{x:0,y:0};const c=(z-g.x)/g.scale,A=(s-g.y)/g.scale;return{x:y.min_x+c,y:y.max_y-A}};return{viewport:g,worldToScreen:Q,screenToWorld:w,fitToBounds:(z,s,y,c=56)=>{if(!z||!s||!y)return;const A=Math.max(z.max_x-z.min_x,1e-6),B=Math.max(z.max_y-z.min_y,1e-6),k=Math.min((s-c*2)/A,(y-c*2)/B),R=(z.min_x+z.max_x)/2,$=(z.min_y+z.max_y)/2;g.scale=Math.max(.01,k),g.x=s/2-(R-z.min_x)*g.scale,g.y=y/2-(z.max_y-$)*g.scale},startDrag:(z,s)=>{g.isDragging=!0,g.lastX=z,g.lastY=s},dragTo:(z,s)=>{g.isDragging&&(g.x+=z-g.lastX,g.y+=s-g.lastY,g.lastX=z,g.lastY=s)},endDrag:()=>{g.isDragging=!1},zoomAt:(z,s,y,c,A=.1,B=50)=>{if(!c)return;const k=Math.max(A,Math.min(B,g.scale*z));if(k===g.scale)return;const R=w(s,y,c);g.scale=k,g.x=s-(R.x-c.min_x)*g.scale,g.y=y-(c.max_y-R.y)*g.scale}}}const fn={mpi:["#0e7490","#14b8a6","#facc15","#fb923c","#dc2626"],rsi:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],bri:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],asi:["#0e7490","#14b8a6","#84cc16","#f59e0b","#dc2626"]},Wt=g=>Math.max(0,Math.min(1,g)),go=g=>{const w=String(g||"").match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return w?{r:Number(w[1]),g:Number(w[2]),b:Number(w[3])}:null},xo=(g,Q=.8)=>{const w=go(g);if(!w)return"#94a3b8";const Ne=Math.round(w.r*.299+w.g*.587+w.b*.114),f=Math.round(Ne*Q+235*(1-Q));return`rgb(${f},${f},${f})`},yn=g=>{var Ne,f;const Q=Number((Ne=g==null?void 0:g.min)!=null?Ne:0),w=Number((f=g==null?void 0:g.max)!=null?f:100);return!Number.isFinite(Q)||!Number.isFinite(w)||Q===w?{min:0,max:100}:{min:Q,max:w}};function wo(){const g=s=>fn[s]||fn.mpi,Q=s=>`linear-gradient(90deg, ${g(s).join(",")})`,w=(s,y,c)=>{const{min:A,max:B}=yn(c),k=Wt((Number(y)-A)/(B-A));return oo(g(s))(k)},Ne=(s,y,c,A,B,k,R={})=>{var H;const $=y.length,Y=((H=y[0])==null?void 0:H.length)||0;if($<2||Y<2)return;const ue=new Array($*Y);let j=0;for(let N=0;N<$;N+=1)for(let G=0;G<Y;G+=1)ue[j]=Number(y[N][G]||0),j+=1;const{min:X,max:fe}=yn(B),ye=Math.max(5,Number(R.contourLevels||9)),re=lo(X,fe,ye).slice(1,-1);if(!re.length)return;const he=ao().size([Y,$]).thresholds(re)(ue),ge=Math.max(c.max_x-c.min_x,1e-6),ce=Math.max(c.max_y-c.min_y,1e-6);s.save(),s.strokeStyle=R.contourColor||"rgba(15,23,42,0.32)",s.lineWidth=A.scale>2?1.2:.9,s.globalAlpha=A.scale<.65?.45:.7;for(const N of he)for(const G of N.coordinates)for(const ke of G)if(!(!Array.isArray(ke)||ke.length<2)){s.beginPath();for(let de=0;de<ke.length;de+=1){const Ce=ke[de],Pe=c.min_x+Ce[0]/Math.max(Y-1,1)*ge,ne=c.max_y-Ce[1]/Math.max($-1,1)*ce,Ie=k(Pe,ne,c);de===0?s.moveTo(Ie.x,Ie.y):s.lineTo(Ie.x,Ie.y)}s.closePath(),s.stroke()}s.restore()};return{getLegendGradient:Q,drawGrid:(s,y,c,A,B,k,R,$={})=>{var ge;if(!s||!Array.isArray(y)||y.length===0||!c)return;const Y=y.length,ue=((ge=y[0])==null?void 0:ge.length)||0;if(!ue)return;const j=c.max_x-c.min_x,X=c.max_y-c.min_y,fe=j/ue,ye=X/Y,re=s.canvas.width,he=s.canvas.height;for(let ce=0;ce<Y;ce+=1){const H=y[ce],N=c.max_y-ce*ye;for(let G=0;G<ue;G+=1){const ke=c.min_x+G*fe,de=R(ke,N,c),Ce=R(ke+fe,N-ye,c),Pe=Math.min(de.x,Ce.x),ne=Math.min(de.y,Ce.y),Ie=Math.abs(Ce.x-de.x)+.8,O=Math.abs(Ce.y-de.y)+.8;Pe>re||Pe+Ie<0||ne>he||ne+O<0||(s.fillStyle=w(B,Number(H[G]||0),k),s.fillRect(Pe,ne,Ie,O))}}if($.showContours!==!1&&Ne(s,y,c,A,k,R,$),A.scale>3.2){s.strokeStyle="rgba(255,255,255,0.18)",s.lineWidth=1,s.beginPath();for(let ce=0;ce<=Y;ce+=1){const H=c.max_y-ce*ye,N=R(c.min_x,H,c),G=R(c.max_x,H,c);s.moveTo(N.x,N.y),s.lineTo(G.x,G.y)}for(let ce=0;ce<=ue;ce+=1){const H=c.min_x+ce*fe,N=R(H,c.min_y,c),G=R(H,c.max_y,c);s.moveTo(N.x,N.y),s.lineTo(G.x,G.y)}s.stroke()}},drawBoreholes:(s,y,c,A,B,k,R="",$=null)=>{if(!s||!Array.isArray(y)||!B)return;const Y=!!($!=null&&$.active&&($==null?void 0:$.indexSet)instanceof Set&&$.indexSet.size>0),ue=String(($==null?void 0:$.accent)||"#111827"),j=!!($!=null&&$.animate),X=Number(($==null?void 0:$.pulseT)||0);for(let fe=0;fe<y.length;fe+=1){const ye=y[fe],re=k(ye.x,ye.y,B),he=R&&R===ye.borehole_name,ge=!Y||$.indexSet.has(fe),ce=j&&Y&&ge?(Math.sin(X*5+fe*.35)+1)/2:0,H=he?7.5:ge&&Y?6.6:5.8;s.save();const N=w(c,ye[c],A);s.globalAlpha=Y&&!ge?.24:1,s.fillStyle=Y&&!ge?xo(N,.84):N,s.strokeStyle=he?"#111827":ge&&Y?ue:"rgba(255,255,255,0.95)",s.lineWidth=he?2.4:1.8,s.beginPath(),s.arc(re.x,re.y,H,0,Math.PI*2),s.fill(),s.stroke(),ge&&Y&&!he&&(s.globalAlpha=.95,s.strokeStyle=ue,s.lineWidth=2,s.beginPath(),s.arc(re.x,re.y,H+3.6,0,Math.PI*2),s.stroke(),j&&(s.globalAlpha=.35+ce*.45,s.lineWidth=1.6+ce*.9,s.beginPath(),s.arc(re.x,re.y,H+6+ce*5.5,0,Math.PI*2),s.stroke())),s.restore()}},pickNearestBorehole:(s,y,c,A,B,k=14)=>{if(!Array.isArray(c)||!A)return null;let R=null,$=Number.POSITIVE_INFINITY;for(const Y of c){const ue=B(Y.x,Y.y,A),j=Math.hypot(s-ue.x,y-ue.y);j<$&&($=j,R=Y)}return $<=k?R:null},sampleGridValue:(s,y,c,A)=>{var j;if(!Array.isArray(s)||s.length===0||!y)return null;const B=s.length,k=((j=s[0])==null?void 0:j.length)||0;if(!k)return null;const R=Wt((c-y.min_x)/Math.max(y.max_x-y.min_x,1e-6)),$=Wt((y.max_y-A)/Math.max(y.max_y-y.min_y,1e-6)),Y=Math.max(0,Math.min(k-1,Math.floor(R*(k-1)))),ue=Math.max(0,Math.min(B-1,Math.floor($*(B-1))));return Number(s[ue][Y])},drawMiniHeatmap:(s,y,c,A)=>{var fe;if(!s||!Array.isArray(y)||y.length===0)return;const B=window.devicePixelRatio||1,k=s.clientWidth||150,R=s.clientHeight||110;s.width=Math.round(k*B),s.height=Math.round(R*B);const $=s.getContext("2d");$.setTransform(B,0,0,B,0,0),$.clearRect(0,0,k,R);const Y=y.length,ue=((fe=y[0])==null?void 0:fe.length)||0;if(!ue)return;const j=k/ue,X=R/Y;for(let ye=0;ye<Y;ye+=1)for(let re=0;re<ue;re+=1)$.fillStyle=w(c,Number(y[ye][re]||0),A),$.fillRect(re*j,ye*X,j+.4,X+.4);$.strokeStyle="rgba(255,255,255,0.35)",$.strokeRect(0,0,k,R)}}}const _o={__name:"ScienceChart",props:{option:{type:Object,required:!0},height:{type:[String,Number],default:320}},emits:["chart-click"],setup(g,{emit:Q}){const w=g,Ne=Q,f=Z(null);let ve=null,b=null;const q=p(()=>typeof w.height=="number"?`${w.height}px`:w.height),z=()=>{ve&&ve.setOption(w.option||{},{notMerge:!0,lazyUpdate:!0,silent:!0})},s=()=>{ve&&ve.resize()},y=B=>{Ne("chart-click",B)},c=()=>{if(f.value){if(typeof ResizeObserver!="undefined"){b=new ResizeObserver(()=>{s()}),b.observe(f.value);return}window.addEventListener("resize",s)}},A=()=>{b?(b.disconnect(),b=null):window.removeEventListener("resize",s)};return hn(()=>we(this,null,function*(){yield jt(),f.value&&(ve=ho(f.value,null,{renderer:"canvas"}),ve.on("click",y),z(),c())})),Be(()=>w.option,()=>{z()}),Be(()=>w.height,()=>we(this,null,function*(){yield jt(),s()})),bn(()=>{A(),ve&&(ve.off("click",y),ve.dispose(),ve=null)}),(B,k)=>(J(),K("div",{ref_key:"container",ref:f,class:"science-chart",style:vt({height:q.value})},null,4))}},Ee=Ht(_o,[["__scopeId","data-v-40fa2a4e"]]),So={class:"science-gallery"},ko={class:"gallery-head"},Co={class:"head-metrics"},Ao={class:"metric-chip"},No={class:"metric-chip"},Mo={key:0,class:"metric-chip"},Io={key:1,class:"metric-chip"},$o={class:"figure-card"},Ro={class:"caption meta"},Po={class:"figure-card"},Fo={class:"caption meta"},To={class:"figure-card"},Lo={class:"caption meta"},zo={class:"figure-card"},Do={class:"caption meta"},Eo={class:"figure-card"},Bo={class:"caption meta"},Oo={class:"figure-card"},Uo={class:"caption meta"},Vo={class:"figure-card"},Go={class:"caption meta"},Wo={class:"figure-card"},jo={class:"caption meta"},Ho={class:"figure-card"},qo={class:"caption meta"},Yo={class:"figure-card"},Zo={class:"caption meta"},_e="'Times New Roman', 'Noto Serif SC', 'Source Han Serif SC', serif",Xo={__name:"ValidationScienceFigures",props:{result:{type:Object,default:null},evaluation:{type:Object,default:null}},emits:["matrix-select"],setup(g,{emit:Q}){const w=g,Ne=Q,f={blue:"#1d4ed8",cyan:"#0891b2",green:"#15803d",orange:"#d97706",red:"#b91c1c",purple:"#7c3aed",slate:"#475569"},ve={left:66,right:26,top:46,bottom:62},b=(t,n,a)=>Math.max(n,Math.min(a,t)),q=(t,n=0)=>{const a=Number(t);return Number.isFinite(a)?a:n},z=t=>`${(b(q(t,0),0,1)*100).toFixed(1)}%`,s=(t,n=3)=>Number(q(t,0).toFixed(n)),y=(t,n,a=0)=>n>0?t/n:a,c=(t,n=!0)=>({type:n?"value":"category",name:t,nameLocation:"middle",nameGap:38,nameTextStyle:{fontFamily:_e,fontSize:12,color:"#0f172a"},axisLabel:{fontFamily:_e,fontSize:11,color:"#0f172a"},axisLine:{lineStyle:{color:"#0f172a",width:1.15}},axisTick:{lineStyle:{color:"#334155",width:1}},splitLine:{show:!0,lineStyle:{color:"#e2e8f0",width:.8,type:"dashed"}}}),A={top:6,textStyle:{fontFamily:_e,fontSize:11,color:"#0f172a"}},B={right:8,top:6,itemSize:14,iconStyle:{borderColor:"#334155"},feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"框选缩放",back:"还原缩放"}},restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}},k=[{type:"inside",xAxisIndex:0,filterMode:"none",zoomOnMouseWheel:"ctrl",moveOnMouseMove:!0}],R=p(()=>{var t;return((t=w.result)==null?void 0:t.evaluation_inputs)||{}}),$=p(()=>{var n,a;const t=((n=R.value)==null?void 0:n.mode)||((a=R.value)==null?void 0:a.source)||"pseudo_threshold";return String(t)}),Y=p(()=>{var t,n;return String(((t=R.value)==null?void 0:t.source)||((n=R.value)==null?void 0:n.sourceFile)||"")}),ue=p(()=>$.value==="real_label_stream"?"真实标签流":$.value==="pseudo_threshold"?"伪标签估计":"未知"),j=p(()=>{var d,C,T,U;const t=Array.isArray((d=R.value)==null?void 0:d.y_true)?R.value.y_true:Array.isArray((C=R.value)==null?void 0:C.yTrue)?R.value.yTrue:[],n=Array.isArray((T=R.value)==null?void 0:T.y_prob)?R.value.y_prob:Array.isArray((U=R.value)==null?void 0:U.yProb)?R.value.yProb:[],a=Math.min(t.length,n.length),u=[];for(let W=0;W<a;W+=1){const P=q(t[W],0)>=1?1:0,M=b(q(n[W],0),0,1);u.push({y:P,p:M})}return u}),X=p(()=>j.value.length),fe=p(()=>j.value.filter(t=>t.y===1).length),ye=p(()=>X.value-fe.value),re=p(()=>y(fe.value,Math.max(X.value,1),0)),he=p(()=>X.value>=6&&fe.value>0&&ye.value>0),ge=p(()=>{const t=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const n of j.value)t.push(Number(n.p.toFixed(3)));return Array.from(new Set(t.map(n=>b(n,0,1)))).sort((n,a)=>a-n)}),ce=t=>{let n=0,a=0,u=0,d=0;for(const V of j.value){const oe=V.p>=t?1:0;V.y===1&&oe===1?n+=1:V.y===1&&oe===0?d+=1:V.y===0&&oe===1?a+=1:u+=1}const C=y(n,n+d,0),T=y(n,n+a,0),U=y(u,u+a,0),W=y(a,a+u,0),P=y(n+u,n+u+a+d,0),M=y(2*T*C,T+C,0);return{threshold:t,tp:n,fp:a,tn:u,fn:d,recall:C,precision:T,specificity:U,fpr:W,accuracy:P,f1:M}},H=p(()=>ge.value.map(t=>ce(t))),N=p(()=>{if(!he.value)return[[0,0],[.06,.28],[.15,.54],[.33,.75],[.56,.89],[1,1]];const t=H.value.map(n=>[n.fpr,n.recall]);return t.push([0,0],[1,1]),t.sort((n,a)=>n[0]-a[0]||n[1]-a[1]),t}),G=p(()=>{if(!he.value)return[[0,1],[.15,.9],[.35,.82],[.55,.73],[.75,.61],[1,.5]];const t=H.value.map(n=>[n.recall,n.precision]);return t.push([0,1],[1,re.value]),t.sort((n,a)=>n[0]-a[0]||a[1]-n[1]),t}),ke=t=>{let n=0;for(let a=1;a<t.length;a+=1){const[u,d]=t[a-1],[C,T]=t[a];n+=(C-u)*((d+T)/2)}return b(n,0,1)},de=(t,n,a=0)=>{const u=t.filter(W=>Number.isFinite(W)).slice().sort((W,P)=>W-P);if(!u.length)return a;const d=b(n,0,1)*(u.length-1),C=Math.floor(d),T=Math.min(u.length-1,C+1),U=d-C;return u[C]*(1-U)+u[T]*U},Ce=(t,n)=>{if(!Array.isArray(t)||t.length===0)return 0;if(t.length===1||n<=t[0][0])return b(q(t[0][1],0),0,1);for(let a=1;a<t.length;a+=1){const[u,d]=t[a-1],[C,T]=t[a];if(n<=C){if(Math.abs(C-u)<1e-12)return b(Math.max(d,T),0,1);const U=(n-u)/(C-u);return b(d+(T-d)*U,0,1)}}return b(q(t[t.length-1][1],0),0,1)},Pe=t=>{const n=t.length,a=t.reduce((P,M)=>P+(M.y>=1?1:0),0),u=n-a;if(n<2||a<=0||u<=0)return{roc:[[0,0],[1,1]],pr:[[0,1],[1,b(y(a,Math.max(n,1),0),0,1)]],auc:.5,prAuc:.5};const d=[1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0];for(const P of t)d.push(Number(P.p.toFixed(3)));const C=Array.from(new Set(d.map(P=>b(P,0,1)))).sort((P,M)=>M-P),T=[],U=[];for(const P of C){let M=0,V=0,oe=0,m=0;for(const ie of t){const D=ie.p>=P?1:0;ie.y===1&&D===1?M+=1:ie.y===1&&D===0?m+=1:ie.y===0&&D===1?V+=1:oe+=1}const E=y(M,M+m,0),le=y(M,M+V,0),ae=y(V,V+oe,0);T.push([ae,E]),U.push([E,le])}T.push([0,0],[1,1]),T.sort((P,M)=>P[0]-M[0]||P[1]-M[1]);const W=b(y(a,n,0),0,1);return U.push([0,1],[1,W]),U.sort((P,M)=>P[0]-M[0]||M[1]-P[1]),{roc:T,pr:U,auc:ke(T),prAuc:ke(U)}},ne=p(()=>{let t=2166136261;for(let n=0;n<j.value.length;n+=1){const a=j.value[n],u=a.y>=1?1:0,d=Math.round(b(a.p,0,1)*1e3);t^=u*733+d*31+n*131>>>0,t=Math.imul(t,16777619)>>>0}return t||1315423911}),Ie=p(()=>he.value?X.value<=60?240:X.value<=180?180:120:0),O=p(()=>{if(!he.value)return null;const t=j.value.length,n=Ie.value;if(n<=0||t<6)return null;const a=Array.from({length:21},(m,E)=>E/20),u=a.map(()=>[]),d=a.map(()=>[]),C=[],T=[];let U=ne.value>>>0;const W=()=>{U+=1831565813;let m=U;return m=Math.imul(m^m>>>15,m|1),m^=m+Math.imul(m^m>>>7,m|61),((m^m>>>14)>>>0)/4294967296};for(let m=0;m<n;m+=1){const E=[];for(let ae=0;ae<t;ae+=1)E.push(j.value[Math.floor(W()*t)]);const le=Pe(E);C.push(le.auc),T.push(le.prAuc);for(let ae=0;ae<a.length;ae+=1){const ie=a[ae];u[ae].push(Ce(le.roc,ie)),d[ae].push(Ce(le.pr,ie))}}const P=u.map(m=>de(m,.025,0)),M=u.map(m=>de(m,.975,1)),V=d.map(m=>de(m,.025,0)),oe=d.map(m=>de(m,.975,1));return{iterations:n,grid:a,rocLow:P,rocHigh:M,prLow:V,prHigh:oe,aucLow:b(de(C,.025,Fe.value),0,1),aucHigh:b(de(C,.975,Fe.value),0,1),prAucLow:b(de(T,.025,Ae.value),0,1),prAucHigh:b(de(T,.975,Ae.value),0,1)}}),Ge=p(()=>O.value?{low:O.value.grid.map((t,n)=>[t,O.value.rocLow[n]]),high:O.value.grid.map((t,n)=>[t,O.value.rocHigh[n]])}:{low:[],high:[]}),Qe=p(()=>O.value?O.value.grid.map((t,n)=>[t,Math.max(O.value.rocHigh[n]-O.value.rocLow[n],0)]):[]),xe=p(()=>O.value?{low:O.value.grid.map((t,n)=>[t,O.value.prLow[n]]),high:O.value.grid.map((t,n)=>[t,O.value.prHigh[n]])}:{low:[],high:[]}),be=p(()=>O.value?O.value.grid.map((t,n)=>[t,Math.max(O.value.prHigh[n]-O.value.prLow[n],0)]):[]),et=p(()=>ke(N.value)),rt=p(()=>ke(G.value)),tt=p(()=>he.value?H.value.reduce((t,n)=>{const a=n.recall-n.fpr;return a>t.j?te(ee({},n),{j:a}):t},{threshold:.5,fpr:1,recall:0,j:-1}):{threshold:.5,fpr:.22,recall:.78,j:.56}),We=p(()=>he.value?H.value.reduce((t,n)=>n.f1>t.f1?n:t,H.value[0]||{threshold:.5,recall:0,precision:0,f1:0}):{threshold:.5,recall:.74,precision:.78,f1:.76}),it=p(()=>{if(!j.value.length)return .25;const t=j.value.reduce((n,a)=>n+dn(a.p-a.y,2),0);return b(t/j.value.length,0,1)}),Oe=p(()=>{if(!he.value)return{centers:[.1,.22,.34,.46,.58,.7,.82,.94],pred:[.11,.23,.36,.45,.57,.69,.8,.9],obs:[.14,.2,.31,.49,.55,.63,.78,.89],lower:[.04,.08,.19,.31,.39,.47,.63,.74],band:[.2,.24,.24,.18,.16,.16,.15,.15],count:[4,6,8,11,12,10,7,5],ece:.043};const t=8,n=Array.from({length:t+1},(m,E)=>E/t),a=Array.from({length:t},()=>0),u=Array.from({length:t},()=>0),d=Array.from({length:t},()=>0);for(const m of j.value){const E=Math.min(t-1,Math.floor(m.p*t));a[E]+=1,u[E]+=m.p,d[E]+=m.y}const C=[],T=[],U=[],W=[],P=[],M=[];for(let m=0;m<t;m+=1){if(a[m]<=0)continue;const E=u[m]/a[m],le=d[m]/a[m],ae=1.96*Math.sqrt(y(le*(1-le),a[m],0)),ie=b(le-ae,0,1),D=b(le+ae,0,1);C.push((n[m]+n[m+1])/2),T.push(E),U.push(le),W.push(ie),P.push(D-ie),M.push(a[m])}const V=Math.max(j.value.length,1),oe=T.reduce((m,E,le)=>m+Math.abs(E-U[le])*M[le],0)/V;return{centers:C,pred:T,obs:U,lower:W,band:P,count:M,ece:oe}}),Fe=p(()=>{var a,u,d;const t=q((a=w.evaluation)==null?void 0:a.auc,NaN);if(!Number.isNaN(t)&&t>0)return b(t,.5,1);const n=q((d=(u=w.result)==null?void 0:u.kpi)==null?void 0:d.auc,NaN);return!Number.isNaN(n)&&n>0?b(n,.5,1):b(et.value,.5,1)}),Ae=p(()=>{var n;const t=q((n=w.evaluation)==null?void 0:n.pr_auc,NaN);return!Number.isNaN(t)&&t>0?b(t,.4,1):b(rt.value,.4,1)}),je=p(()=>{var a,u,d;const t=q((a=w.evaluation)==null?void 0:a.brier,NaN);if(!Number.isNaN(t)&&t>=0)return b(t,0,1);const n=q((d=(u=w.result)==null?void 0:u.kpi)==null?void 0:d.brier_score,NaN);return!Number.isNaN(n)&&n>=0?b(n,0,1):b(it.value,0,1)}),ft=p(()=>{var n;const t=q((n=w.evaluation)==null?void 0:n.ece,NaN);return!Number.isNaN(t)&&t>=0?b(t,0,1):b(Oe.value.ece,0,1)}),nt=p(()=>{var a;const t=(a=w.evaluation)==null?void 0:a.confusion_matrix;if(t&&["tp","tn","fp","fn"].every(u=>Number.isFinite(Number(t[u]))))return{tp:Number(t.tp),tn:Number(t.tn),fp:Number(t.fp),fn:Number(t.fn)};const n=H.value.find(u=>Math.abs(u.threshold-.5)<1e-9);return n?{tp:n.tp,tn:n.tn,fp:n.fp,fn:n.fn}:{tp:13,tn:31,fp:6,fn:8}}),ot=p(()=>{const t=nt.value,n=y(t.tp+t.tn,t.tp+t.tn+t.fp+t.fn,0),a=y(t.tp,t.tp+t.fp,0),u=y(t.tp,t.tp+t.fn,0),d=y(t.tn,t.tn+t.fp,0);return{accuracy:n,precision:a,recall:u,specificity:d}}),yt=p(()=>{var M,V,oe;const t=q((oe=(V=(M=w.result)==null?void 0:M.modules)==null?void 0:V.rsi)==null?void 0:oe.value,62),n=["伪顶","直接顶","老顶Ⅰ","老顶Ⅱ","关键层A","关键层B","关键层C","覆岩"],a=[0,-4,-2,1,3,4,2,1],u=n.map((m,E)=>b(t+a[E]*3+Math.sin(E*1.2)*2.2,24,96)),d=n.map((m,E)=>b(9-E*.7+(100-t)*.03,3,12)),C=u.map((m,E)=>b(m-d[E],0,100)),U=u.map((m,E)=>b(m+d[E],0,100)).map((m,E)=>s(m-C[E],4)),W=u.map(m=>b(102-m,4,90)),P=u.reduce((m,E,le,ae)=>E<ae[m]?le:m,0);return{layers:n,stability:u,lower:C,band:U,damage:W,minIdx:P}}),ht=p(()=>{var M,V,oe,m,E,le;const t=Array.from({length:12},(ae,ie)=>`T${String(ie+1).padStart(2,"0")}`),n=q((oe=(V=(M=w.result)==null?void 0:M.modules)==null?void 0:V.bri)==null?void 0:oe.event_count,20),a=q((le=(E=(m=w.result)==null?void 0:m.modules)==null?void 0:E.bri)==null?void 0:le.avg_magnitude,2.6),u=t.map((ae,ie)=>Math.max(1,Math.round(n/t.length*(.8+.6*Math.sin((ie+1)/1.7))))),d=u.map((ae,ie)=>s(ae*(18+a*6)*(.85+.25*Math.cos((ie+2)/2.3)))),C=d.map((ae,ie)=>s((d[Math.max(0,ie-1)]+d[ie]+d[Math.min(d.length-1,ie+1)])/3,2));let T=0;const U=d.reduce((ae,ie)=>ae+ie,0)||1,W=d.map(ae=>(T+=ae,s(T/U*100,2))),P=d.reduce((ae,ie,D,pt)=>ie>pt[ae]?D:ae,0);return{windows:t,energy:d,smooth:C,eventRate:u,cumulativeRisk:W,peakIdx:P}}),bt=p(()=>{var U,W,P;const t=q((P=(W=(U=w.result)==null?void 0:U.modules)==null?void 0:W.asi)==null?void 0:P.value,58),n=[2.5,3,3.5,4,5,6,7,8,9,10],a=n.map(M=>s(b(6.5+t*.06+10/Math.max(M,1),4,34),3)),u=n.map(M=>s(b(12+t*.16+18/Math.max(M-1.5,1),8,48),3)),d=n.map((M,V)=>s(b(y(u[V],a[V],1),1,4.5),3)),C=u.reduce((M,V,oe,m)=>V>m[M]?oe:M,0),T=n.find((M,V)=>d[V]<2)||n[n.length-1];return{dist:n,radial:a,tangential:u,kt:d,peakIdx:C,riskRadius:T}}),gt=p(()=>{var M,V,oe;const t=(oe=(V=(M=w.result)==null?void 0:M.figures)==null?void 0:V.fig5_dbn)==null?void 0:oe.posterior,n=[{t:"t-4",high_risk_prob:.31},{t:"t-3",high_risk_prob:.35},{t:"t-2",high_risk_prob:.42},{t:"t-1",high_risk_prob:.48},{t:"t",high_risk_prob:.56}],a=Array.isArray(t)&&t.length?t:n,u=a.map(m=>String(m.t)),d=a.map(m=>b(q(m.high_risk_prob,0),0,1)),C=b(.22-Math.sqrt(Math.max(X.value,1))/22,.06,.2),T=d.map(m=>b(m-C,0,1)),W=d.map(m=>b(m+C,0,1)).map((m,E)=>s(m-T[E],4)),P=d.filter(m=>m>=.6).length;return{labels:u,p:d,lower:T,band:W,alertCount:P}}),lt=p(()=>{var P,M,V,oe,m;const t=b(q((M=(P=w.result)==null?void 0:P.fusion)==null?void 0:M.mpi,52),0,100),n=b(q((m=(oe=(V=w.result)==null?void 0:V.fusion)==null?void 0:oe.baseline)==null?void 0:m.mpi,t-4.5),0,100),a=b(Fe.value,.5,1),u=b(Ae.value,.4,1),d=b(je.value,0,1),C=["MPI","AUC×100","PR-AUC×100","(1-Brier)×100"],T=[s(t,2),s(a*100,2),s(u*100,2),s((1-d)*100,2)],U=[s(n,2),s(b((a-.05)*100,0,100),2),s(b((u-.06)*100,0,100),2),s(b((1-(d+.05))*100,0,100),2)],W=T.map((E,le)=>s(E-U[le],2));return{categories:C,newScores:T,baseScores:U,gain:W}}),xt=p(()=>{var M,V;const t=s(b(Fe.value*100,45,99),2),n=((V=(M=w.result)==null?void 0:M.fusion)==null?void 0:V.dynamic_weights)||{rsi:.4,bri:.35,asi:.25},a=s(2.5+q(n.rsi,.4)*16,2),u=s(2.5+q(n.bri,.35)*16,2),d=s(2.5+q(n.asi,.25)*16,2),C=["全模型","去RSI","去BRI","去ASI"],T=[t,s(b(t-a,40,99),2),s(b(t-u,40,99),2),s(b(t-d,40,99),2)],U=[0,a,u,d],W=a+u+d||1,P=[0,s(a/W*100,1),s(u/W*100,1),s(d/W*100,1)];return{categories:C,score:T,drop:U,contribution:P}}),It=p(()=>{const t=yt.value,n=t.layers[t.minIdx],a=t.stability[t.minIdx];return`关键结论：最低稳定层位为 ${n}（${a.toFixed(1)}%），${a<60?"低于":"高于"}60%预警阈值。`}),$t=p(()=>{const t=ht.value;return`关键结论：峰值窗口 ${t.windows[t.peakIdx]}，能量 ${t.energy[t.peakIdx].toFixed(1)} a.u.，累计风险在后半段快速抬升。`}),Rt=p(()=>{const t=bt.value;return`关键结论：切向应力峰值出现在 r=${t.dist[t.peakIdx]} m，Kt>2 高风险圈带约在 r≤${t.riskRadius.toFixed(1)} m。`}),Pt=p(()=>{const t=gt.value;return`关键结论：最新后验概率 ${t.p[t.p.length-1].toFixed(3)}，达到0.6报警阈值的时间片数量为 ${t.alertCount}。`}),Ft=p(()=>{const t=lt.value,n=t.gain.reduce((a,u,d,C)=>u>C[a]?d:a,0);return`关键结论：最大增益指标为 ${t.categories[n]}（+${t.gain[n].toFixed(2)}）。`}),Tt=p(()=>{const t=xt.value,n=t.drop.reduce((a,u,d,C)=>u>C[a]?d:a,0);return`关键结论：${t.categories[n]} 对整体性能贡献最大（移除后下降 ${t.drop[n].toFixed(2)} 分）。`}),Ue=p(()=>`关键结论：ECE=${ft.value.toFixed(4)}，有效分箱 ${Oe.value.centers.length} 个。`),$e=p(()=>{const t=tt.value,n=O.value,a=n?`，95%CI=[${n.aucLow.toFixed(3)}, ${n.aucHigh.toFixed(3)}]`:"";return`关键结论：AUC=${Fe.value.toFixed(3)}${a}，最优阈值≈${t.threshold.toFixed(3)}（TPR=${t.recall.toFixed(2)}, FPR=${t.fpr.toFixed(2)}）。`}),Lt=p(()=>{const t=We.value,n=O.value,a=n?`，95%CI=[${n.prAucLow.toFixed(3)}, ${n.prAucHigh.toFixed(3)}]`:"";return`关键结论：PR-AUC=${Ae.value.toFixed(3)}${a}，最佳F1=${t.f1.toFixed(3)} 对应阈值≈${t.threshold.toFixed(3)}。`}),wt=p(()=>{const t=ot.value;return`关键结论：Accuracy=${(t.accuracy*100).toFixed(1)}%，Precision=${(t.precision*100).toFixed(1)}%，Recall=${(t.recall*100).toFixed(1)}%。`}),_t=t=>{var a;const n=String(((a=t==null?void 0:t.data)==null?void 0:a.label)||(t==null?void 0:t.name)||"").toUpperCase();(n==="TP"||n==="TN"||n==="FP"||n==="FN")&&Ne("matrix-select",n.toLowerCase())},ut=p(()=>{const t=yt.value;return{color:[f.blue,"rgba(29,78,216,0.18)",f.orange,f.red],animationDuration:350,grid:ve,legend:A,toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("层位",!1)),{data:t.layers,nameGap:30}),yAxis:[te(ee({},c("稳定度 / 置信区间 (%)",!0)),{min:0,max:100}),te(ee({},c("损伤占比 (%)",!0)),{min:0,max:100})],series:[{name:"CI下界",type:"line",stack:"rsi_ci",data:t.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"rsi_ci",data:t.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.14)"}},{name:"稳定度",type:"line",data:t.stability,smooth:!0,symbolSize:7,lineStyle:{width:2.5,color:f.blue},itemStyle:{color:f.blue},markLine:{symbol:"none",label:{formatter:"预警阈值 60%",color:"#7f1d1d",fontFamily:_e,fontSize:10},lineStyle:{type:"dashed",color:"#b91c1c",width:1.2},data:[{yAxis:60}]},markPoint:{symbol:"circle",symbolSize:44,label:{color:"#111827",fontFamily:_e,fontSize:10,formatter:"最低层"},itemStyle:{color:"#fee2e2",borderColor:"#b91c1c",borderWidth:1.2},data:[{coord:[t.minIdx,t.stability[t.minIdx]]}]}},{name:"损伤占比",type:"bar",yAxisIndex:1,data:t.damage,barWidth:14,itemStyle:{color:f.orange,opacity:.75}}]}}),St=p(()=>{const t=ht.value;return{color:[f.orange,f.cyan,f.red],animationDuration:350,grid:ve,legend:A,toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("时间窗",!1)),{data:t.windows,nameGap:30}),yAxis:[te(ee({},c("能量释放 / 平滑能量 (a.u.)",!0)),{min:0}),te(ee({},c("事件频次 / 累计风险 (%)",!0)),{min:0,max:110})],series:[{name:"能量释放",type:"bar",data:t.energy,barWidth:14,itemStyle:{color:f.orange,opacity:.82},markPoint:{symbol:"pin",symbolSize:34,data:[{name:"峰值",coord:[t.peakIdx,t.energy[t.peakIdx]]}],label:{formatter:"峰值",fontSize:10,color:"#111827"}}},{name:"平滑能量",type:"line",data:t.smooth,smooth:!0,symbolSize:5,lineStyle:{width:2,color:f.cyan}},{name:"事件频次",type:"line",yAxisIndex:1,data:t.eventRate,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:f.slate}},{name:"累计风险",type:"line",yAxisIndex:1,data:t.cumulativeRisk,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:f.red},itemStyle:{color:f.red}}]}}),zt=p(()=>{const t=bt.value;return{color:[f.blue,f.red,f.purple],animationDuration:350,grid:{left:64,right:54,top:46,bottom:62},legend:A,toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("径向距离 r (m)",!0)),{min:2,max:10}),yAxis:[te(ee({},c("应力 (MPa)",!0)),{min:0,max:50}),te(ee({},c("应力集中系数 Kt",!0)),{min:1,max:4.5,position:"right"})],series:[{name:"径向应力 σr",type:"line",data:t.dist.map((n,a)=>[n,t.radial[a]]),smooth:!0,symbolSize:6,lineStyle:{width:2.2,color:f.blue}},{name:"切向应力 σθ",type:"line",data:t.dist.map((n,a)=>[n,t.tangential[a]]),smooth:!0,symbolSize:6,lineStyle:{width:2.4,color:f.red},markPoint:{symbol:"circle",symbolSize:40,itemStyle:{color:"#fee2e2",borderColor:f.red,borderWidth:1.2},label:{formatter:"峰值",fontSize:10,color:"#111827"},data:[{coord:[t.dist[t.peakIdx],t.tangential[t.peakIdx]]}]}},{name:"Kt=σθ/σr",type:"line",yAxisIndex:1,data:t.dist.map((n,a)=>[n,t.kt[a]]),smooth:!0,symbolSize:5,lineStyle:{width:1.9,type:"dashed",color:f.purple},markLine:{symbol:"none",label:{formatter:"Kt=2",color:f.purple,fontFamily:_e,fontSize:10},lineStyle:{color:f.purple,width:1.1,type:"dashed"},data:[{yAxis:2}]}}]}}),ct=p(()=>{const t=gt.value;return{color:[f.blue,"rgba(29,78,216,0.18)",f.red],animationDuration:350,grid:ve,legend:A,toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("时间片",!1)),{data:t.labels,nameGap:30}),yAxis:te(ee({},c("高风险后验概率",!0)),{min:0,max:1}),series:[{name:"CI下界",type:"line",stack:"dbn_ci",data:t.lower,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"dbn_ci",data:t.band,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.18)"}},{name:"后验概率",type:"line",data:t.p,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:f.red},itemStyle:{color:f.red},markLine:{symbol:"none",lineStyle:{type:"dashed",width:1.15},data:[{yAxis:.3,name:"关注阈值",lineStyle:{color:f.orange}},{yAxis:.6,name:"报警阈值",lineStyle:{color:f.red}}]}}]}}),kt=p(()=>{const t=lt.value;return{color:[f.cyan,f.slate,f.red],animationDuration:350,grid:{left:74,right:54,top:46,bottom:66},legend:A,toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("指标",!1)),{data:t.categories,nameGap:30}),yAxis:[te(ee({},c("归一化分数",!0)),{min:0,max:100}),te(ee({},c("增益(新-基线)",!0)),{min:Math.min(...t.gain)-2,max:Math.max(...t.gain)+2,position:"right"})],series:[{name:"新算法",type:"bar",data:t.newScores,barWidth:14,itemStyle:{color:f.cyan}},{name:"基线算法",type:"bar",data:t.baseScores,barWidth:14,itemStyle:{color:f.slate,opacity:.85}},{name:"增益",type:"line",yAxisIndex:1,data:t.gain,symbol:"diamond",symbolSize:8,lineStyle:{width:2.2,color:f.red},label:{show:!0,position:"top",color:f.red,fontFamily:_e,fontSize:10,formatter:({value:n})=>`+${Number(n).toFixed(2)}`}}]}}),Dt=p(()=>{const t=xt.value,n=t.drop.reduce((a,u,d,C)=>u>C[a]?d:a,0);return{color:[f.green,f.red,f.orange],animationDuration:350,grid:{left:66,right:52,top:46,bottom:64},legend:A,toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("模型版本",!1)),{data:t.categories,nameGap:30}),yAxis:[te(ee({},c("性能分数 (AUC×100)",!0)),{min:40,max:100}),te(ee({},c("下降分数 / 贡献(%)",!0)),{min:0,max:Math.max(...t.drop,...t.contribution)+8,position:"right"})],series:[{name:"性能分数",type:"bar",data:t.score,barWidth:16,itemStyle:{color:f.green},label:{show:!0,position:"top",fontFamily:_e,fontSize:10,formatter:({value:a})=>Number(a).toFixed(1)}},{name:"下降分数",type:"line",yAxisIndex:1,data:t.drop,symbolSize:8,lineStyle:{width:2,color:f.red},itemStyle:{color:f.red},markPoint:{symbol:"pin",symbolSize:34,data:[{coord:[n,t.drop[n]],name:"最大下降"}],label:{formatter:"最大下降",fontSize:10,color:"#111827"}}},{name:"贡献率(%)",type:"line",yAxisIndex:1,data:t.contribution,symbolSize:6,lineStyle:{width:1.8,type:"dashed",color:f.orange}}]}}),Et=p(()=>{const t=Oe.value,n=Math.max(...t.count,1);return{color:[f.blue,"rgba(29,78,216,0.2)","#94a3b8",f.cyan],animationDuration:350,grid:{left:66,right:54,top:46,bottom:62},legend:A,toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("预测概率",!0)),{min:0,max:1,interval:.1}),yAxis:[te(ee({},c("真实频率",!0)),{min:0,max:1,interval:.1}),te(ee({},c("样本数",!0)),{min:0,max:n+2,position:"right"})],series:[{name:"理想校准线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.4,type:"dashed",color:"#94a3b8"}},{name:"CI下界",type:"line",stack:"cal_ci",data:t.centers.map((a,u)=>[a,t.lower[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%CI",type:"line",stack:"cal_ci",data:t.centers.map((a,u)=>[a,t.band[u]]),symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(29,78,216,0.15)"}},{name:"校准曲线",type:"line",data:t.centers.map((a,u)=>[a,t.obs[u]]),smooth:!0,symbolSize:7,lineStyle:{width:2.4,color:f.blue},itemStyle:{color:f.blue}},{name:"分箱样本数",type:"bar",yAxisIndex:1,data:t.centers.map((a,u)=>[a,t.count[u]]),barWidth:18,itemStyle:{color:"#cbd5e1",opacity:.6}}],graphic:[{type:"text",right:26,top:18,style:{text:`ECE=${ft.value.toFixed(4)}`,font:`600 12px ${_e}`,fill:"#0f172a"}}]}}),dt=p(()=>{const t=tt.value,n=Ge.value,a=Qe.value,u=O.value,d=`ROC 曲线 (AUC=${Fe.value.toFixed(3)})`,C=u?`AUC 95%CI [${u.aucLow.toFixed(3)}, ${u.aucHigh.toFixed(3)}]`:"AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",f.blue,f.red],animationDuration:350,grid:ve,legend:te(ee({},A),{data:["随机参考线",d,"最优阈值点"]}),toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("假阳性率 FPR",!0)),{min:0,max:1,interval:.1}),yAxis:te(ee({},c("真阳性率 TPR",!0)),{min:0,max:1,interval:.1}),series:[{name:"随机参考线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__roc_ci_low__",type:"line",stack:"roc_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__roc_ci_band__",type:"line",stack:"roc_ci",data:a,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"ROC 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"ROC 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:d,type:"line",smooth:!0,data:N.value,symbolSize:5,lineStyle:{width:2.6,color:f.blue},areaStyle:{color:"rgba(29,78,216,0.12)"}},{name:"最优阈值点",type:"scatter",data:[[t.fpr,t.recall]],symbolSize:12,itemStyle:{color:f.red},label:{show:!0,position:"top",fontFamily:_e,fontSize:10,color:f.red,formatter:`thr=${t.threshold.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:C,font:`600 11px ${_e}`,fill:"#0f172a"}}]}}),He=p(()=>{const n=[];for(let a=1;a<=99;a+=1){const u=a/100,d=2*u-.6;if(d<=0)continue;const C=b(.6*u/d,0,1);C>0&&C<=1&&n.push([u,C])}return n}),qe=p(()=>{const t=We.value,n=xe.value,a=be.value,u=O.value,d=`PR 曲线 (PR-AUC=${Ae.value.toFixed(3)})`,C=u?`PR-AUC 95%CI [${u.prAucLow.toFixed(3)}, ${u.prAucHigh.toFixed(3)}]`:"PR-AUC 95%CI 不可用";return{color:["#64748b","#94a3b8",f.orange,f.red,f.green],animationDuration:350,grid:ve,legend:te(ee({},A),{data:["基线(阳性占比)","F1=0.6 等值线",d,"最佳F1点"]}),toolbox:B,dataZoom:k,tooltip:{trigger:"axis"},xAxis:te(ee({},c("召回率 Recall",!0)),{min:0,max:1,interval:.1}),yAxis:te(ee({},c("精确率 Precision",!0)),{min:0,max:1,interval:.1}),series:[{name:"基线(阳性占比)",type:"line",data:[[0,re.value],[1,re.value]],symbol:"none",lineStyle:{width:1.5,type:"dashed",color:"#94a3b8"}},{name:"__pr_ci_low__",type:"line",stack:"pr_ci",data:n.low,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0},tooltip:{show:!1}},{name:"__pr_ci_band__",type:"line",stack:"pr_ci",data:a,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(100,116,139,0.12)"},tooltip:{show:!1}},{name:"PR 95%CI下界",type:"line",data:n.low,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"PR 95%CI上界",type:"line",data:n.high,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:"#64748b"}},{name:"F1=0.6 等值线",type:"line",data:He.value,symbol:"none",lineStyle:{width:1.2,type:"dotted",color:f.orange}},{name:d,type:"line",smooth:!0,data:G.value,symbolSize:5,lineStyle:{width:2.6,color:f.red}},{name:"最佳F1点",type:"scatter",data:[[t.recall,t.precision]],symbolSize:12,itemStyle:{color:f.green},label:{show:!0,position:"top",fontFamily:_e,fontSize:10,color:f.green,formatter:`F1=${t.f1.toFixed(2)}`}}],graphic:[{type:"text",right:26,top:18,style:{text:C,font:`600 11px ${_e}`,fill:"#0f172a"}}]}}),mt=p(()=>{const t=nt.value,n=Math.max(t.tp+t.tn+t.fp+t.fn,1),a=[{value:[0,0,t.tn,t.tn/n],label:"TN"},{value:[1,0,t.fp,t.fp/n],label:"FP"},{value:[0,1,t.fn,t.fn/n],label:"FN"},{value:[1,1,t.tp,t.tp/n],label:"TP"}],u=ot.value;return{animationDuration:350,grid:{left:76,right:120,top:38,bottom:66},toolbox:te(ee({},B),{feature:{restore:{title:"重置视图"},saveAsImage:{title:"导出PNG",type:"png",pixelRatio:3,backgroundColor:"#ffffff"}}}),tooltip:{trigger:"item",formatter:({data:d})=>`${d.label}：${d.value[2]} (${(d.value[3]*100).toFixed(1)}%)`},xAxis:te(ee({},c("预测类别",!1)),{data:["低风险","高风险"],nameGap:34,splitLine:{show:!1}}),yAxis:te(ee({},c("真实类别",!1)),{data:["低风险","高风险"],nameGap:54,splitLine:{show:!1}}),visualMap:{min:0,max:Math.max(t.tp,t.tn,t.fp,t.fn,1),orient:"vertical",right:18,top:"middle",text:["高","低"],textStyle:{fontFamily:_e,fontSize:11,color:"#0f172a"},inRange:{color:["#ecfeff","#67e8f9","#0e7490"]}},series:[{name:"混淆矩阵",type:"heatmap",data:a,label:{show:!0,color:"#0f172a",fontFamily:_e,fontSize:11,formatter:({data:d})=>`${d.label}
${d.value[2]}
${(d.value[3]*100).toFixed(1)}%`},itemStyle:{borderWidth:1,borderColor:"#e2e8f0"}}],graphic:[{type:"group",right:10,bottom:8,children:[{type:"text",top:0,style:{text:`Acc ${(u.accuracy*100).toFixed(1)}%`,font:`600 11px ${_e}`,fill:"#0f172a"}},{type:"text",top:16,style:{text:`Prec ${(u.precision*100).toFixed(1)}%`,font:`600 11px ${_e}`,fill:"#0f172a"}},{type:"text",top:32,style:{text:`Rec ${(u.recall*100).toFixed(1)}%`,font:`600 11px ${_e}`,fill:"#0f172a"}},{type:"text",top:48,style:{text:`Spec ${(u.specificity*100).toFixed(1)}%`,font:`600 11px ${_e}`,fill:"#0f172a"}}]}]}});return(t,n)=>(J(),K("section",So,[o("header",ko,[n[0]||(n[0]=o("div",{class:"head-title"},[o("h4",null,"SCI 配图增强版（图2-图11）"),o("p",null,"统一采用期刊风格坐标系、阈值注记、置信区间和关键决策点标注。")],-1)),o("div",Co,[o("span",Ao,"样本 n="+v(X.value),1),o("span",No,"正样本占比 "+v(z(re.value)),1),O.value?(J(),K("span",Mo,"Bootstrap "+v(O.value.iterations)+"次",1)):pe("",!0),o("span",{class:Ke(["metric-chip",{warn:$.value!=="real_label_stream"}])},"评估源 "+v(ue.value),3),Y.value?(J(),K("span",Io,"标签文件 "+v(Y.value),1)):pe("",!0)])]),o("article",$o,[n[1]||(n[1]=o("h4",null,"图2 | RSI 机制剖面图（稳定度-损伤-置信带）",-1)),Re(Ee,{option:ut.value,height:336},null,8,["option"]),n[2]||(n[2]=o("p",{class:"caption"},"怎么看：稳定度实线越高越好，误差带越窄代表层位响应更稳定，损伤柱越低越好。",-1)),o("p",Ro,v(It.value),1)]),o("article",Po,[n[3]||(n[3]=o("h4",null,"图3 | BRI 微震能量释放、事件频次与累计风险",-1)),Re(Ee,{option:St.value,height:336},null,8,["option"]),n[4]||(n[4]=o("p",{class:"caption"},"怎么看：能量柱与事件频次线共同识别冲击窗口，累计风险线反映风险积聚过程。",-1)),o("p",Fo,v($t.value),1)]),o("article",To,[n[5]||(n[5]=o("h4",null,"图4 | ASI 径向/切向应力与应力集中系数 Kt",-1)),Re(Ee,{option:zt.value,height:336},null,8,["option"]),n[6]||(n[6]=o("p",{class:"caption"},"怎么看：切向应力峰值与 Kt>2 区段对应高风险圈带，径向应力反映卸压后衰减。",-1)),o("p",Lo,v(Rt.value),1)]),o("article",zo,[n[7]||(n[7]=o("h4",null,"图5 | DBN 后验概率时序（95% CI + 预警阈值）",-1)),Re(Ee,{option:ct.value,height:336},null,8,["option"]),n[8]||(n[8]=o("p",{class:"caption"},"怎么看：后验概率曲线跨过 0.6 报警阈值时需触发强化巡检，CI 带越窄越可信。",-1)),o("p",Do,v(Pt.value),1)]),o("article",Eo,[n[9]||(n[9]=o("h4",null,"图6 | 新旧算法多指标对比（分数 + 增益）",-1)),Re(Ee,{option:kt.value,height:336},null,8,["option"]),n[10]||(n[10]=o("p",{class:"caption"},"怎么看：柱形给出绝对分数，增益折线给出替代旧算法的实际收益幅度。",-1)),o("p",Bo,v(Ft.value),1)]),o("article",Oo,[n[11]||(n[11]=o("h4",null,"图7 | 消融实验（模块贡献与性能下降）",-1)),Re(Ee,{option:Dt.value,height:336},null,8,["option"]),n[12]||(n[12]=o("p",{class:"caption"},"怎么看：去除模块后的性能下降越大，说明该模块对总体性能贡献越关键。",-1)),o("p",Uo,v(Tt.value),1)]),o("article",Vo,[n[13]||(n[13]=o("h4",null,"图8 | 校准曲线（含样本直方图与置信区间）",-1)),Re(Ee,{option:Et.value,height:336},null,8,["option"]),n[14]||(n[14]=o("p",{class:"caption"},"怎么看：曲线贴近对角线且 ECE 越低，模型概率输出越可直接用于阈值决策。",-1)),o("p",Go,v(Ue.value),1)]),o("article",Wo,[n[15]||(n[15]=o("h4",null,"图9 | ROC 曲线（最优阈值点与 AUC）",-1)),Re(Ee,{option:dt.value,height:336},null,8,["option"]),n[16]||(n[16]=o("p",{class:"caption"},"怎么看：曲线越靠左上角越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，红点为 Youden 最优阈值。",-1)),o("p",jo,v($e.value),1)]),o("article",Ho,[n[17]||(n[17]=o("h4",null,"图10 | PR 曲线（基线、F1 等值线与最优点）",-1)),Re(Ee,{option:qe.value,height:336},null,8,["option"]),n[18]||(n[18]=o("p",{class:"caption"},"怎么看：PR 曲线整体越高越好；灰色阴影带为 bootstrap 95%CI，上下虚线为CI边界，绿点为最佳F1运行点。",-1)),o("p",qo,v(Lt.value),1)]),o("article",Yo,[n[19]||(n[19]=o("h4",null,"图11 | 混淆矩阵热图（计数 + 占比 + 诊断指标）",-1)),Re(Ee,{option:mt.value,height:336,onChartClick:_t},null,8,["option"]),n[20]||(n[20]=o("p",{class:"caption"},"怎么看：对角线高、非对角低为理想状态；右侧指标用于误报/漏报成本权衡。",-1)),o("p",Zo,v(wt.value),1)])]))}},Jo=Ht(Xo,[["__scopeId","data-v-f81ec0ce"]]),Ko={class:"top-nav"},Qo={class:"nav-left"},el={class:"seam-select"},tl=["value"],nl={key:0,class:"mini-stats"},ol={class:"danger"},ll={class:"nav-right"},al=["disabled"],sl=["disabled"],rl={class:"metric-dashboard"},il=["onClick"],ul={class:"head"},cl={key:0,class:"problem-dot"},dl={class:"value"},ml={class:"meta"},pl={class:"main-layout"},vl={class:"main-canvas-card"},fl={class:"canvas-head"},yl={class:"canvas-controls"},hl={class:"check"},bl={class:"check"},gl={key:0,class:"trust-banner"},xl={class:"trust-chip warn"},wl={class:"trust-chip info"},_l={key:0,class:"trust-chip danger"},Sl={key:1,class:"trust-chip hint"},kl={key:2,class:"trust-chip link"},Cl={key:3,class:"trust-meta"},Al={class:"trust-meta"},Nl={key:0,class:"loading-mask"},Ml={class:"legend-wrap"},Il={class:"legend-labels"},$l={class:"thumb-list"},Rl=["onClick","onMouseenter","onMousemove"],Pl={class:"thumb-meta"},Fl={key:0,class:"floating-panel"},Tl={class:"weight-row"},Ll={class:"weight-row"},zl={class:"weight-row"},Dl={key:0,class:"floating-panel geo-panel"},El={class:"geo-row"},Bl=["disabled"],Ol={key:0,class:"geo-error"},Ul={key:1,class:"geo-result-grid"},Vl={class:"geo-cell"},Gl={class:"geo-cell"},Wl={class:"geo-cell"},jl={class:"geo-cell"},Hl={class:"geo-cell"},ql={key:0,class:"eval-drawer"},Yl={class:"actions"},Zl={key:0,class:"panel-empty"},Xl={key:1,class:"panel-empty"},Jl={class:"eval-grid"},Kl={class:"metric"},Ql={class:"metric"},ea={class:"metric"},ta={class:"metric"},na={class:"metric"},oa={class:"eval-content"},la={class:"cm-card"},aa={class:"cm-grid"},sa={class:"cm-cell"},ra={class:"cm-cell warn"},ia={class:"cm-cell warn"},ua={class:"cm-cell"},ca={class:"baseline-card"},da={viewBox:"0 0 560 170",class:"baseline-svg"},ma=["width"],pa={x:"485",y:"26"},va=["width"],fa={x:"485",y:"90"},ya={key:0,class:"science-section"},ha={class:"data-note"},ba={key:1,class:"export-note"},ga={class:"risk"},xa="advanced_v2_asi_calibrated_v1",wa={__name:"AlgorithmValidation",setup(g){const Q=uo(),w=io(),{workspaceState:Ne,setSelectedSeam:f,markStepDone:ve}=to(),b=[{key:"mpi",label:"MPI",desc:"综合指标"},{key:"rsi",label:"RSI",desc:"顶板稳定"},{key:"bri",label:"BRI",desc:"冲击风险"},{key:"asi",label:"ASI",desc:"支承应力"}],q={tp:{label:"TP 真阳性",color:"#15803d"},tn:{label:"TN 真阴性",color:"#0e7490"},fp:{label:"FP 假阳性",color:"#d97706"},fn:{label:"FN 假阴性",color:"#b91c1c"}},z=Z(null),s=Z(null),y=Z(null),c=Z(null),A=Z(null),B=Z([]),k=Z(""),R=Z(50),$=Z(9),Y=Z("idw"),ue=Z(!0),j=Z(!1),X=Z("mpi"),fe=Z(!1),ye=Z(!1),re=Z(!1),he=Z(!1),ge=Z(!0),ce=Z(!1),H=Mt({rsi:.4,bri:.35,asi:.25}),N=ro(null),G=Z(null),ke=Z(!1),de=Z(""),Ce=Z(!1),Pe=Z(""),ne=Z(null),Ie=Mt({x:0,y:0}),O=Mt({visible:!1,metric:"",x:0,y:0}),Ge=Z("pseudo_threshold"),Qe=Z(""),xe=Z("all"),be=Z(null),et=Z(!1),rt={},tt=new Map,We=new Map,it=Z(""),Oe=Z(!1),Fe=Z(""),Ae=Z(null);let je=null;const ft=()=>we(this,null,function*(){if(je)return je;const l=yield no(()=>import("./jszip-CsMIhXuR.js").then(e=>e.j),[]);if(je=(l==null?void 0:l.default)||(l==null?void 0:l.JSZip)||window.JSZip||null,!je)throw new Error("JSZip 加载失败");return je}),{viewport:nt,worldToScreen:ot,screenToWorld:yt,fitToBounds:ht,startDrag:bt,dragTo:gt,endDrag:lt,zoomAt:xt}=bo(),{getLegendGradient:It,drawGrid:$t,drawBoreholes:Rt,pickNearestBorehole:Pt,sampleGridValue:Ft,drawMiniHeatmap:Tt}=wo(),Ue=p(()=>{const l=H.rsi+H.bri+H.asi||1;return{rsi:H.rsi/l,bri:H.bri/l,asi:H.asi/l}}),$e=p(()=>{var l,e,r;return!!((l=N.value)!=null&&l.grids&&((e=N.value)!=null&&e.statistics)&&((r=N.value)!=null&&r.boreholes))}),Lt=p(()=>{var e;const l=String(((e=N.value)==null?void 0:e.algorithm_mode)||"");return l==="advanced_v2"?"新算法(advanced_v2)":l||"未标记"}),wt=p(()=>{var r,h;const l=(r=N.value)==null?void 0:r.problem_indicators;if(Array.isArray(l))return l;const e=((h=N.value)==null?void 0:h.indicator_diagnostics)||{};return Object.keys(e).filter(i=>{var x;return((x=e==null?void 0:e[i])==null?void 0:x.status)&&e[i].status!=="ok"})}),_t=p(()=>wt.value.map(l=>le(l))),ut=p(()=>{var l,e;return((e=(l=N.value)==null?void 0:l.statistics)==null?void 0:e[X.value])||{}}),St=p(()=>{const l=ut.value,e=Number(l==null?void 0:l.min),r=Number(l==null?void 0:l.max);return!Number.isFinite(e)||!Number.isFinite(r)?0:Math.max(0,r-e)}),zt=p(()=>$e.value&&j.value&&St.value<20),ct=p(()=>{var l,e,r;return Number(((r=(e=(l=N.value)==null?void 0:l.statistics)==null?void 0:e.mpi)==null?void 0:r.mean)||0)}),kt=p(()=>Math.max(0,ct.value-4.5)),Dt=p(()=>Yt(X.value)),Et=p(()=>Ge.value==="real_label_stream"?"真实标签流":Ge.value==="pseudo_threshold"?"伪标签估计（阈值构造）":Ge.value==="none"?"无可评估样本":"未知来源"),dt=p(()=>{var l,e;return j.value?{min:0,mean:50,max:100}:((e=(l=N.value)==null?void 0:l.statistics)==null?void 0:e[X.value])||{min:0,mean:0,max:0}}),He=p(()=>{var e,r,h,i;const l={};for(const x of b){const _=((r=(e=N.value)==null?void 0:e.statistics)==null?void 0:r[x.key])||{},S=(i=(h=N.value)==null?void 0:h.grids)==null?void 0:i[x.key];let I=0,se=0,me=0,L=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY;if(Array.isArray(S))for(const Ye of S)for(const Ze of Ye||[]){const Te=Number(Ze);Number.isFinite(Te)&&(I+=1,se+=Te,me+=Te*Te,Te<L&&(L=Te),Te>F&&(F=Te))}const Me=I?se/I:Number(_.mean||0),Le=I?Math.max(me/I-Me*Me,0):0;l[x.key]={min:Number.isFinite(Number(_.min))?Number(_.min):I?L:0,max:Number.isFinite(Number(_.max))?Number(_.max):I?F:0,mean:Me,std:Math.sqrt(Le)}}return l}),qe=p(()=>He.value[O.metric]||null),mt=p(()=>{var L,F,Me,Le,Ye,Ze,Te,Xe;if(!$e.value)return null;const l=He.value,e=((L=N.value)==null?void 0:L.boreholes)||[],r=Kt(),h=Number(((F=l.mpi)==null?void 0:F.mean)||0),i=Math.max(0,h-4.5),x=i>0?(h-i)/i*100:0,_=e.length||1,S=Yt("mpi")/_,I=at(1-h/100,0,1),se=at(Number(((Me=G.value)==null?void 0:Me.auc)||.7)-.5,0,.45),me=["t-4","t-3","t-2","t-1","t"].map((Nt,Ve)=>({t:Nt,high_risk_prob:at(I+(Ve-2)*.05+se*.2,.05,.95)}));return{modules:{rsi:{value:Number(((Le=l.rsi)==null?void 0:Le.mean)||0),input_layers:6},bri:{value:Number(((Ye=l.bri)==null?void 0:Ye.mean)||0),event_count:e.length,avg_magnitude:2.6},asi:{value:Number(((Ze=l.asi)==null?void 0:Ze.mean)||0),avg_friction_angle:31.2}},fusion:{mpi:h,baseline:{mpi:i},dynamic_weights:Ue.value},kpi:{mpi_mean:h,high_risk_ratio:S,auc:Number(((Te=G.value)==null?void 0:Te.auc)||.7),brier_score:Number(((Xe=G.value)==null?void 0:Xe.brier)||.24),improvement_vs_baseline_pct:x},figures:{fig5_dbn:{posterior:me}},evaluation_inputs:r}}),t=l=>{var e;return((e=q[String(l||"").toLowerCase()])==null?void 0:e.label)||"全部"},n=p(()=>{var _,S;const l=((_=N.value)==null?void 0:_.boreholes)||[],e=((S=mt.value)==null?void 0:S.evaluation_inputs)||{},r=Array.isArray(e.y_true)?e.y_true:Array.isArray(e.yTrue)?e.yTrue:[],h=Array.isArray(e.y_prob)?e.y_prob:Array.isArray(e.yProb)?e.yProb:[];if(!l.length||r.length!==l.length||h.length!==l.length)return{available:!1,roles:[],counts:{tp:0,tn:0,fp:0,fn:0}};const i=[],x={tp:0,tn:0,fp:0,fn:0};for(let I=0;I<l.length;I+=1){const se=Number(r[I])>=1?1:0,me=Number(h[I])>=.5?1:0,L=se===1?me===1?"tp":"fn":me===1?"fp":"tn";i.push(L),x[L]+=1}return{available:!0,roles:i,counts:x}}),a=p(()=>n.value.available),u=p(()=>{var e;if(xe.value==="all")return 0;const l=String(xe.value).toLowerCase();return Number(((e=n.value.counts)==null?void 0:e[l])||0)}),d=p(()=>{const l=String(xe.value||"").toLowerCase();if(!n.value.available||!["tp","tn","fp","fn"].includes(l))return[];const e=[];for(let r=0;r<n.value.roles.length;r+=1)n.value.roles[r]===l&&e.push(r);return e}),C=p(()=>new Set(d.value)),T=p(()=>{var e;const l=String(xe.value||"").toLowerCase();return["tp","tn","fp","fn"].includes(l)?{active:!0,indexSet:C.value,accent:((e=q[l])==null?void 0:e.color)||"#111827"}:null}),U=p(()=>xe.value!=="all"&&a.value&&!et.value);let W=0,P=0,M=null,V=null,oe=0,m=0;const E=()=>{window.clearTimeout(M),M=window.setTimeout(()=>{Jt(),Bt(),Se(),Ct()},80)},le=l=>{var e;return((e=b.find(r=>r.key===l))==null?void 0:e.label)||l.toUpperCase()},ae=l=>wt.value.includes(l),ie=l=>It(l),D=(l,e=2)=>l==null||Number.isNaN(Number(l))?"--":Number(l).toFixed(e),pt=l=>`${(Number(l||0)*100).toFixed(0)}%`,at=(l,e,r)=>Math.max(e,Math.min(r,l)),gn=l=>{const e=String(l||"").toLowerCase();return e.includes("high")||e.includes("高")?"高风险":e.includes("medium")||e.includes("中")?"中风险":e.includes("low")||e.includes("低")?"低风险":"未知"},qt=l=>`${at(Number(l||0),0,100)*3.6}`,Yt=l=>{var e;return(((e=N.value)==null?void 0:e.boreholes)||[]).filter(r=>Number(r[l])<50).length},Zt=l=>{var e,r;return j.value?{min:0,mean:50,max:100}:((r=(e=N.value)==null?void 0:e.statistics)==null?void 0:r[l])||{min:0,mean:0,max:0}},Xt=()=>{const l=Number($.value);$.value=Number.isFinite(l)?Math.max(5,Math.min(24,Math.round(l))):9},xn=(l,e,r)=>{if(!Array.isArray(r)||r.length===0)return{borehole:null,distance:null};let h=null,i=Number.POSITIVE_INFINITY;for(const x of r){const _=Number(x.x)-l,S=Number(x.y)-e,I=Math.hypot(_,S);I<i&&(i=I,h=x)}return{borehole:h,distance:Number.isFinite(i)?i:null}},wn=()=>{const l=Ue.value;return[xa,k.value,R.value,Y.value,l.rsi.toFixed(3),l.bri.toFixed(3),l.asi.toFixed(3)].join("|")},_n=l=>e=>{e?(rt[l]=e,Ct()):delete rt[l]},Jt=()=>{if(!s.value||!c.value||!A.value)return;const l=s.value.getBoundingClientRect(),e=window.devicePixelRatio||1,r=Math.max(1,Math.floor(l.width*e)),h=Math.max(1,Math.floor(l.height*e));for(const i of[c.value,A.value])i.width=r,i.height=h},Bt=()=>{var e;const l=(e=N.value)==null?void 0:e.bounds;!l||!c.value||(ht(l,c.value.width,c.value.height,62),Se())},Sn=(l,e,r)=>{const h=String(xe.value||"").toLowerCase();if(!["tp","tn","fp","fn"].includes(h)||!n.value.available)return;const i=q[h],x=d.value;x.length&&(l.save(),l.fillStyle="rgba(15, 23, 42, 0.88)",l.fillRect(12,10,250,28),l.fillStyle="#f4f9f8",l.font="600 12px 'Noto Sans SC', 'Segoe UI', sans-serif",l.fillText(`联动筛选: ${i.label} (${x.length})  Esc清除`,22,29),l.restore())},Ot=()=>{var _,S,I;if(W=0,!c.value||!A.value)return;const l=N.value,e=c.value.getContext("2d"),r=A.value.getContext("2d");if(e.clearRect(0,0,c.value.width,c.value.height),r.clearRect(0,0,A.value.width,A.value.height),!l)return;const h=X.value,i=Zt(h);$t(e,(_=l.grids)==null?void 0:_[h],l.bounds,nt,h,i,ot,{showContours:ue.value,contourLevels:$.value});const x=T.value?te(ee({},T.value),{animate:U.value,pulseT:performance.now()/1e3}):null;Rt(r,l.boreholes,h,i,l.bounds,ot,((I=(S=ne.value)==null?void 0:S.borehole)==null?void 0:I.borehole_name)||"",x),Sn(r,l.boreholes||[],l.bounds),ne.value&&(r.strokeStyle="rgba(15, 23, 42, 0.55)",r.lineWidth=1.1,r.setLineDash([5,4]),r.beginPath(),r.moveTo(ne.value.sx,0),r.lineTo(ne.value.sx,A.value.height),r.moveTo(0,ne.value.sy),r.lineTo(A.value.width,ne.value.sy),r.stroke(),r.setLineDash([])),U.value&&Se()},kn=()=>{var e;P=0;const l=N.value;if(l)for(const r of b){const h=rt[r.key];h&&Tt(h,(e=l.grids)==null?void 0:e[r.key],r.key,Zt(r.key))}},Se=()=>{W||(W=window.requestAnimationFrame(Ot))},Ct=()=>{P||(P=window.requestAnimationFrame(kn))},Kt=()=>{var i,x;const l=(i=N.value)==null?void 0:i.evaluation_inputs;if((l==null?void 0:l.mode)==="real_label_stream"){const _=Array.isArray(l.y_true)?l.y_true:[],S=Array.isArray(l.y_prob)?l.y_prob:[];if(_.length===S.length&&_.length>=2){const I=_.map(L=>Number(L)>=1?1:0),se=S.map(L=>at(Number(L),0,1));if(se.every(L=>Number.isFinite(L))&&new Set(I).size>1)return{mode:"real_label_stream",source:String(l.source||""),sourceFile:String(l.source||""),y_true:I,y_prob:se,yTrue:I,yProb:se}}}const e=((x=N.value)==null?void 0:x.boreholes)||[];if(e.length<4)return null;let r=e.map(_=>_.rsi<50||_.bri<50||_.asi<50?1:0);const h=e.map(_=>at(1-Number(_.mpi||0)/100,0,1));if(new Set(r).size<2){const _=e.map(I=>Number(I.mpi||0)).sort((I,se)=>I-se),S=_[Math.floor(_.length/2)];r=e.map(I=>Number(I.mpi||0)<=S?1:0)}return{mode:"pseudo_threshold",source:"",sourceFile:"",y_true:r,y_prob:h,yTrue:r,yProb:h}},Cn=()=>we(this,null,function*(){var r,h;const l=++m,e=Kt();if(!e){if(l!==m)return;Ge.value="none",Qe.value="",G.value=null,de.value="当前煤层钻孔点不足，无法计算评估指标。";return}if(l===m){Ge.value=e.mode||"pseudo_threshold",Qe.value=e.sourceFile||"",ke.value=!0,de.value="";try{const i=yield po({y_true:e.y_true||e.yTrue,y_prob:e.y_prob||e.yProb});if(l!==m)return;G.value=i.data}catch(i){if(l!==m)return;G.value=null,de.value=((h=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:h.detail)||"评估指标计算失败"}finally{l===m&&(ke.value=!1)}}}),Qt=l=>we(this,null,function*(){N.value=l,ne.value=null,xe.value="all",yield jt(),Jt(),Bt(),Se(),Ct(),Cn()}),At=(...e)=>we(this,[...e],function*({force:l=!1}={}){var i,x;if(!k.value)return;const r=++oe,h=wn();if(!l&&tt.has(h)){if(r!==oe)return;yield Qt(tt.get(h));return}fe.value=!0;try{const _=yield mo(k.value,R.value,Y.value,Ue.value);if(r!==oe)return;const S=_.data;tt.set(h,S),yield Qt(S),ve("AlgorithmValidation",{validationReady:!0})}catch(_){if(r!==oe)return;de.value=((x=(i=_==null?void 0:_.response)==null?void 0:i.data)==null?void 0:x.detail)||"空间总览加载失败"}finally{r===oe&&(fe.value=!1)}}),An=l=>{const e=String(l||"").toLowerCase();["tp","tn","fp","fn"].includes(e)&&a.value&&(xe.value=xe.value===e?"all":e,Se())},en=()=>{xe.value="all",Se()},tn=l=>{l.key==="Escape"&&xe.value!=="all"&&en()},Nn=l=>{var e,r;!$e.value||!s.value||l.pointerType==="mouse"&&l.button!==0||be.value!==null&&be.value!==l.pointerId||(be.value=l.pointerId,(r=(e=s.value).setPointerCapture)==null||r.call(e,l.pointerId),bt(l.clientX,l.clientY))},Mn=l=>{var me,L,F,Me,Le;if(be.value!==null&&l.pointerId!==be.value||!A.value||!$e.value)return;const e=A.value.getBoundingClientRect(),r=window.devicePixelRatio||1,h=(l.clientX-e.left)*r,i=(l.clientY-e.top)*r;if(Ie.x=l.clientX-e.left,Ie.y=l.clientY-e.top,nt.isDragging){gt(l.clientX,l.clientY),Se();return}const x=(me=N.value)==null?void 0:me.bounds,_=yt(h,i,x),S=X.value,I=xn(_.x,_.y,((L=N.value)==null?void 0:L.boreholes)||[]),se=Pt(h,i,((F=N.value)==null?void 0:F.boreholes)||[],x,ot);ne.value={sx:h,sy:i,worldX:_.x,worldY:_.y,gridValue:Ft((Le=(Me=N.value)==null?void 0:Me.grids)==null?void 0:Le[S],x,_.x,_.y),borehole:se,nearestBorehole:I.borehole,nearestDistance:I.distance},Se()},In=l=>{var e,r;be.value!==null&&l.pointerId!==be.value||((r=(e=s.value)==null?void 0:e.hasPointerCapture)!=null&&r.call(e,l.pointerId)&&s.value.releasePointerCapture(l.pointerId),be.value=null,lt())},$n=l=>{var e,r;be.value!==null&&l.pointerId!==be.value||((r=(e=s.value)==null?void 0:e.hasPointerCapture)!=null&&r.call(e,l.pointerId)&&s.value.releasePointerCapture(l.pointerId),be.value=null,lt(),ne.value=null,Se())},Rn=l=>{var e,r;if(be.value!==null&&l.pointerId===be.value){if((r=(e=s.value)==null?void 0:e.hasPointerCapture)==null?void 0:r.call(e,l.pointerId))return;be.value=null,lt()}nt.isDragging||(ne.value=null,Se())},Pn=l=>{var x;if(!A.value||!$e.value)return;const e=A.value.getBoundingClientRect(),r=window.devicePixelRatio||1,h=(l.clientX-e.left)*r,i=(l.clientY-e.top)*r;xt(l.deltaY<0?1.14:.88,h,i,(x=N.value)==null?void 0:x.bounds),Se()},Fn=(l,e)=>{O.metric=l,nn(l,e)},nn=(l,e)=>{if(!y.value)return;const r=y.value.getBoundingClientRect();O.visible=!0,O.metric=l,O.x=e.clientX-r.left,O.y=e.clientY-r.top},Tn=()=>{O.visible=!1},on=l=>String(l||"figure").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),ln=(l,e="image/png",r=1)=>new Promise((h,i)=>{l.toBlob(x=>{x?h(x):i(new Error("Canvas 导出失败"))},e,r)}),Ln=l=>{const e=l.cloneNode(!0);return e.getAttribute("xmlns")||e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.getAttribute("xmlns:xlink")||e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),new XMLSerializer().serializeToString(e)},zn=(l,e,r,h=3)=>we(this,null,function*(){const i=new Blob([l],{type:"image/svg+xml;charset=utf-8"}),x=URL.createObjectURL(i);try{const _=yield new Promise((se,me)=>{const L=new Image;L.onload=()=>se(L),L.onerror=()=>me(new Error("SVG 转 PNG 失败")),L.src=x}),S=document.createElement("canvas");S.width=Math.max(1,Math.round(e*h)),S.height=Math.max(1,Math.round(r*h));const I=S.getContext("2d");return I.fillStyle="#ffffff",I.fillRect(0,0,S.width,S.height),I.drawImage(_,0,0,S.width,S.height),yield ln(S,"image/png",1)}finally{URL.revokeObjectURL(x)}}),Dn=()=>new Promise(l=>window.requestAnimationFrame(l)),an=l=>we(this,null,function*(){const e=et.value;et.value=!0,Ot(),yield Dn();try{return yield l()}finally{et.value=e,Ot(),U.value&&Se()}}),En=()=>we(this,null,function*(){!c.value||!A.value||(yield an(()=>we(this,null,function*(){const e=c.value.width,r=c.value.height,h=document.createElement("canvas");h.width=Math.round(e*3),h.height=Math.round(r*3);const i=h.getContext("2d");i.scale(3,3),i.fillStyle="#ffffff",i.fillRect(0,0,e,r),i.drawImage(c.value,0,0),i.drawImage(A.value,0,0),i.fillStyle="rgba(15, 23, 42, 0.92)",i.font="14px 'Times New Roman', 'Noto Serif SC', serif",i.fillText(`煤层：${k.value||"--"} | 指标：${le(X.value)} | 分辨率：${R.value}`,16,26);const x=document.createElement("a");x.href=h.toDataURL("image/png",1),x.download=`algorithm_validation_${k.value||"seam"}_${X.value}_hd.png`,x.click()})))}),Bn=()=>we(this,null,function*(){if(!(!z.value||!$e.value||Ce.value)){Ce.value=!0,Pe.value="";try{yield an(()=>we(this,null,function*(){var Me,Le,Ye;const l=yield ft(),e=new l,r=new Date().toISOString().replace(/[:.]/g,"-"),h=document.createElement("canvas"),i=3,x=c.value.width,_=c.value.height;h.width=Math.round(x*i),h.height=Math.round(_*i);const S=h.getContext("2d");S.scale(i,i),S.fillStyle="#ffffff",S.fillRect(0,0,x,_),S.drawImage(c.value,0,0),S.drawImage(A.value,0,0),S.fillStyle="rgba(15, 23, 42, 0.92)",S.font="14px 'Times New Roman', 'Noto Serif SC', serif",S.fillText(`煤层：${k.value||"--"} | 指标：${le(X.value)} | 分辨率：${R.value}`,16,26),e.file("figures/main_heatmap_hd.png",yield ln(h,"image/png",1));const I=z.value.querySelectorAll(".science-section .figure-card");let se=0;for(const Ze of I){se+=1;const Te=((Le=(Me=Ze.querySelector("h4"))==null?void 0:Me.textContent)==null?void 0:Le.trim())||`图${se}`,Xe=Ze.querySelector(".science-chart svg");if(!Xe)continue;const Nt=Xe.getBoundingClientRect(),Ve=(Ye=Xe.viewBox)==null?void 0:Ye.baseVal,Yn=(Ve==null?void 0:Ve.width)||Nt.width||960,Zn=(Ve==null?void 0:Ve.height)||Nt.height||540,sn=Ln(Xe),rn=on(`${String(se).padStart(2,"0")}_${Te}`);e.file(`figures/${rn}.svg`,sn),e.file(`figures/${rn}.png`,yield zn(sn,Yn,Zn,3))}e.file("data/spatial_statistics.json",JSON.stringify(He.value,null,2)),e.file("data/evaluation.json",JSON.stringify(G.value||{},null,2)),e.file("data/science_result.json",JSON.stringify(mt.value||{},null,2)),e.file("README.txt",["新算法实证图组导出包",`时间: ${new Date().toLocaleString()}`,`煤层: ${k.value||"--"}`,`主图指标: ${le(X.value)}`,"","内容说明:","- figures/: 主热力图和图2-图11（SVG+PNG）","- data/: 统计与评估原始数据"].join(`
`));const me=yield e.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),L=URL.createObjectURL(me),F=document.createElement("a");F.href=L,F.download=`新算法实证图组_${on(k.value||"seam")}_${r}.zip`,F.click(),URL.revokeObjectURL(L)})),Pe.value="图组包导出完成。"}catch(l){Pe.value=(l==null?void 0:l.message)||"图组包导出失败"}finally{Ce.value=!1}}}),On=()=>{if(!N.value)return;const l=new Blob([JSON.stringify(N.value,null,2)],{type:"application/json"}),e=URL.createObjectURL(l),r=document.createElement("a");r.href=e,r.download=`algorithm_validation_${k.value||"seam"}_spatial.json`,r.click(),URL.revokeObjectURL(e)},Un=()=>we(this,null,function*(){z.value&&(document.fullscreenElement?yield document.exitFullscreen():yield z.value.requestFullscreen())}),Vn=l=>Array.isArray(l)?l[0]||"":typeof l=="string"?l:"",Gn=()=>{w.push({name:"Report",query:k.value?{seam:k.value}:void 0})},Wn=()=>we(this,null,function*(){var l,e,r,h;try{const i=yield co(),x=((l=i==null?void 0:i.data)==null?void 0:l.seams)||[];if(B.value=x,x.length===0)return;const _=Vn((e=Q.query)==null?void 0:e.seam)||Ne.selectedSeam||"16-3煤",S=x.find(I=>I.name===_);k.value=(S==null?void 0:S.name)||x[0].name,f(k.value)}catch(i){de.value=((h=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:h.detail)||"煤层列表加载失败"}}),jn=l=>we(this,null,function*(){if(!l)return null;if(We.has(l))return We.get(l);try{const{data:e}=yield yo(l);return We.set(l,e),e}catch(e){return We.set(l,null),null}}),Hn=()=>we(this,null,function*(){var se,me;if(!k.value)return null;const{data:l}=yield fo(k.value),r=((l==null?void 0:l.boreholes)||[]).find(L=>Array.isArray(L.layers)&&L.layers.length>0);if(!r)return null;const h=r.layers||[],i=h.find(L=>L.name===k.value),x=h.filter(L=>L.name!==k.value),_=[];for(const L of x){const F=yield jn(L.name);_.push({thickness:Number(L.thickness||0),name:L.name||"",density:F==null?void 0:F.density,bulk_modulus:F==null?void 0:F.bulk_modulus,shear_modulus:F==null?void 0:F.shear_modulus,cohesion:F==null?void 0:F.cohesion,friction_angle:F==null?void 0:F.friction_angle,tensile_strength:F==null?void 0:F.tensile_strength,compressive_strength:F==null?void 0:F.compressive_strength,elastic_modulus:F==null?void 0:F.elastic_modulus,poisson_ratio:F==null?void 0:F.poisson_ratio})}const S=Number((me=(se=r.seam_top_depth)!=null?se:r.total_overburden_thickness)!=null?me:0),I=Number((i==null?void 0:i.thickness)||0);return{x:Number(r.x||0),y:Number(r.y||0),borehole:r.name||"",thickness:I,burial_depth:S,z_top:S,z_bottom:S+I,strata:_}}),qn=()=>we(this,null,function*(){var l,e;Fe.value="",Ae.value=null,Oe.value=!0;try{const r=yield Hn();if(!r){Fe.value="未找到可用于对照的钻孔数据";return}const{data:h}=yield vo({point:r,geomodel_job_id:it.value||null,include_baseline:!0});Ae.value=h}catch(r){Fe.value=((e=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:e.detail)||(r==null?void 0:r.message)||"地质对照计算失败"}finally{Oe.value=!1}});return Be(X,()=>Se()),Be(ue,()=>Se()),Be($,()=>{Xt(),Se()}),Be(j,()=>{Se(),Ct()}),Be([R,Y],()=>{ye.value&&At({force:!1})}),Be(k,()=>{f(k.value||""),Fe.value="",Ae.value=null,ye.value&&At({force:!1})}),Be(a,l=>{!l&&xe.value!=="all"&&(xe.value="all",Se())}),Be(()=>[H.rsi,H.bri,H.asi],()=>{ye.value&&(window.clearTimeout(V),V=window.setTimeout(()=>At({force:!1}),300))}),hn(()=>we(this,null,function*(){Xt(),yield Wn(),k.value&&(yield At({force:!0})),ye.value=!0,window.addEventListener("resize",E),window.addEventListener("keydown",tn)})),bn(()=>{var l,e;window.clearTimeout(V),window.clearTimeout(M),W&&window.cancelAnimationFrame(W),P&&window.cancelAnimationFrame(P),s.value&&be.value!==null&&((e=(l=s.value).hasPointerCapture)!=null&&e.call(l,be.value))&&s.value.releasePointerCapture(be.value),be.value=null,window.removeEventListener("resize",E),window.removeEventListener("keydown",tn)}),(l,e)=>{var r,h;return J(),K("div",{ref_key:"pageRoot",ref:z,class:"validation-page"},[o("nav",Ko,[o("div",Qo,[o("button",{class:"icon-btn",type:"button",title:"返回",onClick:e[0]||(e[0]=i=>so(w).back())},[...e[19]||(e[19]=[o("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{d:"M19 12H5m0 0 6-6m-6 6 6 6"})],-1)])]),e[24]||(e[24]=o("h1",null,"新算法实证",-1)),e[25]||(e[25]=o("span",{class:"divider"},null,-1)),o("label",el,[e[20]||(e[20]=o("span",null,"煤层",-1)),De(o("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>k.value=i)},[(J(!0),K(Je,null,Ut(B.value,i=>(J(),K("option",{key:i.name,value:i.name},v(i.name),9,tl))),128))],512),[[mn,k.value]])]),$e.value?(J(),K("div",nl,[o("span",null,[e[21]||(e[21]=ze("均值 ",-1)),o("b",null,v(D(ut.value.mean)),1)]),o("span",null,[e[22]||(e[22]=ze("最低 ",-1)),o("b",null,v(D(ut.value.min)),1)]),o("span",ol,[e[23]||(e[23]=ze("高风险点 ",-1)),o("b",null,v(Dt.value),1)])])):pe("",!0)]),o("div",ll,[o("button",{class:Ke(["tool-btn",{active:re.value}]),type:"button",onClick:e[2]||(e[2]=i=>re.value=!re.value)},"权重",2),o("button",{class:Ke(["tool-btn",{active:he.value}]),type:"button",onClick:e[3]||(e[3]=i=>he.value=!he.value)},"地质对照",2),o("button",{class:Ke(["tool-btn",{active:ge.value}]),type:"button",onClick:e[4]||(e[4]=i=>ge.value=!ge.value)},"评估",2),o("button",{class:"tool-btn",type:"button",onClick:En},"导出高清图"),o("button",{class:"tool-btn",type:"button",disabled:Ce.value||!$e.value,onClick:Bn},v(Ce.value?"打包中...":"导出图组包"),9,al),o("button",{class:"tool-btn",type:"button",disabled:!$e.value,onClick:Gn},"下一步：结果报告",8,sl),o("button",{class:"tool-btn",type:"button",onClick:Un},"全屏")])]),o("section",rl,[(J(),K(Je,null,Ut(b,i=>{var x,_,S,I,se,me,L,F,Me;return o("button",{key:i.key,class:Ke(["metric-card",{active:X.value===i.key,problematic:ae(i.key)}]),type:"button",onClick:Le=>X.value=i.key},[o("div",ul,[o("strong",null,v(i.label),1),o("span",null,v(i.desc),1),ae(i.key)?(J(),K("em",cl,"! 异常")):pe("",!0)]),o("div",dl,v(D((S=(_=(x=N.value)==null?void 0:x.statistics)==null?void 0:_[i.key])==null?void 0:S.mean)),1),o("div",ml,[o("span",null,"最低 "+v(D((me=(se=(I=N.value)==null?void 0:I.statistics)==null?void 0:se[i.key])==null?void 0:me.min)),1),o("span",null,"最高 "+v(D((Me=(F=(L=N.value)==null?void 0:L.statistics)==null?void 0:F[i.key])==null?void 0:Me.max)),1)]),o("div",{class:"risk-bar",style:vt({background:ie(i.key)})},null,4)],10,il)}),64))]),o("section",pl,[o("div",vl,[o("header",fl,[o("div",null,[o("h2",null,v(le(X.value))+"全矿区插值热力图",1),e[26]||(e[26]=o("p",null,"双击适配视图，拖拽平移，滚轮缩放",-1))]),o("div",yl,[o("label",null,[e[27]||(e[27]=ze("分辨率",-1)),De(o("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>R.value=i),type:"number",min:"20",max:"120",step:"5"},null,512),[[st,R.value,void 0,{number:!0}]])]),o("label",null,[e[28]||(e[28]=ze("线级",-1)),De(o("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>$.value=i),type:"number",min:"5",max:"24",step:"1"},null,512),[[st,$.value,void 0,{number:!0}]])]),o("label",null,[e[30]||(e[30]=ze("插值 ",-1)),De(o("select",{"onUpdate:modelValue":e[7]||(e[7]=i=>Y.value=i)},[...e[29]||(e[29]=[o("option",{value:"idw"},"反距离权重",-1),o("option",{value:"linear"},"线性插值",-1),o("option",{value:"nearest"},"最近邻",-1),o("option",{value:"kriging"},"克里金",-1)])],512),[[mn,Y.value]])]),o("label",hl,[De(o("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>ue.value=i),type:"checkbox"},null,512),[[pn,ue.value]]),e[31]||(e[31]=ze("等值线",-1))]),o("label",bl,[De(o("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>j.value=i),type:"checkbox"},null,512),[[pn,j.value]]),e[32]||(e[32]=ze("固定量程(0-100)",-1))])])]),$e.value?(J(),K("div",gl,[e[33]||(e[33]=o("span",{class:"trust-chip real"},"空间图：真实钻孔与坐标数据",-1)),o("span",xl,"评估："+v(Et.value),1),o("span",wl,"算法："+v(Lt.value),1),_t.value.length?(J(),K("span",_l," 指标异常："+v(_t.value.join("、")),1)):pe("",!0),zt.value?(J(),K("span",Sl,"当前指标范围 "+v(D(St.value))+"，固定量程会压缩色差",1)):pe("",!0),xe.value!=="all"&&u.value>0?(J(),K("span",kl," 联动高亮 "+v(t(xe.value))+" · "+v(u.value)+"点 ",1)):pe("",!0),Qe.value?(J(),K("span",Cl,"标签源 "+v(Qe.value),1)):pe("",!0),o("span",Al,"钻孔 "+v(((r=N.value)==null?void 0:r.borehole_count)||0)+" 个 · 坐标源 zuobiao.csv",1)])):pe("",!0),o("div",{ref_key:"stageContainer",ref:s,class:"stage",onPointerdown:Nn,onPointermove:Mn,onPointerup:In,onPointercancel:$n,onPointerleave:Rn,onWheel:vn(Pn,["prevent"]),onContextmenu:e[10]||(e[10]=vn(()=>{},["prevent"])),onDblclick:Bt},[o("canvas",{ref_key:"heatmapCanvas",ref:c,class:"layer"},null,512),o("canvas",{ref_key:"overlayCanvas",ref:A,class:"layer"},null,512),fe.value?(J(),K("div",Nl,[e[34]||(e[34]=o("div",{class:"skeleton"},null,-1)),e[35]||(e[35]=o("div",{class:"skeleton"},null,-1)),o("p",null,"正在计算 "+v(k.value||"目标煤层")+" 空间指标...",1)])):pe("",!0)],544),o("footer",Ml,[o("div",{class:"legend-track",style:vt({background:ie(X.value)})},null,4),o("div",Il,[o("span",null,v(D(dt.value.min)),1),o("span",null,v(D(dt.value.mean)),1),o("span",null,v(D(dt.value.max)),1)])])]),o("aside",{ref_key:"thumbPanelRef",ref:y,class:Ke(["thumb-panel",{collapsed:ce.value}])},[o("header",null,[e[36]||(e[36]=o("h3",null,"指标缩略图",-1)),o("button",{class:"icon-btn mini",type:"button",onClick:e[11]||(e[11]=i=>ce.value=!ce.value)},v(ce.value?"展开":"收起"),1)]),o("div",$l,[(J(),K(Je,null,Ut(b,i=>{var x,_;return o("button",{key:`thumb-${i.key}`,class:Ke(["thumb-item",{active:X.value===i.key}]),type:"button",onClick:S=>X.value=i.key,onMouseenter:S=>Fn(i.key,S),onMousemove:S=>nn(i.key,S),onMouseleave:Tn},[o("canvas",{ref_for:!0,ref:_n(i.key),class:"thumb-canvas"},null,512),o("div",Pl,[o("strong",null,v(i.label),1),o("span",null,"均值 "+v(D((x=He.value[i.key])==null?void 0:x.mean)),1),o("span",null,"σ "+v(D((_=He.value[i.key])==null?void 0:_.std)),1)])],42,Rl)}),64))]),O.visible&&qe.value?(J(),K("div",{key:0,class:"thumb-tooltip",style:vt({left:`${O.x+12}px`,top:`${O.y+12}px`})},[o("p",null,[o("strong",null,v(le(O.metric))+"统计",1)]),o("p",null,"最小值 "+v(D(qe.value.min)),1),o("p",null,"最大值 "+v(D(qe.value.max)),1),o("p",null,"均值 "+v(D(qe.value.mean)),1),o("p",null,"标准差 "+v(D(qe.value.std)),1)],4)):pe("",!0)],2)]),Re(Gt,{name:"fade-up"},{default:Vt(()=>[re.value?(J(),K("aside",Fl,[o("header",null,[e[37]||(e[37]=o("h3",null,"权重配置",-1)),o("button",{type:"button",class:"close-btn",onClick:e[12]||(e[12]=i=>re.value=!1)},"×")]),e[41]||(e[41]=o("p",null,"RSI / BRI / ASI 自动归一化。调整后 300ms 内自动重算。",-1)),o("label",Tl,[e[38]||(e[38]=o("span",null,"RSI",-1)),De(o("input",{"onUpdate:modelValue":e[13]||(e[13]=i=>H.rsi=i),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[st,H.rsi,void 0,{number:!0}]]),o("strong",null,v(pt(Ue.value.rsi)),1)]),o("label",Ll,[e[39]||(e[39]=o("span",null,"BRI",-1)),De(o("input",{"onUpdate:modelValue":e[14]||(e[14]=i=>H.bri=i),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[st,H.bri,void 0,{number:!0}]]),o("strong",null,v(pt(Ue.value.bri)),1)]),o("label",zl,[e[40]||(e[40]=o("span",null,"ASI",-1)),De(o("input",{"onUpdate:modelValue":e[15]||(e[15]=i=>H.asi=i),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[st,H.asi,void 0,{number:!0}]]),o("strong",null,v(pt(Ue.value.asi)),1)])])):pe("",!0)]),_:1}),Re(Gt,{name:"fade-up"},{default:Vt(()=>{var i,x,_,S;return[he.value?(J(),K("aside",Dl,[o("header",null,[e[42]||(e[42]=o("h3",null,"Geology-aware 对照",-1)),o("button",{type:"button",class:"close-btn",onClick:e[16]||(e[16]=I=>he.value=!1)},"×")]),e[49]||(e[49]=o("p",null,"基于当前煤层首个有效钻孔，计算 baseline 与 geology-aware 对照结果。",-1)),o("label",El,[e[43]||(e[43]=o("span",null,"Geomodel任务ID",-1)),De(o("input",{"onUpdate:modelValue":e[17]||(e[17]=I=>it.value=I),type:"text",placeholder:"可选，不填时走默认特征"},null,512),[[st,it.value,void 0,{trim:!0}]])]),o("button",{class:"tool-btn small geo-run-btn",type:"button",disabled:Oe.value||!k.value,onClick:qn},v(Oe.value?"计算中...":"执行对照"),9,Bl),Fe.value?(J(),K("p",Ol,v(Fe.value),1)):pe("",!0),Ae.value?(J(),K("div",Ul,[o("div",Vl,[e[44]||(e[44]=o("span",null,"模式",-1)),o("strong",null,v(Ae.value.algorithm_mode),1)]),o("div",Gl,[e[45]||(e[45]=o("span",null,"Baseline",-1)),o("strong",null,v(D((i=Ae.value.baseline)==null?void 0:i.mpi)),1)]),o("div",Wl,[e[46]||(e[46]=o("span",null,"Geo-aware",-1)),o("strong",null,v(D((x=Ae.value.geology_aware)==null?void 0:x.mpi)),1)]),o("div",jl,[e[47]||(e[47]=o("span",null,"差值",-1)),o("strong",null,v(D((((_=Ae.value.geology_aware)==null?void 0:_.mpi)||0)-(((S=Ae.value.baseline)==null?void 0:S.mpi)||0))),1)]),o("div",Hl,[e[48]||(e[48]=o("span",null,"回退",-1)),o("strong",null,v(Ae.value.fallback_used?"是":"否"),1)])])):pe("",!0)])):pe("",!0)]}),_:1}),Re(Gt,{name:"drawer-up"},{default:Vt(()=>{var i,x,_,S,I,se,me,L;return[ge.value?(J(),K("section",ql,[o("header",null,[e[50]||(e[50]=o("h3",null,"算法评估面板（当前煤层批量结果）",-1)),o("div",Yl,[o("button",{type:"button",class:"tool-btn small",onClick:On},"导出数据"),o("button",{type:"button",class:"close-btn",onClick:e[18]||(e[18]=F=>ge.value=!1)},"×")])]),ke.value?(J(),K("div",Zl,"正在计算评估指标...")):G.value?(J(),K(Je,{key:2},[o("div",Jl,[o("div",Kl,[e[51]||(e[51]=o("span",null,"AUC",-1)),o("strong",null,v(D(G.value.auc,4)),1)]),o("div",Ql,[e[52]||(e[52]=o("span",null,"PR-AUC",-1)),o("strong",null,v(D(G.value.pr_auc,4)),1)]),o("div",ea,[e[53]||(e[53]=o("span",null,"F1",-1)),o("strong",null,v(D(G.value.f1,4)),1)]),o("div",ta,[e[54]||(e[54]=o("span",null,"Brier",-1)),o("strong",null,v(D(G.value.brier,4)),1)]),o("div",na,[e[55]||(e[55]=o("span",null,"ECE",-1)),o("strong",null,v(D(G.value.ece,4)),1)])]),o("div",oa,[o("div",la,[e[60]||(e[60]=o("h4",null,"混淆矩阵",-1)),o("div",aa,[o("div",sa,[e[56]||(e[56]=o("span",null,"TN",-1)),o("b",null,v((x=(i=G.value.confusion_matrix)==null?void 0:i.tn)!=null?x:0),1)]),o("div",ra,[e[57]||(e[57]=o("span",null,"FP",-1)),o("b",null,v((S=(_=G.value.confusion_matrix)==null?void 0:_.fp)!=null?S:0),1)]),o("div",ia,[e[58]||(e[58]=o("span",null,"FN",-1)),o("b",null,v((se=(I=G.value.confusion_matrix)==null?void 0:I.fn)!=null?se:0),1)]),o("div",ua,[e[59]||(e[59]=o("span",null,"TP",-1)),o("b",null,v((L=(me=G.value.confusion_matrix)==null?void 0:me.tp)!=null?L:0),1)])])]),o("div",ca,[e[67]||(e[67]=o("h4",null,"基线对比（SVG）",-1)),(J(),K("svg",da,[e[61]||(e[61]=o("rect",{x:"0",y:"0",width:"560",height:"170",fill:"#fff"},null,-1)),e[62]||(e[62]=o("text",{x:"14",y:"26"},"基线 MPI",-1)),e[63]||(e[63]=o("rect",{x:"112",y:"12",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"12",width:qt(kt.value),height:"18",rx:"9",fill:"#64748b"},null,8,ma),o("text",pa,v(D(kt.value,3)),1),e[64]||(e[64]=o("text",{x:"14",y:"90"},"新算法 MPI",-1)),e[65]||(e[65]=o("rect",{x:"112",y:"76",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),o("rect",{x:"112",y:"76",width:qt(ct.value),height:"18",rx:"9",fill:"#0f766e"},null,8,va),o("text",fa,v(D(ct.value,3)),1),e[66]||(e[66]=o("text",{x:"14",y:"148",fill:"#64748b"},"注：基于当前煤层批量钻孔的空间实证均值。",-1))]))])])],64)):(J(),K("div",Xl,v(de.value||"暂无评估数据"),1))])):pe("",!0)]}),_:1}),$e.value?(J(),K("section",ya,[o("header",null,[e[69]||(e[69]=o("h3",null,"期刊级图组（自动生成）",-1)),e[70]||(e[70]=o("p",null,"全部图件已直接展示，满足对比、消融、校准、判别与机制解释需求。",-1)),e[71]||(e[71]=o("p",{class:"data-note"},"说明：评估与部分机制曲线目前为模型推导/示意，不等同于真实标签实验结果。",-1)),o("p",ha,[e[68]||(e[68]=ze(" 图11支持点击 TP/TN/FP/FN 联动主图高亮。 ",-1)),xe.value!=="all"?(J(),K(Je,{key:0},[ze("可按 Esc 快速清除筛选。")],64)):pe("",!0),a.value?pe("",!0):(J(),K(Je,{key:1},[ze("当前样本与钻孔点未一一对齐，联动高亮不可用。")],64))]),e[72]||(e[72]=o("p",{class:"data-note"},"导出高清图与图组包时会自动冻结脉冲动画，保证稿件图件为静态一致版。",-1)),xe.value!=="all"?(J(),K("button",{key:0,type:"button",class:"tool-btn small",onClick:en},"清除联动高亮")):pe("",!0),Pe.value?(J(),K("p",ba,v(Pe.value),1)):pe("",!0)]),Re(Jo,{result:mt.value,evaluation:G.value,onMatrixSelect:An},null,8,["result","evaluation"])])):pe("",!0),ne.value&&$e.value?(J(),K("div",{key:1,class:"hover-tooltip",style:vt({left:`${Ie.x+14}px`,top:`${Ie.y+14}px`})},[o("p",null,"坐标："+v(D(ne.value.worldX,2))+", "+v(D(ne.value.worldY,2)),1),o("p",null,v(le(X.value))+"插值："+v(D(ne.value.gridValue,3)),1),o("p",null,"最近钻孔："+v(((h=ne.value.nearestBorehole)==null?void 0:h.borehole_name)||"--")+"（"+v(D(ne.value.nearestDistance,1))+" m）",1),ne.value.borehole?(J(),K(Je,{key:0},[o("p",null,[o("strong",null,v(ne.value.borehole.borehole_name),1)]),o("p",null,"RSI "+v(D(ne.value.borehole.rsi,2))+" | BRI "+v(D(ne.value.borehole.bri,2)),1),o("p",null,"ASI "+v(D(ne.value.borehole.asi,2))+" | MPI "+v(D(ne.value.borehole.mpi,2)),1),o("p",ga,v(gn(ne.value.borehole.risk_label)),1)],64)):pe("",!0)],4)):pe("",!0)],512)}}},$a=Ht(wa,[["__scopeId","data-v-cc49e807"]]);export{$a as default};
