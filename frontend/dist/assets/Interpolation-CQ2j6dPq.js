var Re=Object.defineProperty,We=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ht=Math.pow,Ce=(q,lt,j)=>lt in q?Re(q,lt,{enumerable:!0,configurable:!0,writable:!0,value:j}):q[lt]=j,ue=(q,lt)=>{for(var j in lt||(lt={}))Ie.call(lt,j)&&Ce(q,j,lt[j]);if(we)for(var j of we(lt))Ee.call(lt,j)&&Ce(q,j,lt[j]);return q},de=(q,lt)=>We(q,Ne(lt));var Vt=(q,lt,j)=>new Promise((W,Nt)=>{var St=ft=>{try{bt(j.next(ft))}catch(wt){Nt(wt)}},$t=ft=>{try{bt(j.throw(ft))}catch(wt){Nt(wt)}},bt=ft=>ft.done?W(ft.value):Promise.resolve(ft.value).then(St,$t);bt((j=j.apply(q,lt)).next())});import{w as De,b5 as x,b8 as _,b7 as o,bb as k,bn as ee,bm as Te,bi as et,bc as oe,b9 as le,ba as Ht,b as M,c as Wt,bf as Ye,bq as te,br as ke,bs as Me,bt as Le,bo as ve,b6 as Fe,n as he}from"./vendor-CA5Q5CdR.js";import{u as Xe,a as ze}from"./vue-router-D9BXaJFq.js";import{_ as Ae,u as He,a as qe}from"./index-oBIkjPyK.js";import{g as Ue,a as Oe,b as Ve,c as Qe}from"./api-CJun_zz_.js";import"./network-T6nY3V_4.js";const Je={key:0,class:"error-placeholder"},Ke={class:"error-detail"},je={key:1,class:"loading-placeholder"},Ge=["src"],Ze=["viewBox"],to={key:0},eo=["x1","y1","x2","y2"],oo=["cx","cy"],lo=["x","y"],so=["cx","cy"],no=["x","y"],ao=["x","y"],io=["x1","y1","x2","y2"],ro=["transform","onMouseenter"],co=["fill"],uo={class:"map-controls"},vo={key:1,class:"legend"},ho={class:"legend-title"},fo={class:"legend-range"},mo={class:"legend-min"},go={class:"legend-bar"},po={class:"legend-max"},yo={class:"legend-mid"},bo={key:0,class:"tooltip-borehole"},xo={class:"tooltip-name"},ko={class:"tooltip-coords"},_o={class:"tooltip-value"},So={class:"tooltip-label"},wo={class:"tooltip-number"},Co={__name:"ContourMap",props:{imageUrl:{type:String,default:""},boreholes:{type:Array,default:()=>[]},bounds:{type:Object,default:()=>({})},property:{type:String,default:"thickness"},propertyLabel:{type:String,default:"厚度"},valueRange:{type:Object,default:()=>({min:0,max:10})},colormap:{type:String,default:"YlOrBr"},crossSectionMode:{type:Boolean,default:!1}},emits:["crossSectionChange","crossSectionComplete"],setup(q,{expose:lt,emit:j}){const W=q,Nt=j,St=M(null),$t=M(800),bt=M(600),ft=M(!1),wt=M(null),N=M(1),Tt=M(0),st=M(0),mt=M(!1),Q=M(!1),It=M({x:0,y:0}),Ct=M(null),rt=M(null),Mt=M({x:0,y:0}),xt=M(!0),f=M({start:null,end:null,distance:null}),J=M(null),ct=Wt(()=>{if(W.bounds&&W.bounds.min_x!==void 0)return{minX:W.bounds.min_x,maxX:W.bounds.max_x,minY:W.bounds.min_y,maxY:W.bounds.max_y,rangeX:W.bounds.max_x-W.bounds.min_x,rangeY:W.bounds.max_y-W.bounds.min_y};if(W.boreholes.length===0)return null;let c=1/0,r=-1/0,m=1/0,S=-1/0;return W.boreholes.forEach(A=>{A.x<c&&(c=A.x),A.x>r&&(r=A.x),A.y<m&&(m=A.y),A.y>S&&(S=A.y)}),{minX:c,maxX:r,minY:m,maxY:S,rangeX:r-c,rangeY:S-m}}),At=Wt(()=>{if(!ct.value||W.boreholes.length===0)return[];if(!ft.value||!W.imageUrl)return[];const c=ct.value,r=$t.value,m=bt.value;if(!Number.isFinite(r)||!Number.isFinite(m)||r<=0||m<=0)return[];if(!Number.isFinite(c.rangeX)||!Number.isFinite(c.rangeY)||c.rangeX<=0||c.rangeY<=0)return[];const S=r*.1,A=r*(1-.1-.85),tt=m*.1,nt=m*(1-.1-.8),gt=r-S-A,G=m-tt-nt;return W.boreholes.map(at=>{var Gt,ce;const pt=(Gt=at.x)!=null?Gt:at.borehole_x,Xt=(ce=at.y)!=null?ce:at.borehole_y;if(pt==null||Xt==null)return null;const jt=(pt-c.minX)/c.rangeX,re=(Xt-c.minY)/c.rangeY,ye=S+jt*gt,be=m-tt-re*G;return de(ue({},at),{x:pt,y:Xt,canvasX:Math.round(ye*10)/10,canvasY:Math.round(be*10)/10,color:Bt(at[W.property]||at.thickness||at.burial_depth)})}).filter(at=>at!==null)}),Bt=c=>{var A,tt;if(c==null)return"#3b82f6";const r=((A=W.valueRange)==null?void 0:A.min)||0,m=((tt=W.valueRange)==null?void 0:tt.max)||1,S=Math.max(0,Math.min(1,(c-r)/(m-r||1)));return W.colormap==="YlOrBr"?Qt(S,[{t:0,r:255,g:255,b:204},{t:.25,r:255,g:230,b:153},{t:.5,r:255,g:190,b:121},{t:.75,r:230,g:140,b:80},{t:1,r:160,g:80,b:50}]):Qt(S,[{t:0,r:68,g:1,b:84},{t:.25,r:59,g:82,b:139},{t:.5,r:33,g:154,b:141},{t:.75,r:94,g:201,b:98},{t:1,r:253,g:231,b:37}])},Qt=(c,r)=>{let m=r[0],S=r[r.length-1];for(let G=0;G<r.length-1;G++)if(c>=r[G].t&&c<=r[G+1].t){m=r[G],S=r[G+1];break}const A=S.t!==m.t?(c-m.t)/(S.t-m.t):0,tt=Math.round(m.r+(S.r-m.r)*A),nt=Math.round(m.g+(S.g-m.g)*A),gt=Math.round(m.b+(S.b-m.b)*A);return`rgb(${tt}, ${nt}, ${gt})`},Rt=Wt(()=>({transform:`scale(${N.value}) translate(${Tt.value/N.value}px, ${st.value/N.value}px)`,transformOrigin:"center center",transition:mt.value?"none":"transform 0.1s ease-out"})),se=Wt(()=>({position:"absolute",top:"50%",left:"50%",transform:`translate(-50%, -50%) scale(${N.value}) translate(${Tt.value/N.value}px, ${st.value/N.value}px)`,transformOrigin:"center center",pointerEvents:"none",transition:mt.value?"none":"transform 0.1s ease-out",maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto"})),ne=Wt(()=>({left:Mt.value.x+15+"px",top:Mt.value.y+15+"px"})),fe=Wt(()=>W.colormap==="YlOrBr"?"background: linear-gradient(to right, #fffacc, #ffe699, #ffbe79, #e68c50, #a05032)":"background: linear-gradient(to right, #440154, #3b528b, #21918c, #5ec962, #fde725)"),me=Wt(()=>{var m,S;const c=Number((m=W.valueRange)==null?void 0:m.min),r=Number((S=W.valueRange)==null?void 0:S.max);return!Number.isFinite(c)||!Number.isFinite(r)?0:(c+r)/2}),ae=c=>{$t.value=c.target.naturalWidth,bt.value=c.target.naturalHeight,ft.value=!0,wt.value=null},ie=c=>{var r;wt.value="图片加载失败，请检查数据",ft.value=!1,console.error("Image load error:",c,((r=W.imageUrl)==null?void 0:r.substring(0,50))+"...")},I=()=>{N.value=Math.min(N.value*1.2,3)},Jt=()=>{N.value=Math.max(N.value/1.2,.5)},Et=()=>{N.value=1,Tt.value=0,st.value=0},Lt=()=>{f.value={start:null,end:null,distance:null},J.value=null,Nt("crossSectionChange",null)},Dt=(c,r)=>{if(!St.value)return null;const m=St.value.getBoundingClientRect(),S=m.width/2,A=m.height/2,tt=(c-S-Tt.value)/N.value+S,nt=(r-A-st.value)/N.value+A,gt=(m.width-$t.value)/2,G=(m.height-bt.value)/2;return{x:tt-gt,y:nt-G}},qt=(c,r)=>{if(!ct.value)return null;const m=$t.value,S=bt.value,A=m*.1,tt=m*(1-.1-.85),nt=S*.1,gt=S*(1-.1-.8),G=m-A-tt,at=S-nt-gt,pt=ct.value,Xt=pt.minX+(c-A)/G*pt.rangeX,jt=pt.minY+(S-r-nt)/at*pt.rangeY;return{x:Xt,y:jt}},ge=c=>{var r,m;if(!(c.pointerType!=="touch"&&c.button!==0))if(Ct.value=c.pointerId,(m=(r=St.value)==null?void 0:r.setPointerCapture)==null||m.call(r,c.pointerId),W.crossSectionMode){const S=Dt(c.clientX,c.clientY);if(!S)return;if(!f.value.start)f.value.start=S,Q.value=!0;else if(f.value.end)f.value={start:S,end:null,distance:null},Q.value=!0;else{f.value.end=S,Q.value=!1;const A=qt(S.x,S.y),tt=qt(f.value.start.x,f.value.start.y);if(A&&tt){const nt=Math.sqrt(ht(tt.x-A.x,2)+ht(tt.y-A.y,2));f.value.distance=nt}J.value=null,Nt("crossSectionComplete",{start:qt(f.value.start.x,f.value.start.y),end:qt(f.value.end.x,f.value.end.y),startCanvas:f.value.start,endCanvas:f.value.end,distance:f.value.distance})}Nt("crossSectionChange",f.value)}else mt.value=!0,It.value={x:c.clientX-Tt.value,y:c.clientY-st.value}},Kt=c=>{var r,m;Ct.value!==null&&c.pointerId!==Ct.value||(Ct.value=null,(m=(r=St.value)==null?void 0:r.releasePointerCapture)==null||m.call(r,c.pointerId),mt.value=!1)},U=c=>{if(St.value){if(St.value.getBoundingClientRect(),W.crossSectionMode&&Q.value){const r=Dt(c.clientX,c.clientY);r&&(J.value=r),Mt.value={x:c.clientX,y:c.clientY};return}if(mt.value){Tt.value=c.clientX-It.value.x,st.value=c.clientY-It.value.y;return}c.pointerType!=="touch"&&(Mt.value={x:c.clientX,y:c.clientY})}},Ut=()=>{mt.value||(rt.value=null)},pe=c=>{c.preventDefault();const r=c.deltaY>0?.9:1.1;N.value=Math.max(.5,Math.min(3,N.value*r))};return De(()=>W.imageUrl,()=>{Et(),ft.value=!1,wt.value=null}),lt({resetView:Et,resetCrossSection:Lt,boreholes:At,crossSectionLine:f}),(c,r)=>{var m,S,A,tt,nt,gt;return x(),_("div",{class:Ht(["contour-map-wrapper",{"cross-section-mode":q.crossSectionMode}])},[o("div",{ref_key:"imageContainer",ref:St,class:"image-container",onPointerdown:ge,onPointermove:U,onPointerup:Kt,onPointercancel:Kt,onPointerleave:Ut,onWheel:Te(pe,["prevent"]),onContextmenu:r[0]||(r[0]=Te(()=>{},["prevent"]))},[wt.value?(x(),_("div",Je,[r[3]||(r[3]=o("p",null,"⚠️ 图片加载失败",-1)),o("p",Ke,k(wt.value),1),r[4]||(r[4]=o("p",{class:"error-hint"},"请检查后端服务是否正常运行",-1))])):q.imageUrl?(x(),_("img",{key:2,src:q.imageUrl,class:"contour-image",style:ee(Rt.value),alt:"Contour Map",loading:"lazy",decoding:"async",onLoad:ae,onError:ie},null,44,Ge)):(x(),_("div",je,[...r[5]||(r[5]=[o("div",{class:"spinner"},null,-1),o("p",null,"正在生成等值线图...",-1)])]))],544),q.imageUrl?(x(),_("svg",{key:0,class:"borehole-overlay",viewBox:`0 0 ${$t.value} ${bt.value}`,style:ee(se.value),preserveAspectRatio:"xMidYMid meet"},[r[7]||(r[7]=o("defs",null,[o("filter",{id:"shadow",x:"-50%",y:"-50%",width:"200%",height:"200%"},[o("feDropShadow",{dx:"0",dy:"1",stdDeviation:"2","flood-opacity":"0.3"})]),o("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto"},[o("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#f59e0b"})])],-1)),f.value.start&&f.value.end?(x(),_("g",to,[o("line",{x1:f.value.start.x,y1:f.value.start.y,x2:f.value.end.x,y2:f.value.end.y,stroke:"#f59e0b","stroke-width":"3","stroke-dasharray":"8,4","marker-end":"url(#arrowhead)",class:"cross-section-line"},null,8,eo),o("circle",{cx:f.value.start.x,cy:f.value.start.y,r:"8",fill:"#f59e0b",stroke:"white","stroke-width":"2",class:"cross-section-marker"},null,8,oo),o("text",{x:f.value.start.x,y:f.value.start.y-15,fill:"#f59e0b","font-size":"14","font-weight":"bold","text-anchor":"middle"},"A",8,lo),o("circle",{cx:f.value.end.x,cy:f.value.end.y,r:"8",fill:"#f59e0b",stroke:"white","stroke-width":"2",class:"cross-section-marker"},null,8,so),o("text",{x:f.value.end.x,y:f.value.end.y-15,fill:"#f59e0b","font-size":"14","font-weight":"bold","text-anchor":"middle"},"A'",8,no),o("text",{x:(f.value.start.x+f.value.end.x)/2,y:(f.value.start.y+f.value.end.y)/2-15,fill:"white","font-size":"12","text-anchor":"middle",class:"distance-label"},k((m=f.value.distance)==null?void 0:m.toFixed(0))+"m",9,ao)])):et("",!0),q.crossSectionMode&&f.value.start&&J.value?(x(),_("line",{key:1,x1:f.value.start.x,y1:f.value.start.y,x2:J.value.x,y2:J.value.y,stroke:"rgba(245, 158, 11, 0.5)","stroke-width":"2","stroke-dasharray":"4,4"},null,8,io)):et("",!0),xt.value?(x(!0),_(oe,{key:2},le(At.value,(G,at)=>(x(),_("g",{key:at,transform:`translate(${G.canvasX}, ${G.canvasY})`,class:"borehole-marker",onMouseenter:pt=>rt.value=de(ue({},G),{isBorehole:!0}),onMouseleave:r[1]||(r[1]=pt=>rt.value=null)},[r[6]||(r[6]=o("circle",{r:"9",fill:"rgba(255,255,255,0.95)",filter:"url(#shadow)"},null,-1)),o("circle",{r:"6",fill:G.color||"#3b82f6",stroke:"#1e3a8a","stroke-width":"1.5"},null,8,co)],40,ro))),128)):et("",!0)],12,Ze)):et("",!0),o("div",uo,[o("button",{class:"control-btn",onClick:I,title:"放大"},[...r[8]||(r[8]=[o("span",null,"+",-1)])]),o("button",{class:"control-btn",onClick:Jt,title:"缩小"},[...r[9]||(r[9]=[o("span",null,"−",-1)])]),o("button",{class:"control-btn",onClick:Et,title:"重置"},[...r[10]||(r[10]=[o("span",null,"⟲",-1)])]),o("button",{class:Ht(["control-btn",{active:xt.value}]),onClick:r[2]||(r[2]=G=>xt.value=!xt.value),title:"显示或隐藏钻孔点"},[...r[11]||(r[11]=[o("span",null,"◉",-1)])],2)]),q.valueRange?(x(),_("div",vo,[o("div",ho,k(q.propertyLabel),1),o("div",fo,[o("span",mo,k((S=q.valueRange.min)==null?void 0:S.toFixed(2))+"m",1),o("div",go,[o("div",{class:"legend-gradient",style:ee(fe.value)},null,4)]),o("span",po,k((A=q.valueRange.max)==null?void 0:A.toFixed(2))+"m",1)]),o("div",yo,"中值 "+k(me.value.toFixed(2))+" m",1)])):et("",!0),rt.value?(x(),_("div",{key:2,class:"hover-tooltip",style:ee(ne.value)},[rt.value.isBorehole?(x(),_("div",bo,[o("div",xo,k(rt.value.name||rt.value.borehole),1),o("div",ko,"("+k((tt=rt.value.x)==null?void 0:tt.toFixed(1))+", "+k((nt=rt.value.y)==null?void 0:nt.toFixed(1))+")",1),o("div",_o,[o("span",So,k(q.propertyLabel)+":",1),o("span",wo,k((gt=rt.value.value)==null?void 0:gt.toFixed(2))+" m",1)])])):et("",!0)],4)):et("",!0)],2)}}},Pe=Ae(Co,[["__scopeId","data-v-c959f615"]]),To={class:"page"},Mo={class:"header"},Fo={class:"muted"},Po={key:0,class:"header-stats"},$o={class:"stat-badge"},Ao={class:"stat-badge primary"},Bo={class:"stat-badge"},Ro={key:0,class:"card"},Wo={class:"seam-selection-grid"},No=["onClick"],Io={class:"seam-card-header"},Eo={class:"seam-name"},Do={class:"seam-count"},Yo={class:"seam-card-stats"},Lo={class:"mini-stat"},Xo={class:"mini-stat-value"},zo={class:"mini-stat"},Ho={class:"mini-stat-value"},qo={key:1,class:"grid"},Uo={class:"card params-card compact-card"},Oo={class:"param-row"},Vo={class:"tab-buttons"},Qo=["onClick"],Jo={class:"param-row"},Ko={class:"param-header"},jo={class:"param-value"},Go={class:"param-row"},Zo={class:"param-header"},tl={class:"param-value"},el={class:"param-row"},ol={class:"tab-buttons quality-tabs"},ll=["onClick"],sl={key:0,class:"param-row"},nl={class:"toggle-btn",style:{width:"100%"}},al={key:0,class:"hint-text"},il={class:"action-buttons"},rl=["disabled"],cl={key:0,class:"spinner sm"},ul={key:1,class:"status-text"},dl={class:"card compact-card"},vl={key:0,class:"histogram-wrapper"},hl={key:1,class:"empty-state"},fl={key:2,class:"stats-grid"},ml={class:"stat-item"},gl={class:"stat-value"},pl={class:"stat-item"},yl={class:"stat-value"},bl={class:"stat-item"},xl={class:"stat-value"},kl={class:"stat-item"},_l={class:"stat-value"},Sl={class:"stat-item"},wl={class:"stat-value"},Cl={class:"stat-item"},Tl={class:"stat-value"},Ml={class:"card compact-card"},Fl={class:"stratigraphic-wrapper"},Pl={class:"lithology-legend-compact"},$l={class:"legend-name"},Al={key:0,class:"map-row"},Bl={class:"card map-card-large"},Rl={class:"map-header"},Wl={key:0,class:"section-desc"},Nl={key:1,class:"section-desc"},Il={class:"map-wrapper"},El={key:0,class:"spinner"},Dl={class:"card map-card-large"},Yl={class:"map-header"},Ll={key:0,class:"section-desc"},Xl={key:1,class:"section-desc"},zl={class:"map-wrapper"},Hl={key:0,class:"spinner"},ql={key:1,class:"card map-card-full"},Ul={class:"map-wrapper uncertainty-wrapper"},Ol={key:0,class:"spinner"},Vl={key:2,class:"card map-card-full"},Ql={class:"map-header"},Jl={class:"section-title"},Kl={class:"section-badge"},jl={class:"cross-section-wrapper"},$e="interpolation:lastContour:v1",Gl={__name:"Interpolation",setup(q,{expose:lt}){const j=qe(),W=Xe(),Nt=ze(),{workspaceState:St,setSelectedSeam:$t,markStepDone:bt}=He(),ft=M(!1),wt=M(null),N=M(!1),Tt=M([]),st=M(null),mt=M(null),Q=M([]),It=M([]),Ct=M("kriging"),rt=M(80),Mt=M(10),xt=M("standard"),f=M(""),J=M(null),ct=M(null),At=M(!1),Bt=M({line:null,points:[],depthProfile:[],distance:null,hasData:!1}),Qt=M(null),Rt=M(null),se=M(null),ne=M(null),fe=[{key:"kriging",label:"Kriging"},{key:"idw",label:"IDW"},{key:"linear",label:"Linear"},{key:"nearest",label:"Nearest"}],me=[{key:"fast",label:"快速"},{key:"standard",label:"标准"},{key:"high",label:"高精"}],ae={fast:{dpi:120,smoothSigma:.75,label:"快速"},standard:{dpi:200,smoothSigma:1.15,label:"标准"},high:{dpi:300,smoothSigma:1.35,label:"高精"}},ie={fast:72,standard:96,high:128},I={textColor:"#111827",subTextColor:"#475569",axisColor:"#1f2937",gridColor:"rgba(148, 163, 184, 0.28)",fontFamily:"'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif",monoFamily:"'JetBrains Mono', 'SFMono-Regular', Consolas, monospace"};let Jt=0,Et=0,Lt=null,Dt=null;const qt={细砂岩:"#FCEBB6",粉砂岩:"#E0FFFF",泥岩:"#D3D3D3",中砂岩:"#FCEBB6",粗砂岩:"#F5DEB3",砾岩:"#DEB887",炭质泥岩:"#8B8B8B",砂质泥岩:"#D8D8D8",泥质砂岩:"#E8E8E8",石灰岩:"#B0E0E6",煤:"#2F4F4F"},ge={细砂岩:{facecolor:"#FCEBB6",hatch:"...",edgecolor:"#999999"},粉砂岩:{facecolor:"#E0FFFF",hatch:"...",edgecolor:"#AAAAAA"},泥岩:{facecolor:"#D3D3D3",hatch:"---",edgecolor:"#666666"},中砂岩:{facecolor:"#FCEBB6",hatch:"...",edgecolor:"#999999"},粗砂岩:{facecolor:"#F5DEB3",hatch:"...",edgecolor:"#999999"},砾岩:{facecolor:"#DEB887",hatch:"ooo",edgecolor:"#8B4513"},炭质泥岩:{facecolor:"#8B8B8B",hatch:"---",edgecolor:"#444444"},砂质泥岩:{facecolor:"#D8D8D8",hatch:"-..",edgecolor:"#777777"},泥质砂岩:{facecolor:"#E8E8E8",hatch:".-.",edgecolor:"#888888"},石灰岩:{facecolor:"#B0E0E6",hatch:"+++",edgecolor:"#5F9EA0"},煤:{facecolor:"#2F4F4F",hatch:"",edgecolor:"#1a1a1a"}},Kt=e=>({kriging:"Kriging",idw:"IDW",linear:"Linear",nearest:"Nearest"})[e]||e,U=(e,t=400,i=!1)=>{const n=i?I.monoFamily:I.fontFamily;return`${t} ${e}px ${n}`},Ut=e=>{e.imageSmoothingEnabled=!0,"imageSmoothingQuality"in e&&(e.imageSmoothingQuality="high"),e.lineCap="round",e.lineJoin="round"},pe=Wt(()=>Q.value.map(e=>Number(e.thickness)).filter(e=>Number.isFinite(e))),c=Wt(()=>{const e=pe.value,t=e.length;if(!t)return{count:0,mean:0,stdDev:0,cv:0,min:0,max:0};const i=e.reduce((s,p)=>s+p,0)/t,n=e.reduce((s,p)=>s+ht(p-i,2),0)/t,g=Math.sqrt(n),l=Math.min(...e),a=Math.max(...e),u=i>0?g/i*100:0;return{count:t,mean:i,stdDev:g,cv:u,min:l,max:a}}),r=e=>{var t,i;Q.value=(e==null?void 0:e.boreholes)||Q.value,(t=e==null?void 0:e.thickness)!=null&&t.image?J.value={imageUrl:`data:image/png;base64,${e.thickness.image}`,valueRange:e.thickness.value_range,bounds:e.bounds}:J.value=null,(i=e==null?void 0:e.depth)!=null&&i.image?ct.value={imageUrl:`data:image/png;base64,${e.depth.image}`,valueRange:e.depth.value_range,bounds:e.bounds}:ct.value=null},m=e=>{var t;if(typeof window=="undefined")return null;try{const i=window.sessionStorage.getItem($e);if(!i)return null;const n=JSON.parse(i);return!(n!=null&&n.seamName)||n.seamName!==e||!((t=n==null?void 0:n.data)!=null&&t.bounds)?null:n}catch(i){return null}},S=(e,t)=>{if(typeof window!="undefined")try{const i={seamName:e,updatedAt:Date.now(),method:Ct.value,gridSize:rt.value,contourLevels:Mt.value,quality:xt.value,data:{bounds:(t==null?void 0:t.bounds)||null,boreholes:(t==null?void 0:t.boreholes)||[],thickness:(t==null?void 0:t.thickness)||null,depth:(t==null?void 0:t.depth)||null}};window.sessionStorage.setItem($e,JSON.stringify(i))}catch(i){}},A=()=>Vt(this,null,function*(){ft.value=!0;try{const{data:e}=yield Ue();Tt.value=e.seams||[]}catch(e){wt.value="加载煤层失败"}finally{ft.value=!1}}),tt=(e=[])=>{let t=0;return e.map(i=>{var a,u;const n=Number((a=i.thickness)!=null?a:0)||0;let g=Number(i.z_top),l=Number(i.z_bottom);if(Number.isFinite(g)||(g=t),Number.isFinite(l)||(l=g+n),!Number.isFinite(n)||n===0){const s=Math.max((l||0)-(g||0),0);s>0&&(i.thickness=s)}return t=l,de(ue({},i),{thickness:Number((u=i.thickness)!=null?u:n)||0,z_top:g,z_bottom:l})})},nt=e=>Vt(this,null,function*(){var i,n;const t=++Et;st.value=e,$t((e==null?void 0:e.name)||""),J.value=null,ct.value=null,It.value=[],f.value="";try{const g=m(e.name);g!=null&&g.data&&(r(g.data),f.value="已加载上次缓存结果，正在后台刷新...",yield he(),G());const l=Oe(e.name),a=Ve(e.name).catch(()=>null),{data:u}=yield l;if(t!==Et)return;mt.value=u,Q.value=u.points||[],yield he(),pt(),bt("Interpolation",{interpolationPoints:Q.value.length||0}),gt({presetKey:"fast",forceRefresh:!1,silent:!0,autoMode:!0}),Vt(this,null,function*(){var C;const s=yield a;if(t!==Et)return;const p=((C=s==null?void 0:s.data)==null?void 0:C.boreholes)||[],$=p.reduce((P,O)=>{var H,E;const z=((H=P==null?void 0:P.layers)==null?void 0:H.length)||0;return(((E=O==null?void 0:O.layers)==null?void 0:E.length)||0)>z?O:P},p[0]),w=tt(($==null?void 0:$.layers)||[]);It.value=w.sort((P,O)=>(P.z_top||0)-(O.z_top||0)),yield he(),Xt()})}catch(g){if(t!==Et)return;j.add("加载煤层详情失败: "+(((n=(i=g.response)==null?void 0:i.data)==null?void 0:n.detail)||g.message),"error")}}),gt=(...t)=>Vt(this,[...t],function*(e={}){var p,$,w;if(!st.value)return;const{presetKey:i=xt.value,forceRefresh:n=!1,silent:g=!1,autoMode:l=!1}=e,a=ae[i]||ae.standard,u=st.value.name,s=++Jt;N.value=!0,f.value=l?`正在生成${a.label}预览图...`:`正在渲染${a.label}质量结果...`;try{const{data:C}=yield Qe(u,Ct.value,rt.value,Mt.value,a.dpi,a.smoothSigma,{forceRefresh:n});if(s!==Jt)return;r(C),S(u,C),yield he(),G(),pt(),bt("Interpolation",{interpolationPoints:Q.value.length||0}),g||j.add("等值线图生成完成","success")}catch(C){console.error("Interpolate error:",C),console.error("Error response:",(p=C.response)==null?void 0:p.data),j.add(((w=($=C.response)==null?void 0:$.data)==null?void 0:w.detail)||"生成等值线图失败","error")}finally{s===Jt&&(N.value=!1,f.value="")}}),G=()=>{if(typeof window=="undefined"){at();return}if(typeof window.cancelIdleCallback=="function"&&Lt!==null&&(window.cancelIdleCallback(Lt),Lt=null),Dt!==null&&(window.clearTimeout(Dt),Dt=null),typeof window.requestIdleCallback=="function"){Lt=window.requestIdleCallback(()=>{Lt=null,at()},{timeout:240});return}Dt=window.setTimeout(()=>{Dt=null,at()},16)},at=()=>{var y;if(!Q.value.length||!J.value)return;const e=ne.value;if(!e)return;const t=e.getContext("2d");if(!t)return;const i=(y=e.parentElement)==null?void 0:y.getBoundingClientRect(),n=Math.max(720,Math.floor((i==null?void 0:i.width)||900)),g=Math.max(420,Math.floor((i==null?void 0:i.height)||550)),l=typeof window!="undefined"&&window.devicePixelRatio||1;e.width=Math.floor(n*l),e.height=Math.floor(g*l),e.style.width=`${n}px`,e.style.height=`${g}px`,t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.setTransform(l,0,0,l,0,0),Ut(t);const a=n,u=g,s=J.value.bounds;if(!(s&&Number.isFinite(s.min_x)&&Number.isFinite(s.max_x)&&Number.isFinite(s.min_y)&&Number.isFinite(s.max_y)&&s.max_x>s.min_x&&s.max_y>s.min_y))return;const $=Q.value.map(v=>({x:Number(v.x),y:Number(v.y)})).filter(v=>Number.isFinite(v.x)&&Number.isFinite(v.y));if($.length===0)return;t.fillStyle="#ffffff",t.fillRect(0,0,a,u);const w={left:56,right:48,top:26,bottom:76},C=a-w.left-w.right-58,P=u-w.top-w.bottom,O=Math.max(30,Number(rt.value)||80),z=ie[xt.value]||ie.standard,B=Math.max(64,Math.min(144,Math.round((O+z)/2))),H=[],E=500;for(let v=0;v<B;v++){H[v]=[];for(let F=0;F<B;F++){const D=s.min_x+F/B*(s.max_x-s.min_x),Pt=s.max_y-v/B*(s.max_y-s.min_y);let _t=1/0;for(const Yt of $){const Ot=Math.sqrt(ht(D-Yt.x,2)+ht(Pt-Yt.y,2));Ot<_t&&(_t=Ot)}H[v][F]=Math.min(1.6,_t/E*1.6)}}const K=[],R=xt.value==="high"?3:xt.value==="standard"?2.4:2;for(let v=0;v<B;v++){K[v]=[];for(let F=0;F<B;F++){let D=0,Pt=0;for(let _t=-R;_t<=R;_t++)for(let Yt=-R;Yt<=R;Yt++){const Ot=v+_t,xe=F+Yt;if(Ot>=0&&Ot<B&&xe>=0&&xe<B){const _e=Math.sqrt(Yt*Yt+_t*_t),Se=Math.exp(-(_e*_e)/(2*R*R));D+=H[Ot][xe]*Se,Pt+=Se}}K[v][F]=D/Pt}}const ut=v=>{const F=Math.min(1.5,Math.max(0,v))/1.5;if(F<.5){const D=F*2;return{r:Math.floor(49+206*D),g:Math.floor(130+125*D),b:Math.floor(189+-189*D)}}else{const D=(F-.5)*2;return{r:Math.floor(255+-40*D),g:Math.floor(255+-207*D),b:Math.floor(0+48*D)}}},yt=C/B,Y=P/B;for(let v=0;v<B;v++)for(let F=0;F<B;F++){const D=K[v][F],Pt=ut(D);t.fillStyle=`rgb(${Pt.r}, ${Pt.g}, ${Pt.b})`,t.fillRect(w.left+F*yt,w.top+(B-1-v)*Y,yt+1,Y+1)}const Z=6;for(const v of $){const F=w.left+(v.x-s.min_x)/(s.max_x-s.min_x)*C,D=w.top+(s.max_y-v.y)/(s.max_y-s.min_y)*P;t.beginPath(),t.arc(F,D,Z,0,Math.PI*2),t.fillStyle="#000000",t.fill()}t.strokeStyle="#000000",t.lineWidth=2,t.strokeRect(w.left,w.top,C,P);const L=w.left+20,h=w.top+P-80,V=120,b=50;t.fillStyle="#ffffff",t.strokeStyle="#000000",t.lineWidth=1.5,t.fillRect(L,h,V,b),t.strokeRect(L,h,V,b),t.fillStyle="#d73027",t.fillRect(L+10,h+28,15,15),t.strokeStyle="#000000",t.lineWidth=1,t.strokeRect(L+10,h+28,15,15),t.fillStyle=I.textColor,t.font=U(12),t.textAlign="left",t.fillText("高不确定性",L+32,h+40),t.beginPath(),t.arc(L+17,h+18,Z,0,Math.PI*2),t.fillStyle="#000000",t.fill(),t.fillText("钻孔位置",L+32,h+22);const d=w.left+C-150,T=h,X=130,ot=35;t.fillStyle="#ffffff",t.strokeStyle="#000000",t.lineWidth=1.5,t.fillRect(d,T,X,ot),t.strokeRect(d,T,X,ot),t.fillStyle=I.textColor,t.font=U(11),t.textAlign="left",t.fillText("0",d+10,T+22),t.textAlign="center",t.fillText("500",d+75,T+22),t.textAlign="right",t.fillText("1000 米",d+120,T+22);const dt=T+12;t.strokeStyle="#000000",t.lineWidth=2,t.beginPath(),t.moveTo(d+10,dt),t.lineTo(d+120,dt),t.stroke(),t.lineWidth=4,t.beginPath(),t.moveTo(d+10,dt),t.lineTo(d+75,dt),t.stroke();const kt=w.left+C+20,it=w.top,vt=20,Ft=P;for(let v=0;v<Ft;v++){const F=(1-v/Ft)*1.5,D=ut(F);t.fillStyle=`rgb(${D.r}, ${D.g}, ${D.b})`,t.fillRect(kt,it+v,vt,1)}t.strokeStyle="#000000",t.lineWidth=1.5,t.strokeRect(kt,it,vt,Ft),t.fillStyle=I.subTextColor,t.font=U(10),t.textAlign="left";const Zt=[0,.5,1,1.5],zt=["0","0.5","1.0","1.5+"];Zt.forEach((v,F)=>{const D=it+Ft-v/1.5*Ft;t.beginPath(),t.moveTo(kt+vt,D),t.lineTo(kt+vt+4,D),t.strokeStyle="#000000",t.lineWidth=1,t.stroke(),t.fillText(zt[F],kt+vt+8,D+4)}),t.save(),t.translate(kt+vt+35,it+Ft/2),t.rotate(-Math.PI/2),t.textAlign="center",t.font=U(11,500),t.fillText("不确定性 (归一化)",0,0),t.restore(),t.fillStyle=I.textColor,t.font=U(13,700),t.textAlign="center",t.fillText("Fig. 3 | 插值不确定性分布",w.left+C/2,u-28),t.fillStyle=I.subTextColor,t.font=U(10),t.fillText("红色区域表示较高不确定性，蓝色区域表示相对可靠。",w.left+C/2,u-12)},pt=()=>{var Zt,zt;const e=Qt.value;if(!e||Q.value.length===0)return;const t=e.getContext("2d");if(!t)return;const i=window.devicePixelRatio||1,n=e.parentElement,g=(n==null?void 0:n.clientWidth)||e.clientWidth||500,l=(n==null?void 0:n.clientHeight)||e.clientHeight||350;e.width=Math.round(g*i),e.height=Math.round(l*i),e.style.width=`${g}px`,e.style.height=`${l}px`,t.setTransform(i,0,0,i,0,0),Ut(t);const a=g,u=l,s=Q.value.map(y=>Number(y.thickness)).filter(y=>Number.isFinite(y));if(s.length===0)return;const p=Math.min(...s),$=Math.max(...s),w=s.reduce((y,v)=>y+v,0)/s.length,C=s.reduce((y,v)=>y+ht(v-w,2),0)/s.length,P=Math.sqrt(C),O=$-p,z=[...s].sort((y,v)=>y-v),B=(Zt=z[Math.floor((z.length-1)*.25)])!=null?Zt:p,H=(zt=z[Math.floor((z.length-1)*.75)])!=null?zt:$,E=Math.max(H-B,0),K=E>Number.EPSILON?2*E/Math.cbrt(z.length):0,R=K>0&&O>0?Math.round(O/K):16,ut=Math.max(10,Math.min(28,R||16)),yt=O>0?O/ut:1,Y=Array(ut).fill(0);for(const y of s){const v=O>0?Math.floor((y-p)/yt):Math.floor(ut/2),F=Math.max(0,Math.min(v,ut-1));Y[F]++}const Z=Math.max(...Y),L="#5f8fb0",h="#c5523a",V=.85;t.fillStyle="#ffffff",t.fillRect(0,0,a,u);const b={left:50,right:25,top:45,bottom:45},d=a-b.left-b.right,T=u-b.top-b.bottom,X=d/ut,ot=T/(Z*1.1);t.fillStyle=L,t.globalAlpha=V;for(let y=0;y<ut;y++){const v=Y[y]*ot,F=b.left+y*X,D=u-b.bottom-v;v>0&&(t.fillRect(F,D,X-1,v),t.strokeStyle="white",t.lineWidth=.8,t.strokeRect(F,D,X-1,v))}t.globalAlpha=1;const dt=P>Number.EPSILON&&O>0;if(dt){t.strokeStyle=h,t.lineWidth=2,t.beginPath();for(let y=0;y<=100;y++){const v=b.left+y/100*d,F=p+y/100*O,Pt=1/(P*Math.sqrt(2*Math.PI))*Math.exp(-.5*ht((F-w)/P,2))*s.length*yt,_t=u-b.bottom-Pt*ot;y===0?t.moveTo(v,_t):t.lineTo(v,_t)}t.stroke()}t.strokeStyle=I.axisColor,t.lineWidth=1,t.beginPath(),t.moveTo(b.left,b.top),t.lineTo(b.left,u-b.bottom),t.stroke(),t.beginPath(),t.moveTo(b.left,u-b.bottom),t.lineTo(a-b.right,u-b.bottom),t.stroke();const kt=4;t.strokeStyle=I.axisColor,t.lineWidth=1;for(let y=0;y<=6;y++){const v=b.left+y/6*d;t.beginPath(),t.moveTo(v,u-b.bottom),t.lineTo(v,u-b.bottom+kt),t.stroke()}for(let y=0;y<=5;y++){const v=u-b.bottom-y/5*T;t.beginPath(),t.moveTo(b.left,v),t.lineTo(b.left-kt,v),t.stroke()}t.fillStyle=I.subTextColor,t.font=U(10),t.textAlign="center";for(let y=0;y<=6;y++){const v=p+y/6*($-p),F=b.left+y/6*d;t.fillText(v.toFixed(1),F,u-b.bottom+15)}t.textAlign="right";for(let y=0;y<=5;y++){const v=Math.round(y/5*(Z*1.1)),F=u-b.bottom-y/5*T;t.fillText(v.toString(),b.left-6,F+3)}t.fillStyle=I.subTextColor,t.font=U(11),t.textAlign="center",t.fillText("厚度 (m)",b.left+d/2,u-8),t.save(),t.translate(12,b.top+T/2),t.rotate(-Math.PI/2),t.fillText("频数",0,0),t.restore(),t.fillStyle=I.textColor,t.font=U(12,700),t.textAlign="left",t.fillText("Fig. 1 | 煤层厚度频率分布 (n="+s.length+")",b.left,18),t.fillStyle=I.textColor,t.font=U(10),t.textAlign="left";const it=a-b.right-120,vt=b.top+10;t.fillStyle=L,t.globalAlpha=V,t.fillRect(it,vt-4,12,10),t.globalAlpha=1,t.strokeStyle="white",t.lineWidth=.8,t.strokeRect(it,vt-4,12,10),t.fillText("观测值",it+16,vt+4),dt&&(t.strokeStyle=h,t.lineWidth=2,t.beginPath(),t.moveTo(it,vt+20),t.lineTo(it+12,vt+20),t.stroke(),t.fillStyle="#000000",t.fillText("密度拟合",it+16,vt+24)),t.fillStyle=I.subTextColor,t.font=U(9,400,!0),t.textAlign="left";const Ft=`μ=${w.toFixed(2)}  σ=${P.toFixed(2)}`;t.fillText(Ft,it,vt+42)},Xt=()=>{const e=se.value;if(!e||It.value.length===0)return;const t=e.getContext("2d"),i=window.devicePixelRatio||1,n=e.parentElement,g=(n==null?void 0:n.clientWidth)||e.clientWidth||280,l=(n==null?void 0:n.clientHeight)||e.clientHeight||500;e.width=Math.round(g*i),e.height=Math.round(l*i),e.style.width=`${g}px`,e.style.height=`${l}px`,t.setTransform(i,0,0,i,0,0),Ut(t);const a=g,u=l;t.fillStyle="#FFFFFF",t.fillRect(0,0,a,u);const s=It.value;let p=Math.max(...s.map(Y=>Y.z_bottom||0));if((!Number.isFinite(p)||p<=0)&&(p=s.reduce((Y,Z)=>Y+(Number(Z.thickness)||0),0)),!Number.isFinite(p)||p<=0)return;const $={top:24,bottom:22},w=(u-$.top-$.bottom)/p,C=$.top,P=14,O=Math.max(110,Math.min(160,a*.3)),z=Math.max(80,Math.min(140,a*.22)),B=P+z+16+O,E=Math.max(16,(a-B)/2),K=E+P,R=K+z+16;t.fillStyle=I.textColor,t.font=U(12,700),t.textAlign="left",t.fillText("Fig. 2 | 代表性钻孔地层柱状图",K,18);const ut=4,yt=Math.max(5,Math.ceil(p/6/5)*5)||10;t.strokeStyle=I.gridColor,t.lineWidth=1,t.fillStyle=I.subTextColor,t.font=U(10),t.textAlign="right",t.beginPath(),t.moveTo(E,C),t.lineTo(E,u-$.bottom),t.stroke();for(let Y=0;Y<=p;Y+=yt){const Z=C+Y*w;t.beginPath(),t.moveTo(E,Z),t.lineTo(E+ut,Z),t.stroke(),t.fillText(`${Math.round(Y)} m`,E-6,Z+3)}t.save(),t.translate(E-28,C+(u-$.bottom-C)/2),t.rotate(-Math.PI/2),t.textAlign="center",t.fillStyle=I.subTextColor,t.font=U(11),t.fillText("深度 (m)",0,0),t.restore(),s.forEach((Y,Z)=>{const L=C+(Y.z_top||0)*w,h=Y.thickness||0,V=Math.max(h*w,3),b=ge[Y.name]||{facecolor:"#D3D3D3",hatch:"---",edgecolor:"#666666"};t.fillStyle=b.facecolor,t.fillRect(K,L,z,V),V>6&&b.hatch&&jt(t,b.hatch,K,L,z,V,b.edgecolor),t.strokeStyle="#1a1a1a",t.lineWidth=.5,t.strokeRect(K,L,z,V),V>10&&(t.fillStyle=I.subTextColor,t.font=U(10),t.textAlign="left",t.fillText(Y.name,R,L+V/2+3),t.fillStyle="#2563EB",t.font=U(9,500,!0),t.fillText(`${h.toFixed(1)}米`,R,L+V/2+14))}),t.strokeStyle="#94A3B8",t.lineWidth=1,t.strokeRect(K,C,z,u-C-$.bottom)},jt=(e,t,i,n,g,l,a)=>{e.save(),e.beginPath(),e.rect(i,n,g,l),e.clip(),e.strokeStyle=a,e.globalAlpha=.4,e.lineWidth=.5;const u=6;switch(t){case"...":case"ooo":e.fillStyle=a,e.globalAlpha=.3;for(let s=u/2;s<g;s+=u)for(let p=u/2;p<l;p+=u)e.beginPath(),t==="ooo"?e.arc(i+s,n+p,2.5,0,Math.PI*2):e.arc(i+s,n+p,1,0,Math.PI*2),e.fill();break;case"---":e.globalAlpha=.5;for(let s=4;s<l;s+=u)e.beginPath(),e.moveTo(i,n+s),e.lineTo(i+g,n+s),e.stroke();break;case"+++":case"xx":e.globalAlpha=.3;for(let s=u/2;s<g;s+=u)for(let p=u/2;p<l;p+=u)e.beginPath(),e.moveTo(i+s-3,n+p),e.lineTo(i+s+3,n+p),e.stroke(),e.beginPath(),e.moveTo(i+s,n+p-3),e.lineTo(i+s,n+p+3),e.stroke();break;case"-..":case".-.":e.globalAlpha=.5;for(let s=u;s<l;s+=u*1.5)e.beginPath(),e.moveTo(i,n+s),e.lineTo(i+g/2,n+s),e.stroke(),e.fillStyle=a,e.beginPath(),e.arc(i+g*.75,n+s,1.5,0,Math.PI*2),e.fill();break;case"//":case"\\\\":e.globalAlpha=.4;for(let s=-l;s<g;s+=u)e.beginPath(),e.moveTo(i+s,n),e.lineTo(i+s+l,n+l),e.stroke();break}e.restore()},re=e=>{Bt.value={line:{start:e.startCanvas,end:e.endCanvas},worldLine:{start:e.start,end:e.end},points:e.points||[],depthProfile:[],distance:e.distance,hasData:!0},ye(e.start,e.end,e.distance)},ye=(e,t,i)=>{if(!Q.value.length||i===null)return;const n=Rt.value;if(!n)return;const g=n.getContext("2d");if(!g)return;const l=typeof window!="undefined"&&window.devicePixelRatio||1,a=Math.max(640,n.offsetWidth||900),u=300;n.width=Math.round(a*l),n.height=Math.round(u*l),n.style.width=`${a}px`,n.style.height=`${u}px`,g.setTransform(l,0,0,l,0,0);const s=100,p=(t.x-e.x)/s,$=(t.y-e.y)/s,w=[];for(let C=0;C<=s;C++){const P=e.x+p*C,O=e.y+$*C,z=Q.value.map(B=>{const H=Math.sqrt(ht(P-B.x,2)+ht(O-B.y,2));return{depth:B.burial_depth,distance:H}}).filter(B=>B.depth!=null&&B.distance<500);if(z.length>0){let B=0,H=0;for(const E of z){const K=1/ht(E.distance+1,2);H+=E.depth*K,B+=K}w.push({distance:C/s*i,depth:H/B})}}Bt.value.depthProfile=w,be(w,i,a,u)},be=(e,t,i,n)=>{var V,b;const g=Rt.value;if(!g)return;const l=g.getContext("2d");if(!l)return;if(Ut(l),l.fillStyle="#FFFFFF",l.fillRect(0,0,i,n),!e.length||!Number.isFinite(t)||t<=0){l.fillStyle=I.subTextColor,l.font=U(14),l.textAlign="center",l.fillText("当前剖面线附近缺少可用埋深数据，请重选剖面线。",i/2,n/2);return}const a={left:50,right:30,top:35,bottom:40},u=i-a.left-a.right,s=n-a.top-a.bottom,p=e.map(d=>d.depth),$=Math.min(...p),w=Math.max(...p),C=w-$||1,P={topSoil:"#8FBC8F",sandstone:"#F4A460",shale:"#778899",coal:"#2F2F2F",sandyShale:"#A9A9A9",limestone:"#B0C4DE"},z=s/6;[P.limestone,P.sandyShale,P.coal,P.shale,P.sandstone,P.topSoil].forEach((d,T)=>{const X=a.top+T*z;l.fillStyle=d,l.globalAlpha=.08,l.fillRect(a.left,X,u,z),l.globalAlpha=1}),l.strokeStyle=I.gridColor,l.lineWidth=.8;const H=10;for(let d=0;d<=H;d++){const T=a.left+d/H*u;l.beginPath(),l.moveTo(T,a.top),l.lineTo(T,n-a.bottom),l.stroke()}const E=5;for(let d=0;d<=E;d++){const T=a.top+d/E*s;l.beginPath(),l.moveTo(a.left,T),l.lineTo(i-a.right,T),l.stroke()}l.strokeStyle=I.axisColor,l.lineWidth=1,l.beginPath(),l.moveTo(a.left,a.top),l.lineTo(a.left,n-a.bottom),l.stroke(),l.beginPath(),l.moveTo(a.left,n-a.bottom),l.lineTo(i-a.right,n-a.bottom),l.stroke();const K=4;l.strokeStyle="rgba(148, 163, 184, 0.75)",l.lineWidth=1;for(let d=0;d<=H;d++){const T=a.left+d/H*u;l.beginPath(),l.moveTo(T,n-a.bottom),l.lineTo(T,n-a.bottom+K),l.stroke()}for(let d=0;d<=E;d++){const T=n-a.bottom-d/E*s;l.beginPath(),l.moveTo(a.left,T),l.lineTo(a.left-K,T),l.stroke()}l.beginPath(),l.strokeStyle=P.sandstone,l.lineWidth=2.5,l.lineCap="round",l.lineJoin="round";const R=e.map(d=>({x:a.left+d.distance/t*u,y:n-a.bottom-(d.depth-$)/C*s}));if(l.moveTo(R[0].x,R[0].y),R.length>2){for(let X=1;X<R.length-1;X++){const ot=(R[X].x+R[X+1].x)/2,dt=(R[X].y+R[X+1].y)/2;l.quadraticCurveTo(R[X].x,R[X].y,ot,dt)}const d=R[R.length-1],T=R[R.length-2];l.quadraticCurveTo(T.x,T.y,d.x,d.y)}else R.length===2&&l.lineTo(R[1].x,R[1].y);l.stroke(),l.lineTo(a.left+u,n-a.bottom),l.lineTo(a.left,n-a.bottom),l.closePath(),l.fillStyle="rgba(244, 164, 96, 0.12)",l.fill();for(const d of Q.value){if(d.burial_depth==null)continue;const T=d.x,X=d.y,ot=((V=Bt.value.worldLine)==null?void 0:V.start)||{x:0,y:0},dt=((b=Bt.value.worldLine)==null?void 0:b.end)||{x:0,y:0},kt=Math.sqrt(ht(dt.x-ot.x,2)+ht(dt.y-ot.y,2));if(kt===0)continue;const it=((T-ot.x)*(dt.x-ot.x)+(X-ot.y)*(dt.y-ot.y))/ht(kt,2),vt=ot.x+it*(dt.x-ot.x),Ft=ot.y+it*(dt.y-ot.y);if(Math.sqrt(ht(T-vt,2)+ht(X-Ft,2))<50&&it>=0&&it<=1){const zt=a.left+it*u,y=n-a.bottom-(d.burial_depth-$)/C*s;l.beginPath(),l.arc(zt,y,4,0,Math.PI*2),l.fillStyle=P.coal,l.fill(),l.strokeStyle="#ffffff",l.lineWidth=1.5,l.stroke(),l.fillStyle=I.subTextColor,l.font=U(10),l.textAlign="center";const v=d.borehole||d.name||"";v&&l.fillText(v,zt,y-10)}}l.fillStyle=I.subTextColor,l.font=U(11),l.textAlign="center";for(let d=0;d<=H;d++){const T=a.left+d/H*u,X=d/H*t;l.fillText(`${X.toFixed(0)}`,T,n-15)}l.textAlign="right";for(let d=0;d<=E;d++){const T=n-a.bottom-d/E*s,X=$+d/E*C;l.fillText(`${X.toFixed(0)}`,a.left-8,T+4)}l.fillStyle=I.subTextColor,l.font=U(12),l.textAlign="center",l.fillText("剖面距离 (米)",a.left+u/2,n-5),l.save(),l.translate(12,a.top+s/2),l.rotate(-Math.PI/2),l.fillText("埋藏深度 (米)",0,0),l.restore(),l.fillStyle=I.textColor,l.font=U(13,700),l.textAlign="left",l.fillText(`Fig. 4 | 剖面 A-A' 深度分布 (${$.toFixed(1)}-${w.toFixed(1)} m)`,a.left,18);const ut=Math.max(10,t/4),yt=[10,20,50,100,200,500,1e3];let Y=yt[0];for(const d of yt)d<=ut&&(Y=d);const Z=Math.max(34,Math.min(110,Y/t*u)),L=i-a.right-Z-16,h=n-a.bottom+12;l.strokeStyle=I.axisColor,l.lineWidth=2,l.beginPath(),l.moveTo(L,h),l.lineTo(L+Z,h),l.stroke(),l.beginPath(),l.moveTo(L,h-3),l.lineTo(L,h+3),l.stroke(),l.beginPath(),l.moveTo(L+Z,h-3),l.lineTo(L+Z,h+3),l.stroke(),l.fillStyle=I.subTextColor,l.font=U(10,500),l.textAlign="center",l.fillText(`比例尺: ${Math.round(Y)} m`,L+Z/2,h+12)},Gt=()=>{At.value=!1,Bt.value={line:null,points:[],depthProfile:[],distance:null,hasData:!1},Rt.value&&Rt.value.getContext("2d").clearRect(0,0,Rt.value.width,Rt.value.height)},ce=()=>{var e;Nt.push({name:"AcademicAlgorithm",query:(e=st.value)!=null&&e.name?{seam:st.value.name}:void 0})},Be=e=>Array.isArray(e)?e[0]||"":typeof e=="string"?e:"";return Ye(()=>Vt(this,null,function*(){var i;yield A();const e=Be((i=W.query)==null?void 0:i.seam)||St.selectedSeam;if(!e)return;const t=Tt.value.find(n=>n.name===e);t&&(yield nt(t))})),lt({resetView:()=>{Gt()}}),(e,t)=>{var i,n,g,l,a,u,s,p,$,w,C,P,O,z,B,H,E,K,R,ut,yt,Y,Z,L;return x(),_("div",To,[o("div",Mo,[o("div",null,[t[5]||(t[5]=o("h2",null,"插值分析",-1)),o("div",Fo,k(((i=st.value)==null?void 0:i.name)||"请选择煤层并执行空间插值分析"),1)]),st.value&&mt.value?(x(),_("div",Po,[o("div",$o,[t[6]||(t[6]=o("span",{class:"stat-label"},"厚度范围",-1)),o("strong",null,k(((l=(g=(n=mt.value)==null?void 0:n.thickness)==null?void 0:g.min)==null?void 0:l.toFixed(2))||"-")+" - "+k(((s=(u=(a=mt.value)==null?void 0:a.thickness)==null?void 0:u.max)==null?void 0:s.toFixed(2))||"-")+" m",1)]),o("div",Ao,[t[7]||(t[7]=o("span",{class:"stat-label"},"平均厚度",-1)),o("strong",null,k(((w=($=(p=mt.value)==null?void 0:p.thickness)==null?void 0:$.mean)==null?void 0:w.toFixed(2))||"-")+" m",1)]),o("div",Bo,[t[8]||(t[8]=o("span",{class:"stat-label"},"钻孔数量",-1)),o("strong",null,k(((C=mt.value)==null?void 0:C.borehole_count)||Q.value.length||"-"),1)])])):et("",!0)]),st.value?(x(),_("div",qo,[o("div",Uo,[t[20]||(t[20]=te('<h3 class="section-title" data-v-d3611681><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-d3611681><circle cx="12" cy="12" r="3" data-v-d3611681></circle><path d="M12 1v6m0 6v6" data-v-d3611681></path><path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24" data-v-d3611681></path><path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24" data-v-d3611681></path></svg> 插值参数 </h3>',1)),o("div",Oo,[t[12]||(t[12]=o("label",{class:"param-label"},"插值方法",-1)),o("div",Vo,[(x(),_(oe,null,le(fe,h=>o("button",{key:h.key,class:Ht(["tab-btn",{active:Ct.value===h.key}]),onClick:V=>Ct.value=h.key},k(h.label),11,Qo)),64))])]),o("div",Jo,[o("div",Ko,[t[13]||(t[13]=o("label",{class:"param-label"},"网格密度",-1)),o("span",jo,k(rt.value),1)]),ke(o("input",{"onUpdate:modelValue":t[0]||(t[0]=h=>rt.value=h),type:"range",min:"30",max:"150",step:"10",class:"slider"},null,512),[[Me,rt.value,void 0,{number:!0}]]),t[14]||(t[14]=o("div",{class:"slider-labels"},[o("span",null,"粗"),o("span",null,"细")],-1))]),o("div",Go,[o("div",Zo,[t[15]||(t[15]=o("label",{class:"param-label"},"等值线级别",-1)),o("span",tl,k(Mt.value),1)]),ke(o("input",{"onUpdate:modelValue":t[1]||(t[1]=h=>Mt.value=h),type:"range",min:"5",max:"20",step:"1",class:"slider"},null,512),[[Me,Mt.value,void 0,{number:!0}]]),t[16]||(t[16]=o("div",{class:"slider-labels"},[o("span",null,"少"),o("span",null,"多")],-1))]),o("div",el,[t[17]||(t[17]=o("label",{class:"param-label"},"渲染质量",-1)),o("div",ol,[(x(),_(oe,null,le(me,h=>o("button",{key:h.key,class:Ht(["tab-btn",{active:xt.value===h.key}]),onClick:V=>xt.value=h.key},k(h.label),11,ll)),64))]),t[18]||(t[18]=o("div",{class:"slider-labels quality-hint"},[o("span",null,"默认先快速预览，需要时再切换更高质量重算。")],-1))]),J.value?(x(),_("div",sl,[o("label",nl,[ke(o("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=h=>At.value=h)},null,512),[[Le,At.value]]),t[19]||(t[19]=o("span",null,"绘制剖面线",-1))]),At.value?(x(),_("p",al,"在地图上点击两点绘制剖面线")):et("",!0)])):et("",!0),o("div",il,[o("button",{class:"btn primary",onClick:t[3]||(t[3]=h=>gt({forceRefresh:!0,silent:!1})),disabled:N.value},[N.value?(x(),_("span",cl)):et("",!0),ve(" "+k(N.value?"计算中...":"生成等值线图"),1)],8,rl),o("button",{class:"btn outline",onClick:t[4]||(t[4]=h=>{st.value=null,J.value=null,ct.value=null})}," 更换煤层 "),J.value||ct.value?(x(),_("button",{key:0,class:"btn outline",onClick:ce}," 下一步：新算法原理 ")):et("",!0)]),f.value?(x(),_("p",ul,k(f.value),1)):et("",!0)]),o("div",dl,[t[28]||(t[28]=te('<h3 class="section-title" data-v-d3611681><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-d3611681><line x1="18" y1="20" x2="18" y2="10" data-v-d3611681></line><line x1="12" y1="20" x2="12" y2="4" data-v-d3611681></line><line x1="6" y1="20" x2="6" y2="14" data-v-d3611681></line></svg> 数据分布 </h3>',1)),Q.value.length>0?(x(),_("div",vl,[o("canvas",{ref_key:"histogramCanvas",ref:Qt,class:"histogram-canvas"},null,512)])):(x(),_("div",hl,[...t[21]||(t[21]=[o("p",null,"暂无数据分布",-1)])])),Q.value.length>0?(x(),_("div",fl,[o("div",ml,[t[22]||(t[22]=o("span",{class:"stat-label"},"样本数",-1)),o("span",gl,k(c.value.count),1)]),o("div",pl,[t[23]||(t[23]=o("span",{class:"stat-label"},"均值",-1)),o("span",yl,k(c.value.mean.toFixed(2))+"m",1)]),o("div",bl,[t[24]||(t[24]=o("span",{class:"stat-label"},"标准差",-1)),o("span",xl,k(c.value.stdDev.toFixed(2))+"m",1)]),o("div",kl,[t[25]||(t[25]=o("span",{class:"stat-label"},"变异系数",-1)),o("span",_l,k(c.value.cv.toFixed(2)),1)]),o("div",Sl,[t[26]||(t[26]=o("span",{class:"stat-label"},"最小值",-1)),o("span",wl,k(c.value.min.toFixed(2))+"m",1)]),o("div",Cl,[t[27]||(t[27]=o("span",{class:"stat-label"},"最大值",-1)),o("span",Tl,k(c.value.max.toFixed(2))+"m",1)])])):et("",!0)]),o("div",Ml,[t[29]||(t[29]=te('<h3 class="section-title" data-v-d3611681><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-d3611681><path d="M12 2L2 7l10 5 10-5-10-5z" data-v-d3611681></path><path d="m2 17 10 5 10-5" data-v-d3611681></path><path d="m2 12 10 5 10-5" data-v-d3611681></path></svg> 地层柱状图 </h3>',1)),o("div",Fl,[o("canvas",{ref_key:"stratigraphicCanvas",ref:se,class:"stratigraphic-canvas"},null,512)]),o("div",Pl,[(x(),_(oe,null,le(qt,(h,V)=>o("div",{key:V,class:"legend-item-compact"},[o("div",{class:"legend-color",style:ee({background:h})},null,4),o("span",$l,k(V),1)])),64))])]),st.value?(x(),_("div",Al,[o("div",Bl,[o("div",Rl,[o("div",null,[t[30]||(t[30]=o("h3",{class:"section-title"},[o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"})]),ve(" 煤层厚度分布 ")],-1)),J.value?(x(),_("p",Wl,k(Kt(Ct.value))+" · "+k((z=(O=(P=J.value)==null?void 0:P.valueRange)==null?void 0:O.min)==null?void 0:z.toFixed(1))+" - "+k((E=(H=(B=J.value)==null?void 0:B.valueRange)==null?void 0:H.max)==null?void 0:E.toFixed(1))+" m",1)):(x(),_("p",Nl,"正在准备厚度分布图..."))])]),o("div",Il,[J.value?(x(),Fe(Pe,{key:0,"image-url":J.value.imageUrl,boreholes:Q.value,bounds:J.value.bounds,property:"thickness","property-label":"厚度","value-range":J.value.valueRange,colormap:"YlOrBr","cross-section-mode":At.value,onCrossSectionComplete:re},null,8,["image-url","boreholes","bounds","value-range","cross-section-mode"])):(x(),_("div",{key:1,class:Ht(["map-placeholder",{loading:N.value}])},[N.value?(x(),_("div",El)):et("",!0),o("p",null,k(N.value?"正在计算厚度分布图...":"点击“生成等值线图”后显示厚度分布图。"),1)],2))])]),o("div",Dl,[o("div",Yl,[o("div",null,[t[31]||(t[31]=o("h3",{class:"section-title"},[o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o("path",{d:"m2 17 10 5 10-5"})]),ve(" 煤层埋深分布 ")],-1)),ct.value?(x(),_("p",Ll,k(Kt(Ct.value))+" · "+k((ut=(R=(K=ct.value)==null?void 0:K.valueRange)==null?void 0:R.min)==null?void 0:ut.toFixed(1))+" - "+k((Z=(Y=(yt=ct.value)==null?void 0:yt.valueRange)==null?void 0:Y.max)==null?void 0:Z.toFixed(1))+" m",1)):(x(),_("p",Xl,"正在准备埋深分布图..."))])]),o("div",zl,[ct.value?(x(),Fe(Pe,{key:0,"image-url":ct.value.imageUrl,boreholes:Q.value,bounds:ct.value.bounds,property:"burial_depth","property-label":"埋深","value-range":ct.value.valueRange,colormap:"viridis","cross-section-mode":At.value,onCrossSectionComplete:re},null,8,["image-url","boreholes","bounds","value-range","cross-section-mode"])):(x(),_("div",{key:1,class:Ht(["map-placeholder",{loading:N.value}])},[N.value?(x(),_("div",Hl)):et("",!0),o("p",null,k(N.value?"正在计算埋深分布图...":"点击“生成等值线图”后显示埋深分布图。"),1)],2))])])])):et("",!0),st.value?(x(),_("div",ql,[t[32]||(t[32]=te('<div class="map-header" data-v-d3611681><div data-v-d3611681><h3 class="section-title" data-v-d3611681><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-d3611681><circle cx="12" cy="12" r="10" data-v-d3611681></circle><line x1="12" y1="8" x2="12" y2="12" data-v-d3611681></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-d3611681></line></svg> 插值不确定性分布 </h3><p class="section-desc" data-v-d3611681>红色区域表示高不确定性，蓝色区域更可靠</p></div></div>',1)),o("div",Ul,[J.value?(x(),_("canvas",{key:0,ref_key:"uncertaintyCanvas",ref:ne,class:"uncertainty-canvas"},null,512)):(x(),_("div",{key:1,class:Ht(["map-placeholder",{loading:N.value}])},[N.value?(x(),_("div",Ol)):et("",!0),o("p",null,k(N.value?"正在计算不确定性分布图...":"完成插值后显示不确定性分布图。"),1)],2))])])):et("",!0),Bt.value.hasData?(x(),_("div",Vl,[o("div",Ql,[o("div",null,[o("h3",Jl,[t[33]||(t[33]=o("svg",{class:"section-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[o("path",{d:"M3 3v18h18"}),o("path",{d:"m19 9-5 5-4-4-3 3"})],-1)),t[34]||(t[34]=ve(" 剖面切片 (A-A') ",-1)),o("span",Kl,k((L=Bt.value.distance)==null?void 0:L.toFixed(0))+" m",1)])]),o("button",{class:"btn outline small",onClick:Gt},"重置")]),o("div",jl,[o("canvas",{ref_key:"crossSectionCanvas",ref:Rt,class:"cross-section-canvas"},null,512)])])):et("",!0)])):(x(),_("div",Ro,[t[11]||(t[11]=te('<h3 class="section-title" data-v-d3611681><svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-d3611681><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-d3611681></rect><line x1="3" y1="9" x2="21" y2="9" data-v-d3611681></line><line x1="9" y1="21" x2="9" y2="9" data-v-d3611681></line></svg> 选择分析煤层 </h3><p class="section-desc" data-v-d3611681>从以下可用煤层中选择一个进行插值分析</p>',2)),o("div",Wo,[(x(!0),_(oe,null,le(Tt.value,h=>{var V,b,d,T,X;return x(),_("div",{key:h.name,class:"seam-selection-card",onClick:ot=>nt(h)},[o("div",Io,[o("span",Eo,k(h.name),1),o("span",Do,k(h.borehole_count)+" 个钻孔",1)]),o("div",Yo,[o("div",Lo,[t[9]||(t[9]=o("span",{class:"mini-stat-label"},"平均厚度",-1)),o("span",Xo,k((V=h.avg_thickness)==null?void 0:V.toFixed(2))+" m",1)]),o("div",zo,[t[10]||(t[10]=o("span",{class:"mini-stat-label"},"厚度范围",-1)),o("span",Ho,k((d=(b=h.thickness_range)==null?void 0:b.min)==null?void 0:d.toFixed(1))+"-"+k((X=(T=h.thickness_range)==null?void 0:T.max)==null?void 0:X.toFixed(1))+" m",1)])])],8,No)}),128))])]))])}}},as=Ae(Gl,[["__scopeId","data-v-d3611681"]]);export{as as default};
