var g=(oe,y,v)=>new Promise((M,I)=>{var G=m=>{try{S(v.next(m))}catch(h){I(h)}},L=m=>{try{S(v.throw(m))}catch(h){I(h)}},S=m=>m.done?M(m.value):Promise.resolve(m.value).then(G,L);S((v=v.apply(oe,y)).next())});import{w as se,bf as Ie,b8 as d,b7 as t,bi as x,bo as c,bb as p,br as b,bv as C,bs as B,bc as me,b9 as be,b6 as ye,b as u,c as Ve,b5 as i}from"./vendor-CA5Q5CdR.js";import{_ as Re,a as Be}from"./index-D1RuNWc2.js";import{H as fe}from"./HeatmapCanvas-DZhbS9WW.js";import{g as Ge,o as Le,q as Ne,r as Ee,t as $e,w as ze,b as Ce,m as Te,l as qe}from"./api-BcwPnB85.js";import"./vue-router-D9BXaJFq.js";import"./network-T6nY3V_4.js";const Oe={class:"steps-page"},je={class:"hero card"},Fe={class:"hero-actions"},He=["disabled"],De={key:0,class:"spinner"},Qe=["disabled"],Ae=["disabled"],We={class:"card params-card"},Je={class:"params-grid"},Ke={key:0},Xe=["disabled"],Ye=["value"],Ze={class:"card kpi-card"},et={class:"kpi-grid"},tt={class:"kpi-item"},lt={key:0},st={class:"kpi-item"},nt={key:0},at={class:"kpi-item"},ot={key:0},ut={class:"kpi-item"},it={key:0},rt={key:0,class:"hint"},dt={class:"two-col"},vt={class:"card panel"},pt={class:"panel-head"},ct={class:"tag"},mt={class:"panel-body"},bt={key:0,class:"loading-block"},yt={key:2,class:"empty-block"},ft={class:"card panel"},gt={class:"panel-head"},kt={class:"tag"},_t={class:"panel-body"},ht={key:0,class:"loading-block"},wt={key:2,class:"empty-block"},Mt={class:"stats-row"},St={class:"stat-item"},Pt={class:"stat-item"},Ut={class:"stat-item"},xt={class:"suggestion"},It={class:"card panel"},Vt={class:"panel-body"},Rt={key:0,class:"loading-block"},Bt={key:1,class:"table-wrap"},Gt={key:0,class:"table-foot"},Lt={key:2,class:"empty-block"},Nt={__name:"Steps",setup(oe){const y=Be(),v=u("fixed"),M=u("initial"),I=u(10),G=u(1),L=u(2),S=u(1),m=u("total"),h=u("density_thickness"),T=u(1),N=u(60),E=u([]),k=u(""),D=u(60),Q=u("idw"),q=u(!1),O=u(!1),A=u(!1),ne=u(!1),W=u(!1),J=u(!1),ae=u(null),K=u(null),V=u(null),j=u(null),P=u({}),X=u(""),Y=u(""),Z=u(""),R=u(""),ee=new Map,U=(l,e=2,a="")=>{const s=Number(l);return Number.isFinite(s)?`${s.toFixed(e)}${a?` ${a}`:""}`:"-"},ge=Ve(()=>{var e;const l=Number((e=P.value)==null?void 0:e.mean);return Number.isFinite(l)?l<60?"MPI偏低，建议适当减小步距并提高支护强度。":l<80?"MPI中等，建议按当前步距执行并重点监测局部异常区。":"MPI较高，整体风险较低，可在安全条件下适度增大步距。":"暂无建议，等待MPI结果自动计算完成。"}),te=(l,e=600)=>{let a=null;return()=>{window.clearTimeout(a),a=window.setTimeout(l,e)}},ue=(l=!1)=>g(this,null,function*(){var e,a;A.value=!0,X.value="";try{const{data:s}=yield Ee(v.value,I.value,G.value,L.value,S.value);ae.value=s}catch(s){const r=((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.detail)||"步距计算失败";X.value=r,l&&y.add(r,"error")}finally{A.value=!1}}),ie=(l=!1)=>g(this,null,function*(){var e,a;ne.value=!0,Y.value="";try{const{data:s}=yield $e(v.value,M.value,m.value,h.value,N.value,T.value);K.value=s}catch(s){const r=((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.detail)||"步距网格计算失败";Y.value=r,l&&y.add(r,"error")}finally{ne.value=!1}}),re=(l=!1)=>g(this,null,function*(){var e,a;W.value=!0,Z.value="";try{const{data:s}=yield ze(v.value);V.value=s}catch(s){const r=((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.detail)||"批量步距计算失败";Z.value=r,l&&y.add(r,"error")}finally{W.value=!1}}),ke=l=>g(this,null,function*(){if(!l)return null;if(ee.has(l))return ee.get(l);try{const{data:e}=yield qe(l);return ee.set(l,e),e}catch(e){return ee.set(l,null),null}}),_e=(...e)=>g(this,[...e],function*(l=[]){var s,r;const a=[];for(const _ of l){const f=_.layers||[],$=f.find(w=>w.name===k.value),le=f.filter(w=>w.name!==k.value),F=[];for(const w of le){const o=yield ke(w.name);F.push({thickness:w.thickness||0,name:w.name||"",density:o==null?void 0:o.density,bulk_modulus:o==null?void 0:o.bulk_modulus,shear_modulus:o==null?void 0:o.shear_modulus,cohesion:o==null?void 0:o.cohesion,friction_angle:o==null?void 0:o.friction_angle,tensile_strength:o==null?void 0:o.tensile_strength,compressive_strength:o==null?void 0:o.compressive_strength,elastic_modulus:o==null?void 0:o.elastic_modulus,poisson_ratio:o==null?void 0:o.poisson_ratio})}const z=(r=(s=_.seam_top_depth)!=null?s:_.total_overburden_thickness)!=null?r:0,H=($==null?void 0:$.thickness)||0;a.push({x:_.x,y:_.y,borehole:_.name,thickness:H,burial_depth:z,z_top:z,z_bottom:z+H,strata:F})}return a}),de=(l=!1)=>g(this,null,function*(){var e,a;if(!k.value){j.value=null,P.value={};return}J.value=!0,R.value="";try{const{data:s}=yield Ce(k.value),r=(s==null?void 0:s.boreholes)||[];if(!r.length){j.value=null,P.value={},R.value="当前煤层没有可用钻孔数据",l&&y.add(R.value,"warning");return}const _=yield _e(r),{data:f}=yield Te(_,D.value,Q.value);j.value=(f==null?void 0:f.grid)||null,P.value=(f==null?void 0:f.statistics)||{}}catch(s){const r=((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.detail)||"MPI分布计算失败";R.value=r,l&&y.add(r,"error")}finally{J.value=!1}}),ve=(l=!1)=>g(this,null,function*(){q.value=!0,yield Promise.all([ue(l),ie(l),re(l),de(l)]),q.value=!1,l&&y.add("全部结果已刷新","success")}),he=()=>g(this,null,function*(){try{const{data:l}=yield Le(v.value,M.value,m.value,h.value,N.value,T.value),e=URL.createObjectURL(l),a=document.createElement("a");a.href=e,a.download=`pressure_steps_grid_${v.value}_${M.value}_${N.value}.csv`,a.click(),URL.revokeObjectURL(e),y.add("步距网格导出成功","success")}catch(l){y.add("步距网格导出失败","error")}}),we=()=>g(this,null,function*(){try{const{data:l}=yield Ne(v.value),e=URL.createObjectURL(l),a=document.createElement("a");a.href=e,a.download=`pressure_steps_${v.value}.csv`,a.click(),URL.revokeObjectURL(e),y.add("批量结果导出成功","success")}catch(l){y.add("批量结果导出失败","error")}}),Me=()=>g(this,null,function*(){try{const{data:l}=yield Ge();E.value=(l==null?void 0:l.seams)||[],!k.value&&E.value.length&&(k.value=E.value[0].name)}catch(l){E.value=[],k.value="",R.value="煤层列表加载失败"}}),Se=te(()=>ue(!1),500),Pe=te(()=>ie(!1),650),Ue=te(()=>re(!1),650),xe=te(()=>de(!1),700);return se([v,I,G,L,S],()=>{O.value&&Se()}),se([v,M,m,h,T,N],()=>{O.value&&Pe()}),se(v,()=>{O.value&&Ue()}),se([k,D,Q],()=>{O.value&&xe()}),Ie(()=>g(this,null,function*(){yield Me(),O.value=!0,yield ve(!1)})),(l,e)=>{var a,s,r,_,f,$,le,F,z,H,w,o,pe;return i(),d("div",Oe,[t("header",je,[e[14]||(e[14]=t("div",null,[t("h1",null,"来压步距智能计算"),t("p",null,"默认自动计算：进入页面后立即生成步距结果、步距网格、MPI分布和批量统计。")],-1)),t("div",Fe,[t("button",{class:"btn primary",disabled:q.value,onClick:e[0]||(e[0]=n=>ve(!0))},[q.value?(i(),d("span",De)):x("",!0),c(" "+p(q.value?"刷新中...":"刷新全部结果"),1)],8,He),t("button",{class:"btn secondary",disabled:!K.value,onClick:he},"导出步距网格",8,Qe),t("button",{class:"btn secondary",disabled:!V.value,onClick:we},"导出批量结果",8,Ae)])]),t("section",We,[e[33]||(e[33]=t("h2",null,"参数设置",-1)),t("div",Je,[t("label",null,[e[16]||(e[16]=c(" 力学模型 ",-1)),b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n)},[...e[15]||(e[15]=[t("option",{value:"fixed"},"固支梁模型",-1),t("option",{value:"simply"},"简支梁模型",-1),t("option",{value:"shear"},"剪切破坏模型",-1),t("option",{value:"empirical"},"经验比例模型",-1)])],512),[[C,v.value]])]),t("label",null,[e[18]||(e[18]=c(" 计算目标 ",-1)),b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>M.value=n)},[...e[17]||(e[17]=[t("option",{value:"initial"},"初次来压步距",-1),t("option",{value:"periodic"},"周期来压步距",-1)])],512),[[C,M.value]])]),t("label",null,[e[19]||(e[19]=c(" 顶板厚度 h (m) ",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>I.value=n),type:"number",step:"0.1",min:"0.1"},null,512),[[B,I.value,void 0,{number:!0}]])]),t("label",null,[e[20]||(e[20]=c(" 载荷 q (MPa) ",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>G.value=n),type:"number",step:"0.1",min:"0.1"},null,512),[[B,G.value,void 0,{number:!0}]])]),t("label",null,[e[21]||(e[21]=c(" 抗拉强度 t (MPa) ",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>L.value=n),type:"number",step:"0.1",min:"0.1"},null,512),[[B,L.value,void 0,{number:!0}]])]),t("label",null,[e[22]||(e[22]=c(" 抗剪强度 s (MPa) ",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>S.value=n),type:"number",step:"0.1",min:"0.1"},null,512),[[B,S.value,void 0,{number:!0}]])]),t("label",null,[e[24]||(e[24]=c(" h取值 ",-1)),b(t("select",{"onUpdate:modelValue":e[7]||(e[7]=n=>m.value=n)},[...e[23]||(e[23]=[t("option",{value:"total"},"总厚度",-1)])],512),[[C,m.value]])]),t("label",null,[e[26]||(e[26]=c(" q取值 ",-1)),b(t("select",{"onUpdate:modelValue":e[8]||(e[8]=n=>h.value=n)},[...e[25]||(e[25]=[t("option",{value:"density_thickness"},"容重 × 厚度",-1),t("option",{value:"default"},"默认值",-1)])],512),[[C,h.value]])]),h.value==="default"?(i(),d("label",Ke,[e[27]||(e[27]=c(" 默认q ",-1)),b(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>T.value=n),type:"number",step:"0.1",min:"0.1"},null,512),[[B,T.value,void 0,{number:!0}]])])):x("",!0),t("label",null,[e[28]||(e[28]=c(" 网格大小 ",-1)),b(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>N.value=n),type:"number",min:"20",max:"120",step:"1"},null,512),[[B,N.value,void 0,{number:!0}]])]),t("label",null,[e[29]||(e[29]=c(" MPI煤层 ",-1)),b(t("select",{"onUpdate:modelValue":e[11]||(e[11]=n=>k.value=n),disabled:E.value.length===0},[(i(!0),d(me,null,be(E.value,n=>(i(),d("option",{key:n.name,value:n.name},p(n.name),9,Ye))),128))],8,Xe),[[C,k.value]])]),t("label",null,[e[30]||(e[30]=c(" MPI网格 ",-1)),b(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>D.value=n),type:"number",min:"20",max:"150",step:"1"},null,512),[[B,D.value,void 0,{number:!0}]])]),t("label",null,[e[32]||(e[32]=c(" MPI插值 ",-1)),b(t("select",{"onUpdate:modelValue":e[13]||(e[13]=n=>Q.value=n)},[...e[31]||(e[31]=[t("option",{value:"idw"},"IDW",-1),t("option",{value:"linear"},"Linear",-1),t("option",{value:"nearest"},"Nearest",-1)])],512),[[C,Q.value]])])])]),t("section",Ze,[e[38]||(e[38]=t("h2",null,"核心结果总览",-1)),t("div",et,[t("article",tt,[e[34]||(e[34]=t("span",null,"初次来压步距",-1)),t("strong",null,p(U((a=ae.value)==null?void 0:a.initial_step,2,"m")),1),A.value?(i(),d("small",lt,"自动计算中...")):x("",!0)]),t("article",st,[e[35]||(e[35]=t("span",null,"周期来压步距",-1)),t("strong",null,p(U((s=ae.value)==null?void 0:s.periodic_step,2,"m")),1),A.value?(i(),d("small",nt,"自动计算中...")):x("",!0)]),t("article",at,[e[36]||(e[36]=t("span",null,"MPI均值",-1)),t("strong",null,p(U((r=P.value)==null?void 0:r.mean,2)),1),J.value?(i(),d("small",ot,"自动计算中...")):x("",!0)]),t("article",ut,[e[37]||(e[37]=t("span",null,"批量样本数",-1)),t("strong",null,p(((f=(_=V.value)==null?void 0:_.items)==null?void 0:f.length)||0),1),W.value?(i(),d("small",it,"自动计算中...")):x("",!0)])]),X.value||Y.value||Z.value||R.value?(i(),d("p",rt,p(X.value||Y.value||Z.value||R.value),1)):x("",!0)]),t("section",dt,[t("article",vt,[t("div",pt,[e[39]||(e[39]=t("h3",null,"步距分布网格",-1)),t("span",ct,p(v.value)+" / "+p(M.value),1)]),t("div",mt,[ne.value?(i(),d("div",bt,"正在自动计算步距网格...")):(le=($=K.value)==null?void 0:$.values)!=null&&le.length?(i(),ye(fe,{key:1,grid:K.value.values,size:480},null,8,["grid"])):(i(),d("div",yt,"暂无网格数据"))])]),t("article",ft,[t("div",gt,[e[40]||(e[40]=t("h3",null,"MPI分布与步距建议",-1)),t("span",kt,p(k.value||"未选择煤层"),1)]),t("div",_t,[J.value?(i(),d("div",ht,"正在自动计算MPI分布...")):(F=j.value)!=null&&F.length?(i(),ye(fe,{key:1,grid:j.value,size:420},null,8,["grid"])):(i(),d("div",wt,"暂无MPI分布")),t("div",Mt,[t("div",St,[e[41]||(e[41]=t("span",null,"最小值",-1)),t("strong",null,p(U((z=P.value)==null?void 0:z.min,2)),1)]),t("div",Pt,[e[42]||(e[42]=t("span",null,"最大值",-1)),t("strong",null,p(U((H=P.value)==null?void 0:H.max,2)),1)]),t("div",Ut,[e[43]||(e[43]=t("span",null,"平均值",-1)),t("strong",null,p(U((w=P.value)==null?void 0:w.mean,2)),1)])]),t("div",xt,[e[44]||(e[44]=t("h4",null,"步距建议",-1)),t("p",null,p(ge.value),1)])])])]),t("section",It,[e[46]||(e[46]=t("div",{class:"panel-head"},[t("h3",null,"批量步距结果"),t("span",{class:"tag"},"最多预览前20条")],-1)),t("div",Vt,[W.value?(i(),d("div",Rt,"正在自动计算批量结果...")):(pe=(o=V.value)==null?void 0:o.items)!=null&&pe.length?(i(),d("div",Bt,[t("table",null,[e[45]||(e[45]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"初次来压步距 (m)"),t("th",null,"周期来压步距 (m)")])],-1)),t("tbody",null,[(i(!0),d(me,null,be(V.value.items.slice(0,20),(n,ce)=>(i(),d("tr",{key:ce},[t("td",null,p(ce+1),1),t("td",null,p(U(n.initial,2)),1),t("td",null,p(U(n.periodic,2)),1)]))),128))])]),V.value.items.length>20?(i(),d("div",Gt,"还有 "+p(V.value.items.length-20)+" 条未展示",1)):x("",!0)])):(i(),d("div",Lt,"暂无批量结果"))])])])}}},jt=Re(Nt,[["__scopeId","data-v-ba2206fa"]]);export{jt as default};
