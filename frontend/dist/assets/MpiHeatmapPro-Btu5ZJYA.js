import{a as We,i as G,C as Le,D as ge,_ as Hn,b as lt,c as ct,d as v,t as st,F as ye,k as me,g as qt,n as Ut,w as Re,o as zr,m as At,y as Wr,h as xn,f as Ht,l as _n,B as Or,T as Ur,E as at,r as Z,u as Gr,G as Kr,v as Zr,p as Yt}from"./index-tY8q6Zf3.js";import{g as Jr,j as Qr,c as jr,m as ti,l as ei}from"./api-ChvzGBUD.js";function ni(t,e={}){const n={totalDistance:e.totalDistance||500,frameRate:e.frameRate||60,progressPerSecond:e.progressPerSecond||10,autoPlay:e.autoPlay||!1},r=Le({isPlaying:n.autoPlay,progress:0,direction:0,playbackSpeed:1,lastFrameTime:0,animationId:null}),i=G(()=>r.progress/100*n.totalDistance),s=G(()=>n.totalDistance-i.value),o=G(()=>r.progress>=100),u=G(()=>(r.direction-90)*Math.PI/180),f=G(()=>{if(!t.value)return null;if(t.value.bounds)return t.value.bounds;if(t.value.points&&t.value.points.length>0){const L=t.value.points.map(J=>J[0]),et=t.value.points.map(J=>J[1]);return{min_x:Math.min(...L),max_x:Math.max(...L),min_y:Math.min(...et),max_y:Math.max(...et)}}return null}),c=G(()=>f.value?{x:(f.value.min_x+f.value.max_x)/2,y:(f.value.min_y+f.value.max_y)/2}:null),h=G(()=>f.value?f.value.max_y-f.value.min_y:0),d=G(()=>{if(!c.value||!f.value)return null;const L=u.value,J=(f.value.max_x-f.value.min_x)*(r.progress/100),pt=f.value.min_x+Math.cos(L)*J,gt=c.value.y+Math.sin(L)*J,_t=L+Math.PI/2,yt=h.value/2;return{start:{x:pt-Math.cos(_t)*yt,y:gt-Math.sin(_t)*yt},end:{x:pt+Math.cos(_t)*yt,y:gt+Math.sin(_t)*yt},center:{x:pt,y:gt},angle:_t,length:h.value}}),g=G(()=>{if(!f.value||!d.value)return null;const L=u.value;f.value.min_x,f.value.max_y,f.value.min_x,f.value.min_y;const et=c.value,J=f.value.min_x,P={x:et.x-Math.cos(L)*(et.x-J),y:et.y-Math.sin(L)*(et.x-J)},pt=L+Math.PI/2,gt=h.value/2,_t={x:P.x-Math.cos(pt)*gt,y:P.y-Math.sin(pt)*gt},yt={x:P.x+Math.cos(pt)*gt,y:P.y+Math.sin(pt)*gt};return[_t,yt,d.value.end,d.value.start]}),y=G(()=>{if(!d.value)return null;const L=50;return L/d.value.length,{distance:L,frontLine:d.value}}),_=G(()=>d.value?{distance:30,frontLine:d.value}:null),b=()=>{o.value&&(r.progress=0),r.isPlaying=!0,r.lastFrameTime=performance.now(),A()},M=()=>{r.isPlaying=!1,r.animationId&&(cancelAnimationFrame(r.animationId),r.animationId=null)},E=()=>{r.isPlaying?M():b()},$=L=>{r.progress=Math.max(0,Math.min(100,L))},V=()=>{$(0)},w=()=>{$(100)},I=()=>{$(r.progress+2)},H=()=>{$(r.progress-2)},S=L=>{r.direction=L%360,r.direction<0&&(r.direction+=360)},C=L=>{r.playbackSpeed=Math.max(.1,Math.min(10,L))},A=()=>{if(!r.isPlaying)return;const L=performance.now(),et=L-r.lastFrameTime;r.lastFrameTime=L;const J=et/1e3*n.progressPerSecond*r.playbackSpeed,P=r.progress+J;P>=100?(r.progress=100,r.isPlaying=!1):(r.progress=P,r.animationId=requestAnimationFrame(A)),N&&N(r.progress)};let N=null;const q=L=>{N=L};return We(()=>{M()}),{state:r,isPlaying:G(()=>r.isPlaying),progress:G(()=>r.progress),direction:G(()=>r.direction),playbackSpeed:G(()=>r.playbackSpeed),frontLine:d,goafArea:g,stressZone:y,reliefZone:_,currentDistance:i,remainingDistance:s,isComplete:o,play:b,pause:M,togglePlay:E,seek:$,skipToStart:V,skipToEnd:w,stepForward:I,stepBackward:H,setDirection:S,setPlaybackSpeed:C,onProgress:q}}function wn(t={}){const{maxParticles:e=200,particleLife:n=2e3,emitRate:r=2}=t,i=ge([]),s=[];let o=null;const u=()=>{for(let w=0;w<e+50;w++)s.push(f())};function f(){return{x:0,y:0,vx:0,vy:0,type:"stress",life:0,maxLife:n,birth:0,size:2,colorHue:0,colorSat:80,colorLight:60,active:!1}}function c(){for(let I=0;I<s.length;I++)if(!s[I].active)return s[I];const w=f();return s.push(w),w}function h(w,I,H,S,C,A="stress"){w.x=I,w.y=H,w.vx=S,w.vy=C,w.type=A,w.life=1,w.maxLife=n+Math.random()*500-250,w.birth=Date.now(),w.size=2+Math.random()*2,w.active=!0,A==="stress"?w.colorHue=Math.random()*30:w.colorHue=200+Math.random()*40}const d=(w,I,H=1)=>{let S=0;for(let A=0;A<s.length;A++)s[A].active&&S++;if(S>=e)return;const C=.3;for(let A=0;A<r;A++){const N=c(),q=Math.random(),L=w[0].x+(w[1].x-w[0].x)*q,et=w[0].y+(w[1].y-w[0].y)*q,J=I.x*H+(Math.random()-.5)*C,P=I.y*H+(Math.random()-.5)*C;h(N,L,et,J,P,"stress")}y()},g=(w,I=.5)=>{let H=0;for(let S=0;S<s.length;S++)s[S].active&&H++;if(!(H>=e)){for(let S=0;S<Math.ceil(r/2);S++){const C=c(),A=w.minX+Math.random()*(w.maxX-w.minX),N=w.minY+Math.random()*(w.maxY-w.minY),q=Math.random()*Math.PI*2,L=Math.cos(q)*I,et=Math.sin(q)*I;h(C,A,N,L,et,"relief")}y()}};function y(){const w=[];for(let I=0;I<s.length;I++)s[I].active&&w.push(s[I]);i.value=w}const _=(w=.016)=>{const I=Date.now();for(let H=0;H<s.length;H++){const S=s[H];if(!S.active)continue;const C=I-S.birth;if(S.life=1-C/S.maxLife,S.life<=0){S.active=!1;continue}S.x+=S.vx*w,S.y+=S.vy*w,S.vx+=(Math.random()-.5)*.02,S.vy+=(Math.random()-.5)*.02,S.vx*=.99,S.vy*=.99}y()},b=w=>{const I=[],H=[];for(let S=0;S<i.value.length;S++){const C=i.value[S];C.type==="stress"?I.push(C):H.push(C)}for(let S=0;S<I.length;S++){const C=I[S],A=C.life*.6;w.fillStyle=`hsla(${C.colorHue}, ${C.colorSat}%, ${C.colorLight}%, ${A})`,w.beginPath(),w.arc(C.x,C.y,C.size*C.life,0,Math.PI*2),w.fill()}for(let S=0;S<H.length;S++){const C=H[S],A=C.life*.6;w.fillStyle=`hsla(${C.colorHue}, ${C.colorSat}%, ${C.colorLight}%, ${A})`,w.beginPath(),w.arc(C.x,C.y,C.size*C.life,0,Math.PI*2),w.fill()}},M=()=>{for(let w=0;w<s.length;w++)s[w].active=!1;i.value=[]},E=G(()=>i.value.length);u();const $=w=>{o&&cancelAnimationFrame(o);let I=performance.now();const H=()=>{const S=performance.now(),C=(S-I)/1e3;I=S,_(C),w(),o=requestAnimationFrame(H)};o=requestAnimationFrame(H)},V=()=>{o&&(cancelAnimationFrame(o),o=null)};return We(()=>{V(),M()}),{particles:i,count:E,emitStressParticles:d,emitReliefParticles:g,update:_,draw:b,clear:M,startAnimation:$,stopAnimation:V}}function ri(t={}){const{maxRipples:e=10,rippleSpeed:n=50,rippleInterval:r=800}=t,i=ge([]),s=[];let o=0;const u=()=>{for(let _=0;_<e+2;_++)s.push({x:0,y:0,radius:0,maxRadius:100,life:0,speed:n,width:2,active:!1})};function f(){for(let b=0;b<s.length;b++)if(!s[b].active)return s[b];const _={x:0,y:0,radius:0,maxRadius:100,life:0,speed:n,width:2,active:!1};return s.push(_),_}function c(){const _=[];for(let b=0;b<s.length;b++)s[b].active&&_.push(s[b]);i.value=_}const h=(_,b)=>{const M=Date.now();if(M-o<r)return;let E=0;for(let V=0;V<s.length;V++)s[V].active&&E++;if(E>=e)return;const $=f();$.x=_,$.y=b,$.radius=0,$.maxRadius=100+Math.random()*50,$.life=1,$.speed=n+Math.random()*20,$.width=2+Math.random()*2,$.active=!0,o=M,c()},d=(_=.016)=>{for(let b=0;b<s.length;b++){const M=s[b];M.active&&(M.radius+=M.speed*_,M.life=1-M.radius/M.maxRadius,M.life<=0&&(M.active=!1))}c()},g=_=>{for(let b=0;b<i.value.length;b++){const M=i.value[b];_.beginPath(),_.arc(M.x,M.y,M.radius,0,Math.PI*2),_.strokeStyle=`rgba(239, 68, 68, ${M.life*.5})`,_.lineWidth=M.width*M.life,_.stroke()}},y=()=>{for(let _=0;_<s.length;_++)s[_].active=!1;i.value=[]};return u(),{ripples:i,emit:h,update:d,draw:g,clear:y}}const ii={class:"direction-control"},si={class:"control-header"},oi={class:"value-display"},ai={class:"compass-container"},li={class:"compass-ring"},ci={class:"compass-marks"},ui={class:"quick-select"},fi=["onClick","title"],hi={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},di=["d"],vi={class:"fine-control"},pi=["value"],gi={__name:"DirectionControl",props:{direction:{type:Number,default:0}},emits:["update:direction"],setup(t){const e=t,n=[{angle:0,label:"E"},{angle:45,label:"NE"},{angle:90,label:"N"},{angle:135,label:"NW"},{angle:180,label:"W"},{angle:225,label:"SW"},{angle:270,label:"S"},{angle:315,label:"SE"}],r=[{value:0,label:"向东 (0°)",icon:"M5 12h14M12 5l7 7-7 7"},{value:90,label:"向北 (90°)",icon:"M12 19V5M5 12l7-7 7 7"},{value:180,label:"向西 (180°)",icon:"M19 12H5M12 19l-7-7 7-7"},{value:270,label:"向南 (270°)",icon:"M12 5v14M19 12l-7 7-7-7"}],i=s=>{const o=Math.abs(e.direction-s);return o<=10||o>=350};return(s,o)=>(lt(),ct("div",ii,[v("div",si,[o[1]||(o[1]=v("span",{class:"label"},"推进方向",-1)),v("span",oi,st(t.direction)+"°",1)]),v("div",ai,[v("div",li,[v("div",ci,[(lt(),ct(ye,null,me(n,u=>v("span",{key:u.angle,class:Ut(["mark",{active:i(u.angle)}]),style:qt({transform:`rotate(${u.angle}deg) translateX(-50%)`})},[v("span",{class:"mark-label",style:qt({transform:`rotate(-${u.angle}deg)`})},st(u.label),5)],6)),64))]),v("div",{class:"compass-arrow",style:qt({transform:`rotate(${t.direction}deg)`})},[...o[2]||(o[2]=[v("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[v("path",{d:"M12 2L4.5 20L12 17L19.5 20L12 2Z"})],-1)])],4),v("div",{class:"compass-center",style:qt({transform:`rotate(${t.direction}deg)`})},[...o[3]||(o[3]=[v("div",{class:"direction-line"},null,-1)])],4)])]),v("div",ui,[(lt(),ct(ye,null,me(r,u=>v("button",{key:u.value,class:Ut(["quick-btn",{active:t.direction===u.value}]),onClick:f=>s.$emit("update:direction",u.value),title:u.label},[(lt(),ct("svg",hi,[v("path",{d:u.icon},null,8,di)]))],10,fi)),64))]),v("div",vi,[v("input",{type:"range",value:t.direction,onInput:o[0]||(o[0]=u=>s.$emit("update:direction",Number(u.target.value))),min:"0",max:"360",step:"1",class:"direction-slider"},null,40,pi),o[4]||(o[4]=v("div",{class:"slider-labels"},[v("span",null,"0°"),v("span",null,"180°"),v("span",null,"360°")],-1))])]))}},yi=Hn(gi,[["__scopeId","data-v-e9ee0388"]]);function mi(t,e){let n=0;for(let r of t)r!=null&&(r=+r)>=r&&++n;return n}function xi(t,e){let n,r;if(e===void 0)for(const i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let s of t)(s=e(s,++i,t))!=null&&(n===void 0?s>=s&&(n=r=s):(n>s&&(n=s),r<s&&(r=s)))}return[n,r]}const _i=Math.sqrt(50),wi=Math.sqrt(10),bi=Math.sqrt(2);function xe(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=_i?10:s>=wi?5:s>=bi?2:1;let u,f,c;return i<0?(c=Math.pow(10,-i)/o,u=Math.round(t*c),f=Math.round(e*c),u/c<t&&++u,f/c>e&&--f,c=-c):(c=Math.pow(10,i)*o,u=Math.round(t/c),f=Math.round(e/c),u*c<t&&++u,f*c>e&&--f),f<u&&.5<=n&&n<2?xe(t,e,n*2):[u,f,c]}function Mi(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,o]=r?xe(e,t,n):xe(t,e,n);if(!(s>=i))return[];const u=s-i+1,f=new Array(u);if(r)if(o<0)for(let c=0;c<u;++c)f[c]=(s-c)/-o;else for(let c=0;c<u;++c)f[c]=(s-c)*o;else if(o<0)for(let c=0;c<u;++c)f[c]=(i+c)/-o;else for(let c=0;c<u;++c)f[c]=(i+c)*o;return f}function ki(t,e,n){return e=+e,t=+t,n=+n,xe(t,e,n)[2]}function Si(t,e,n){let r;for(;;){const i=ki(t,e,n);if(i===r||i===0||!isFinite(i))return[t,e];i>0?(t=Math.floor(t/i)*i,e=Math.ceil(e/i)*i):i<0&&(t=Math.ceil(t*i)/i,e=Math.floor(e*i)/i),r=i}}function Ci(t){return Math.max(1,Math.ceil(Math.log(mi(t))/Math.LN2)+1)}function Pi(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(i);++r<i;)s[r]=t+r*n;return s}var $i={value:()=>{}};function Yn(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new de(n)}function de(t){this._=t}function Ai(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}de.prototype=Yn.prototype={constructor:de,on:function(t,e){var n=this._,r=Ai(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=Ei(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=bn(n[i],t.name,e);else if(e==null)for(i in n)n[i]=bn(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new de(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function Ei(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function bn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=$i,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Xe="http://www.w3.org/1999/xhtml";const Mn={svg:"http://www.w3.org/2000/svg",xhtml:Xe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ce(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Mn.hasOwnProperty(e)?{space:Mn[e],local:t}:t}function Ni(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Xe&&e.documentElement.namespaceURI===Xe?e.createElement(t):e.createElementNS(n,t)}}function Ti(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Vn(t){var e=Ce(t);return(e.local?Ti:Ni)(e)}function Ri(){}function Oe(t){return t==null?Ri:function(){return this.querySelector(t)}}function Ii(t){typeof t!="function"&&(t=Oe(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,u=r[i]=new Array(o),f,c,h=0;h<o;++h)(f=s[h])&&(c=t.call(f,f.__data__,h,s))&&("__data__"in f&&(c.__data__=f.__data__),u[h]=c);return new dt(r,this._parents)}function Di(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Fi(){return[]}function qn(t){return t==null?Fi:function(){return this.querySelectorAll(t)}}function Li(t){return function(){return Di(t.apply(this,arguments))}}function Xi(t){typeof t=="function"?t=Li(t):t=qn(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],u=o.length,f,c=0;c<u;++c)(f=o[c])&&(r.push(t.call(f,f.__data__,c,o)),i.push(f));return new dt(r,i)}function zn(t){return function(){return this.matches(t)}}function Wn(t){return function(e){return e.matches(t)}}var Bi=Array.prototype.find;function Hi(t){return function(){return Bi.call(this.children,t)}}function Yi(){return this.firstElementChild}function Vi(t){return this.select(t==null?Yi:Hi(typeof t=="function"?t:Wn(t)))}var qi=Array.prototype.filter;function zi(){return Array.from(this.children)}function Wi(t){return function(){return qi.call(this.children,t)}}function Oi(t){return this.selectAll(t==null?zi:Wi(typeof t=="function"?t:Wn(t)))}function Ui(t){typeof t!="function"&&(t=zn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,u=r[i]=[],f,c=0;c<o;++c)(f=s[c])&&t.call(f,f.__data__,c,s)&&u.push(f);return new dt(r,this._parents)}function On(t){return new Array(t.length)}function Gi(){return new dt(this._enter||this._groups.map(On),this._parents)}function _e(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}_e.prototype={constructor:_e,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ki(t){return function(){return t}}function Zi(t,e,n,r,i,s){for(var o=0,u,f=e.length,c=s.length;o<c;++o)(u=e[o])?(u.__data__=s[o],r[o]=u):n[o]=new _e(t,s[o]);for(;o<f;++o)(u=e[o])&&(i[o]=u)}function Ji(t,e,n,r,i,s,o){var u,f,c=new Map,h=e.length,d=s.length,g=new Array(h),y;for(u=0;u<h;++u)(f=e[u])&&(g[u]=y=o.call(f,f.__data__,u,e)+"",c.has(y)?i[u]=f:c.set(y,f));for(u=0;u<d;++u)y=o.call(t,s[u],u,s)+"",(f=c.get(y))?(r[u]=f,f.__data__=s[u],c.delete(y)):n[u]=new _e(t,s[u]);for(u=0;u<h;++u)(f=e[u])&&c.get(g[u])===f&&(i[u]=f)}function Qi(t){return t.__data__}function ji(t,e){if(!arguments.length)return Array.from(this,Qi);var n=e?Ji:Zi,r=this._parents,i=this._groups;typeof t!="function"&&(t=Ki(t));for(var s=i.length,o=new Array(s),u=new Array(s),f=new Array(s),c=0;c<s;++c){var h=r[c],d=i[c],g=d.length,y=ts(t.call(h,h&&h.__data__,c,r)),_=y.length,b=u[c]=new Array(_),M=o[c]=new Array(_),E=f[c]=new Array(g);n(h,d,b,M,E,y,e);for(var $=0,V=0,w,I;$<_;++$)if(w=b[$]){for($>=V&&(V=$+1);!(I=M[V])&&++V<_;);w._next=I||null}}return o=new dt(o,r),o._enter=u,o._exit=f,o}function ts(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function es(){return new dt(this._exit||this._groups.map(On),this._parents)}function ns(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function rs(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),u=new Array(i),f=0;f<o;++f)for(var c=n[f],h=r[f],d=c.length,g=u[f]=new Array(d),y,_=0;_<d;++_)(y=c[_]||h[_])&&(g[_]=y);for(;f<i;++f)u[f]=n[f];return new dt(u,this._parents)}function is(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function ss(t){t||(t=os);function e(d,g){return d&&g?t(d.__data__,g.__data__):!d-!g}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],u=o.length,f=i[s]=new Array(u),c,h=0;h<u;++h)(c=o[h])&&(f[h]=c);f.sort(e)}return new dt(i,this._parents).order()}function os(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function as(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ls(){return Array.from(this)}function cs(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function us(){let t=0;for(const e of this)++t;return t}function fs(){return!this.node()}function hs(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,u;s<o;++s)(u=i[s])&&t.call(u,u.__data__,s,i);return this}function ds(t){return function(){this.removeAttribute(t)}}function vs(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ps(t,e){return function(){this.setAttribute(t,e)}}function gs(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ys(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function ms(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function xs(t,e){var n=Ce(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?vs:ds:typeof e=="function"?n.local?ms:ys:n.local?gs:ps)(n,e))}function Un(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function _s(t){return function(){this.style.removeProperty(t)}}function ws(t,e,n){return function(){this.style.setProperty(t,e,n)}}function bs(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ms(t,e,n){return arguments.length>1?this.each((e==null?_s:typeof e=="function"?bs:ws)(t,e,n??"")):Ft(this.node(),t)}function Ft(t,e){return t.style.getPropertyValue(e)||Un(t).getComputedStyle(t,null).getPropertyValue(e)}function ks(t){return function(){delete this[t]}}function Ss(t,e){return function(){this[t]=e}}function Cs(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Ps(t,e){return arguments.length>1?this.each((e==null?ks:typeof e=="function"?Cs:Ss)(t,e)):this.node()[t]}function Gn(t){return t.trim().split(/^|\s+/)}function Ue(t){return t.classList||new Kn(t)}function Kn(t){this._node=t,this._names=Gn(t.getAttribute("class")||"")}Kn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Zn(t,e){for(var n=Ue(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Jn(t,e){for(var n=Ue(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function $s(t){return function(){Zn(this,t)}}function As(t){return function(){Jn(this,t)}}function Es(t,e){return function(){(e.apply(this,arguments)?Zn:Jn)(this,t)}}function Ns(t,e){var n=Gn(t+"");if(arguments.length<2){for(var r=Ue(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Es:e?$s:As)(n,e))}function Ts(){this.textContent=""}function Rs(t){return function(){this.textContent=t}}function Is(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ds(t){return arguments.length?this.each(t==null?Ts:(typeof t=="function"?Is:Rs)(t)):this.node().textContent}function Fs(){this.innerHTML=""}function Ls(t){return function(){this.innerHTML=t}}function Xs(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Bs(t){return arguments.length?this.each(t==null?Fs:(typeof t=="function"?Xs:Ls)(t)):this.node().innerHTML}function Hs(){this.nextSibling&&this.parentNode.appendChild(this)}function Ys(){return this.each(Hs)}function Vs(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qs(){return this.each(Vs)}function zs(t){var e=typeof t=="function"?t:Vn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Ws(){return null}function Os(t,e){var n=typeof t=="function"?t:Vn(t),r=e==null?Ws:typeof e=="function"?e:Oe(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Us(){var t=this.parentNode;t&&t.removeChild(this)}function Gs(){return this.each(Us)}function Ks(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Zs(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Js(t){return this.select(t?Zs:Ks)}function Qs(t){return arguments.length?this.property("__data__",t):this.node().__data__}function js(t){return function(e){t.call(this,e,this.__data__)}}function to(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function eo(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function no(t,e,n){return function(){var r=this.__on,i,s=js(e);if(r){for(var o=0,u=r.length;o<u;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function ro(t,e,n){var r=to(t+""),i,s=r.length,o;if(arguments.length<2){var u=this.node().__on;if(u){for(var f=0,c=u.length,h;f<c;++f)for(i=0,h=u[f];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(u=e?no:eo,i=0;i<s;++i)this.each(u(r[i],e,n));return this}function Qn(t,e,n){var r=Un(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function io(t,e){return function(){return Qn(this,t,e)}}function so(t,e){return function(){return Qn(this,t,e.apply(this,arguments))}}function oo(t,e){return this.each((typeof e=="function"?so:io)(t,e))}function*ao(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var lo=[null];function dt(t,e){this._groups=t,this._parents=e}function Qt(){return new dt([[document.documentElement]],lo)}function co(){return this}dt.prototype=Qt.prototype={constructor:dt,select:Ii,selectAll:Xi,selectChild:Vi,selectChildren:Oi,filter:Ui,data:ji,enter:Gi,exit:es,join:ns,merge:rs,selection:co,order:is,sort:ss,call:as,nodes:ls,node:cs,size:us,empty:fs,each:hs,attr:xs,style:Ms,property:Ps,classed:Ns,text:Ds,html:Bs,raise:Ys,lower:qs,append:zs,insert:Os,remove:Gs,clone:Js,datum:Qs,on:ro,dispatch:oo,[Symbol.iterator]:ao};function Ge(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function jn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function jt(){}var Gt=.7,we=1/Gt,Dt="\\s*([+-]?\\d+)\\s*",Kt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",mt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",uo=/^#([0-9a-f]{3,8})$/,fo=new RegExp(`^rgb\\(${Dt},${Dt},${Dt}\\)$`),ho=new RegExp(`^rgb\\(${mt},${mt},${mt}\\)$`),vo=new RegExp(`^rgba\\(${Dt},${Dt},${Dt},${Kt}\\)$`),po=new RegExp(`^rgba\\(${mt},${mt},${mt},${Kt}\\)$`),go=new RegExp(`^hsl\\(${Kt},${mt},${mt}\\)$`),yo=new RegExp(`^hsla\\(${Kt},${mt},${mt},${Kt}\\)$`),kn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ge(jt,Zt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Sn,formatHex:Sn,formatHex8:mo,formatHsl:xo,formatRgb:Cn,toString:Cn});function Sn(){return this.rgb().formatHex()}function mo(){return this.rgb().formatHex8()}function xo(){return tr(this).formatHsl()}function Cn(){return this.rgb().formatRgb()}function Zt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=uo.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Pn(e):n===3?new ut(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ue(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ue(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=fo.exec(t))?new ut(e[1],e[2],e[3],1):(e=ho.exec(t))?new ut(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=vo.exec(t))?ue(e[1],e[2],e[3],e[4]):(e=po.exec(t))?ue(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=go.exec(t))?En(e[1],e[2]/100,e[3]/100,1):(e=yo.exec(t))?En(e[1],e[2]/100,e[3]/100,e[4]):kn.hasOwnProperty(t)?Pn(kn[t]):t==="transparent"?new ut(NaN,NaN,NaN,0):null}function Pn(t){return new ut(t>>16&255,t>>8&255,t&255,1)}function ue(t,e,n,r){return r<=0&&(t=e=n=NaN),new ut(t,e,n,r)}function _o(t){return t instanceof jt||(t=Zt(t)),t?(t=t.rgb(),new ut(t.r,t.g,t.b,t.opacity)):new ut}function Be(t,e,n,r){return arguments.length===1?_o(t):new ut(t,e,n,r??1)}function ut(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Ge(ut,Be,jn(jt,{brighter(t){return t=t==null?we:Math.pow(we,t),new ut(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Gt:Math.pow(Gt,t),new ut(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ut(Tt(this.r),Tt(this.g),Tt(this.b),be(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$n,formatHex:$n,formatHex8:wo,formatRgb:An,toString:An}));function $n(){return`#${Nt(this.r)}${Nt(this.g)}${Nt(this.b)}`}function wo(){return`#${Nt(this.r)}${Nt(this.g)}${Nt(this.b)}${Nt((isNaN(this.opacity)?1:this.opacity)*255)}`}function An(){const t=be(this.opacity);return`${t===1?"rgb(":"rgba("}${Tt(this.r)}, ${Tt(this.g)}, ${Tt(this.b)}${t===1?")":`, ${t})`}`}function be(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Tt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Nt(t){return t=Tt(t),(t<16?"0":"")+t.toString(16)}function En(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ht(t,e,n,r)}function tr(t){if(t instanceof ht)return new ht(t.h,t.s,t.l,t.opacity);if(t instanceof jt||(t=Zt(t)),!t)return new ht;if(t instanceof ht)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,u=s-i,f=(s+i)/2;return u?(e===s?o=(n-r)/u+(n<r)*6:n===s?o=(r-e)/u+2:o=(e-n)/u+4,u/=f<.5?s+i:2-s-i,o*=60):u=f>0&&f<1?0:o,new ht(o,u,f,t.opacity)}function bo(t,e,n,r){return arguments.length===1?tr(t):new ht(t,e,n,r??1)}function ht(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Ge(ht,bo,jn(jt,{brighter(t){return t=t==null?we:Math.pow(we,t),new ht(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Gt:Math.pow(Gt,t),new ht(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new ut(Ie(t>=240?t-240:t+120,i,r),Ie(t,i,r),Ie(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ht(Nn(this.h),fe(this.s),fe(this.l),be(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=be(this.opacity);return`${t===1?"hsl(":"hsla("}${Nn(this.h)}, ${fe(this.s)*100}%, ${fe(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Nn(t){return t=(t||0)%360,t<0?t+360:t}function fe(t){return Math.max(0,Math.min(1,t||0))}function Ie(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const er=t=>()=>t;function Mo(t,e){return function(n){return t+n*e}}function ko(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function So(t){return(t=+t)==1?nr:function(e,n){return n-e?ko(e,n,t):er(isNaN(e)?n:e)}}function nr(t,e){var n=e-t;return n?Mo(t,n):er(isNaN(t)?e:t)}const Tn=function t(e){var n=So(e);function r(i,s){var o=n((i=Be(i)).r,(s=Be(s)).r),u=n(i.g,s.g),f=n(i.b,s.b),c=nr(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=u(h),i.b=f(h),i.opacity=c(h),i+""}}return r.gamma=t,r}(1);function Pt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var He=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,De=new RegExp(He.source,"g");function Co(t){return function(){return t}}function Po(t){return function(e){return t(e)+""}}function $o(t,e){var n=He.lastIndex=De.lastIndex=0,r,i,s,o=-1,u=[],f=[];for(t=t+"",e=e+"";(r=He.exec(t))&&(i=De.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),u[o]?u[o]+=s:u[++o]=s),(r=r[0])===(i=i[0])?u[o]?u[o]+=i:u[++o]=i:(u[++o]=null,f.push({i:o,x:Pt(r,i)})),n=De.lastIndex;return n<e.length&&(s=e.slice(n),u[o]?u[o]+=s:u[++o]=s),u.length<2?f[0]?Po(f[0].x):Co(e):(e=f.length,function(c){for(var h=0,d;h<e;++h)u[(d=f[h]).i]=d.x(c);return u.join("")})}var Rn=180/Math.PI,Ye={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function rr(t,e,n,r,i,s){var o,u,f;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(f=t*n+e*r)&&(n-=t*f,r-=e*f),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,f/=u),t*r<e*n&&(t=-t,e=-e,f=-f,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*Rn,skewX:Math.atan(f)*Rn,scaleX:o,scaleY:u}}var he;function Ao(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ye:rr(e.a,e.b,e.c,e.d,e.e,e.f)}function Eo(t){return t==null||(he||(he=document.createElementNS("http://www.w3.org/2000/svg","g")),he.setAttribute("transform",t),!(t=he.transform.baseVal.consolidate()))?Ye:(t=t.matrix,rr(t.a,t.b,t.c,t.d,t.e,t.f))}function ir(t,e,n,r){function i(c){return c.length?c.pop()+" ":""}function s(c,h,d,g,y,_){if(c!==d||h!==g){var b=y.push("translate(",null,e,null,n);_.push({i:b-4,x:Pt(c,d)},{i:b-2,x:Pt(h,g)})}else(d||g)&&y.push("translate("+d+e+g+n)}function o(c,h,d,g){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),g.push({i:d.push(i(d)+"rotate(",null,r)-2,x:Pt(c,h)})):h&&d.push(i(d)+"rotate("+h+r)}function u(c,h,d,g){c!==h?g.push({i:d.push(i(d)+"skewX(",null,r)-2,x:Pt(c,h)}):h&&d.push(i(d)+"skewX("+h+r)}function f(c,h,d,g,y,_){if(c!==d||h!==g){var b=y.push(i(y)+"scale(",null,",",null,")");_.push({i:b-4,x:Pt(c,d)},{i:b-2,x:Pt(h,g)})}else(d!==1||g!==1)&&y.push(i(y)+"scale("+d+","+g+")")}return function(c,h){var d=[],g=[];return c=t(c),h=t(h),s(c.translateX,c.translateY,h.translateX,h.translateY,d,g),o(c.rotate,h.rotate,d,g),u(c.skewX,h.skewX,d,g),f(c.scaleX,c.scaleY,h.scaleX,h.scaleY,d,g),c=h=null,function(y){for(var _=-1,b=g.length,M;++_<b;)d[(M=g[_]).i]=M.x(y);return d.join("")}}}var No=ir(Ao,"px, ","px)","deg)"),To=ir(Eo,", ",")",")"),Lt=0,zt=0,Vt=0,sr=1e3,Me,Wt,ke=0,Rt=0,Pe=0,Jt=typeof performance=="object"&&performance.now?performance:Date,or=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Ke(){return Rt||(or(Ro),Rt=Jt.now()+Pe)}function Ro(){Rt=0}function Se(){this._call=this._time=this._next=null}Se.prototype=ar.prototype={constructor:Se,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Ke():+n)+(e==null?0:+e),!this._next&&Wt!==this&&(Wt?Wt._next=this:Me=this,Wt=this),this._call=t,this._time=n,Ve()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ve())}};function ar(t,e,n){var r=new Se;return r.restart(t,e,n),r}function Io(){Ke(),++Lt;for(var t=Me,e;t;)(e=Rt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Lt}function In(){Rt=(ke=Jt.now())+Pe,Lt=zt=0;try{Io()}finally{Lt=0,Fo(),Rt=0}}function Do(){var t=Jt.now(),e=t-ke;e>sr&&(Pe-=e,ke=t)}function Fo(){for(var t,e=Me,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Me=n);Wt=t,Ve(r)}function Ve(t){if(!Lt){zt&&(zt=clearTimeout(zt));var e=t-Rt;e>24?(t<1/0&&(zt=setTimeout(In,t-Jt.now()-Pe)),Vt&&(Vt=clearInterval(Vt))):(Vt||(ke=Jt.now(),Vt=setInterval(Do,sr)),Lt=1,or(In))}}function Dn(t,e,n){var r=new Se;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Lo=Yn("start","end","cancel","interrupt"),Xo=[],lr=0,Fn=1,qe=2,ve=3,Ln=4,ze=5,pe=6;function $e(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Bo(t,n,{name:e,index:r,group:i,on:Lo,tween:Xo,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:lr})}function Ze(t,e){var n=vt(t,e);if(n.state>lr)throw new Error("too late; already scheduled");return n}function xt(t,e){var n=vt(t,e);if(n.state>ve)throw new Error("too late; already running");return n}function vt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Bo(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=ar(s,0,n.time);function s(c){n.state=Fn,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var h,d,g,y;if(n.state!==Fn)return f();for(h in r)if(y=r[h],y.name===n.name){if(y.state===ve)return Dn(o);y.state===Ln?(y.state=pe,y.timer.stop(),y.on.call("interrupt",t,t.__data__,y.index,y.group),delete r[h]):+h<e&&(y.state=pe,y.timer.stop(),y.on.call("cancel",t,t.__data__,y.index,y.group),delete r[h])}if(Dn(function(){n.state===ve&&(n.state=Ln,n.timer.restart(u,n.delay,n.time),u(c))}),n.state=qe,n.on.call("start",t,t.__data__,n.index,n.group),n.state===qe){for(n.state=ve,i=new Array(g=n.tween.length),h=0,d=-1;h<g;++h)(y=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++d]=y);i.length=d+1}}function u(c){for(var h=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(f),n.state=ze,1),d=-1,g=i.length;++d<g;)i[d].call(t,h);n.state===ze&&(n.on.call("end",t,t.__data__,n.index,n.group),f())}function f(){n.state=pe,n.timer.stop(),delete r[e];for(var c in r)return;delete t.__transition}}function Ho(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>qe&&r.state<ze,r.state=pe,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function Yo(t){return this.each(function(){Ho(this,t)})}function Vo(t,e){var n,r;return function(){var i=xt(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,u=r.length;o<u;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function qo(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=xt(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var u={name:e,value:n},f=0,c=i.length;f<c;++f)if(i[f].name===e){i[f]=u;break}f===c&&i.push(u)}s.tween=i}}function zo(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=vt(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?Vo:qo)(n,t,e))}function Je(t,e,n){var r=t._id;return t.each(function(){var i=xt(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return vt(i,r).value[e]}}function cr(t,e){var n;return(typeof e=="number"?Pt:e instanceof Zt?Tn:(n=Zt(e))?(e=n,Tn):$o)(t,e)}function Wo(t){return function(){this.removeAttribute(t)}}function Oo(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Uo(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function Go(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function Ko(t,e,n){var r,i,s;return function(){var o,u=n(this),f;return u==null?void this.removeAttribute(t):(o=this.getAttribute(t),f=u+"",o===f?null:o===r&&f===i?s:(i=f,s=e(r=o,u)))}}function Zo(t,e,n){var r,i,s;return function(){var o,u=n(this),f;return u==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),f=u+"",o===f?null:o===r&&f===i?s:(i=f,s=e(r=o,u)))}}function Jo(t,e){var n=Ce(t),r=n==="transform"?To:cr;return this.attrTween(t,typeof e=="function"?(n.local?Zo:Ko)(n,r,Je(this,"attr."+t,e)):e==null?(n.local?Oo:Wo)(n):(n.local?Go:Uo)(n,r,e))}function Qo(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function jo(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ta(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&jo(t,s)),n}return i._value=e,i}function ea(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&Qo(t,s)),n}return i._value=e,i}function na(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ce(t);return this.tween(n,(r.local?ta:ea)(r,e))}function ra(t,e){return function(){Ze(this,t).delay=+e.apply(this,arguments)}}function ia(t,e){return e=+e,function(){Ze(this,t).delay=e}}function sa(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ra:ia)(e,t)):vt(this.node(),e).delay}function oa(t,e){return function(){xt(this,t).duration=+e.apply(this,arguments)}}function aa(t,e){return e=+e,function(){xt(this,t).duration=e}}function la(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?oa:aa)(e,t)):vt(this.node(),e).duration}function ca(t,e){if(typeof e!="function")throw new Error;return function(){xt(this,t).ease=e}}function ua(t){var e=this._id;return arguments.length?this.each(ca(e,t)):vt(this.node(),e).ease}function fa(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;xt(this,t).ease=n}}function ha(t){if(typeof t!="function")throw new Error;return this.each(fa(this._id,t))}function da(t){typeof t!="function"&&(t=zn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,u=r[i]=[],f,c=0;c<o;++c)(f=s[c])&&t.call(f,f.__data__,c,s)&&u.push(f);return new kt(r,this._parents,this._name,this._id)}function va(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),u=0;u<s;++u)for(var f=e[u],c=n[u],h=f.length,d=o[u]=new Array(h),g,y=0;y<h;++y)(g=f[y]||c[y])&&(d[y]=g);for(;u<r;++u)o[u]=e[u];return new kt(o,this._parents,this._name,this._id)}function pa(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function ga(t,e,n){var r,i,s=pa(e)?Ze:xt;return function(){var o=s(this,t),u=o.on;u!==r&&(i=(r=u).copy()).on(e,n),o.on=i}}function ya(t,e){var n=this._id;return arguments.length<2?vt(this.node(),n).on.on(t):this.each(ga(n,t,e))}function ma(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function xa(){return this.on("end.remove",ma(this._id))}function _a(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Oe(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var u=r[o],f=u.length,c=s[o]=new Array(f),h,d,g=0;g<f;++g)(h=u[g])&&(d=t.call(h,h.__data__,g,u))&&("__data__"in h&&(d.__data__=h.__data__),c[g]=d,$e(c[g],e,n,g,c,vt(h,n)));return new kt(s,this._parents,e,n)}function wa(t){var e=this._name,n=this._id;typeof t!="function"&&(t=qn(t));for(var r=this._groups,i=r.length,s=[],o=[],u=0;u<i;++u)for(var f=r[u],c=f.length,h,d=0;d<c;++d)if(h=f[d]){for(var g=t.call(h,h.__data__,d,f),y,_=vt(h,n),b=0,M=g.length;b<M;++b)(y=g[b])&&$e(y,e,n,b,g,_);s.push(g),o.push(h)}return new kt(s,o,e,n)}var ba=Qt.prototype.constructor;function Ma(){return new ba(this._groups,this._parents)}function ka(t,e){var n,r,i;return function(){var s=Ft(this,t),o=(this.style.removeProperty(t),Ft(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function ur(t){return function(){this.style.removeProperty(t)}}function Sa(t,e,n){var r,i=n+"",s;return function(){var o=Ft(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function Ca(t,e,n){var r,i,s;return function(){var o=Ft(this,t),u=n(this),f=u+"";return u==null&&(f=u=(this.style.removeProperty(t),Ft(this,t))),o===f?null:o===r&&f===i?s:(i=f,s=e(r=o,u))}}function Pa(t,e){var n,r,i,s="style."+e,o="end."+s,u;return function(){var f=xt(this,t),c=f.on,h=f.value[s]==null?u||(u=ur(e)):void 0;(c!==n||i!==h)&&(r=(n=c).copy()).on(o,i=h),f.on=r}}function $a(t,e,n){var r=(t+="")=="transform"?No:cr;return e==null?this.styleTween(t,ka(t,r)).on("end.style."+t,ur(t)):typeof e=="function"?this.styleTween(t,Ca(t,r,Je(this,"style."+t,e))).each(Pa(this._id,t)):this.styleTween(t,Sa(t,r,e),n).on("end.style."+t,null)}function Aa(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Ea(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Aa(t,o,n)),r}return s._value=e,s}function Na(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Ea(t,e,n??""))}function Ta(t){return function(){this.textContent=t}}function Ra(t){return function(){var e=t(this);this.textContent=e??""}}function Ia(t){return this.tween("text",typeof t=="function"?Ra(Je(this,"text",t)):Ta(t==null?"":t+""))}function Da(t){return function(e){this.textContent=t.call(this,e)}}function Fa(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Da(i)),e}return r._value=t,r}function La(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Fa(t))}function Xa(){for(var t=this._name,e=this._id,n=fr(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],u=o.length,f,c=0;c<u;++c)if(f=o[c]){var h=vt(f,e);$e(f,t,n,c,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new kt(r,this._parents,t,n)}function Ba(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var u={value:o},f={value:function(){--i===0&&s()}};n.each(function(){var c=xt(this,r),h=c.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(u),e._.interrupt.push(u),e._.end.push(f)),c.on=e}),i===0&&s()})}var Ha=0;function kt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function fr(){return++Ha}var bt=Qt.prototype;kt.prototype={constructor:kt,select:_a,selectAll:wa,selectChild:bt.selectChild,selectChildren:bt.selectChildren,filter:da,merge:va,selection:Ma,transition:Xa,call:bt.call,nodes:bt.nodes,node:bt.node,size:bt.size,empty:bt.empty,each:bt.each,on:ya,attr:Jo,attrTween:na,style:$a,styleTween:Na,text:Ia,textTween:La,remove:xa,tween:zo,delay:sa,duration:la,ease:ua,easeVarying:ha,end:Ba,[Symbol.iterator]:bt[Symbol.iterator]};function Ya(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Va={time:null,delay:0,duration:250,ease:Ya};function qa(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function za(t){var e,n;t instanceof kt?(e=t._id,t=t._name):(e=fr(),(n=Va).time=Ke(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],u=o.length,f,c=0;c<u;++c)(f=o[c])&&$e(f,t,e,c,o,n||qa(f,e));return new kt(r,this._parents,t,e)}Qt.prototype.interrupt=Yo;Qt.prototype.transition=za;var Wa=Array.prototype,Oa=Wa.slice;function Ua(t,e){return t-e}function Ga(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}const Xn=t=>()=>t;function Ka(t,e){for(var n=-1,r=e.length,i;++n<r;)if(i=Za(t,e[n]))return i;return 0}function Za(t,e){for(var n=e[0],r=e[1],i=-1,s=0,o=t.length,u=o-1;s<o;u=s++){var f=t[s],c=f[0],h=f[1],d=t[u],g=d[0],y=d[1];if(Ja(f,d,e))return 0;h>r!=y>r&&n<(g-c)*(r-h)/(y-h)+c&&(i=-i)}return i}function Ja(t,e,n){var r;return Qa(t,e,n)&&ja(t[r=+(t[0]===e[0])],n[r],e[r])}function Qa(t,e,n){return(e[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(e[1]-t[1])}function ja(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}function tl(){}var Mt=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function el(){var t=1,e=1,n=Ci,r=f;function i(c){var h=n(c);if(Array.isArray(h))h=h.slice().sort(Ua);else{const d=xi(c,nl);for(h=Mi(...Si(d[0],d[1],h),h);h[h.length-1]>=d[1];)h.pop();for(;h[1]<d[0];)h.shift()}return h.map(d=>s(c,d))}function s(c,h){const d=h==null?NaN:+h;if(isNaN(d))throw new Error(`invalid value: ${h}`);var g=[],y=[];return o(c,d,function(_){r(_,c,d),Ga(_)>0?g.push([_]):y.push(_)}),y.forEach(function(_){for(var b=0,M=g.length,E;b<M;++b)if(Ka((E=g[b])[0],_)!==-1){E.push(_);return}}),{type:"MultiPolygon",value:h,coordinates:g}}function o(c,h,d){var g=new Array,y=new Array,_,b,M,E,$,V;for(_=b=-1,E=Et(c[0],h),Mt[E<<1].forEach(w);++_<t-1;)M=E,E=Et(c[_+1],h),Mt[M|E<<1].forEach(w);for(Mt[E<<0].forEach(w);++b<e-1;){for(_=-1,E=Et(c[b*t+t],h),$=Et(c[b*t],h),Mt[E<<1|$<<2].forEach(w);++_<t-1;)M=E,E=Et(c[b*t+t+_+1],h),V=$,$=Et(c[b*t+_+1],h),Mt[M|E<<1|$<<2|V<<3].forEach(w);Mt[E|$<<3].forEach(w)}for(_=-1,$=c[b*t]>=h,Mt[$<<2].forEach(w);++_<t-1;)V=$,$=Et(c[b*t+_+1],h),Mt[$<<2|V<<3].forEach(w);Mt[$<<3].forEach(w);function w(I){var H=[I[0][0]+_,I[0][1]+b],S=[I[1][0]+_,I[1][1]+b],C=u(H),A=u(S),N,q;(N=y[C])?(q=g[A])?(delete y[N.end],delete g[q.start],N===q?(N.ring.push(S),d(N.ring)):g[N.start]=y[q.end]={start:N.start,end:q.end,ring:N.ring.concat(q.ring)}):(delete y[N.end],N.ring.push(S),y[N.end=A]=N):(N=g[A])?(q=y[C])?(delete g[N.start],delete y[q.end],N===q?(N.ring.push(S),d(N.ring)):g[q.start]=y[N.end]={start:q.start,end:N.end,ring:q.ring.concat(N.ring)}):(delete g[N.start],N.ring.unshift(H),g[N.start=C]=N):g[C]=y[A]={start:C,end:A,ring:[H,S]}}}function u(c){return c[0]*2+c[1]*(t+1)*4}function f(c,h,d){c.forEach(function(g){var y=g[0],_=g[1],b=y|0,M=_|0,E=Fe(h[M*t+b]);y>0&&y<t&&b===y&&(g[0]=Bn(y,Fe(h[M*t+b-1]),E,d)),_>0&&_<e&&M===_&&(g[1]=Bn(_,Fe(h[(M-1)*t+b]),E,d))})}return i.contour=s,i.size=function(c){if(!arguments.length)return[t,e];var h=Math.floor(c[0]),d=Math.floor(c[1]);if(!(h>=0&&d>=0))throw new Error("invalid size");return t=h,e=d,i},i.thresholds=function(c){return arguments.length?(n=typeof c=="function"?c:Array.isArray(c)?Xn(Oa.call(c)):Xn(c),i):n},i.smooth=function(c){return arguments.length?(r=c?f:tl,i):r===f},i}function nl(t){return isFinite(t)?t:NaN}function Et(t,e){return t==null?!1:+t>=e}function Fe(t){return t==null||isNaN(t=+t)?-1/0:t}function Bn(t,e,n,r){const i=r-e,s=n-e,o=isFinite(i)||isFinite(s)?i/s:Math.sign(i)/Math.sign(s);return isNaN(o)?t:t+o-.5}function Ot(t,e,n){this.k=t,this.x=e,this.y=n}Ot.prototype={constructor:Ot,scale:function(t){return t===1?this:new Ot(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Ot(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Ot.prototype;const rl={class:"mpi-pro-page"},il={class:"top-nav"},sl={class:"nav-left"},ol=["value"],al={key:0,class:"mini-stats"},ll={class:"mini-stat"},cl={class:"mini-stat danger"},ul={class:"nav-center"},fl={key:0,class:"control-panel-overlay"},hl={class:"control-panel"},dl={class:"control-section"},vl={class:"control-grid"},pl={class:"control-item"},gl={class:"range-wrapper"},yl={class:"range-value"},ml={class:"control-section"},xl={class:"layer-toggles"},_l={class:"layer-toggle"},wl={class:"layer-toggle"},bl={class:"layer-toggle"},Ml={class:"layer-toggle"},kl={class:"layer-toggle"},Sl={class:"control-section"},Cl={key:0,class:"loading-overlay"},Pl={class:"playback-bar"},$l={class:"playback-main"},Al={key:0,viewBox:"0 0 24 24",fill:"currentColor"},El={key:1,viewBox:"0 0 24 24",fill:"currentColor"},Nl={class:"progress-section"},Tl=["value"],Rl={class:"progress-info"},Il={class:"speed-control"},Dl=["onClick"],Fl={key:0,class:"mini-dashboard"},Ll={class:"dash-item"},Xl={class:"dash-value stress"},Bl={class:"dash-item"},Hl={class:"dash-value relief"},Yl={class:"dash-item"},Vl={class:"dash-value phase"},ql={class:"dash-item"},zl={class:"dash-value"},Wl={class:"tooltip-val"},Ol={class:"tooltip-xy"},Ul=50,Gl={__name:"MpiHeatmapPro",setup(t){const e=Z(!1),n=Z([]),r=Z(""),i=Z(50),s=Z({}),o=Z(null),u=Z([]),f=ge([]),c=Z(!1),h=Z(0),d=ni(o,{totalDistance:500,frameRate:60,progressPerSecond:10}),g=wn({maxParticles:150,emitRate:2}),y=wn({maxParticles:100,emitRate:1}),_=ri({maxRipples:8,rippleSpeed:60,rippleInterval:600}),b=Z(0),M=Le({workfaces:!0,contours:!1,contourLabels:!1,boreholes:!0,grid:!0,gradedBands:!0}),E=Z(null),$=Z(null),V=Z(null),w=Z(null),I=Z(null),H=Z(null),S=Z(!1),C=ge(null),A=Z(null),N=Z(null),q=Z({x:0,y:0}),L=Gr(),et=new Map,J=["#22c55e","#84cc16","#eab308","#f97316","#ef4444","#7c2d12"],P=Le({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),pt=G(()=>!!C.value),gt=G(()=>({left:`${q.value.x+15}px`,top:`${q.value.y+15}px`})),_t=["#4e79a7","#9bb7c7","#f6f0a4","#f4a261","#d62828"],yt=G(()=>{if(!s.value||!Number.isFinite(s.value.min)||!Number.isFinite(s.value.max))return[];const l=s.value.min,a=s.value.max;if(l===a)return[l];const p=(a-l)/5;return[l+p,l+p*2,l+p*3,l+p*4]}),Qe=()=>{c.value=!c.value},hr=()=>{C.value=null,f.value=[],A.value=null,s.value={},d.seek(0),r.value&&Ae()},dr=()=>{r.value&&Ae()},vr=G(()=>{const l=d.progress.value;return l<15?0:l<30?1:l<70?2:l<90?3:4}),pr=["初采","初压","推进","周压","收尾"],gr=G(()=>{const l=d.progress.value,a=40+l*.3,p=20*Math.sin(l/100*Math.PI*4);return Math.min(100,Math.max(0,a+p))}),yr=G(()=>{const l=d.progress.value;return Math.min(95,l*.8+10)}),mr=async()=>{try{const{data:l}=await Jr();n.value=l.seams||[],n.value.length&&(r.value=n.value[0].name,await Ae()),u.value.length===0&&A.value&&xr()}catch(l){console.error(l),L.add("加载煤层失败","error")}},xr=()=>{if(!A.value)return;const{min_x:l,max_x:a,min_y:p,max_y:m}=A.value,x=a-l,k=m-p,T={id:"demo-workface",name:"演示工作面",type:"polygon",bounds:{min_x:l+x*.1,max_x:l+x*.35,min_y:p+k*.3,max_y:p+k*.7},points:[[l+x*.1,p+k*.3],[l+x*.35,p+k*.3],[l+x*.35,p+k*.7],[l+x*.1,p+k*.7]]};u.value.push(T),o.value=T,L.add("已创建演示工作面","success")},_r=async l=>{if(!l)return null;if(et.has(l))return et.get(l);try{const{data:a}=await ei(l);return et.set(l,a),a}catch{return null}},wr=async l=>{const a=[];for(const p of l){const m=p.layers||[],x=m.find(Y=>Y.name===r.value),k=m.filter(Y=>Y.name!==r.value),T=[];for(const Y of k){const R=await _r(Y.name);T.push({thickness:Y.thickness||0,name:Y.name,density:R==null?void 0:R.density,elastic_modulus:R==null?void 0:R.elastic_modulus,compressive_strength:R==null?void 0:R.compressive_strength,tensile_strength:R==null?void 0:R.tensile_strength})}const W=p.seam_top_depth??p.total_overburden_thickness??0;a.push({x:p.x,y:p.y,borehole:p.name,thickness:(x==null?void 0:x.thickness)||0,burial_depth:W,strata:T})}return a},Ae=async()=>{var l;if(r.value){e.value=!0;try{const{data:a}=await jr(r.value);if(!((l=a.boreholes)!=null&&l.length))throw new Error("无钻孔数据");f.value=a.boreholes;const p=await wr(a.boreholes),m=await ti(p,i.value,"idw",null,null);C.value=m.data.grid,A.value=m.data.bounds,s.value=m.data.statistics,je(),requestAnimationFrame(te)}catch(a){console.error(a),L.add(a.message||"计算失败","error")}finally{e.value=!1}}},br=(l,a,p)=>{if(!Number.isFinite(l))return[0,0,0,0];const m=p-a||1,k=Math.max(0,Math.min(1,(l-a)/m))*(J.length-1),T=Math.floor(k),W=k-T,Y=B=>{const X=parseInt(B.slice(1),16);return[X>>16&255,X>>8&255,X&255]},R=Y(J[Math.min(T,J.length-1)]),O=Y(J[Math.min(T+1,J.length-1)]);return[Math.round(R[0]+(O[0]-R[0])*W),Math.round(R[1]+(O[1]-R[1])*W),Math.round(R[2]+(O[2]-R[2])*W),255]},Mr=(l,a,p)=>{if(!Number.isFinite(l)||a.length<4)return[0,0,0,0];let m=0;l<=a[0]?m=0:l<=a[1]?m=1:l<=a[2]?m=2:l<=a[3]?m=3:m=4;const x=p[Math.min(m,p.length-1)],k=parseInt(x.slice(1),16);return[k>>16&255,k>>8&255,k&255,255]},te=()=>{C.value&&(Ee($.value),Ee(V.value),Ee(w.value),kr(),Pr(),d.progress.value>0&&Ne(d.progress.value))},Ee=l=>{if(!l||!E.value)return;const a=E.value.getBoundingClientRect(),p=window.devicePixelRatio||1,m=Math.round(a.width),x=Math.round(a.height);l.style.width=`${m}px`,l.style.height=`${x}px`,l.width=Math.round(m*p),l.height=Math.round(x*p);const k=l.getContext("2d");k&&(k.setTransform(p,0,0,p,0,0),k.imageSmoothingEnabled=!1)},z=(l,a)=>{if(!A.value)return{x:0,y:0};const{min_x:p,max_y:m}=A.value,x=1,k=(l-p)*x,T=(m-a)*x;return{x:k*P.scale+P.x,y:T*P.scale+P.y}},ee=(l,a)=>{if(!A.value)return{x:0,y:0};const{min_x:p,max_y:m}=A.value,x=(l-P.x)/P.scale,k=(a-P.y)/P.scale;return{x:p+x,y:m-k}},kr=()=>{var j;const l=(j=$.value)==null?void 0:j.getContext("2d");if(!l||!C.value)return;const a=`${P.scale.toFixed(2)}-${P.x.toFixed(0)}-${P.y.toFixed(0)}`;if(S.value&&H.value&&H.value.key===a){l.clearRect(0,0,$.value.width,$.value.height),l.drawImage(H.value,0,0);return}l.clearRect(0,0,$.value.width,$.value.height);const p=C.value,m=p.length,x=p[0].length,{min_x:k,max_x:T,min_y:W,max_y:Y}=A.value,R=(T-k)/x,O=(Y-W)/m,B=s.value.min||0,X=s.value.max||100,Q=yt.value;for(let nt=0;nt<m;nt++)for(let ot=0;ot<x;ot++){const ft=p[nt][ot];if(ft===null)continue;const tt=k+ot*R,rt=Y-nt*O,D=z(tt,rt),F=z(tt+R,rt-O),it=F.x-D.x,U=F.y-D.y;if(D.x>$.value.width||F.x<0||D.y>$.value.height||F.y<0)continue;const Bt=M.gradedBands?Mr(ft,Q,_t):br(ft,B,X);l.fillStyle=`rgb(${Bt[0]},${Bt[1]},${Bt[2]})`,l.fillRect(Math.floor(D.x),Math.floor(D.y),Math.ceil(it)+1,Math.ceil(U)+1)}const K=document.createElement("canvas");K.width=$.value.width,K.height=$.value.height,K.key=a,K.getContext("2d").drawImage($.value,0,0),H.value=Kr(K),S.value=!0},Sr=l=>{if(!C.value||!A.value||!s.value)return;const a=C.value,p=a.length,m=a[0].length,x=new Float64Array(p*m);for(let j=0;j<p;j++)for(let nt=0;nt<m;nt++)x[j*m+nt]=a[j][nt]??-9999;const k=s.value.min||0,T=s.value.max||100,W=yt.value.length===4?yt.value:Pi(k,T,(T-k)/5),Y=el().size([m,p]).thresholds(W)(x);l.save(),l.lineWidth=2,l.strokeStyle="rgba(255, 255, 255, 0.75)";const{min_x:R,max_x:O,min_y:B,max_y:X}=A.value,Q=(O-R)/m,K=(X-B)/p;Y.forEach(j=>{l.beginPath(),j.coordinates.forEach(nt=>{nt.forEach(ot=>{ot.forEach((ft,tt)=>{const rt=ft[0],D=ft[1],F=R+rt*Q,it=X-D*K,U=z(F,it);tt===0?l.moveTo(U.x,U.y):l.lineTo(U.x,U.y)}),l.closePath()})}),l.stroke()}),M.contourLabels&&(l.fillStyle="rgba(255,255,255,0.8)",l.font="12px JetBrains Mono, monospace",l.textAlign="center",l.textBaseline="middle",Y.forEach((j,nt)=>{if(nt%2!==0)return;const ot=j.coordinates[0];if(!ot||!ot[0]||!ot[0][0])return;const ft=ot[0][Math.floor(ot[0].length/2)];if(!ft)return;const tt=R+ft[0]*Q,rt=X-ft[1]*K,D=z(tt,rt);l.fillText(j.value.toFixed(1),D.x,D.y)})),l.restore()},Cr=l=>{var a;if((a=f.value)!=null&&a.length){l.save(),l.font="11px JetBrains Mono, monospace",l.textAlign="center",l.textBaseline="middle";for(const p of f.value){const m=z(p.x,p.y),x=50;m.x<-x||m.x>w.value.width+x||m.y<-x||m.y>w.value.height+x||(l.beginPath(),l.arc(m.x,m.y,6,0,Math.PI*2),l.fillStyle="rgba(239, 68, 68, 0.9)",l.fill(),l.strokeStyle="#fff",l.lineWidth=2,l.stroke(),l.beginPath(),l.moveTo(m.x-3,m.y),l.lineTo(m.x+3,m.y),l.moveTo(m.x,m.y-3),l.lineTo(m.x,m.y+3),l.strokeStyle="#fff",l.lineWidth=1.5,l.stroke(),l.fillStyle="rgba(30, 41, 59, 0.85)",l.fillRect(m.x-25,m.y+10,50,16),l.strokeStyle="rgba(148, 163, 184, 0.5)",l.lineWidth=1,l.strokeRect(m.x-25,m.y+10,50,16),l.fillStyle="#fff",l.fillText(p.name||"",m.x,m.y+18))}l.restore()}},Pr=()=>{var a;const l=(a=w.value)==null?void 0:a.getContext("2d");l&&(l.clearRect(0,0,w.value.width,w.value.height),M.grid&&$r(l),M.contours&&Sr(l),M.boreholes&&Cr(l),M.workfaces&&u.value.forEach(p=>{if(l.beginPath(),p.type==="polygon"&&p.points)p.points.forEach((m,x)=>{const k=z(m[0],m[1]);x===0?l.moveTo(k.x,k.y):l.lineTo(k.x,k.y)});else if(p.bounds){const m=z(p.bounds.min_x,p.bounds.max_y),x=z(p.bounds.max_x,p.bounds.max_y),k=z(p.bounds.max_x,p.bounds.min_y),T=z(p.bounds.min_x,p.bounds.min_y);l.moveTo(m.x,m.y),l.lineTo(x.x,x.y),l.lineTo(k.x,k.y),l.lineTo(T.x,T.y)}l.closePath(),l.strokeStyle=p===o.value?"#facc15":"#fff",l.lineWidth=p===o.value?3:2,l.stroke(),p===o.value&&(l.fillStyle="rgba(250, 204, 21, 0.1)",l.fill())}))},$r=l=>{if(!A.value||!E.value)return;const a=E.value.getBoundingClientRect(),p=a.width,m=a.height,k=Math.max(20,Math.round(100/P.scale/10)*10);l.save(),l.strokeStyle="rgba(148, 163, 184, 0.15)",l.lineWidth=1;const T=ee(0,0),W=ee(p,m),Y=Math.floor(Math.min(T.x,W.x)/k)*k,R=Math.ceil(Math.max(T.x,W.x)/k)*k,O=Math.floor(Math.min(T.y,W.y)/k)*k,B=Math.ceil(Math.max(T.y,W.y)/k)*k;for(let X=Y;X<=R;X+=k){const Q=z(X,O),K=z(X,B);l.beginPath(),l.moveTo(Q.x,Q.y),l.lineTo(K.x,K.y),l.stroke()}for(let X=O;X<=B;X+=k){const Q=z(Y,X),K=z(R,X);l.beginPath(),l.moveTo(Q.x,Q.y),l.lineTo(K.x,K.y),l.stroke()}l.restore()},Ne=l=>{var yn;const a=(yn=V.value)==null?void 0:yn.getContext("2d");if(!a||!o.value)return;a.clearRect(0,0,V.value.width,V.value.height);let p=o.value.bounds;if(!p&&o.value.points){const wt=o.value.points.map(Ct=>Ct[0]),$t=o.value.points.map(Ct=>Ct[1]);p={min_x:Math.min(...wt),max_x:Math.max(...wt),min_y:Math.min(...$t),max_y:Math.max(...$t)}}if(!p)return;const m=(h.value-90)*Math.PI/180,x=p.max_y-p.min_y,k=p.max_x-p.min_x,T=(p.min_x+p.max_x)/2,W=(p.min_y+p.max_y)/2,Y=k*(l/100),R=T+Math.cos(m)*Y,O=W+Math.sin(m)*Y,B=m+Math.PI/2,X=x/2,Q={x:R-Math.cos(B)*X,y:O-Math.sin(B)*X},K={x:R+Math.cos(B)*X,y:O+Math.sin(B)*X},j=T-Math.cos(m)*(T-p.min_x),nt=W-Math.sin(m)*(T-p.min_x),ot={x:j-Math.cos(B)*X,y:nt-Math.sin(B)*X},ft={x:j+Math.cos(B)*X,y:nt+Math.sin(B)*X},tt=z(ot.x,ot.y),rt=z(ft.x,ft.y),D=z(Q.x,Q.y),F=z(K.x,K.y),it=z(R,O);a.save();const U=a.createLinearGradient((tt.x+rt.x)/2,(tt.y+rt.y)/2,(D.x+F.x)/2,(D.y+F.y)/2);l<20?(U.addColorStop(0,"rgba(35, 35, 35, 0.9)"),U.addColorStop(1,"rgba(40, 40, 40, 0.85)")):l<40?(U.addColorStop(0,"rgba(40, 40, 40, 0.85)"),U.addColorStop(.5,"rgba(38, 38, 38, 0.82)"),U.addColorStop(1,"rgba(42, 42, 42, 0.8)")):l<60?(U.addColorStop(0,"rgba(45, 45, 45, 0.8)"),U.addColorStop(.5,"rgba(40, 40, 40, 0.78)"),U.addColorStop(1,"rgba(43, 43, 43, 0.75)")):l<80?(U.addColorStop(0,"rgba(48, 48, 48, 0.75)"),U.addColorStop(.5,"rgba(42, 42, 42, 0.73)"),U.addColorStop(1,"rgba(45, 45, 45, 0.7)")):(U.addColorStop(0,"rgba(50, 50, 50, 0.72)"),U.addColorStop(.5,"rgba(44, 44, 44, 0.7)"),U.addColorStop(1,"rgba(47, 47, 47, 0.68)")),a.fillStyle=U,a.beginPath(),a.moveTo(tt.x,tt.y),a.lineTo(rt.x,rt.y),a.lineTo(F.x,F.y),a.lineTo(D.x,D.y),a.closePath(),a.fill(),a.strokeStyle="rgba(255, 255, 255, 0.03)",a.lineWidth=1;const Bt=20,en=Math.hypot(F.x-rt.x,F.y-rt.y);Math.hypot(F.x-D.x,F.y-D.y);for(let wt=0;wt<en;wt+=Bt){const $t=wt/en,Ct=tt.x+(D.x-tt.x)*$t,mn=tt.y+(D.y-tt.y)*$t;a.beginPath(),a.moveTo(Ct,mn),a.lineTo(Ct+F.x-D.x,mn+F.y-D.y),a.stroke()}const nn=k*.12,rn=R+Math.cos(m)*nn,sn=O+Math.sin(m)*nn,ne=x*.58,on={x:rn-Math.cos(B)*ne,y:sn-Math.sin(B)*ne},an={x:rn+Math.cos(B)*ne,y:sn+Math.sin(B)*ne},re=z(on.x,on.y),St=z(an.x,an.y),Br=Date.now()/800%2,Hr=Date.now()/1200%2,ln=.5+.2*Math.sin(Br*Math.PI),cn=.4+.15*Math.sin(Hr*Math.PI),ie=a.createRadialGradient(it.x,it.y,0,it.x,it.y,Math.hypot(St.x-it.x,St.y-it.y)*1.5);ie.addColorStop(0,`rgba(239, 68, 68, ${ln*.3})`),ie.addColorStop(.5,`rgba(239, 68, 68, ${ln*.15})`),ie.addColorStop(1,"rgba(239, 68, 68, 0)"),a.fillStyle=ie,a.beginPath(),a.arc(it.x,it.y,Math.hypot(St.x-it.x,St.y-it.y)*1.5,0,Math.PI*2),a.fill();const se=a.createLinearGradient((D.x+F.x)/2,(D.y+F.y)/2,(re.x+St.x)/2,(re.y+St.y)/2);se.addColorStop(0,`rgba(220, 38, 38, ${cn*.7})`),se.addColorStop(.5,`rgba(239, 68, 68, ${cn*.4})`),se.addColorStop(1,"rgba(239, 68, 68, 0)"),a.fillStyle=se,a.beginPath(),a.moveTo(D.x,D.y),a.lineTo(F.x,F.y),a.lineTo(St.x,St.y),a.lineTo(re.x,re.y),a.closePath(),a.fill();const un=k*.1,fn=R-Math.cos(m)*un,hn=O-Math.sin(m)*un,oe=x*.52,dn={x:fn-Math.cos(B)*oe,y:hn-Math.sin(B)*oe},vn={x:fn+Math.cos(B)*oe,y:hn+Math.sin(B)*oe},ae=z(dn.x,dn.y),le=z(vn.x,vn.y),Yr=Date.now()/2e3%2,pn=.4+.1*Math.sin(Yr*Math.PI),ce=a.createLinearGradient((ae.x+le.x)/2,(ae.y+le.y)/2,(D.x+F.x)/2,(D.y+F.y)/2);if(ce.addColorStop(0,`rgba(59, 130, 246, ${pn*.5})`),ce.addColorStop(.7,`rgba(96, 165, 250, ${pn*.3})`),ce.addColorStop(1,"rgba(59, 130, 246, 0)"),a.fillStyle=ce,a.beginPath(),a.moveTo(ae.x,ae.y),a.lineTo(le.x,le.y),a.lineTo(D.x,D.y),a.lineTo(F.x,F.y),a.closePath(),a.fill(),(d.isPlaying.value||l>0)&&(_.update(.016),_.draw(a),d.isPlaying.value&&Math.random()<.02&&_.emit(it.x,it.y)),d.isPlaying.value&&l>0){const wt=Date.now();if(wt-b.value>Ul){const $t={x:Math.cos(m),y:Math.sin(m)};g.emitStressParticles([D,F],$t,2);const Ct={minX:Math.min(tt.x,rt.x,D.x,F.x),maxX:Math.max(tt.x,rt.x,D.x,F.x),minY:Math.min(tt.y,rt.y,D.y,F.y),maxY:Math.max(tt.y,rt.y,D.y,F.y)};y.emitReliefParticles(Ct,.5),b.value=wt}g.update(.016),g.draw(a),y.update(.016),y.draw(a)}else l>0&&(g.update(.016),y.update(.016),g.draw(a),y.draw(a));a.strokeStyle="#facc15",a.lineWidth=3,a.lineCap="round",a.beginPath(),a.moveTo(D.x,D.y),a.lineTo(F.x,F.y),a.stroke(),a.strokeStyle="rgba(250, 204, 21, 0.4)",a.lineWidth=6,a.beginPath(),a.moveTo(D.x,D.y),a.lineTo(F.x,F.y),a.stroke(),a.restore(),a.save();const Vr=(j+R)/2,qr=(nt+O)/2,gn=z(Vr,qr);a.translate(gn.x,gn.y),a.rotate(h.value*Math.PI/180),a.fillStyle="rgba(255, 255, 255, 0.8)",a.beginPath(),a.moveTo(-10,0),a.lineTo(6,-6),a.lineTo(6,6),a.closePath(),a.fill(),a.shadowColor="rgba(255, 255, 255, 0.5)",a.shadowBlur=8,a.fill(),a.restore()},je=()=>{if(!A.value||!E.value)return;const{min_x:l,max_x:a,min_y:p,max_y:m}=A.value,x=a-l,k=m-p,T=E.value.getBoundingClientRect(),W=T.width,Y=T.height,R=W/x,O=Y/k,B=Math.min(R,O)*.9;P.scale=B;const X=(l+a)/2,Q=(p+m)/2;P.x=W/2-(X-l)*B,P.y=Y/2-(m-Q)*B,Xt()},Ar=l=>{E.value&&(P.isDragging=!0,P.lastX=l.clientX,P.lastY=l.clientY,P.startX=l.clientX,P.startY=l.clientY)},Er=l=>{if(!E.value)return;const a=E.value.getBoundingClientRect(),p=l.clientX-a.left,m=l.clientY-a.top;q.value={x:p,y:m};const x=ee(p,m);if(C.value&&A.value){const{min_x:W,max_x:Y,min_y:R,max_y:O}=A.value,B=C.value.length,X=C.value[0].length,Q=Math.floor((x.x-W)/((Y-W)/X)),K=Math.floor((O-x.y)/((O-R)/B));if(K>=0&&K<B&&Q>=0&&Q<X){const j=C.value[K][Q];j!==null?N.value={x:x.x,y:x.y,value:j}:N.value=null}else N.value=null}if(!P.isDragging)return;const k=l.clientX-P.lastX,T=l.clientY-P.lastY;P.x+=k,P.y+=T,P.lastX=l.clientX,P.lastY=l.clientY,Xt()},Nr=l=>{const a=Math.hypot(l.clientX-P.startX,l.clientY-P.startY);P.isDragging&&a<5&&Tr(l),P.isDragging=!1},Tr=l=>{if(!E.value)return;const a=E.value.getBoundingClientRect(),p=l.clientX-a.left,m=l.clientY-a.top,x=ee(p,m),k=u.value.find(T=>T.bounds?x.x>=T.bounds.min_x&&x.x<=T.bounds.max_x&&x.y>=T.bounds.min_y&&x.y<=T.bounds.max_y:!1);k&&(o.value=k,te())},Rr=l=>{l.preventDefault();const p=-l.deltaY*.001,m=P.scale*(1+p);P.scale=Math.max(.1,Math.min(50,m)),Xt()},It=Z(null);let Te=!1;const Xt=()=>{Te||(Te=!0,requestAnimationFrame(()=>{te(),Te=!1}))};Re(()=>d.progress.value,l=>{Ne(l)}),Re(()=>d.isPlaying.value,l=>{l&&Ir()}),Re(()=>[P.scale,P.x,P.y],()=>{S.value=!1},{flush:"sync"});const Ir=()=>{It.value&&cancelAnimationFrame(It.value);const l=()=>{d.isPlaying.value&&d.progress.value<100?(Ne(d.progress.value),It.value=requestAnimationFrame(l)):d.progress.value>=100&&(d.isPlaying.value=!1)};It.value=requestAnimationFrame(l)},tn=l=>{if(!(l.target.tagName==="INPUT"||l.target.tagName==="TEXTAREA"||l.target.tagName==="SELECT"))switch(l.code){case"Space":l.preventDefault(),d.togglePlay();break;case"ArrowLeft":l.preventDefault(),l.shiftKey?d.skipToStart():d.stepBackward();break;case"ArrowRight":l.preventDefault(),l.shiftKey?d.skipToEnd():d.stepForward();break;case"ArrowUp":l.preventDefault(),d.setPlaybackSpeed(Math.min(5,d.playbackSpeed.value+.5));break;case"ArrowDown":l.preventDefault(),d.setPlaybackSpeed(Math.max(.5,d.playbackSpeed.value-.5));break;case"KeyR":l.preventDefault(),d.seek(0),g.clear(),y.clear(),_.clear();break;case"Digit1":l.preventDefault(),d.setPlaybackSpeed(1);break;case"Digit2":l.preventDefault(),d.setPlaybackSpeed(2);break;case"Digit5":l.preventDefault(),d.setPlaybackSpeed(5);break}};We(()=>{It.value&&cancelAnimationFrame(It.value),d.pause(),g.clear(),y.clear(),_.clear(),g.stopAnimation(),y.stopAnimation(),window.removeEventListener("keydown",tn)}),zr(()=>{mr();const l=E.value;l.addEventListener("mousedown",Ar),window.addEventListener("mousemove",Er),window.addEventListener("mouseup",Nr),l.addEventListener("wheel",Rr,{passive:!1}),window.addEventListener("keydown",tn)});const Dr=()=>{var l;return(l=I.value)==null?void 0:l.click()},Fr=async l=>{const a=l.target.files[0];if(!a)return;const{data:p}=await Qr(a);u.value=[...u.value,...p.workfaces],p.workfaces.length&&(o.value=p.workfaces[0],d.seek(0),g.clear(),y.clear(),_.clear()),te()},Lr=()=>{P.scale=Math.min(50,P.scale*1.15),Xt()},Xr=()=>{P.scale=Math.max(.1,P.scale/1.15),Xt()};return(l,a)=>{var p,m;return lt(),ct("div",rl,[v("nav",il,[v("div",sl,[v("button",{class:"back-btn-mini",onClick:a[0]||(a[0]=x=>l.$router.back()),title:"返回"},[...a[13]||(a[13]=[v("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[v("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)])]),a[16]||(a[16]=v("span",{class:"nav-title"},"MPI 数值模拟",-1)),a[17]||(a[17]=v("div",{class:"nav-separator"},null,-1)),At(v("select",{"onUpdate:modelValue":a[1]||(a[1]=x=>r.value=x),onChange:hr,class:"nav-select"},[(lt(!0),ct(ye,null,me(n.value,x=>(lt(),ct("option",{key:x.name,value:x.name},st(x.name),9,ol))),128))],544),[[Wr,r.value]]),pt.value?(lt(),ct("div",al,[v("span",ll,[a[14]||(a[14]=xn("均值: ",-1)),v("b",null,st((p=s.value.mean)==null?void 0:p.toFixed(1)),1)]),v("span",cl,[a[15]||(a[15]=xn("风险: ",-1)),v("b",null,st((m=s.value.min)==null?void 0:m.toFixed(1)),1)])])):Ht("",!0)]),v("div",ul,[v("button",{class:Ut(["nav-tool",{active:c.value}]),onClick:Qe,title:"控制面板"},[...a[18]||(a[18]=[v("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[v("circle",{cx:"12",cy:"12",r:"3"}),v("path",{d:"M12 1v6m0 6v6m4.24-13.24l-4.24 4.24m0 5.66l4.24 4.24M1 12h6m6 0h6m13.24 4.24l-4.24-4.24m-5.66 0l-4.24-4.24"})],-1)])],2)]),v("div",{class:"nav-right"},[v("button",{class:"nav-btn",onClick:Dr,title:"导入工作面"},[...a[19]||(a[19]=[v("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[v("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"})],-1)])]),v("button",{class:"nav-btn",onClick:je,title:"适配视图"},[...a[20]||(a[20]=[v("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[v("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"})],-1)])]),v("button",{class:"nav-btn",onClick:Lr,title:"放大"},[...a[21]||(a[21]=[v("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[v("circle",{cx:"11",cy:"11",r:"8"}),v("path",{d:"M21 21l-4.35-4.35M11 8v6M8 11h6"})],-1)])]),v("button",{class:"nav-btn",onClick:Xr,title:"缩小"},[...a[22]||(a[22]=[v("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[v("circle",{cx:"11",cy:"11",r:"8"}),v("path",{d:"M21 21l-4.35-4.35M8 11h6"})],-1)])])]),v("input",{ref_key:"fileInput",ref:I,type:"file",style:{display:"none"},onChange:Fr,accept:".csv,.json,.txt"},null,544)]),_n(Ur,{name:"panel-slide"},{default:Or(()=>[c.value?(lt(),ct("div",fl,[v("div",hl,[v("div",dl,[a[24]||(a[24]=v("h4",null,"视图设置",-1)),v("div",vl,[v("div",pl,[a[23]||(a[23]=v("label",null,"网格精度 (越小越精细)",-1)),v("div",gl,[At(v("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=x=>i.value=x),min:"20",max:"100",step:"5",onChange:dr,class:"range-input"},null,544),[[Zr,i.value,void 0,{number:!0}]]),v("span",yl,st(i.value)+"m",1)])])])]),v("div",ml,[a[30]||(a[30]=v("h4",null,"图层",-1)),v("div",xl,[v("label",_l,[At(v("input",{type:"checkbox","onUpdate:modelValue":a[3]||(a[3]=x=>M.workfaces=x)},null,512),[[Yt,M.workfaces]]),a[25]||(a[25]=v("span",null,"工作面",-1))]),v("label",wl,[At(v("input",{type:"checkbox","onUpdate:modelValue":a[4]||(a[4]=x=>M.contours=x)},null,512),[[Yt,M.contours]]),a[26]||(a[26]=v("span",null,"等值线",-1))]),v("label",bl,[At(v("input",{type:"checkbox","onUpdate:modelValue":a[5]||(a[5]=x=>M.grid=x)},null,512),[[Yt,M.grid]]),a[27]||(a[27]=v("span",null,"网格",-1))]),v("label",Ml,[At(v("input",{type:"checkbox","onUpdate:modelValue":a[6]||(a[6]=x=>M.boreholes=x)},null,512),[[Yt,M.boreholes]]),a[28]||(a[28]=v("span",null,"钻孔",-1))]),v("label",kl,[At(v("input",{type:"checkbox","onUpdate:modelValue":a[7]||(a[7]=x=>M.gradedBands=x)},null,512),[[Yt,M.gradedBands]]),a[29]||(a[29]=v("span",null,"分级带",-1))])])]),v("div",Sl,[a[31]||(a[31]=v("h4",null,"推进方向",-1)),_n(yi,{direction:h.value,"onUpdate:direction":[a[8]||(a[8]=x=>h.value=x),at(d).setDirection]},null,8,["direction","onUpdate:direction"])]),a[33]||(a[33]=v("div",{class:"control-section"},[v("h4",null,"图例"),v("div",{class:"mini-legend"},[v("div",{class:"legend-gradient"}),v("div",{class:"legend-labels"},[v("span",null,"低风险"),v("span",null,"高风险")])])],-1)),v("button",{class:"panel-close",onClick:Qe},[...a[32]||(a[32]=[v("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[v("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])])])):Ht("",!0)]),_:1}),v("div",{ref_key:"stageContainer",ref:E,class:"stage-container"},[e.value?(lt(),ct("div",Cl,[...a[34]||(a[34]=[v("div",{class:"loading-spinner"},null,-1),v("div",{class:"loading-text"},"全域数据计算中...",-1)])])):Ht("",!0),v("canvas",{ref_key:"bgCanvas",ref:$,class:"layer-canvas layer-bg"},null,512),v("canvas",{ref_key:"dynamicCanvas",ref:V,class:"layer-canvas layer-dynamic"},null,512),v("canvas",{ref_key:"overlayCanvas",ref:w,class:"layer-canvas layer-overlay"},null,512)],512),v("div",Pl,[v("div",$l,[v("button",{class:Ut(["play-btn-mini",{playing:at(d).isPlaying.value}]),onClick:a[9]||(a[9]=(...x)=>at(d).togglePlay&&at(d).togglePlay(...x)),title:"播放/暂停"},[at(d).isPlaying.value?(lt(),ct("svg",El,[...a[36]||(a[36]=[v("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])])):(lt(),ct("svg",Al,[...a[35]||(a[35]=[v("path",{d:"M8 5v14l11-7z"},null,-1)])]))],2),v("div",Nl,[v("input",{type:"range",value:at(d).progress.value,onInput:a[10]||(a[10]=x=>at(d).seek(Number(x.target.value))),min:"0",max:"100",step:"0.1",class:"progress-slider"},null,40,Tl),v("div",Rl,[v("span",null,st(Math.round(at(d).progress.value))+"%",1),v("span",null,st((at(d).progress.value/100*500).toFixed(0))+"m",1)])]),v("div",Il,[(lt(),ct(ye,null,me([.5,1,2,5],x=>v("button",{key:x,class:Ut(["speed-btn",{active:at(d).playbackSpeed.value===x}]),onClick:k=>at(d).setPlaybackSpeed(x)},st(x)+"x",11,Dl)),64))]),v("button",{class:"step-btn",onClick:a[11]||(a[11]=(...x)=>at(d).stepBackward&&at(d).stepBackward(...x)),title:"后退"},[...a[37]||(a[37]=[v("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[v("path",{d:"M6 6h2v12H6zm3.5 6l8.5-6V12z"})],-1)])]),v("button",{class:"step-btn",onClick:a[12]||(a[12]=(...x)=>at(d).stepForward&&at(d).stepForward(...x)),title:"前进"},[...a[38]||(a[38]=[v("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[v("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})],-1)])])]),o.value?(lt(),ct("div",Fl,[v("div",Ll,[a[39]||(a[39]=v("span",{class:"dash-label"},"应力",-1)),v("span",Xl,st(gr.value.toFixed(0))+"%",1)]),v("div",Bl,[a[40]||(a[40]=v("span",{class:"dash-label"},"卸压",-1)),v("span",Hl,st(yr.value.toFixed(0))+"%",1)]),v("div",Yl,[a[41]||(a[41]=v("span",{class:"dash-label"},"阶段",-1)),v("span",Vl,st(pr[vr.value]),1)]),v("div",ql,[a[42]||(a[42]=v("span",{class:"dash-label"},"方向",-1)),v("span",zl,st(h.value)+"°",1)])])):Ht("",!0)]),a[43]||(a[43]=v("div",{class:"floating-hint"}," 拖拽移动 · 滚轮缩放 · 空格播放 · R 重置 ",-1)),N.value?(lt(),ct("div",{key:0,class:"hover-tooltip",style:qt(gt.value)},[v("div",Wl,st(N.value.value.toFixed(2)),1),v("div",Ol,"X: "+st(N.value.x.toFixed(0))+" Y: "+st(N.value.y.toFixed(0)),1)],4)):Ht("",!0)])}}},Jl=Hn(Gl,[["__scopeId","data-v-12c62df9"]]);export{Jl as default};
