var Yt=Object.defineProperty,Xt=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var ut=Object.getOwnPropertySymbols;var Jt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var Ue=Math.pow,ct=(u,b,f)=>b in u?Yt(u,b,{enumerable:!0,configurable:!0,writable:!0,value:f}):u[b]=f,j=(u,b)=>{for(var f in b||(b={}))Jt.call(b,f)&&ct(u,f,b[f]);if(ut)for(var f of ut(b))Zt.call(b,f)&&ct(u,f,b[f]);return u},H=(u,b)=>Xt(u,qt(b));var ve=(u,b,f)=>new Promise((x,W)=>{var T=N=>{try{U(f.next(N))}catch(a){W(a)}},P=N=>{try{U(f.throw(N))}catch(a){W(a)}},U=N=>N.done?x(N.value):Promise.resolve(N.value).then(T,P);U((f=f.apply(u,b)).next())});import{M as Le,e as gt,G as yt,v as _e,J as ht,o as Q,b as ee,z as Pe,d as Y,k as X,a as t,i as re,O as Kt,C as he,I as mt,F as Ie,r as Ge,A as ke,t as h,y as ye,n as Te,D as Fe,E as Qt,x as en,w as dt,L as vt,u as tn,N as nn}from"./vue-vendor-uHJg9g_5.js";import{J as ln}from"./jszip.min-eC0OUXGO.js";import{g as an,v as sn,n as on}from"./api-BlLoGSss.js";import{a as rn,t as un,C as cn}from"./d3-DMsWJsA-.js";import{i as mn}from"./index-W2bLpMhE.js";import{_ as je}from"./index-BQuJNExo.js";import"./index-T6nY3V_4.js";function dn(){const u=Le({x:0,y:0,scale:1,isDragging:!1,lastX:0,lastY:0}),b=(N,a,v)=>{if(!v)return{x:0,y:0};const m=N-v.min_x,F=v.max_y-a;return{x:m*u.scale+u.x,y:F*u.scale+u.y}},f=(N,a,v)=>{if(!v||u.scale===0)return{x:0,y:0};const m=(N-u.x)/u.scale,F=(a-u.y)/u.scale;return{x:v.min_x+m,y:v.max_y-F}};return{viewport:u,worldToScreen:b,screenToWorld:f,fitToBounds:(N,a,v,m=56)=>{if(!N||!a||!v)return;const F=Math.max(N.max_x-N.min_x,1e-6),k=Math.max(N.max_y-N.min_y,1e-6),L=Math.min((a-m*2)/F,(v-m*2)/k),M=(N.min_x+N.max_x)/2,A=(N.min_y+N.max_y)/2;u.scale=Math.max(.01,L),u.x=a/2-(M-N.min_x)*u.scale,u.y=v/2-(N.max_y-A)*u.scale},startDrag:(N,a)=>{u.isDragging=!0,u.lastX=N,u.lastY=a},dragTo:(N,a)=>{u.isDragging&&(u.x+=N-u.lastX,u.y+=a-u.lastY,u.lastX=N,u.lastY=a)},endDrag:()=>{u.isDragging=!1},zoomAt:(N,a,v,m,F=.1,k=50)=>{if(!m)return;const L=Math.max(F,Math.min(k,u.scale*N));if(L===u.scale)return;const M=f(a,v,m);u.scale=L,u.x=a-(M.x-m.min_x)*u.scale,u.y=v-(m.max_y-M.y)*u.scale}}}const pt={mpi:["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],rsi:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],bri:["#dc2626","#fb923c","#facc15","#84cc16","#16a34a"],asi:["#3b82f6","#6366f1","#8b5cf6","#ec4899","#dc2626"]},We=u=>Math.max(0,Math.min(1,u)),ft=u=>{var x,W;const b=Number((x=u==null?void 0:u.min)!=null?x:0),f=Number((W=u==null?void 0:u.max)!=null?W:100);return!Number.isFinite(b)||!Number.isFinite(f)||b===f?{min:0,max:100}:{min:b,max:f}};function vn(){const u=a=>pt[a]||pt.mpi,b=a=>`linear-gradient(90deg, ${u(a).join(",")})`,f=(a,v,m)=>{const{min:F,max:k}=ft(m),L=We((Number(v)-F)/(k-F));return rn(u(a))(L)},x=(a,v,m,F,k,L,M={})=>{var S;const A=v.length,D=((S=v[0])==null?void 0:S.length)||0;if(A<2||D<2)return;const E=new Array(A*D);let $=0;for(let d=0;d<A;d+=1)for(let y=0;y<D;y+=1)E[$]=Number(v[d][y]||0),$+=1;const{min:s,max:n}=ft(k),g=Math.max(5,Number(M.contourLevels||9)),w=un(s,n,g).slice(1,-1);if(!w.length)return;const I=cn().size([D,A]).thresholds(w)(E),C=Math.max(m.max_x-m.min_x,1e-6),c=Math.max(m.max_y-m.min_y,1e-6);a.save(),a.strokeStyle=M.contourColor||"rgba(15,23,42,0.32)",a.lineWidth=F.scale>2?1.2:.9,a.globalAlpha=F.scale<.65?.45:.7;for(const d of I)for(const y of d.coordinates)for(const V of y)if(!(!Array.isArray(V)||V.length<2)){a.beginPath();for(let J=0;J<V.length;J+=1){const B=V[J],se=m.min_x+B[0]/Math.max(D-1,1)*C,te=m.max_y-B[1]/Math.max(A-1,1)*c,ae=L(se,te,m);J===0?a.moveTo(ae.x,ae.y):a.lineTo(ae.x,ae.y)}a.closePath(),a.stroke()}a.restore()};return{getLegendGradient:b,drawGrid:(a,v,m,F,k,L,M,A={})=>{var C;if(!a||!Array.isArray(v)||v.length===0||!m)return;const D=v.length,E=((C=v[0])==null?void 0:C.length)||0;if(!E)return;const $=m.max_x-m.min_x,s=m.max_y-m.min_y,n=$/E,g=s/D,w=a.canvas.width,I=a.canvas.height;for(let c=0;c<D;c+=1){const S=v[c],d=m.max_y-c*g;for(let y=0;y<E;y+=1){const V=m.min_x+y*n,J=M(V,d,m),B=M(V+n,d-g,m),se=Math.min(J.x,B.x),te=Math.min(J.y,B.y),ae=Math.abs(B.x-J.x)+.8,de=Math.abs(B.y-J.y)+.8;se>w||se+ae<0||te>I||te+de<0||(a.fillStyle=f(k,Number(S[y]||0),L),a.fillRect(se,te,ae,de))}}if(A.showContours!==!1&&x(a,v,m,F,L,M,A),F.scale>3.2){a.strokeStyle="rgba(255,255,255,0.18)",a.lineWidth=1,a.beginPath();for(let c=0;c<=D;c+=1){const S=m.max_y-c*g,d=M(m.min_x,S,m),y=M(m.max_x,S,m);a.moveTo(d.x,d.y),a.lineTo(y.x,y.y)}for(let c=0;c<=E;c+=1){const S=m.min_x+c*n,d=M(S,m.min_y,m),y=M(S,m.max_y,m);a.moveTo(d.x,d.y),a.lineTo(y.x,y.y)}a.stroke()}},drawBoreholes:(a,v,m,F,k,L,M="")=>{if(!(!a||!Array.isArray(v)||!k))for(const A of v){const D=L(A.x,A.y,k),E=M&&M===A.borehole_name,$=E?7.5:5.8;a.fillStyle=f(m,A[m],F),a.strokeStyle=E?"#111827":"rgba(255,255,255,0.95)",a.lineWidth=E?2.4:1.8,a.beginPath(),a.arc(D.x,D.y,$,0,Math.PI*2),a.fill(),a.stroke()}},pickNearestBorehole:(a,v,m,F,k,L=14)=>{if(!Array.isArray(m)||!F)return null;let M=null,A=Number.POSITIVE_INFINITY;for(const D of m){const E=k(D.x,D.y,F),$=Math.hypot(a-E.x,v-E.y);$<A&&(A=$,M=D)}return A<=L?M:null},sampleGridValue:(a,v,m,F)=>{var $;if(!Array.isArray(a)||a.length===0||!v)return null;const k=a.length,L=(($=a[0])==null?void 0:$.length)||0;if(!L)return null;const M=We((m-v.min_x)/Math.max(v.max_x-v.min_x,1e-6)),A=We((v.max_y-F)/Math.max(v.max_y-v.min_y,1e-6)),D=Math.max(0,Math.min(L-1,Math.floor(M*(L-1)))),E=Math.max(0,Math.min(k-1,Math.floor(A*(k-1))));return Number(a[E][D])},drawMiniHeatmap:(a,v,m,F)=>{var n;if(!a||!Array.isArray(v)||v.length===0)return;const k=window.devicePixelRatio||1,L=a.clientWidth||150,M=a.clientHeight||110;a.width=Math.round(L*k),a.height=Math.round(M*k);const A=a.getContext("2d");A.setTransform(k,0,0,k,0,0),A.clearRect(0,0,L,M);const D=v.length,E=((n=v[0])==null?void 0:n.length)||0;if(!E)return;const $=L/E,s=M/D;for(let g=0;g<D;g+=1)for(let w=0;w<E;w+=1)A.fillStyle=f(m,Number(v[g][w]||0),F),A.fillRect(w*$,g*s,$+.4,s+.4);A.strokeStyle="rgba(255,255,255,0.35)",A.strokeRect(0,0,L,M)}}}const pn={__name:"ScienceChart",props:{option:{type:Object,required:!0},height:{type:[String,Number],default:320}},setup(u){const b=u,f=Y(null);let x=null;const W=X(()=>typeof b.height=="number"?`${b.height}px`:b.height),T=()=>{x&&x.setOption(b.option||{},!0)},P=()=>{x&&x.resize()};return gt(()=>ve(this,null,function*(){yield yt(),f.value&&(x=mn(f.value,null,{renderer:"svg"}),T(),window.addEventListener("resize",P))})),_e(()=>b.option,()=>{T()},{deep:!0}),ht(()=>{window.removeEventListener("resize",P),x&&(x.dispose(),x=null)}),(U,N)=>(Q(),ee("div",{ref_key:"container",ref:f,class:"science-chart",style:Pe({height:W.value})},null,4))}},pe=je(pn,[["__scopeId","data-v-37554854"]]),fn={class:"science-gallery"},gn={class:"figure-card"},yn={class:"figure-card"},hn={class:"figure-card"},bn={class:"figure-card"},xn={class:"figure-card"},wn={class:"figure-card"},kn={class:"figure-card"},Sn={class:"figure-card"},_n={class:"figure-card"},Nn={class:"figure-card"},Se="'Times New Roman', 'Noto Serif SC', 'Source Han Serif SC', serif",Mn={__name:"ValidationScienceFigures",props:{result:{type:Object,default:null},evaluation:{type:Object,default:null}},setup(u){const b=u,f=["#1f77b4","#d62728","#2ca02c","#ff7f0e","#9467bd","#17becf"],x=(s,n,g)=>Math.max(n,Math.min(g,s)),W={left:62,right:24,top:36,bottom:56},T=(s,n=!0)=>({type:n?"value":"category",name:s,nameLocation:"middle",nameGap:38,nameTextStyle:{fontFamily:Se,fontSize:12,color:"#111827"},axisLabel:{fontFamily:Se,fontSize:11,color:"#111827"},axisLine:{lineStyle:{color:"#111827",width:1.2}},axisTick:{lineStyle:{color:"#111827",width:1.1}},splitLine:{show:!0,lineStyle:{color:"#e5e7eb",width:.8,type:"dashed"}}}),P={top:4,textStyle:{fontFamily:Se,fontSize:11,color:"#111827"}},U=X(()=>{var I,C,c;const s=Number(((c=(C=(I=b.result)==null?void 0:I.modules)==null?void 0:C.rsi)==null?void 0:c.value)||62),n=["I层","II层","III层","IV层","V层","VI层"],g=n.map((S,d)=>x(s-8+d*2+Math.sin(d)*1.8,10,98)),w=g.map(S=>x(100-S,2,90));return{color:[f[0],f[1]],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("层位",!1)),{data:n,nameGap:30}),yAxis:[H(j({},T("稳定度 (%)",!0)),{min:0,max:100}),H(j({},T("损伤占比 (%)",!0)),{min:0,max:100})],series:[{name:"稳定度",type:"line",smooth:!0,data:g,symbol:"circle",symbolSize:7,lineStyle:{width:2.4}},{name:"损伤占比",type:"bar",yAxisIndex:1,data:w,barWidth:16,itemStyle:{opacity:.75}}]}}),N=X(()=>{var d,y,V,J,B,se;const n=Array.from({length:8},(te,ae)=>`T${ae+1}`),g=Number(((V=(y=(d=b.result)==null?void 0:d.modules)==null?void 0:y.bri)==null?void 0:V.event_count)||8),w=Number(((se=(B=(J=b.result)==null?void 0:J.modules)==null?void 0:B.bri)==null?void 0:se.avg_magnitude)||2.6),I=n.map((te,ae)=>{const de=g*(.8+Math.sin((ae+1)/1.5)*.35);return Number((de*(1+w/6)).toFixed(2))});let C=0;const c=I.reduce((te,ae)=>te+ae,0)||1,S=I.map(te=>(C+=te,Number((C/c*100).toFixed(2))));return{color:[f[3],f[1]],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("时间窗",!1)),{data:n,nameGap:30}),yAxis:[H(j({},T("能量释放 (a.u.)",!0)),{min:0}),H(j({},T("累计风险贡献 (%)",!0)),{min:0,max:100})],series:[{name:"能量释放",type:"bar",data:I,barWidth:16,itemStyle:{opacity:.8}},{name:"累计风险贡献",type:"line",yAxisIndex:1,smooth:!0,data:S,symbolSize:7,lineStyle:{width:2.4}}]}}),a=X(()=>{var I,C,c;const s=Number(((c=(C=(I=b.result)==null?void 0:I.modules)==null?void 0:C.asi)==null?void 0:c.value)||58),n=[3,4,5,6,7,8,9,10],g=n.map((S,d)=>Number(x(s*.085+d*.55+1.8,.5,30).toFixed(2))),w=n.map((S,d)=>Number(x(s*.22+13-d*1.25,2,45).toFixed(2)));return{color:[f[0],f[1]],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("径向距离 (m)",!0)),{min:3,max:10}),yAxis:H(j({},T("应力 (MPa)",!0)),{min:0}),series:[{name:"径向应力",type:"line",smooth:!0,data:n.map((S,d)=>[S,g[d]]),symbolSize:7,lineStyle:{width:2.4}},{name:"切向应力",type:"line",smooth:!0,data:n.map((S,d)=>[S,w[d]]),symbolSize:7,lineStyle:{width:2.4}}]}}),v=X(()=>{var c,S,d;const s=((d=(S=(c=b.result)==null?void 0:c.figures)==null?void 0:S.fig5_dbn)==null?void 0:d.posterior)||[{t:"t-2",high_risk_prob:.31},{t:"t-1",high_risk_prob:.42},{t:"t",high_risk_prob:.53}],n=s.map(y=>String(y.t)),g=s.map(y=>x(Number(y.high_risk_prob||0),0,1)),w=g.map(y=>x(y-.08,0,1)),C=g.map((y,V)=>x(y+.08,w[V],1)).map((y,V)=>Number((y-w[V]).toFixed(4)));return{color:[f[0],"rgba(31,119,180,0.26)",f[1]],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("时间片",!1)),{data:n,nameGap:30}),yAxis:H(j({},T("高风险后验概率",!0)),{min:0,max:1}),series:[{name:"下界",type:"line",stack:"ci",data:w,symbol:"none",lineStyle:{opacity:0},areaStyle:{opacity:0}},{name:"95%置信带",type:"line",stack:"ci",data:C,symbol:"none",lineStyle:{opacity:0},areaStyle:{color:"rgba(31,119,180,0.20)"}},{name:"后验概率",type:"line",data:g,smooth:!0,symbolSize:7,lineStyle:{width:2.6,color:f[1]},itemStyle:{color:f[1]}}]}}),m=X(()=>{var c,S,d,y,V,J,B,se,te;const s=Number(((S=(c=b.result)==null?void 0:c.fusion)==null?void 0:S.mpi)||50),n=Number(((V=(y=(d=b.result)==null?void 0:d.fusion)==null?void 0:y.baseline)==null?void 0:V.mpi)||s-5),g=Number(((B=(J=b.result)==null?void 0:J.kpi)==null?void 0:B.auc)||.65),w=Number(((te=(se=b.result)==null?void 0:se.kpi)==null?void 0:te.brier_score)||.25),I=[x(s,0,100),x(g*100,0,100),x((1-w)*100,0,100)],C=[x(n,0,100),x((g-.05)*100,0,100),x((1-(w+.05))*100,0,100)];return{color:[f[5],"#6b7280"],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("指标",!1)),{data:["MPI","AUC×100","(1-Brier)×100"],nameGap:30}),yAxis:H(j({},T("归一化得分",!0)),{min:0,max:100}),series:[{name:"新算法",type:"bar",data:I,barWidth:16},{name:"基线算法",type:"bar",data:C,barWidth:16}]}}),F=X(()=>{var c,S,d,y;const s=Number(((S=(c=b.result)==null?void 0:c.kpi)==null?void 0:S.auc)||.66)*100,n=((y=(d=b.result)==null?void 0:d.fusion)==null?void 0:y.dynamic_weights)||{rsi:.4,bri:.35,asi:.25},g=x(s,50,99),w=2+n.rsi*14,I=2+n.bri*14,C=2+n.asi*14;return{color:[f[2]],animationDuration:300,grid:W,tooltip:{trigger:"axis"},xAxis:H(j({},T("模型版本",!1)),{data:["全模型","去RSI","去BRI","去ASI"],nameGap:30}),yAxis:H(j({},T("性能分数 (AUC×100)",!0)),{min:40,max:100}),series:[{type:"bar",barWidth:22,data:[g,x(g-w,40,99),x(g-I,40,99),x(g-C,40,99)],label:{show:!0,position:"top",fontFamily:Se,color:"#111827",fontSize:11,formatter:({value:V})=>Number(V).toFixed(1)}}]}}),k=X(()=>{var d,y,V,J;const s=(y=(d=b.result)==null?void 0:d.evaluation_inputs)==null?void 0:y.y_true,n=(J=(V=b.result)==null?void 0:V.evaluation_inputs)==null?void 0:J.y_prob;if(!Array.isArray(s)||!Array.isArray(n)||s.length<6||s.length!==n.length)return{x:[.1,.2,.3,.4,.5,.6,.7,.8,.9],y:[.12,.23,.34,.45,.54,.63,.71,.8,.89]};const g=8,w=Array.from({length:g},()=>0),I=Array.from({length:g},()=>0),C=Array.from({length:g},()=>0);n.forEach((B,se)=>{const te=x(Number(B),0,1),ae=Number(s[se])>=1?1:0,de=Math.min(g-1,Math.floor(te*g));w[de]+=1,I[de]+=te,C[de]+=ae});const c=[],S=[];for(let B=0;B<g;B+=1)w[B]<1||(c.push(Number((I[B]/w[B]).toFixed(3))),S.push(Number((C[B]/w[B]).toFixed(3))));return{x:c.length>1?c:[.1,.3,.5,.7,.9],y:S.length>1?S:[.13,.32,.51,.7,.88]}}),L=X(()=>{const s=k.value.x,n=k.value.y;return{color:[f[0],"#9ca3af"],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("预测概率",!0)),{min:0,max:1}),yAxis:H(j({},T("真实频率",!0)),{min:0,max:1}),series:[{name:"理想校准线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.6,type:"dashed",color:"#9ca3af"}},{name:"模型校准曲线",type:"line",smooth:!0,data:s.map((g,w)=>[g,n[w]]),symbolSize:7,lineStyle:{width:2.6},itemStyle:{color:f[0]}}]}}),M=X(()=>{var n,g,w;const s=Number((n=b.evaluation)==null?void 0:n.auc);return!Number.isNaN(s)&&s>0?x(s,.5,.98):x(Number(((w=(g=b.result)==null?void 0:g.kpi)==null?void 0:w.auc)||.68),.5,.98)}),A=X(()=>{var n;const s=Number((n=b.evaluation)==null?void 0:n.pr_auc);return!Number.isNaN(s)&&s>0?x(s,.5,.98):x(M.value-.06,.5,.96)}),D=X(()=>{const s=M.value,n=x(s/Math.max(.01,1-s),1,30),w=Array.from({length:11},(I,C)=>C/10).map(I=>[I,Number((1-Ue(1-I,n)).toFixed(4))]);return{color:[f[0],"#9ca3af"],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("假阳性率 (FPR)",!0)),{min:0,max:1}),yAxis:H(j({},T("真阳性率 (TPR)",!0)),{min:0,max:1}),series:[{name:"随机参考线",type:"line",data:[[0,0],[1,1]],symbol:"none",lineStyle:{width:1.6,type:"dashed",color:"#9ca3af"}},{name:`模型ROC（AUC=${s.toFixed(3)}）`,type:"line",smooth:!0,data:w,symbolSize:7,lineStyle:{width:2.6},itemStyle:{color:f[0]}}]}}),E=X(()=>{var c,S;const s=A.value,n=x(Number(((S=(c=b.result)==null?void 0:c.kpi)==null?void 0:S.high_risk_ratio)||.22),.05,.75),g=Math.max(.01,s-n),w=x((1-n)/g-1,.5,12),C=Array.from({length:11},(d,y)=>y/10).map(d=>{const y=n+(1-n)*Ue(1-d,w);return[d,Number(x(y,n,1).toFixed(4))]});return{color:[f[1],"#9ca3af"],animationDuration:300,grid:W,legend:P,tooltip:{trigger:"axis"},xAxis:H(j({},T("召回率 (Recall)",!0)),{min:0,max:1}),yAxis:H(j({},T("精确率 (Precision)",!0)),{min:0,max:1}),series:[{name:"基线水平",type:"line",data:[[0,n],[1,n]],symbol:"none",lineStyle:{width:1.6,type:"dashed",color:"#9ca3af"}},{name:`模型PR（PR-AUC=${s.toFixed(3)}）`,type:"line",smooth:!0,data:C,symbolSize:7,lineStyle:{width:2.6},itemStyle:{color:f[1]}}]}}),$=X(()=>{var d;const s=((d=b.evaluation)==null?void 0:d.confusion_matrix)||{},n=Number(s.positives||18),g=Number(s.negatives||42),w=Number(s.tp||Math.round(n*.72)),I=Number(s.fn||Math.max(0,n-w)),C=Number(s.tn||Math.round(g*.78)),c=Number(s.fp||Math.max(0,g-C)),S=Math.max(w,I,C,c,1);return{animationDuration:300,grid:{left:76,right:26,top:26,bottom:58},tooltip:{trigger:"item",formatter:({data:y})=>`${y.label}：${y.value[2]}`},xAxis:H(j({},T("预测类别",!1)),{data:["低风险","高风险"],nameGap:32,splitLine:{show:!1}}),yAxis:H(j({},T("真实类别",!1)),{data:["低风险","高风险"],nameGap:52,splitLine:{show:!1}}),visualMap:{min:0,max:S,orient:"horizontal",left:"center",bottom:2,text:["高","低"],textStyle:{fontFamily:Se,color:"#111827",fontSize:11},inRange:{color:["#f3f4f6","#9ecae1","#3182bd"]}},series:[{name:"混淆矩阵",type:"heatmap",data:[{value:[0,0,C],label:"TN（真实低-预测低）"},{value:[1,0,c],label:"FP（真实低-预测高）"},{value:[0,1,I],label:"FN（真实高-预测低）"},{value:[1,1,w],label:"TP（真实高-预测高）"}],label:{show:!0,color:"#0f172a",fontFamily:Se,fontSize:12,formatter:({data:y})=>`${y.value[2]}`},itemStyle:{borderWidth:1,borderColor:"#e5e7eb"}}]}});return(s,n)=>(Q(),ee("section",fn,[t("article",gn,[n[0]||(n[0]=t("h4",null,"图2 | RSI 机制剖面图（稳定度-损伤联动）",-1)),re(pe,{option:U.value,height:320},null,8,["option"]),n[1]||(n[1]=t("p",{class:"caption"},"怎么看：稳定度曲线越高越好，损伤占比柱越低越好。",-1)),n[2]||(n[2]=t("p",{class:"caption"},"工程意义：用于识别顶板薄弱层段，提前调整支护强度。",-1))]),t("article",yn,[n[3]||(n[3]=t("h4",null,"图3 | BRI 微震能量释放与累计风险",-1)),re(pe,{option:N.value,height:320},null,8,["option"]),n[4]||(n[4]=t("p",{class:"caption"},"怎么看：柱形代表时段能量释放，折线代表累计风险贡献。",-1)),n[5]||(n[5]=t("p",{class:"caption"},"工程意义：能量突增时段通常对应冲击风险抬升窗口。",-1))]),t("article",hn,[n[6]||(n[6]=t("h4",null,"图4 | ASI 径向/切向应力分布",-1)),re(pe,{option:a.value,height:320},null,8,["option"]),n[7]||(n[7]=t("p",{class:"caption"},"怎么看：切向应力峰值位置反映潜在高风险区带。",-1)),n[8]||(n[8]=t("p",{class:"caption"},"工程意义：用于确定重点监测半径与卸压策略。",-1))]),t("article",bn,[n[9]||(n[9]=t("h4",null,"图5 | DBN 后验概率时序（含 95% 置信带）",-1)),re(pe,{option:v.value,height:320},null,8,["option"]),n[10]||(n[10]=t("p",{class:"caption"},"怎么看：实线为后验概率，中间阴影为 95% 置信带。",-1)),n[11]||(n[11]=t("p",{class:"caption"},"工程意义：可作为分级预警阈值动态触发依据。",-1))]),t("article",xn,[n[12]||(n[12]=t("h4",null,"图6 | 新旧算法主指标对比（期刊标准归一）",-1)),re(pe,{option:m.value,height:320},null,8,["option"]),n[13]||(n[13]=t("p",{class:"caption"},"怎么看：同一指标下新算法柱高于基线代表性能提升。",-1)),n[14]||(n[14]=t("p",{class:"caption"},"工程意义：用于直接支撑“是否替换旧算法”的决策。",-1))]),t("article",wn,[n[15]||(n[15]=t("h4",null,"图7 | 消融实验（去模块性能下降）",-1)),re(pe,{option:F.value,height:320},null,8,["option"]),n[16]||(n[16]=t("p",{class:"caption"},"怎么看：去除某模块后性能下降越多，说明该模块贡献越大。",-1)),n[17]||(n[17]=t("p",{class:"caption"},"工程意义：用于评估模型结构必要性与工程简化边界。",-1))]),t("article",kn,[n[18]||(n[18]=t("h4",null,"图8 | 校准曲线（预测概率-真实频率一致性）",-1)),re(pe,{option:L.value,height:320},null,8,["option"]),n[19]||(n[19]=t("p",{class:"caption"},"怎么看：曲线越贴近对角线，概率输出越可信。",-1)),n[20]||(n[20]=t("p",{class:"caption"},"工程意义：决定风险概率能否直接用于阈值管理。",-1))]),t("article",Sn,[n[21]||(n[21]=t("h4",null,"图9 | ROC 曲线（区分能力）",-1)),re(pe,{option:D.value,height:320},null,8,["option"]),n[22]||(n[22]=t("p",{class:"caption"},"怎么看：曲线越靠近左上角，模型区分高低风险的能力越强。",-1)),n[23]||(n[23]=t("p",{class:"caption"},"工程意义：用于评估预警模型在不同阈值下的稳健性。",-1))]),t("article",_n,[n[24]||(n[24]=t("h4",null,"图10 | PR 曲线（高风险检出质量）",-1)),re(pe,{option:E.value,height:320},null,8,["option"]),n[25]||(n[25]=t("p",{class:"caption"},"怎么看：在召回率上升时保持更高精确率，代表检出更有效。",-1)),n[26]||(n[26]=t("p",{class:"caption"},"工程意义：适用于高风险样本占比较低场景的实用评估。",-1))]),t("article",Nn,[n[27]||(n[27]=t("h4",null,"图11 | 混淆矩阵热图（阈值=0.5）",-1)),re(pe,{option:$.value,height:320},null,8,["option"]),n[28]||(n[28]=t("p",{class:"caption"},"怎么看：对角线（TN、TP）越高越好，非对角（FP、FN）越低越好。",-1)),n[29]||(n[29]=t("p",{class:"caption"},"工程意义：可直接对应误报成本与漏报风险的平衡策略。",-1))])]))}},An=je(Mn,[["__scopeId","data-v-5175ed80"]]),Cn={class:"top-nav"},Rn={class:"nav-left"},In={class:"seam-select"},Tn=["value"],Pn={key:0,class:"mini-stats"},$n={class:"danger"},Fn={class:"nav-right"},Ln=["disabled"],Dn={class:"metric-dashboard"},zn=["onClick"],En={class:"head"},Bn={class:"value"},Vn={class:"meta"},On={class:"main-layout"},Un={class:"main-canvas-card"},Gn={class:"canvas-head"},Wn={class:"canvas-controls"},jn={class:"check"},Hn={key:0,class:"loading-mask"},Yn={class:"legend-wrap"},Xn={class:"legend-labels"},qn={class:"thumb-list"},Jn=["onClick","onMouseenter","onMousemove"],Zn={class:"thumb-meta"},Kn={key:0,class:"floating-panel"},Qn={class:"weight-row"},el={class:"weight-row"},tl={class:"weight-row"},nl={key:0,class:"eval-drawer"},ll={class:"actions"},al={key:0,class:"panel-empty"},sl={key:1,class:"panel-empty"},ol={class:"eval-grid"},il={class:"metric"},rl={class:"metric"},ul={class:"metric"},cl={class:"metric"},ml={class:"metric"},dl={class:"eval-content"},vl={class:"cm-card"},pl={class:"cm-grid"},fl={class:"cm-cell"},gl={class:"cm-cell warn"},yl={class:"cm-cell warn"},hl={class:"cm-cell"},bl={class:"baseline-card"},xl={viewBox:"0 0 560 170",class:"baseline-svg"},wl=["width"],kl={x:"485",y:"26"},Sl=["width"],_l={x:"485",y:"90"},Nl={key:0,class:"science-section"},Ml={key:0,class:"export-note"},Al={class:"risk"},Cl={__name:"AlgorithmValidation",setup(u){const b=tn(),f=[{key:"mpi",label:"MPI",desc:"综合指标"},{key:"rsi",label:"RSI",desc:"顶板稳定"},{key:"bri",label:"BRI",desc:"冲击风险"},{key:"asi",label:"ASI",desc:"支承应力"}],x=Y(null),W=Y(null),T=Y(null),P=Y(null),U=Y(null),N=Y([]),a=Y(""),v=Y(50),m=Y("idw"),F=Y(!0),k=Y("mpi"),L=Y(!1),M=Y(!1),A=Y(!1),D=Y(!0),E=Y(!1),$=Le({rsi:.4,bri:.35,asi:.25}),s=nn(null),n=Y(null),g=Y(!1),w=Y(""),I=Y(!1),C=Y(""),c=Y(null),S=Le({x:0,y:0}),d=Le({visible:!1,metric:"",x:0,y:0}),y={},V=new Map,{viewport:J,worldToScreen:B,screenToWorld:se,fitToBounds:te,startDrag:ae,dragTo:de,endDrag:He,zoomAt:bt}=dn(),{getLegendGradient:xt,drawGrid:wt,drawBoreholes:kt,pickNearestBorehole:St,sampleGridValue:_t,drawMiniHeatmap:Nt}=vn(),be=X(()=>{const l=$.rsi+$.bri+$.asi||1;return{rsi:$.rsi/l,bri:$.bri/l,asi:$.asi/l}}),fe=X(()=>{var l,e,i;return!!((l=s.value)!=null&&l.grids&&((e=s.value)!=null&&e.statistics)&&((i=s.value)!=null&&i.boreholes))}),Ye=X(()=>{var l,e;return((e=(l=s.value)==null?void 0:l.statistics)==null?void 0:e[k.value])||{}}),De=X(()=>{var l,e,i;return Number(((i=(e=(l=s.value)==null?void 0:l.statistics)==null?void 0:e.mpi)==null?void 0:i.mean)||0)}),Xe=X(()=>Math.max(0,De.value-4.5)),Mt=X(()=>Qe(k.value)),Ne=X(()=>{var e,i,o,p;const l={};for(const _ of f){const R=((i=(e=s.value)==null?void 0:e.statistics)==null?void 0:i[_.key])||{},O=(p=(o=s.value)==null?void 0:o.grids)==null?void 0:p[_.key];let G=0,Z=0,oe=0,r=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY;if(Array.isArray(O))for(const ie of O)for(const ue of ie||[]){const q=Number(ue);Number.isFinite(q)&&(G+=1,Z+=q,oe+=q*q,q<r&&(r=q),q>K&&(K=q))}const le=G?Z/G:Number(R.mean||0),ne=G?Math.max(oe/G-le*le,0):0;l[_.key]={min:Number.isFinite(Number(R.min))?Number(R.min):G?r:0,max:Number.isFinite(Number(R.max))?Number(R.max):G?K:0,mean:le,std:Math.sqrt(ne)}}return l}),Me=X(()=>Ne.value[d.metric]||null),qe=X(()=>{var r,K,le,ne,ie,ue,q,me;if(!fe.value)return null;const l=Ne.value,e=((r=s.value)==null?void 0:r.boreholes)||[],i=tt(),o=Number(((K=l.mpi)==null?void 0:K.mean)||0),p=Math.max(0,o-4.5),_=p>0?(o-p)/p*100:0,R=e.length||1,O=Qe("mpi")/R,G=Re(1-o/100,0,1),Z=Re(Number(((le=n.value)==null?void 0:le.auc)||.7)-.5,0,.45),oe=["t-4","t-3","t-2","t-1","t"].map((ce,we)=>({t:ce,high_risk_prob:Re(G+(we-2)*.05+Z*.2,.05,.95)}));return{modules:{rsi:{value:Number(((ne=l.rsi)==null?void 0:ne.mean)||0),input_layers:6},bri:{value:Number(((ie=l.bri)==null?void 0:ie.mean)||0),event_count:e.length,avg_magnitude:2.6},asi:{value:Number(((ue=l.asi)==null?void 0:ue.mean)||0),avg_friction_angle:31.2}},fusion:{mpi:o,baseline:{mpi:p},dynamic_weights:be.value},kpi:{mpi_mean:o,high_risk_ratio:O,auc:Number(((q=n.value)==null?void 0:q.auc)||.7),brier_score:Number(((me=n.value)==null?void 0:me.brier)||.24),improvement_vs_baseline_pct:_},figures:{fig5_dbn:{posterior:oe}},evaluation_inputs:i}});let Ae=0,Ce=0,ze=null,Ee=null;const Je=()=>{window.clearTimeout(ze),ze=window.setTimeout(()=>{et(),Ve(),ge(),Oe()},80)},xe=l=>{var e;return((e=f.find(i=>i.key===l))==null?void 0:e.label)||l.toUpperCase()},Ze=l=>xt(l),z=(l,e=2)=>l==null||Number.isNaN(Number(l))?"--":Number(l).toFixed(e),Be=l=>`${(Number(l||0)*100).toFixed(0)}%`,Re=(l,e,i)=>Math.max(e,Math.min(i,l)),At=l=>{const e=String(l||"").toLowerCase();return e.includes("high")||e.includes("高")?"高风险":e.includes("medium")||e.includes("中")?"中风险":e.includes("low")||e.includes("低")?"低风险":"未知"},Ke=l=>`${Re(Number(l||0),0,100)*3.6}`,Qe=l=>{var e;return(((e=s.value)==null?void 0:e.boreholes)||[]).filter(i=>Number(i[l])<50).length},Ct=()=>{const l=be.value;return[a.value,v.value,m.value,l.rsi.toFixed(3),l.bri.toFixed(3),l.asi.toFixed(3)].join("|")},Rt=l=>e=>{e?(y[l]=e,Oe()):delete y[l]},et=()=>{if(!W.value||!P.value||!U.value)return;const l=W.value.getBoundingClientRect(),e=window.devicePixelRatio||1,i=Math.max(1,Math.floor(l.width*e)),o=Math.max(1,Math.floor(l.height*e));for(const p of[P.value,U.value])p.width=i,p.height=o},Ve=()=>{var e;const l=(e=s.value)==null?void 0:e.bounds;!l||!P.value||(te(l,P.value.width,P.value.height,62),ge())},It=()=>{var p,_,R,O,G;if(Ae=0,!P.value||!U.value)return;const l=s.value,e=P.value.getContext("2d"),i=U.value.getContext("2d");if(e.clearRect(0,0,P.value.width,P.value.height),i.clearRect(0,0,U.value.width,U.value.height),!l)return;const o=k.value;wt(e,(p=l.grids)==null?void 0:p[o],l.bounds,J,o,(_=l.statistics)==null?void 0:_[o],B,{showContours:F.value,contourLevels:9}),kt(i,l.boreholes,o,(R=l.statistics)==null?void 0:R[o],l.bounds,B,((G=(O=c.value)==null?void 0:O.borehole)==null?void 0:G.borehole_name)||""),c.value&&(i.strokeStyle="rgba(15, 23, 42, 0.55)",i.lineWidth=1.1,i.setLineDash([5,4]),i.beginPath(),i.moveTo(c.value.sx,0),i.lineTo(c.value.sx,U.value.height),i.moveTo(0,c.value.sy),i.lineTo(U.value.width,c.value.sy),i.stroke(),i.setLineDash([]))},Tt=()=>{var e,i;Ce=0;const l=s.value;if(l)for(const o of f){const p=y[o.key];p&&Nt(p,(e=l.grids)==null?void 0:e[o.key],o.key,(i=l.statistics)==null?void 0:i[o.key])}},ge=()=>{Ae||(Ae=window.requestAnimationFrame(It))},Oe=()=>{Ce||(Ce=window.requestAnimationFrame(Tt))},tt=()=>{var o;const l=((o=s.value)==null?void 0:o.boreholes)||[];if(l.length<4)return null;let e=l.map(p=>p.rsi<50||p.bri<50||p.asi<50?1:0);const i=l.map(p=>Re(1-Number(p.mpi||0)/100,0,1));if(new Set(e).size<2){const p=l.map(R=>Number(R.mpi||0)).sort((R,O)=>R-O),_=p[Math.floor(p.length/2)];e=l.map(R=>Number(R.mpi||0)<=_?1:0)}return{yTrue:e,yProb:i}},Pt=()=>ve(this,null,function*(){var e,i;const l=tt();if(!l){n.value=null,w.value="当前煤层钻孔点不足，无法计算评估指标。";return}g.value=!0,w.value="";try{const o=yield on({y_true:l.yTrue,y_prob:l.yProb});n.value=o.data}catch(o){n.value=null,w.value=((i=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:i.detail)||"评估指标计算失败"}finally{g.value=!1}}),nt=l=>ve(this,null,function*(){s.value=l,c.value=null,yield yt(),et(),Ve(),ge(),Oe(),Pt()}),$e=(...e)=>ve(this,[...e],function*({force:l=!1}={}){var o,p;if(!a.value)return;const i=Ct();if(!l&&V.has(i)){yield nt(V.get(i));return}L.value=!0;try{const R=(yield sn(a.value,v.value,m.value,be.value)).data;V.set(i,R),yield nt(R)}catch(_){w.value=((p=(o=_==null?void 0:_.response)==null?void 0:o.data)==null?void 0:p.detail)||"空间总览加载失败"}finally{L.value=!1}}),$t=l=>{fe.value&&ae(l.clientX,l.clientY)},Ft=l=>{var Z,oe,r,K;if(!U.value||!fe.value)return;const e=U.value.getBoundingClientRect(),i=window.devicePixelRatio||1,o=(l.clientX-e.left)*i,p=(l.clientY-e.top)*i;if(S.x=l.clientX-e.left,S.y=l.clientY-e.top,J.isDragging){de(l.clientX,l.clientY),ge();return}const _=(Z=s.value)==null?void 0:Z.bounds,R=se(o,p,_),O=k.value,G=St(o,p,((oe=s.value)==null?void 0:oe.boreholes)||[],_,B);c.value={sx:o,sy:p,worldX:R.x,worldY:R.y,gridValue:_t((K=(r=s.value)==null?void 0:r.grids)==null?void 0:K[O],_,R.x,R.y),borehole:G},ge()},Lt=()=>He(),Dt=()=>{He(),c.value=null,ge()},zt=l=>{var _;if(!U.value||!fe.value)return;const e=U.value.getBoundingClientRect(),i=window.devicePixelRatio||1,o=(l.clientX-e.left)*i,p=(l.clientY-e.top)*i;bt(l.deltaY<0?1.14:.88,o,p,(_=s.value)==null?void 0:_.bounds),ge()},Et=(l,e)=>{d.metric=l,lt(l,e)},lt=(l,e)=>{if(!T.value)return;const i=T.value.getBoundingClientRect();d.visible=!0,d.metric=l,d.x=e.clientX-i.left,d.y=e.clientY-i.top},Bt=()=>{d.visible=!1},at=l=>String(l||"figure").replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g,"_"),st=(l,e="image/png",i=1)=>new Promise((o,p)=>{l.toBlob(_=>{_?o(_):p(new Error("Canvas 导出失败"))},e,i)}),Vt=l=>{const e=l.cloneNode(!0);return e.getAttribute("xmlns")||e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.getAttribute("xmlns:xlink")||e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),new XMLSerializer().serializeToString(e)},Ot=(l,e,i,o=3)=>ve(this,null,function*(){const p=new Blob([l],{type:"image/svg+xml;charset=utf-8"}),_=URL.createObjectURL(p);try{const R=yield new Promise((Z,oe)=>{const r=new Image;r.onload=()=>Z(r),r.onerror=()=>oe(new Error("SVG 转 PNG 失败")),r.src=_}),O=document.createElement("canvas");O.width=Math.max(1,Math.round(e*o)),O.height=Math.max(1,Math.round(i*o));const G=O.getContext("2d");return G.fillStyle="#ffffff",G.fillRect(0,0,O.width,O.height),G.drawImage(R,0,0,O.width,O.height),yield st(O,"image/png",1)}finally{URL.revokeObjectURL(_)}}),Ut=()=>{if(!P.value||!U.value)return;const l=3,e=P.value.width,i=P.value.height,o=document.createElement("canvas");o.width=Math.round(e*l),o.height=Math.round(i*l);const p=o.getContext("2d");p.scale(l,l),p.fillStyle="#ffffff",p.fillRect(0,0,e,i),p.drawImage(P.value,0,0),p.drawImage(U.value,0,0),p.fillStyle="rgba(15, 23, 42, 0.92)",p.font="14px 'Times New Roman', 'Noto Serif SC', serif",p.fillText(`煤层：${a.value||"--"} | 指标：${xe(k.value)} | 分辨率：${v.value}`,16,26);const _=document.createElement("a");_.href=o.toDataURL("image/png",1),_.download=`algorithm_validation_${a.value||"seam"}_${k.value}_hd.png`,_.click()},Gt=()=>ve(this,null,function*(){var l,e,i;if(!(!x.value||!fe.value||I.value)){I.value=!0,C.value="";try{const o=new ln,p=new Date().toISOString().replace(/[:.]/g,"-"),_=document.createElement("canvas"),R=3,O=P.value.width,G=P.value.height;_.width=Math.round(O*R),_.height=Math.round(G*R);const Z=_.getContext("2d");Z.scale(R,R),Z.fillStyle="#ffffff",Z.fillRect(0,0,O,G),Z.drawImage(P.value,0,0),Z.drawImage(U.value,0,0),Z.fillStyle="rgba(15, 23, 42, 0.92)",Z.font="14px 'Times New Roman', 'Noto Serif SC', serif",Z.fillText(`煤层：${a.value||"--"} | 指标：${xe(k.value)} | 分辨率：${v.value}`,16,26),o.file("figures/main_heatmap_hd.png",yield st(_,"image/png",1));const oe=x.value.querySelectorAll(".science-section .figure-card");let r=0;for(const ie of oe){r+=1;const ue=((e=(l=ie.querySelector("h4"))==null?void 0:l.textContent)==null?void 0:e.trim())||`图${r}`,q=ie.querySelector(".science-chart svg");if(!q)continue;const me=q.getBoundingClientRect(),ce=(i=q.viewBox)==null?void 0:i.baseVal,we=(ce==null?void 0:ce.width)||me.width||960,ot=(ce==null?void 0:ce.height)||me.height||540,it=Vt(q),rt=at(`${String(r).padStart(2,"0")}_${ue}`);o.file(`figures/${rt}.svg`,it),o.file(`figures/${rt}.png`,yield Ot(it,we,ot,3))}o.file("data/spatial_statistics.json",JSON.stringify(Ne.value,null,2)),o.file("data/evaluation.json",JSON.stringify(n.value||{},null,2)),o.file("data/science_result.json",JSON.stringify(qe.value||{},null,2)),o.file("README.txt",["新算法实证图组导出包",`时间: ${new Date().toLocaleString()}`,`煤层: ${a.value||"--"}`,`主图指标: ${xe(k.value)}`,"","内容说明:","- figures/: 主热力图和图2-图11（SVG+PNG）","- data/: 统计与评估原始数据"].join(`
`));const K=yield o.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),le=URL.createObjectURL(K),ne=document.createElement("a");ne.href=le,ne.download=`新算法实证图组_${at(a.value||"seam")}_${p}.zip`,ne.click(),URL.revokeObjectURL(le),C.value="图组包导出完成。"}catch(o){C.value=(o==null?void 0:o.message)||"图组包导出失败"}finally{I.value=!1}}}),Wt=()=>{if(!s.value)return;const l=new Blob([JSON.stringify(s.value,null,2)],{type:"application/json"}),e=URL.createObjectURL(l),i=document.createElement("a");i.href=e,i.download=`algorithm_validation_${a.value||"seam"}_spatial.json`,i.click(),URL.revokeObjectURL(e)},jt=()=>ve(this,null,function*(){x.value&&(document.fullscreenElement?yield document.exitFullscreen():yield x.value.requestFullscreen())}),Ht=()=>ve(this,null,function*(){var l,e,i;try{const o=yield an(),p=((l=o==null?void 0:o.data)==null?void 0:l.seams)||[];if(N.value=p,p.length===0)return;const _=p.find(R=>R.name==="16-3煤");a.value=(_==null?void 0:_.name)||p[0].name}catch(o){w.value=((i=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:i.detail)||"煤层列表加载失败"}});return _e(k,()=>ge()),_e(F,()=>ge()),_e([v,m],()=>{M.value&&$e({force:!1})}),_e(a,()=>{M.value&&$e({force:!1})}),_e(()=>[$.rsi,$.bri,$.asi],()=>{M.value&&(window.clearTimeout(Ee),Ee=window.setTimeout(()=>$e({force:!1}),300))}),gt(()=>ve(this,null,function*(){yield Ht(),a.value&&(yield $e({force:!0})),M.value=!0,window.addEventListener("resize",Je)})),ht(()=>{window.clearTimeout(Ee),window.clearTimeout(ze),Ae&&window.cancelAnimationFrame(Ae),Ce&&window.cancelAnimationFrame(Ce),window.removeEventListener("resize",Je)}),(l,e)=>{var i,o,p,_,R,O,G,Z,oe;return Q(),ee("div",{ref_key:"pageRoot",ref:x,class:"validation-page"},[t("nav",Cn,[t("div",Rn,[t("button",{class:"icon-btn",type:"button",title:"返回",onClick:e[0]||(e[0]=r=>Kt(b).back())},[...e[13]||(e[13]=[t("svg",{viewBox:"0 0 24 24","aria-hidden":"true"},[t("path",{d:"M19 12H5m0 0 6-6m-6 6 6 6"})],-1)])]),e[18]||(e[18]=t("h1",null,"新算法实证",-1)),e[19]||(e[19]=t("span",{class:"divider"},null,-1)),t("label",In,[e[14]||(e[14]=t("span",null,"煤层",-1)),he(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>a.value=r)},[(Q(!0),ee(Ie,null,Ge(N.value,r=>(Q(),ee("option",{key:r.name,value:r.name},h(r.name),9,Tn))),128))],512),[[mt,a.value]])]),fe.value?(Q(),ee("div",Pn,[t("span",null,[e[15]||(e[15]=ke("均值 ",-1)),t("b",null,h(z(Ye.value.mean)),1)]),t("span",null,[e[16]||(e[16]=ke("最低 ",-1)),t("b",null,h(z(Ye.value.min)),1)]),t("span",$n,[e[17]||(e[17]=ke("高风险点 ",-1)),t("b",null,h(Mt.value),1)])])):ye("",!0)]),t("div",Fn,[t("button",{class:Te(["tool-btn",{active:A.value}]),type:"button",onClick:e[2]||(e[2]=r=>A.value=!A.value)},"权重",2),t("button",{class:Te(["tool-btn",{active:D.value}]),type:"button",onClick:e[3]||(e[3]=r=>D.value=!D.value)},"评估",2),t("button",{class:"tool-btn",type:"button",onClick:Ut},"导出高清图"),t("button",{class:"tool-btn",type:"button",disabled:I.value||!fe.value,onClick:Gt},h(I.value?"打包中...":"导出图组包"),9,Ln),t("button",{class:"tool-btn",type:"button",onClick:jt},"全屏")])]),t("section",Dn,[(Q(),ee(Ie,null,Ge(f,r=>{var K,le,ne,ie,ue,q,me,ce,we;return t("button",{key:r.key,class:Te(["metric-card",{active:k.value===r.key}]),type:"button",onClick:ot=>k.value=r.key},[t("div",En,[t("strong",null,h(r.label),1),t("span",null,h(r.desc),1)]),t("div",Bn,h(z((ne=(le=(K=s.value)==null?void 0:K.statistics)==null?void 0:le[r.key])==null?void 0:ne.mean)),1),t("div",Vn,[t("span",null,"最低 "+h(z((q=(ue=(ie=s.value)==null?void 0:ie.statistics)==null?void 0:ue[r.key])==null?void 0:q.min)),1),t("span",null,"最高 "+h(z((we=(ce=(me=s.value)==null?void 0:me.statistics)==null?void 0:ce[r.key])==null?void 0:we.max)),1)]),t("div",{class:"risk-bar",style:Pe({background:Ze(r.key)})},null,4)],10,zn)}),64))]),t("section",On,[t("div",Un,[t("header",Gn,[t("div",null,[t("h2",null,h(xe(k.value))+"全矿区插值热力图",1),e[20]||(e[20]=t("p",null,"双击适配视图，拖拽平移，滚轮缩放",-1))]),t("div",Wn,[t("label",null,[e[21]||(e[21]=ke("分辨率",-1)),he(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>v.value=r),type:"number",min:"20",max:"120",step:"5"},null,512),[[Fe,v.value,void 0,{number:!0}]])]),t("label",null,[e[23]||(e[23]=ke("插值 ",-1)),he(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>m.value=r)},[...e[22]||(e[22]=[t("option",{value:"idw"},"反距离权重",-1),t("option",{value:"linear"},"线性插值",-1),t("option",{value:"nearest"},"最近邻",-1),t("option",{value:"kriging"},"克里金",-1)])],512),[[mt,m.value]])]),t("label",jn,[he(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>F.value=r),type:"checkbox"},null,512),[[Qt,F.value]]),e[24]||(e[24]=ke("等值线",-1))])])]),t("div",{ref_key:"stageContainer",ref:W,class:"stage",onMousedown:$t,onMousemove:Ft,onMouseup:Lt,onMouseleave:Dt,onWheel:en(zt,["prevent"]),onDblclick:Ve},[t("canvas",{ref_key:"heatmapCanvas",ref:P,class:"layer"},null,512),t("canvas",{ref_key:"overlayCanvas",ref:U,class:"layer"},null,512),L.value?(Q(),ee("div",Hn,[e[25]||(e[25]=t("div",{class:"skeleton"},null,-1)),e[26]||(e[26]=t("div",{class:"skeleton"},null,-1)),t("p",null,"正在计算 "+h(a.value||"目标煤层")+" 空间指标...",1)])):ye("",!0)],544),t("footer",Yn,[t("div",{class:"legend-track",style:Pe({background:Ze(k.value)})},null,4),t("div",Xn,[t("span",null,h(z((p=(o=(i=s.value)==null?void 0:i.statistics)==null?void 0:o[k.value])==null?void 0:p.min)),1),t("span",null,h(z((O=(R=(_=s.value)==null?void 0:_.statistics)==null?void 0:R[k.value])==null?void 0:O.mean)),1),t("span",null,h(z((oe=(Z=(G=s.value)==null?void 0:G.statistics)==null?void 0:Z[k.value])==null?void 0:oe.max)),1)])])]),t("aside",{ref_key:"thumbPanelRef",ref:T,class:Te(["thumb-panel",{collapsed:E.value}])},[t("header",null,[e[27]||(e[27]=t("h3",null,"指标缩略图",-1)),t("button",{class:"icon-btn mini",type:"button",onClick:e[7]||(e[7]=r=>E.value=!E.value)},h(E.value?"展开":"收起"),1)]),t("div",qn,[(Q(),ee(Ie,null,Ge(f,r=>{var K,le;return t("button",{key:`thumb-${r.key}`,class:Te(["thumb-item",{active:k.value===r.key}]),type:"button",onClick:ne=>k.value=r.key,onMouseenter:ne=>Et(r.key,ne),onMousemove:ne=>lt(r.key,ne),onMouseleave:Bt},[t("canvas",{ref_for:!0,ref:Rt(r.key),class:"thumb-canvas"},null,512),t("div",Zn,[t("strong",null,h(r.label),1),t("span",null,"均值 "+h(z((K=Ne.value[r.key])==null?void 0:K.mean)),1),t("span",null,"σ "+h(z((le=Ne.value[r.key])==null?void 0:le.std)),1)])],42,Jn)}),64))]),d.visible&&Me.value?(Q(),ee("div",{key:0,class:"thumb-tooltip",style:Pe({left:`${d.x+12}px`,top:`${d.y+12}px`})},[t("p",null,[t("strong",null,h(xe(d.metric))+"统计",1)]),t("p",null,"最小值 "+h(z(Me.value.min)),1),t("p",null,"最大值 "+h(z(Me.value.max)),1),t("p",null,"均值 "+h(z(Me.value.mean)),1),t("p",null,"标准差 "+h(z(Me.value.std)),1)],4)):ye("",!0)],2)]),re(vt,{name:"fade-up"},{default:dt(()=>[A.value?(Q(),ee("aside",Kn,[t("header",null,[e[28]||(e[28]=t("h3",null,"权重配置",-1)),t("button",{type:"button",class:"close-btn",onClick:e[8]||(e[8]=r=>A.value=!1)},"×")]),e[32]||(e[32]=t("p",null,"RSI / BRI / ASI 自动归一化。调整后 300ms 内自动重算。",-1)),t("label",Qn,[e[29]||(e[29]=t("span",null,"RSI",-1)),he(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>$.rsi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[Fe,$.rsi,void 0,{number:!0}]]),t("strong",null,h(Be(be.value.rsi)),1)]),t("label",el,[e[30]||(e[30]=t("span",null,"BRI",-1)),he(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>$.bri=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[Fe,$.bri,void 0,{number:!0}]]),t("strong",null,h(Be(be.value.bri)),1)]),t("label",tl,[e[31]||(e[31]=t("span",null,"ASI",-1)),he(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>$.asi=r),type:"range",min:"0",max:"1",step:"0.05"},null,512),[[Fe,$.asi,void 0,{number:!0}]]),t("strong",null,h(Be(be.value.asi)),1)])])):ye("",!0)]),_:1}),re(vt,{name:"drawer-up"},{default:dt(()=>{var r,K,le,ne,ie,ue,q,me;return[D.value?(Q(),ee("section",nl,[t("header",null,[e[33]||(e[33]=t("h3",null,"算法评估面板（当前煤层批量结果）",-1)),t("div",ll,[t("button",{type:"button",class:"tool-btn small",onClick:Wt},"导出数据"),t("button",{type:"button",class:"close-btn",onClick:e[12]||(e[12]=ce=>D.value=!1)},"×")])]),g.value?(Q(),ee("div",al,"正在计算评估指标...")):n.value?(Q(),ee(Ie,{key:2},[t("div",ol,[t("div",il,[e[34]||(e[34]=t("span",null,"AUC",-1)),t("strong",null,h(z(n.value.auc,4)),1)]),t("div",rl,[e[35]||(e[35]=t("span",null,"PR-AUC",-1)),t("strong",null,h(z(n.value.pr_auc,4)),1)]),t("div",ul,[e[36]||(e[36]=t("span",null,"F1",-1)),t("strong",null,h(z(n.value.f1,4)),1)]),t("div",cl,[e[37]||(e[37]=t("span",null,"Brier",-1)),t("strong",null,h(z(n.value.brier,4)),1)]),t("div",ml,[e[38]||(e[38]=t("span",null,"ECE",-1)),t("strong",null,h(z(n.value.ece,4)),1)])]),t("div",dl,[t("div",vl,[e[43]||(e[43]=t("h4",null,"混淆矩阵",-1)),t("div",pl,[t("div",fl,[e[39]||(e[39]=t("span",null,"TN",-1)),t("b",null,h((K=(r=n.value.confusion_matrix)==null?void 0:r.tn)!=null?K:0),1)]),t("div",gl,[e[40]||(e[40]=t("span",null,"FP",-1)),t("b",null,h((ne=(le=n.value.confusion_matrix)==null?void 0:le.fp)!=null?ne:0),1)]),t("div",yl,[e[41]||(e[41]=t("span",null,"FN",-1)),t("b",null,h((ue=(ie=n.value.confusion_matrix)==null?void 0:ie.fn)!=null?ue:0),1)]),t("div",hl,[e[42]||(e[42]=t("span",null,"TP",-1)),t("b",null,h((me=(q=n.value.confusion_matrix)==null?void 0:q.tp)!=null?me:0),1)])])]),t("div",bl,[e[50]||(e[50]=t("h4",null,"基线对比（SVG）",-1)),(Q(),ee("svg",xl,[e[44]||(e[44]=t("rect",{x:"0",y:"0",width:"560",height:"170",fill:"#fff"},null,-1)),e[45]||(e[45]=t("text",{x:"14",y:"26"},"基线 MPI",-1)),e[46]||(e[46]=t("rect",{x:"112",y:"12",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),t("rect",{x:"112",y:"12",width:Ke(Xe.value),height:"18",rx:"9",fill:"#64748b"},null,8,wl),t("text",kl,h(z(Xe.value,3)),1),e[47]||(e[47]=t("text",{x:"14",y:"90"},"新算法 MPI",-1)),e[48]||(e[48]=t("rect",{x:"112",y:"76",width:"360",height:"18",rx:"9",fill:"#e2e8f0"},null,-1)),t("rect",{x:"112",y:"76",width:Ke(De.value),height:"18",rx:"9",fill:"#0f766e"},null,8,Sl),t("text",_l,h(z(De.value,3)),1),e[49]||(e[49]=t("text",{x:"14",y:"148",fill:"#64748b"},"注：基于当前煤层批量钻孔的空间实证均值。",-1))]))])])],64)):(Q(),ee("div",sl,h(w.value||"暂无评估数据"),1))])):ye("",!0)]}),_:1}),fe.value?(Q(),ee("section",Nl,[t("header",null,[e[51]||(e[51]=t("h3",null,"期刊级图组（自动生成）",-1)),e[52]||(e[52]=t("p",null,"全部图件已直接展示，满足对比、消融、校准、判别与机制解释需求。",-1)),C.value?(Q(),ee("p",Ml,h(C.value),1)):ye("",!0)]),re(An,{result:qe.value,evaluation:n.value},null,8,["result","evaluation"])])):ye("",!0),c.value&&fe.value?(Q(),ee("div",{key:1,class:"hover-tooltip",style:Pe({left:`${S.x+14}px`,top:`${S.y+14}px`})},[t("p",null,"坐标："+h(z(c.value.worldX,2))+", "+h(z(c.value.worldY,2)),1),t("p",null,h(xe(k.value))+"插值："+h(z(c.value.gridValue,3)),1),c.value.borehole?(Q(),ee(Ie,{key:0},[t("p",null,[t("strong",null,h(c.value.borehole.borehole_name),1)]),t("p",null,"RSI "+h(z(c.value.borehole.rsi,2))+" | BRI "+h(z(c.value.borehole.bri,2)),1),t("p",null,"ASI "+h(z(c.value.borehole.asi,2))+" | MPI "+h(z(c.value.borehole.mpi,2)),1),t("p",Al,h(At(c.value.borehole.risk_label)),1)],64)):ye("",!0)],4)):ye("",!0)],512)}}},zl=je(Cl,[["__scopeId","data-v-10660445"]]);export{zl as default};
