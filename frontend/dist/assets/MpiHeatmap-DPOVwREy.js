var N=($,C,a)=>new Promise((x,I)=>{var E=m=>{try{k(a.next(m))}catch(R){I(R)}},_=m=>{try{k(a.throw(m))}catch(R){I(R)}},k=m=>m.done?x(m.value):Promise.resolve(m.value).then(E,_);k((a=a.apply($,C)).next())});import{w as de,bf as me,b4 as ke,b5 as b,b8 as h,b7 as e,bc as ue,b9 as ce,bq as W,bw as ge,bb as w,bo as G,bi as L,bj as be,bh as xe,bn as he,ba as oe,bx as we,n as _e,b as y,c as Y,bm as ve,br as J,bv as fe,bs as Me,bt as pe}from"./vendor-CA5Q5CdR.js";import{_ as ye,a as Ce}from"./index-D1RuNWc2.js";import{g as Ie,j as $e,b as Pe,m as Se,k as Re,l as Be}from"./api-BcwPnB85.js";import"./vue-router-D9BXaJFq.js";import"./network-T6nY3V_4.js";const je={class:"mpi-heatmap-viewer"},Ue={key:0,class:"heatmap-skeleton"},Ee={class:"skeleton-grid"},Ve=["src"],Fe={key:1,class:"empty-state"},Ne={class:"empty-text"},Te={key:3,class:"empty-state"},Le=["aria-label"],Oe={class:"tooltip-body"},He={class:"tooltip-row"},We={class:"tooltip-value"},De={class:"tooltip-row"},ze={class:"tooltip-value"},Xe={class:"tooltip-row tooltip-row-highlight"},Ae={class:"tooltip-value tooltip-value-primary"},Ye={class:"tooltip-row"},Je={__name:"MpiHeatmapViewer",props:{mode:{type:String,default:"image"},imageUrl:{type:String,default:""},grid:{type:Array,default:()=>[]},bounds:{type:Object,default:null},workface:{type:Object,default:null},showBoundary:{type:Boolean,default:!0},showMask:{type:Boolean,default:!0},palette:{type:Array,default:()=>[]},size:{type:Number,default:560},loading:{type:Boolean,default:!1}},emits:["hover","imageError","retry","export","fullscreen"],setup($,{emit:C}){const a=$,x=C,I=y(null),E=y(null),_=y(null),k=y(null),m=y(null),R=y({x:0,y:0}),T=y(""),B=Y(()=>({left:`${R.value.x+16}px`,top:`${R.value.y+16}px`})),D=Y(()=>!a.grid||a.grid.length===0),j=["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],O=Y(()=>a.palette&&a.palette.length?a.palette:j),U={left:.1,top:.1,width:.85,height:.8},K=o=>o==null?"未知":o>=.7?"低风险":o>=.4?"中等风险":"高风险",z=o=>o==null?"risk-unknown":o>=.7?"risk-low":o>=.4?"risk-medium":"risk-high",q=()=>{if(a.mode==="image"&&a.imageUrl){const o=document.createElement("a");o.href=a.imageUrl,o.download=`MPI热力图_${new Date().toISOString().slice(0,10)}.png`,o.click()}else if(a.mode==="canvas"&&_.value){const o=document.createElement("a");o.download=`MPI热力图_${new Date().toISOString().slice(0,10)}.png`,o.href=_.value.toDataURL("image/png"),o.click()}x("export")},ne=()=>{I.value&&(document.fullscreenElement?document.exitFullscreen():I.value.requestFullscreen()),x("fullscreen")},V=()=>N(this,null,function*(){yield _e();const o=I.value;if(!o)return;const s=o.getBoundingClientRect(),l=Math.floor(s.width),c=Math.floor(s.height),i=window.devicePixelRatio||1,v=k.value;v&&(v.width=l*i,v.height=c*i,v.style.width=`${l}px`,v.style.height=`${c}px`,v.getContext("2d").setTransform(i,0,0,i,0,0));const n=_.value;n&&a.mode==="canvas"&&(n.width=l*i,n.height=c*i,n.style.width=`${l}px`,n.style.height=`${c}px`,n.getContext("2d").setTransform(i,0,0,i,0,0)),ae(),re()}),M=()=>{T.value="热力图图片加载失败",x("imageError")},X=()=>{const o=I.value;if(!o)return null;const s=o.getBoundingClientRect();let l=0,c=0,i=s.width,v=s.height;if(a.mode==="image"&&E.value){const n=E.value.getBoundingClientRect();l=n.left-s.left,c=n.top-s.top,i=n.width,v=n.height}return{x:l+i*U.left,y:c+v*U.top,width:i*U.width,height:v*U.height}},Q=(o,s)=>{if(!a.bounds)return{x:0,y:0};const l=X();if(!l)return{x:0,y:0};const c=a.bounds.max_x-a.bounds.min_x,i=a.bounds.max_y-a.bounds.min_y,v=(o-a.bounds.min_x)/(c||1),n=(a.bounds.max_y-s)/(i||1);return{x:l.x+v*l.width,y:l.y+n*l.height}},Z=(o,s)=>{if(!a.bounds)return null;const l=X();if(!l||o<l.x||s<l.y||o>l.x+l.width||s>l.y+l.height)return null;const c=(o-l.x)/l.width,i=(s-l.y)/l.height;return{x:a.bounds.min_x+c*(a.bounds.max_x-a.bounds.min_x),y:a.bounds.max_y-i*(a.bounds.max_y-a.bounds.min_y)}},le=o=>{var u,f;if(!o||!a.grid||a.grid.length===0)return null;const s=a.grid.length,l=((u=a.grid[0])==null?void 0:u.length)||0;if(s===0||l===0)return null;const c=a.bounds.max_x-a.bounds.min_x,i=a.bounds.max_y-a.bounds.min_y,v=Math.min(l-1,Math.max(0,Math.round((o.x-a.bounds.min_x)/(c||1)*(l-1)))),n=Math.min(s-1,Math.max(0,Math.round((o.y-a.bounds.min_y)/(i||1)*(s-1)))),t=(f=a.grid[n])==null?void 0:f[v];return Number.isFinite(t)?t:null},ie=o=>{var t;const s=(t=I.value)==null?void 0:t.getBoundingClientRect();if(!s)return;const l=o.clientX-s.left,c=o.clientY-s.top;R.value={x:l,y:c};const i=Z(l,c);if(!i){m.value=null,x("hover",null);return}const v=le(i);if(v==null){m.value=null,x("hover",null);return}const n={x:i.x,y:i.y,value:v};m.value=n,x("hover",n)},ee=()=>{m.value=null,x("hover",null)},te=o=>{const s=O.value,l=o*(s.length-1),c=Math.floor(l),i=l-c,v=s[Math.min(c,s.length-1)],n=s[Math.min(c+1,s.length-1)],t=S=>{const r=S.replace("#",""),F=parseInt(r.slice(0,2),16),A=parseInt(r.slice(2,4),16),se=parseInt(r.slice(4,6),16);return{r:F,g:A,b:se}},u=t(v),f=t(n),g=Math.round(u.r+(f.r-u.r)*i),d=Math.round(u.g+(f.g-u.g)*i),P=Math.round(u.b+(f.b-u.b)*i);return`rgb(${g}, ${d}, ${P})`},ae=()=>{var f;if(a.mode!=="canvas"||!_.value||!a.grid||a.grid.length===0)return;const o=_.value.getContext("2d"),s=X();if(!s)return;o.clearRect(0,0,_.value.width,_.value.height);const l=a.grid.length,c=((f=a.grid[0])==null?void 0:f.length)||0;let i=1/0,v=-1/0;for(const g of a.grid)for(const d of g)Number.isFinite(d)&&(d<i&&(i=d),d>v&&(v=d));const n=v-i||1,t=s.width/c,u=s.height/l;for(let g=0;g<l;g++)for(let d=0;d<c;d++){const P=a.grid[g][d];if(!Number.isFinite(P))continue;const S=(P-i)/n;o.fillStyle=te(S),o.fillRect(s.x+d*t,s.y+g*u,t+.5,u+.5)}},re=()=>{if(!k.value)return;const o=k.value.getContext("2d"),s=k.value.getBoundingClientRect();if(o.clearRect(0,0,s.width,s.height),!a.workface||!a.bounds)return;const l=a.workface.type==="polygon"?a.workface.points:[[a.workface.bounds.min_x,a.workface.bounds.min_y],[a.workface.bounds.max_x,a.workface.bounds.min_y],[a.workface.bounds.max_x,a.workface.bounds.max_y],[a.workface.bounds.min_x,a.workface.bounds.max_y]];!l||l.length<3||(o.save(),o.beginPath(),l.forEach((c,i)=>{const v=Q(c[0],c[1]);i===0?o.moveTo(v.x,v.y):o.lineTo(v.x,v.y)}),o.closePath(),a.showMask&&(o.fillStyle="rgba(37, 99, 235, 0.18)",o.fill()),a.showBoundary&&(o.strokeStyle="rgba(30, 64, 175, 0.9)",o.lineWidth=2,o.setLineDash([6,4]),o.stroke(),o.setLineDash([])),o.restore())};return de(()=>[a.mode,a.grid,a.bounds,a.workface,a.showBoundary,a.showMask,a.imageUrl],()=>{a.imageUrl&&(T.value=""),V()},{deep:!0}),me(()=>{window.addEventListener("resize",V),V()}),ke(()=>{window.removeEventListener("resize",V)}),(o,s)=>(b(),h("div",je,[$.loading?(b(),h("div",Ue,[s[1]||(s[1]=e("div",{class:"skeleton-header"},[e("div",{class:"skeleton-title"}),e("div",{class:"skeleton-subtitle"})],-1)),e("div",Ee,[(b(),h(ue,null,ce(9,l=>e("div",{key:l,class:"skeleton-cell"})),64))]),s[2]||(s[2]=W('<div class="skeleton-spinner" data-v-b7f5e698><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-b7f5e698><circle cx="12" cy="12" r="10" opacity="0.25" data-v-b7f5e698></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round" data-v-b7f5e698><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite" data-v-b7f5e698></animateTransform></path></svg></div>',1))])):(b(),h("div",{key:1,ref_key:"stageRef",ref:I,class:"heatmap-stage",onMousemove:ie,onMouseleave:ee,tabindex:"0",onKeydown:ge(ee,["esc"])},[$.mode==="image"&&$.imageUrl?(b(),h("img",{key:0,ref_key:"imageRef",ref:E,src:$.imageUrl,class:"heatmap-image",loading:"lazy",decoding:"async",onLoad:V,onError:M,alt:"MPI热力图"},null,40,Ve)):$.mode==="image"&&!$.imageUrl?(b(),h("div",Fe,[s[4]||(s[4]=W('<div class="empty-icon" data-v-b7f5e698><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b7f5e698><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-b7f5e698></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-b7f5e698></circle><polyline points="21 15 16 10 5 21" data-v-b7f5e698></polyline></svg></div>',1)),e("p",Ne,w(T.value||"暂无热力图图片"),1),T.value?(b(),h("button",{key:0,class:"btn-retry",onClick:s[0]||(s[0]=l=>o.$emit("retry"))},[...s[3]||(s[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"})],-1),G(" 重试 ",-1)])])):L("",!0)])):L("",!0),$.mode==="canvas"?(b(),h("canvas",{key:2,ref_key:"heatmapCanvas",ref:_,class:"heatmap-canvas"},null,512)):L("",!0),$.mode==="canvas"&&D.value?(b(),h("div",Te,[...s[5]||(s[5]=[W('<div class="empty-icon" data-v-b7f5e698><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b7f5e698><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-b7f5e698></rect><line x1="3" y1="9" x2="21" y2="9" data-v-b7f5e698></line><line x1="9" y1="21" x2="9" y2="9" data-v-b7f5e698></line></svg></div><p class="empty-text" data-v-b7f5e698>暂无MPI网格数据</p>',2)])])):L("",!0),e("canvas",{ref_key:"overlayCanvas",ref:k,class:"overlay-canvas"},null,512),be(we,{name:"tooltip-fade"},{default:xe(()=>{var l,c;return[m.value?(b(),h("div",{key:0,class:"hover-tooltip",style:he(B.value),role:"tooltip","aria-label":`MPI值: ${(l=m.value.value)==null?void 0:l.toFixed(2)}`},[s[11]||(s[11]=e("div",{class:"tooltip-header"},[e("svg",{class:"tooltip-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"}),e("path",{d:"M12 6v6l4 2"})]),e("span",{class:"tooltip-title"},"MPI综合指标")],-1)),e("div",Oe,[e("div",He,[s[6]||(s[6]=e("span",{class:"tooltip-label"},"X坐标",-1)),e("span",We,w(m.value.x.toFixed(1))+" m",1)]),e("div",De,[s[7]||(s[7]=e("span",{class:"tooltip-label"},"Y坐标",-1)),e("span",ze,w(m.value.y.toFixed(1))+" m",1)]),s[10]||(s[10]=e("div",{class:"tooltip-divider"},null,-1)),e("div",Xe,[s[8]||(s[8]=e("span",{class:"tooltip-label"},"MPI值",-1)),e("span",Ae,w((c=m.value.value)==null?void 0:c.toFixed(3)),1)]),e("div",Ye,[s[9]||(s[9]=e("span",{class:"tooltip-label"},"风险等级",-1)),e("span",{class:oe(["tooltip-badge",z(m.value.value)])},w(K(m.value.value)),3)])])],12,Le)):L("",!0)]}),_:1}),e("div",{class:"export-actions"},[e("button",{class:"btn-export",onClick:q,title:"导出热力图"},[...s[12]||(s[12]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])]),e("button",{class:"btn-export",onClick:ne,title:"全屏显示"},[...s[13]||(s[13]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})],-1)])])])],544))]))}},Ge=ye(Je,[["__scopeId","data-v-b7f5e698"]]),Ke={class:"page mpi-heatmap-page"},qe={class:"mpi-layout"},Qe={class:"left-panel"},Ze={class:"card"},et={class:"sample-actions"},tt={key:0,class:"workface-list"},at={class:"workface-header"},st={class:"workface-items"},ot=["onClick"],nt={class:"workface-type"},lt={key:1,class:"empty-tip"},it={class:"card"},rt={class:"param-group"},dt=["value"],ut={class:"param-group"},ct={class:"param-group"},vt={class:"action-buttons"},ft=["disabled"],pt={key:0,class:"spinner sm"},mt=["disabled"],gt={class:"card"},bt={class:"toggle-row"},ht={class:"toggle-item"},yt={class:"toggle-item"},kt={class:"param-group"},xt={class:"mode-tabs"},wt={class:"right-panel"},_t={class:"card"},Mt={class:"heatmap-header"},Ct={class:"heatmap-actions"},It={key:0,class:"tag"},$t={key:1,class:"tag ghost"},Pt={key:0,class:"workface-bounds"},St={key:1,class:"legend"},Rt={key:2,class:"stats-grid"},Bt={class:"stat-item"},jt={class:"stat-value"},Ut={class:"stat-item"},Et={class:"stat-value"},Vt={class:"stat-item"},Ft={class:"stat-value"},Nt={class:"stat-item"},Tt={class:"stat-value"},Lt={key:3,class:"empty-state"},Ot={__name:"MpiHeatmap",setup($){const C=Ce(),a=y([]),x=y(""),I=y("idw"),E=y(80),_=y(!1),k=y([]),m=y(0),R=y(!0),T=y(!0),B=y("image"),D=y(""),j=y(null),O=y(null),U=y({}),K=y(null),z=new Map,q=["#3b82f6","#facc15","#fb923c","#f87171","#dc2626"],ne=Y(()=>`linear-gradient(90deg, ${q.join(", ")})`),V=Y(()=>Array.isArray(j.value)&&j.value.length>0),M=Y(()=>k.value.length&&k.value[Math.min(m.value,k.value.length-1)]||null),X=()=>{var n;(n=Q.value)==null||n.click()},Q=y(null),Z=()=>{localStorage.setItem("mpi-workfaces",JSON.stringify(k.value))},le=()=>{const n=localStorage.getItem("mpi-workfaces");if(n)try{k.value=JSON.parse(n)||[]}catch(t){k.value=[]}},ie=()=>{k.value=[],m.value=0,Z()},ee=n=>N(this,null,function*(){var u,f,g;const t=(u=n.target.files)==null?void 0:u[0];if(t)try{const{data:d}=yield $e(t);k.value=d.workfaces||[],m.value=0,Z(),C.add(`已导入 ${k.value.length} 个工作面`,"success")}catch(d){C.add(((g=(f=d.response)==null?void 0:f.data)==null?void 0:g.detail)||"工作面解析失败","error")}}),te=n=>{if(n==="csv"){ae(`name,xmin,xmax,ymin,ymax
工作面A,100,400,200,600
工作面B,450,750,150,500
`,"workfaces_example.csv","text/csv");return}ae(JSON.stringify({workfaces:[{name:"工作面A",bounds:{min_x:100,max_x:400,min_y:200,max_y:600}},{name:"工作面B",points:[[450,150],[750,150],[720,500],[480,520]]}]},null,2),"workfaces_example.json","application/json")},ae=(n,t,u)=>{const f=new Blob([n],{type:u}),g=URL.createObjectURL(f),d=document.createElement("a");d.href=g,d.download=t,d.click(),URL.revokeObjectURL(g)},re=()=>N(this,null,function*(){try{const{data:n}=yield Ie();a.value=n.seams||[],!x.value&&a.value.length&&(x.value=a.value[0].name)}catch(n){C.add("加载煤层失败","error")}}),o=n=>N(this,null,function*(){if(!n)return null;if(z.has(n))return z.get(n);try{const{data:t}=yield Be(n);return z.set(n,t),t}catch(t){return z.set(n,null),null}}),s=(...t)=>N(this,[...t],function*(n=[]){var f,g;const u=[];for(const d of n){const P=d.layers||[],S=P.find(H=>H.name===x.value),r=P.filter(H=>H.name!==x.value),F=[];for(const H of r){const p=yield o(H.name);F.push({thickness:H.thickness||0,name:H.name||"",density:p==null?void 0:p.density,bulk_modulus:p==null?void 0:p.bulk_modulus,shear_modulus:p==null?void 0:p.shear_modulus,cohesion:p==null?void 0:p.cohesion,friction_angle:p==null?void 0:p.friction_angle,tensile_strength:p==null?void 0:p.tensile_strength,compressive_strength:p==null?void 0:p.compressive_strength,elastic_modulus:p==null?void 0:p.elastic_modulus,poisson_ratio:p==null?void 0:p.poisson_ratio})}const A=(g=(f=d.seam_top_depth)!=null?f:d.total_overburden_thickness)!=null?g:0,se=(S==null?void 0:S.thickness)||0;u.push({x:d.x,y:d.y,borehole:d.name,thickness:se,burial_depth:A,z_top:A,z_bottom:A+se,strata:F})}return u}),l=()=>N(this,null,function*(){var n,t,u,f;if(x.value){_.value=!0;try{const{data:g}=yield Pe(x.value),d=g.boreholes||[];if(!d.length){C.add("当前煤层无可用钻孔数据","error");return}const P=yield s(d),S=((n=M.value)==null?void 0:n.bounds)||null,{data:r}=yield Se(P,E.value,I.value,null,S);j.value=r.grid,O.value=r.bounds,U.value=r.statistics||{},(t=M.value)!=null&&t.bounds&&c(M.value.bounds,r.bounds),B.value==="image"&&(yield i()),C.add("MPI热力图计算完成","success")}catch(g){C.add(((f=(u=g.response)==null?void 0:u.data)==null?void 0:f.detail)||"MPI计算失败","error")}finally{_.value=!1}}}),c=(n,t)=>{if(!n||!t)return;const u=n.min_x<t.min_x||n.max_x>t.max_x,f=n.min_y<t.min_y||n.max_y>t.max_y;(u||f)&&C.add("工作面范围超出MPI网格边界，显示可能被裁剪","warning")},i=()=>N(this,null,function*(){var n,t,u;if(!(!j.value||!O.value))try{const f=(n=M.value)!=null&&n.name?`MPI热力图 - ${M.value.name}`:"MPI热力图",{data:g}=yield Re({grid:j.value,bounds:O.value,title:f,property_name:"MPI",num_levels:12,dpi:200,smooth_sigma:1,colormap:"odi"});D.value=`data:image/png;base64,${g.image}`}catch(f){C.add(((u=(t=f.response)==null?void 0:t.data)==null?void 0:u.detail)||"热力图图像生成失败","error")}}),v=()=>{B.value==="image"&&(B.value="canvas",C.add("图像加载失败，已切换到Canvas模式","warning"))};return de(B,n=>N(this,null,function*(){n==="image"&&j.value&&!D.value&&(yield i())})),de(m,()=>{j.value&&(j.value=null,O.value=null,D.value="",U.value={},C.add("工作面已切换，请重新计算MPI热力图","info"))}),me(()=>{re(),le()}),(n,t)=>{var u,f,g,d,P,S;return b(),h("div",Ke,[t[32]||(t[32]=W('<div class="page-header" data-v-f42dfab5><div class="page-header-content" data-v-f42dfab5><div class="page-header-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" data-v-f42dfab5></path><path d="M12 6v6l4 2" data-v-f42dfab5></path></svg></div><div data-v-f42dfab5><h1 class="page-title" data-v-f42dfab5>MPI热力图分析</h1><p class="page-subtitle" data-v-f42dfab5>独立展示MPI综合指标分布，支持多工作面上传、切换与热力图渲染</p></div></div></div>',1)),e("div",qe,[e("div",Qe,[e("div",Ze,[t[12]||(t[12]=e("h3",{class:"section-title"},"工作面坐标文件",-1)),t[13]||(t[13]=e("p",{class:"section-desc"},"上传多工作面坐标文件（矩形为主，多边形可选）",-1)),e("div",{class:"upload-box",onClick:X,tabindex:"0",onKeydown:ge(X,["enter"])},[e("input",{ref_key:"workfaceInput",ref:Q,type:"file",accept:".csv,.json,.txt",onChange:ee,style:{display:"none"}},null,544),t[10]||(t[10]=W('<div class="upload-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-f42dfab5></path><polyline points="17 8 12 3 7 8" data-v-f42dfab5></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-f42dfab5></line></svg></div><div class="upload-text" data-v-f42dfab5>上传工作面坐标文件</div><div class="upload-hint" data-v-f42dfab5>支持 CSV / JSON / TXT</div>',3))],32),t[14]||(t[14]=e("div",{class:"helper-text"}," 未上传工作面时，将使用全部网格边界进行渲染。 ",-1)),e("div",et,[e("button",{class:"btn ghost",onClick:t[0]||(t[0]=ve(r=>te("csv"),["stop"]))},"下载CSV示例"),e("button",{class:"btn ghost",onClick:t[1]||(t[1]=ve(r=>te("json"),["stop"]))},"下载JSON示例")]),k.value.length?(b(),h("div",tt,[e("div",at,[e("span",null,"已解析 "+w(k.value.length)+" 个工作面",1),e("button",{class:"btn small ghost",onClick:ie},"清空")]),e("div",st,[(b(!0),h(ue,null,ce(k.value,(r,F)=>(b(),h("button",{key:r.name+F,class:oe(["workface-btn",{active:m.value===F}]),onClick:A=>m.value=F},[G(w(r.name||`工作面 ${F+1}`)+" ",1),e("span",nt,w(r.type==="polygon"?"多边形":"矩形"),1)],10,ot))),128))])])):(b(),h("div",lt,[...t[11]||(t[11]=[W('<div class="empty-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-f42dfab5></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-f42dfab5></circle><polyline points="21 15 16 10 5 21" data-v-f42dfab5></polyline></svg></div><p data-v-f42dfab5>请上传工作面坐标文件</p>',2)])]))]),e("div",it,[t[19]||(t[19]=e("h3",{class:"section-title"},"MPI计算设置",-1)),e("div",rt,[t[15]||(t[15]=e("label",{class:"param-label"},"煤层",-1)),J(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>x.value=r),class:"param-select"},[(b(!0),h(ue,null,ce(a.value,r=>(b(),h("option",{key:r.name,value:r.name},w(r.name),9,dt))),128))],512),[[fe,x.value]])]),e("div",ut,[t[17]||(t[17]=e("label",{class:"param-label"},"插值方法",-1)),J(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>I.value=r),class:"param-select"},[...t[16]||(t[16]=[e("option",{value:"idw"},"IDW",-1),e("option",{value:"linear"},"Linear",-1),e("option",{value:"nearest"},"Nearest",-1)])],512),[[fe,I.value]])]),e("div",ct,[t[18]||(t[18]=e("label",{class:"param-label"},"网格分辨率",-1)),J(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>E.value=r),type:"number",min:"20",max:"200",class:"param-input"},null,512),[[Me,E.value,void 0,{number:!0}]])]),e("div",vt,[e("button",{class:"btn primary",onClick:l,disabled:_.value||!x.value},[_.value?(b(),h("span",pt)):L("",!0),G(" "+w(_.value?"计算中...":"计算MPI热力图"),1)],8,ft),e("button",{class:"btn secondary",onClick:i,disabled:_.value||!V.value}," 刷新图像 ",8,mt)])]),e("div",gt,[t[23]||(t[23]=e("h3",{class:"section-title"},"显示设置",-1)),e("div",bt,[e("label",ht,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=r=>R.value=r)},null,512),[[pe,R.value]]),t[20]||(t[20]=G(" 显示边界 ",-1))]),e("label",yt,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=r=>T.value=r)},null,512),[[pe,T.value]]),t[21]||(t[21]=G(" 显示遮罩 ",-1))])]),e("div",kt,[t[22]||(t[22]=e("label",{class:"param-label"},"渲染模式",-1)),e("div",xt,[e("button",{class:oe(["mode-tab",{active:B.value==="image"}]),onClick:t[7]||(t[7]=r=>B.value="image")},"图像",2),e("button",{class:oe(["mode-tab",{active:B.value==="canvas"}]),onClick:t[8]||(t[8]=r=>B.value="canvas")},"Canvas",2)])])])]),e("div",wt,[e("div",_t,[e("div",Mt,[t[24]||(t[24]=e("h3",{class:"section-title"},"MPI综合指标分布",-1)),e("div",Ct,[M.value?(b(),h("span",It,"当前："+w(M.value.name),1)):(b(),h("span",$t,"未选择工作面"))])]),(u=M.value)!=null&&u.bounds?(b(),h("div",Pt," 范围：X "+w(M.value.bounds.min_x)+" ~ "+w(M.value.bounds.max_x)+"， Y "+w(M.value.bounds.min_y)+" ~ "+w(M.value.bounds.max_y),1)):L("",!0),be(Ge,{mode:B.value,"image-url":D.value,grid:j.value||[],bounds:O.value,workface:M.value,"show-boundary":R.value,"show-mask":T.value,palette:q,onHover:t[9]||(t[9]=r=>K.value=r),onImageError:v},null,8,["mode","image-url","grid","bounds","workface","show-boundary","show-mask"]),V.value?(b(),h("div",St,[t[25]||(t[25]=e("div",{class:"legend-label"},"MPI风险渐变（ODI色盘）",-1)),e("div",{class:"legend-bar",style:he({background:ne.value})},null,4),t[26]||(t[26]=e("div",{class:"legend-scale"},[e("span",null,"高风险（低MPI）"),e("span",null,"低风险（高MPI）")],-1))])):L("",!0),V.value?(b(),h("div",Rt,[e("div",Bt,[t[27]||(t[27]=e("span",{class:"stat-label"},"最小值",-1)),e("span",jt,w(((f=U.value.min)==null?void 0:f.toFixed(2))||"-"),1)]),e("div",Ut,[t[28]||(t[28]=e("span",{class:"stat-label"},"最大值",-1)),e("span",Et,w(((g=U.value.max)==null?void 0:g.toFixed(2))||"-"),1)]),e("div",Vt,[t[29]||(t[29]=e("span",{class:"stat-label"},"平均值",-1)),e("span",Ft,w(((d=U.value.mean)==null?void 0:d.toFixed(2))||"-"),1)]),e("div",Nt,[t[30]||(t[30]=e("span",{class:"stat-label"},"悬停值",-1)),e("span",Tt,w(((S=(P=K.value)==null?void 0:P.value)==null?void 0:S.toFixed(2))||"-"),1)])])):(b(),h("div",Lt,[...t[31]||(t[31]=[W('<div class="empty-icon" data-v-f42dfab5><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-f42dfab5><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-f42dfab5></rect><line x1="3" y1="9" x2="21" y2="9" data-v-f42dfab5></line><line x1="9" y1="21" x2="9" y2="9" data-v-f42dfab5></line></svg></div><p data-v-f42dfab5>请选择煤层并计算MPI热力图</p>',2)])]))])])])])}}},Yt=ye(Ot,[["__scopeId","data-v-f42dfab5"]]);export{Yt as default};
