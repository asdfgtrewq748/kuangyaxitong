import{_ as is,c as i,d as e,m as v,y as M,v as k,f as m,h as Q,t as r,l as W,F as A,k as J,r as o,i as us,u as rs,b as u}from"./index-tY8q6Zf3.js";import{H as K}from"./HeatmapCanvas-YA1z60kR.js";import{g as ds,n as ps,o as vs,q as cs,r as ms,t as bs,c as ys,m as _s,l as gs}from"./api-ChvzGBUD.js";const fs={class:"page"},ks={class:"card"},hs={class:"param-row"},xs={class:"param-group"},Ms={class:"param-group"},Ss={class:"param-grid"},ws={class:"param-group"},Us={class:"param-group"},Ps={class:"param-group"},Vs={class:"param-group"},Is={class:"param-row"},Ls={class:"param-group"},Cs={class:"param-group"},Rs={key:0,class:"param-group"},Fs={class:"param-group"},Gs={class:"action-buttons"},Ns=["disabled"],Bs={key:0,class:"spinner sm"},zs=["disabled"],qs=["disabled"],Ds=["disabled"],Es=["disabled"],Os={key:0,class:"result-box"},Ts={class:"result-values"},$s={class:"result-value"},js={class:"result-number"},Hs={class:"result-value"},Qs={class:"result-number"},Ws={key:0,class:"result-error"},As={key:0,class:"card"},Js={class:"result-content"},Ks={class:"card"},Xs={class:"mpi-controls"},Ys={class:"param-group"},Zs=["value"],se={class:"param-group"},ee={class:"param-group"},te=["disabled"],ae={key:0,class:"spinner sm"},le={key:0,class:"result-content"},oe={class:"stats-row"},ne={class:"stat-item"},ie={class:"stat-value"},ue={class:"stat-item"},re={class:"stat-value"},de={class:"stat-item"},pe={class:"stat-value"},ve={class:"mpi-suggestion"},ce={class:"mpi-suggestion-text"},me={key:1,class:"empty-state"},be={key:1,class:"card"},ye={class:"section-desc"},_e={class:"table-wrapper"},ge={class:"table"},fe={key:0,class:"table-more"},ke={__name:"Steps",setup(he){const d=rs(),b=o("fixed"),S=o("initial"),B=o(10),z=o(1),q=o(2),D=o(1),C=o("total"),w=o("density_thickness"),R=o(1),U=o(60),n=o(!1),h=o(null),F=o(null),g=o(null),G=o([]),y=o(""),E=o(60),O=o("idw"),T=o(null),P=o({}),V=o(!1),N=new Map,X=us(()=>{var s;const a=(s=P.value)==null?void 0:s.mean;return a==null||Number.isNaN(a)?"æš‚æ— å»ºè®®ï¼Œè¯·å…ˆè®¡ç®—MPIåˆ†å¸ƒã€‚":a<60?"MPIåä½ï¼Œå»ºè®®é€‚å½“å‡å°æ¥å‹æ­¥è·æˆ–æé«˜æ”¯æŠ¤å¼ºåº¦ã€‚":a<80?"MPIä¸­ç­‰ï¼Œå»ºè®®æŒ‰å½“å‰æ­¥è·æ‰§è¡Œï¼Œå¹¶å…³æ³¨å±€éƒ¨é«˜é£é™©åŒºã€‚":"MPIåé«˜ï¼Œæ•´ä½“é£é™©è¾ƒä½ï¼Œå¯åœ¨å®‰å…¨æ¡ä»¶ä¸‹é€‚åº¦å¢å¤§æ­¥è·ã€‚"}),Y=async()=>{var a,s;n.value=!0;try{const{data:l}=await ps(b.value,B.value,z.value,q.value,D.value);h.value=l,d.add("æ­¥è·è®¡ç®—å®Œæˆ","success")}catch(l){d.add(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.detail)||"è®¡ç®—å¤±è´¥","error")}finally{n.value=!1}},Z=async()=>{var a,s;n.value=!0;try{const{data:l}=await vs(b.value,S.value,C.value,w.value,U.value,R.value);F.value=l,d.add("æ­¥è·ç½‘æ ¼ç”Ÿæˆå®Œæˆ","success")}catch(l){d.add(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.detail)||"ç”Ÿæˆå¤±è´¥","error")}finally{n.value=!1}},ss=async()=>{var a,s,l;n.value=!0;try{const{data:p}=await ms(b.value);g.value=p,d.add(`å·²è®¡ç®— ${((a=p.items)==null?void 0:a.length)||0} ä¸ªé’»å­”`,"success")}catch(p){d.add(((l=(s=p.response)==null?void 0:s.data)==null?void 0:l.detail)||"æ‰¹é‡è®¡ç®—å¤±è´¥","error")}finally{n.value=!1}},es=async()=>{n.value=!0;try{const{data:a}=await cs(b.value,S.value,C.value,w.value,U.value,R.value),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download=`pressure_steps_grid_${b.value}_${S.value}_${U.value}.csv`,l.click(),URL.revokeObjectURL(s),d.add("å¯¼å‡ºæˆåŠŸ","success")}catch{d.add("å¯¼å‡ºå¤±è´¥","error")}finally{n.value=!1}},ts=async()=>{n.value=!0;try{const{data:a}=await bs(b.value),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download=`pressure_steps_${b.value}.csv`,l.click(),URL.revokeObjectURL(s),d.add("å¯¼å‡ºæˆåŠŸ","success")}catch{d.add("å¯¼å‡ºå¤±è´¥","error")}finally{n.value=!1}},as=async()=>{try{const{data:a}=await ds();G.value=a.seams||[],!y.value&&G.value.length>0&&(y.value=G.value[0].name)}catch{d.add("åŠ è½½ç…¤å±‚å¤±è´¥","error")}},ls=async a=>{if(!a)return null;if(N.has(a))return N.get(a);try{const{data:s}=await gs(a);return N.set(a,s),s}catch{return N.set(a,null),null}},os=async(a=[])=>{const s=[];for(const l of a){const p=l.layers||[],_=p.find(c=>c.name===y.value),f=p.filter(c=>c.name!==y.value),I=[];for(const c of f){const t=await ls(c.name);I.push({thickness:c.thickness||0,name:c.name||"",density:t==null?void 0:t.density,bulk_modulus:t==null?void 0:t.bulk_modulus,shear_modulus:t==null?void 0:t.shear_modulus,cohesion:t==null?void 0:t.cohesion,friction_angle:t==null?void 0:t.friction_angle,tensile_strength:t==null?void 0:t.tensile_strength,compressive_strength:t==null?void 0:t.compressive_strength,elastic_modulus:t==null?void 0:t.elastic_modulus,poisson_ratio:t==null?void 0:t.poisson_ratio})}const x=l.seam_top_depth??l.total_overburden_thickness??0,L=(_==null?void 0:_.thickness)||0;s.push({x:l.x,y:l.y,borehole:l.name,thickness:L,burial_depth:x,z_top:x,z_bottom:x+L,strata:I})}return s},ns=async()=>{var a,s;if(y.value){V.value=!0;try{const{data:l}=await ys(y.value),p=l.boreholes||[];if(p.length===0){d.add("å½“å‰ç…¤å±‚æ— å¯ç”¨é’»å­”æ•°æ®","error");return}const _=await os(p),{data:f}=await _s(_,E.value,O.value);T.value=f.grid,P.value=f.statistics||{},d.add("MPIåˆ†å¸ƒè®¡ç®—å®Œæˆ","success")}catch(l){d.add(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.detail)||"MPIè®¡ç®—å¤±è´¥","error")}finally{V.value=!1}}};return as(),(a,s)=>{var l,p,_,f,I,x,L,c;return u(),i("div",fs,[s[45]||(s[45]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"ğŸ“ æ¥å‹æ­¥è·è®¡ç®—"),e("p",{class:"page-subtitle"},"åŸºäºé¡¶æ¿å²©å±‚åŠ›å­¦å‚æ•°è®¡ç®—åˆæ¬¡æ¥å‹æ­¥è·å’Œå‘¨æœŸæ¥å‹æ­¥è·")],-1)),e("div",ks,[s[30]||(s[30]=e("h3",{class:"section-title"},"è®¡ç®—æ¨¡å‹é€‰æ‹©",-1)),e("div",hs,[e("div",xs,[s[14]||(s[14]=e("label",{class:"param-label"},"åŠ›å­¦æ¨¡å‹",-1)),v(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),class:"param-select"},[...s[13]||(s[13]=[e("option",{value:"fixed"},"å›ºæ”¯æ¢æ¨¡å‹",-1),e("option",{value:"simply"},"ç®€æ”¯æ¢æ¨¡å‹",-1),e("option",{value:"shear"},"å‰ªåˆ‡ç ´åæ¨¡å‹",-1),e("option",{value:"empirical"},"ç»éªŒæ¯”ä¾‹æ¨¡å‹",-1)])],512),[[M,b.value]])]),e("div",Ms,[s[16]||(s[16]=e("label",{class:"param-label"},"è®¡ç®—ç›®æ ‡",-1)),v(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>S.value=t),class:"param-select"},[...s[15]||(s[15]=[e("option",{value:"initial"},"åˆæ¬¡æ¥å‹æ­¥è·",-1),e("option",{value:"periodic"},"å‘¨æœŸæ¥å‹æ­¥è·",-1)])],512),[[M,S.value]])])]),e("div",Ss,[e("div",ws,[s[17]||(s[17]=e("label",{class:"param-label"},"é¡¶æ¿åšåº¦ h (m)",-1)),v(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>B.value=t),type:"number",step:"0.1",class:"param-input"},null,512),[[k,B.value,void 0,{number:!0}]])]),e("div",Us,[s[18]||(s[18]=e("label",{class:"param-label"},"è½½è· q (MPa)",-1)),v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>z.value=t),type:"number",step:"0.1",class:"param-input"},null,512),[[k,z.value,void 0,{number:!0}]])]),e("div",Ps,[s[19]||(s[19]=e("label",{class:"param-label"},"æŠ—æ‹‰å¼ºåº¦ t (MPa)",-1)),v(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>q.value=t),type:"number",step:"0.1",class:"param-input"},null,512),[[k,q.value,void 0,{number:!0}]])]),e("div",Vs,[s[20]||(s[20]=e("label",{class:"param-label"},"æŠ—å‰ªå¼ºåº¦ s (MPa)",-1)),v(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>D.value=t),type:"number",step:"0.1",class:"param-input"},null,512),[[k,D.value,void 0,{number:!0}]])])]),e("div",Is,[e("div",Ls,[s[22]||(s[22]=e("label",{class:"param-label"},"h å–å€¼æ–¹å¼",-1)),v(e("select",{"onUpdate:modelValue":s[6]||(s[6]=t=>C.value=t),class:"param-select"},[...s[21]||(s[21]=[e("option",{value:"total"},"æ€»åšåº¦",-1)])],512),[[M,C.value]])]),e("div",Cs,[s[24]||(s[24]=e("label",{class:"param-label"},"q å–å€¼æ–¹å¼",-1)),v(e("select",{"onUpdate:modelValue":s[7]||(s[7]=t=>w.value=t),class:"param-select"},[...s[23]||(s[23]=[e("option",{value:"density_thickness"},"å®¹é‡ Ã— åšåº¦",-1),e("option",{value:"default"},"é»˜è®¤å€¼",-1)])],512),[[M,w.value]])]),w.value==="default"?(u(),i("div",Rs,[s[25]||(s[25]=e("label",{class:"param-label"},"q é»˜è®¤å€¼",-1)),v(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>R.value=t),type:"number",step:"0.1",class:"param-input"},null,512),[[k,R.value,void 0,{number:!0}]])])):m("",!0),e("div",Fs,[s[26]||(s[26]=e("label",{class:"param-label"},"ç½‘æ ¼å¤§å°",-1)),v(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>U.value=t),type:"number",min:"20",max:"120",class:"param-input"},null,512),[[k,U.value,void 0,{number:!0}]])])]),e("div",Gs,[e("button",{class:"btn primary",onClick:Y,disabled:n.value},[n.value?(u(),i("span",Bs)):m("",!0),Q(" "+r(n.value?"è®¡ç®—ä¸­...":"è®¡ç®—æ­¥è·"),1)],8,Ns),e("button",{class:"btn secondary",onClick:Z,disabled:n.value}," ç”Ÿæˆæ­¥è·ç½‘æ ¼ ",8,zs),F.value?(u(),i("button",{key:0,class:"btn secondary",onClick:es,disabled:n.value}," å¯¼å‡ºç½‘æ ¼ ",8,qs)):m("",!0),e("button",{class:"btn secondary",onClick:ss,disabled:n.value}," æ‰¹é‡è®¡ç®— ",8,Ds),g.value?(u(),i("button",{key:1,class:"btn secondary",onClick:ts,disabled:n.value}," å¯¼å‡ºæ‰¹é‡ç»“æœ ",8,Es)):m("",!0)]),h.value?(u(),i("div",Os,[s[29]||(s[29]=e("div",{class:"result-header"},"è®¡ç®—ç»“æœ",-1)),e("div",Ts,[e("div",$s,[s[27]||(s[27]=e("span",{class:"result-label"},"åˆæ¬¡æ¥å‹æ­¥è·",-1)),e("span",js,r(((l=h.value.initial_step)==null?void 0:l.toFixed(2))||"-")+" m",1)]),e("div",Hs,[s[28]||(s[28]=e("span",{class:"result-label"},"å‘¨æœŸæ¥å‹æ­¥è·",-1)),e("span",Qs,r(((p=h.value.periodic_step)==null?void 0:p.toFixed(2))||"-")+" m",1)])]),h.value.error?(u(),i("div",Ws," æ³¨æ„ï¼š"+r(h.value.error),1)):m("",!0)])):m("",!0)]),F.value?(u(),i("div",As,[s[31]||(s[31]=e("h3",{class:"section-title"},"æ­¥è·åˆ†å¸ƒç½‘æ ¼",-1)),e("div",Js,[W(K,{grid:F.value.values,size:500},null,8,["grid"])])])):m("",!0),e("div",Ks,[s[41]||(s[41]=e("h3",{class:"section-title"},"MPIåˆ†å¸ƒä¸æ­¥è·å»ºè®®",-1)),s[42]||(s[42]=e("p",{class:"section-desc"},"åŸºäºç…¤å±‚ä¸Šè¦†å²©å±‚å‚æ•°è®¡ç®—MPIåˆ†å¸ƒï¼Œç”¨äºè¾…åŠ©æ­¥è·è°ƒæ•´",-1)),e("div",Xs,[e("div",Ys,[s[32]||(s[32]=e("label",{class:"param-label"},"ç…¤å±‚",-1)),v(e("select",{"onUpdate:modelValue":s[10]||(s[10]=t=>y.value=t),class:"param-select"},[(u(!0),i(A,null,J(G.value,t=>(u(),i("option",{key:t.name,value:t.name},r(t.name),9,Zs))),128))],512),[[M,y.value]])]),e("div",se,[s[33]||(s[33]=e("label",{class:"param-label"},"ç½‘æ ¼åˆ†è¾¨ç‡",-1)),v(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>E.value=t),type:"number",min:"20",max:"150",class:"param-input"},null,512),[[k,E.value,void 0,{number:!0}]])]),e("div",ee,[s[35]||(s[35]=e("label",{class:"param-label"},"æ’å€¼æ–¹æ³•",-1)),v(e("select",{"onUpdate:modelValue":s[12]||(s[12]=t=>O.value=t),class:"param-select"},[...s[34]||(s[34]=[e("option",{value:"idw"},"IDW",-1),e("option",{value:"linear"},"Linear",-1),e("option",{value:"nearest"},"Nearest",-1)])],512),[[M,O.value]])]),e("button",{class:"btn secondary",onClick:ns,disabled:V.value||!y.value},[V.value?(u(),i("span",ae)):m("",!0),Q(" "+r(V.value?"è®¡ç®—ä¸­...":"è®¡ç®—MPIåˆ†å¸ƒ"),1)],8,te)]),T.value?(u(),i("div",le,[W(K,{grid:T.value,size:420},null,8,["grid"]),e("div",oe,[e("div",ne,[s[36]||(s[36]=e("span",{class:"stat-label"},"æœ€å°å€¼",-1)),e("span",ie,r(((_=P.value.min)==null?void 0:_.toFixed(2))||"-"),1)]),e("div",ue,[s[37]||(s[37]=e("span",{class:"stat-label"},"æœ€å¤§å€¼",-1)),e("span",re,r(((f=P.value.max)==null?void 0:f.toFixed(2))||"-"),1)]),e("div",de,[s[38]||(s[38]=e("span",{class:"stat-label"},"å¹³å‡å€¼",-1)),e("span",pe,r(((I=P.value.mean)==null?void 0:I.toFixed(2))||"-"),1)])]),e("div",ve,[s[39]||(s[39]=e("div",{class:"mpi-suggestion-title"},"æ­¥è·è°ƒæ•´å»ºè®®",-1)),e("p",ce,r(X.value),1)])])):(u(),i("div",me,[...s[40]||(s[40]=[e("div",{class:"empty-icon"},"ğŸ“Š",-1),e("p",null,"è¯·é€‰æ‹©ç…¤å±‚å¹¶è®¡ç®—MPIåˆ†å¸ƒ",-1)])]))]),g.value?(u(),i("div",be,[s[44]||(s[44]=e("h3",{class:"section-title"},"æ‰¹é‡è®¡ç®—ç»“æœ",-1)),e("p",ye,"å·²è®¡ç®— "+r(((x=g.value.items)==null?void 0:x.length)||0)+" ä¸ªé’»å­”çš„æ¥å‹æ­¥è·",1),e("div",_e,[e("table",ge,[s[43]||(s[43]=e("thead",null,[e("tr",null,[e("th",null,"åºå·"),e("th",null,"åˆæ¬¡æ¥å‹æ­¥è· (m)"),e("th",null,"å‘¨æœŸæ¥å‹æ­¥è· (m)")])],-1)),e("tbody",null,[(u(!0),i(A,null,J((L=g.value.items)==null?void 0:L.slice(0,20),(t,$)=>{var j,H;return u(),i("tr",{key:$},[e("td",null,r($+1),1),e("td",null,r(((j=t.initial)==null?void 0:j.toFixed(2))||"-"),1),e("td",null,r(((H=t.periodic)==null?void 0:H.toFixed(2))||"-"),1)])}),128))])]),((c=g.value.items)==null?void 0:c.length)>20?(u(),i("div",fe," è¿˜æœ‰ "+r(g.value.items.length-20)+" æ¡æ•°æ®... ",1)):m("",!0)])])):m("",!0)])}}},we=is(ke,[["__scopeId","data-v-9adc5646"]]);export{we as default};
