import{_ as N,c as v,d as s,f as R,h as T,t as l,F as w,k as M,r as z,u as E,b as _}from"./index-tY8q6Zf3.js";import{v as U,w as A,x as V,y as W,g as $,c as q,z as G,l as H}from"./api-ChvzGBUD.js";const J={class:"page"},K={class:"card"},Q={class:"action-buttons"},X=["disabled"],Y={key:0,class:"spinner sm"},Z={key:0,class:"report-content"},ss={class:"summary-cards"},ts={class:"card-title"},es={class:"card-stats"},as={class:"card-stat"},ns={class:"stat-value"},ls={class:"card-stat"},os={class:"stat-value"},is={class:"card-stat"},ds={class:"stat-value"},rs={class:"card-additional"},cs={key:0,class:"card"},us={class:"section-title"},ms={class:"mpi-summary-grid"},ps={class:"mpi-summary-item"},vs={class:"stat-value"},_s={class:"mpi-summary-item"},bs={class:"stat-value"},hs={class:"mpi-summary-item"},ys={class:"stat-value"},xs={class:"mpi-summary-item"},gs={class:"stat-value"},ks={class:"mpi-summary-item"},fs={class:"stat-value"},Fs={class:"mpi-summary-item"},Ps={class:"stat-value"},Is={class:"mpi-markers"},ws={class:"mpi-marker"},Ms={class:"mpi-marker"},Ss={class:"card"},Rs={class:"table-wrapper"},zs={class:"table"},Ds={key:1,class:"empty-state"},Cs={__name:"Report",setup(js){const S=E(),F=z(!1),f=z(null),d=z(null),P=new Map,C=async()=>{var i,t;F.value=!0;try{const r="idw",u="x",b="ascending",m="decrease",n="fixed",o="initial",[p,h,k,I]=await Promise.all([U(r,60),A({method:r,grid_size:60,axis:u,count:3,direction:b,mode:m,decay:.08,elastic_modulus:.4,density:.3,tensile_strength:.3}),V(n,o,60),W({model:n,target:o,grid_size:60,axis:u,count:3,direction:b,mode:m,decay:.08})]);f.value=[{name:"çŸ¿å‹æŒ‡æ ‡",stats:p.data.grid},{name:"çŸ¿å‹æŒ‡æ ‡-å·¥ä½œé¢",stats:h.data.grid},{name:"æ¥å‹æ­¥è·",stats:k.data.grid},{name:"æ¥å‹æ­¥è·-å·¥ä½œé¢",stats:I.data.grid}],d.value=await L(),S.add("æŠ¥å‘Šç”Ÿæˆå®Œæˆ","success")}catch(r){S.add(((t=(i=r.response)==null?void 0:i.data)==null?void 0:t.detail)||"ç”Ÿæˆå¤±è´¥","error")}finally{F.value=!1}},j=async i=>{if(!i)return null;if(P.has(i))return P.get(i);try{const{data:t}=await H(i);return P.set(i,t),t}catch{return P.set(i,null),null}},B=async(i=[],t="")=>{const r=[];for(const c of i){const u=c.layers||[],y=u.find(o=>o.name===t),b=u.filter(o=>o.name!==t),m=[];for(const o of b){const e=await j(o.name);m.push({thickness:o.thickness||0,name:o.name||"",density:e==null?void 0:e.density,bulk_modulus:e==null?void 0:e.bulk_modulus,shear_modulus:e==null?void 0:e.shear_modulus,cohesion:e==null?void 0:e.cohesion,friction_angle:e==null?void 0:e.friction_angle,tensile_strength:e==null?void 0:e.tensile_strength,compressive_strength:e==null?void 0:e.compressive_strength,elastic_modulus:e==null?void 0:e.elastic_modulus,poisson_ratio:e==null?void 0:e.poisson_ratio})}const a=c.seam_top_depth??c.total_overburden_thickness??0,n=(y==null?void 0:y.thickness)||0;r.push({x:c.x,y:c.y,borehole:c.name,thickness:n,burial_depth:a,z_top:a,z_bottom:a+n,strata:m})}return r},L=async()=>{try{const{data:i}=await $(),t=i.seams||[];if(t.length===0)return null;const r=t[0].name,{data:c}=await q(r),u=c.boreholes||[];if(u.length===0)return null;const y=await B(u,r),{data:b}=await G(y),m=b.results||[],a=m.reduce((p,h)=>{var k,I,D;return p.rsi+=((k=h.breakdown)==null?void 0:k.rsi)||0,p.bri+=((I=h.breakdown)==null?void 0:I.bri)||0,p.asi+=((D=h.breakdown)==null?void 0:D.asi)||0,p},{rsi:0,bri:0,asi:0}),n=m.length||1,o={rsi:a.rsi/n,bri:a.bri/n,asi:a.asi/n},e=[...m].sort((p,h)=>p.mpi-h.mpi),x=e.slice(0,3),g=e.slice(-3).reverse();return{seamName:r,stats:b.summary||{},breakdown:o,high:g,low:x}}catch{return null}},O=()=>{var y,b,m,a;const i=f.value.map(n=>{var o,e,x,g,p,h,k;return{æŒ‡æ ‡:n.name,æœ€å°å€¼:(o=n.stats.min)==null?void 0:o.toFixed(3),æœ€å¤§å€¼:(e=n.stats.max)==null?void 0:e.toFixed(3),å¹³å‡å€¼:(x=n.stats.mean)==null?void 0:x.toFixed(3),æ ‡å‡†å·®:(g=n.stats.std)==null?void 0:g.toFixed(3),P10:(p=n.stats.p10)==null?void 0:p.toFixed(3),P50:(h=n.stats.p50)==null?void 0:h.toFixed(3),P90:(k=n.stats.p90)==null?void 0:k.toFixed(3)}});d.value&&i.push({æŒ‡æ ‡:`MPIç»¼åˆæŒ‡æ ‡ï¼ˆ${d.value.seamName}ï¼‰`,æœ€å°å€¼:(y=d.value.stats.min)==null?void 0:y.toFixed(3),æœ€å¤§å€¼:(b=d.value.stats.max)==null?void 0:b.toFixed(3),å¹³å‡å€¼:(m=d.value.stats.mean)==null?void 0:m.toFixed(3),æ ‡å‡†å·®:(a=d.value.stats.std)==null?void 0:a.toFixed(3),P10:"",P50:"",P90:""});const t=[Object.keys(i[0]).join(","),...i.map(n=>Object.values(n).join(","))].join(`
`),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(r),u=document.createElement("a");u.href=c,u.download=`pressure_report_${new Date().toISOString().slice(0,10)}.csv`,u.click(),URL.revokeObjectURL(c),S.add("æŠ¥å‘Šå¯¼å‡ºæˆåŠŸ","success")};return(i,t)=>{var r,c,u,y,b,m;return _(),v("div",J,[t[17]||(t[17]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"ğŸ“‘ ç»“æœæŠ¥å‘Š"),s("p",{class:"page-subtitle"},"ç”Ÿæˆç»¼åˆåˆ†ææŠ¥å‘Šï¼Œæ±‡æ€»æ‰€æœ‰è®¡ç®—ç»“æœ")],-1)),s("div",K,[t[0]||(t[0]=s("h3",{class:"section-title"},"ç”ŸæˆæŠ¥å‘Š",-1)),t[1]||(t[1]=s("p",{class:"section-desc"},"ç‚¹å‡»ç”ŸæˆæŒ‰é’®è·å–å®Œæ•´çš„åˆ†ææŠ¥å‘Š",-1)),s("div",Q,[s("button",{class:"btn primary",onClick:C,disabled:F.value},[F.value?(_(),v("span",Y)):R("",!0),T(" "+l(F.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆç»¼åˆæŠ¥å‘Š"),1)],8,X),f.value?(_(),v("button",{key:0,class:"btn secondary",onClick:O}," å¯¼å‡ºæŠ¥å‘Š ")):R("",!0)])]),f.value?(_(),v("div",Z,[s("div",ss,[(_(!0),v(w,null,M(f.value,a=>{var n,o,e,x,g;return _(),v("div",{key:a.name,class:"summary-card"},[s("div",ts,l(a.name),1),s("div",es,[s("div",as,[t[2]||(t[2]=s("span",{class:"stat-label"},"æœ€å°å€¼",-1)),s("span",ns,l(((n=a.stats.min)==null?void 0:n.toFixed(3))||"-"),1)]),s("div",ls,[t[3]||(t[3]=s("span",{class:"stat-label"},"æœ€å¤§å€¼",-1)),s("span",os,l(((o=a.stats.max)==null?void 0:o.toFixed(3))||"-"),1)]),s("div",is,[t[4]||(t[4]=s("span",{class:"stat-label"},"å¹³å‡å€¼",-1)),s("span",ds,l(((e=a.stats.mean)==null?void 0:e.toFixed(3))||"-"),1)])]),s("div",rs,[s("span",null,"æ ‡å‡†å·®: "+l(((x=a.stats.std)==null?void 0:x.toFixed(3))||"-"),1),s("span",null,"P50: "+l(((g=a.stats.p50)==null?void 0:g.toFixed(3))||"-"),1)])])}),128))]),d.value?(_(),v("div",cs,[s("h3",us,"MPIä¸“é¢˜åˆ†æï¼ˆ"+l(d.value.seamName)+"ï¼‰",1),t[13]||(t[13]=s("p",{class:"section-desc"},"ç»¼åˆMPIä¸åˆ†é¡¹æŒ‡æ ‡ç»Ÿè®¡ï¼Œå¹¶æ ‡æ³¨é«˜/ä½MPIåŒºåŸŸ",-1)),s("div",ms,[s("div",ps,[t[5]||(t[5]=s("span",{class:"stat-label"},"MPIæœ€å°å€¼",-1)),s("span",vs,l(((r=d.value.stats.min)==null?void 0:r.toFixed(2))||"-"),1)]),s("div",_s,[t[6]||(t[6]=s("span",{class:"stat-label"},"MPIæœ€å¤§å€¼",-1)),s("span",bs,l(((c=d.value.stats.max)==null?void 0:c.toFixed(2))||"-"),1)]),s("div",hs,[t[7]||(t[7]=s("span",{class:"stat-label"},"MPIå¹³å‡å€¼",-1)),s("span",ys,l(((u=d.value.stats.mean)==null?void 0:u.toFixed(2))||"-"),1)]),s("div",xs,[t[8]||(t[8]=s("span",{class:"stat-label"},"RSIå¹³å‡å€¼",-1)),s("span",gs,l(((y=d.value.breakdown.rsi)==null?void 0:y.toFixed(2))||"-"),1)]),s("div",ks,[t[9]||(t[9]=s("span",{class:"stat-label"},"BRIå¹³å‡å€¼",-1)),s("span",fs,l(((b=d.value.breakdown.bri)==null?void 0:b.toFixed(2))||"-"),1)]),s("div",Fs,[t[10]||(t[10]=s("span",{class:"stat-label"},"ASIå¹³å‡å€¼",-1)),s("span",Ps,l(((m=d.value.breakdown.asi)==null?void 0:m.toFixed(2))||"-"),1)])]),s("div",Is,[s("div",ws,[t[11]||(t[11]=s("div",{class:"mpi-marker-title"},"é«˜MPIåŒºåŸŸï¼ˆä½é£é™©ï¼‰",-1)),s("ul",null,[(_(!0),v(w,null,M(d.value.high,a=>(_(),v("li",{key:a.id},l(a.id)+"ï¼šMPI "+l(a.mpi.toFixed(2)),1))),128))])]),s("div",Ms,[t[12]||(t[12]=s("div",{class:"mpi-marker-title"},"ä½MPIåŒºåŸŸï¼ˆé«˜é£é™©ï¼‰",-1)),s("ul",null,[(_(!0),v(w,null,M(d.value.low,a=>(_(),v("li",{key:a.id},l(a.id)+"ï¼šMPI "+l(a.mpi.toFixed(2)),1))),128))])])])])):R("",!0),s("div",Ss,[t[15]||(t[15]=s("h3",{class:"section-title"},"è¯¦ç»†ç»Ÿè®¡æ•°æ®",-1)),s("div",Rs,[s("table",zs,[t[14]||(t[14]=s("thead",null,[s("tr",null,[s("th",null,"æŒ‡æ ‡"),s("th",null,"æœ€å°å€¼"),s("th",null,"æœ€å¤§å€¼"),s("th",null,"å¹³å‡å€¼"),s("th",null,"æ ‡å‡†å·®"),s("th",null,"P10"),s("th",null,"P50"),s("th",null,"P90")])],-1)),s("tbody",null,[(_(!0),v(w,null,M(f.value,a=>{var n,o,e,x,g,p,h;return _(),v("tr",{key:a.name},[s("td",null,[s("strong",null,l(a.name),1)]),s("td",null,l(((n=a.stats.min)==null?void 0:n.toFixed(3))||"-"),1),s("td",null,l(((o=a.stats.max)==null?void 0:o.toFixed(3))||"-"),1),s("td",null,l(((e=a.stats.mean)==null?void 0:e.toFixed(3))||"-"),1),s("td",null,l(((x=a.stats.std)==null?void 0:x.toFixed(3))||"-"),1),s("td",null,l(((g=a.stats.p10)==null?void 0:g.toFixed(3))||"-"),1),s("td",null,l(((p=a.stats.p50)==null?void 0:p.toFixed(3))||"-"),1),s("td",null,l(((h=a.stats.p90)==null?void 0:h.toFixed(3))||"-"),1)])}),128))])])])])])):(_(),v("div",Ds,[...t[16]||(t[16]=[s("div",{class:"empty-icon"},"ğŸ“Š",-1),s("p",null,"æš‚æ— æŠ¥å‘Šæ•°æ®",-1),s("p",{class:"empty-hint"},"è¯·å…ˆå®Œæˆæ•°æ®åˆ†æåå†ç”ŸæˆæŠ¥å‘Š",-1)])]))])}}},Os=N(Cs,[["__scopeId","data-v-be0e28da"]]);export{Os as default};
