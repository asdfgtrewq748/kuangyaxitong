# 2026-02-07 产品化整合方案（矿压智能评估平台）

## 1. 产品目标
将当前“功能集合型系统”整合为“流程驱动型产品”，形成单一主线：
`数据接入 -> 空间建模 -> 实证验证 -> 报告交付`。

目标结果：
- 页面减少、入口清晰、学习成本降低。
- 各页面共享同一项目上下文（煤层、参数、版本、run_id）。
- 输出可直接用于工程汇报与论文附录。

## 2. 现状诊断（基于代码）
### 2.1 前端页面体量过大
- `AcademicAlgorithm.vue` 3705 行
- `MpiHeatmapPro.vue` 2217 行
- `MpiAlgorithm.vue` 2155 行
- `Interpolation.vue` 1843 行
- `DataImport.vue` 1481 行

结论：页面承担了过多职责，后续维护与联动成本高。

### 2.2 导航存在重复与遗留
当前存在 10 个主路由，其中至少 3 组明显重叠：
- 空间类：`/mpi-heatmap` 与 `/mpi-heatmap-pro`
- 算法说明类：`/mpi-algorithm` 与 `/academic-algorithm`
- 评估链路类：`/pressure`、`/steps`、`/algorithm-validation`

### 2.3 页面间上下文未统一
各页多为“独立拉取 API + 独立状态”，缺少统一的项目上下文与 run 管理。

## 3. 目标信息架构（V1）
建议收敛为 6 个产品级入口：
1. 数据导入（Data）
2. 插值分析（Interpolation）
3. 矿压指标（Pressure）
4. MPI数值模拟（Simulation）
5. 新算法实证（Validation）
6. 结果报告（Report）

说明：算法文档页保留路由但退出主导航，作为“帮助/附录内容”。

## 4. 页面处置清单（删/并/留）
### 4.1 立即从导航隐藏（保留路由，零风险回退）
- `/mpi-heatmap`（旧版）
- `/mpi-algorithm`（说明页）
- `/academic-algorithm`（说明页）

### 4.2 中期合并
- `/interpolation` + `/mpi-heatmap-pro` -> `空间建模中心`
- `/pressure` + `/steps` -> `指标与步距中心`

### 4.3 长期删除（完成合并且稳定后）
- 被新中心完全替代的旧页面文件与冗余组件。

## 5. 页面联系增强机制（产品化关键）
### 5.1 统一上下文（Pinia）
建立全局 store：
- `projectStore`: 当前煤层、数据版本、时间窗
- `modelStore`: 插值方法、分辨率、权重、阈值
- `runStore`: 当前 run_id、评估指标、导出状态

### 5.2 路由前置校验
- 无数据时禁止进入验证与报告页，自动引导到数据导入。
- 无 run 时报告页显示“从实证页一键生成”。

### 5.3 跨页动作链
- 插值/指标页：`用当前配置进入实证`
- 实证页：`基于当前 run 生成报告`
- 报告页：`回溯到对应 run 与参数快照`

## 6. 后端收敛建议
以 `run_id` 作为统一主键，沉淀 run 资产：
- 输入快照（参数、数据源）
- 过程产物（网格、评估、图）
- 输出包（报告、图组、数据）

建议新增统一查询端点：
- `GET /api/workspace/context`
- `GET /api/runs/{run_id}`
- `POST /api/runs/{run_id}/export`

## 7. 三阶段落地计划
### 阶段A（1周，低风险）
- 精简导航（隐藏遗留页）
- 修复路由中文乱码
- 补“页面跳转链”按钮（从建模到实证、从实证到报告）

### 阶段B（2周，中风险）
- 建 Pinia 全局上下文
- 将 `/interpolation` 与 `/mpi-heatmap-pro` 抽成共享模块
- 打通 run_id 跨页复用

### 阶段C（2-3周，中高风险）
- 合并页面、删除遗留实现
- 统一导出规范（图、表、JSON）
- 打包发布（Docker Compose + 启动脚本 + 配置模板）

## 8. 本轮已完成（今天）
- 路由标题中文化，修复导航乱码。
- 主导航已过滤 `meta.nav === false`，遗留页从主导航隐藏但路由仍可访问。

涉及文件：
- `frontend/src/router/index.js`
- `frontend/src/layouts/AppLayout.vue`

## 9. 下一步建议（立刻可做）
1. 新增全局 `workspace` store，先只放 5 个核心字段（seam/method/resolution/weights/run_id）。
2. 在 `Interpolation` 页与 `Pressure` 页增加“进入新算法实证”按钮，携带上下文。
3. 在 `AlgorithmValidation` 页增加“生成报告”按钮，直接跳转并传 run_id。
