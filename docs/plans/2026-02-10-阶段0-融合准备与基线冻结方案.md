# 阶段 0 实施方案：融合准备与基线冻结

## 1. 阶段目标

1. 明确地质建模融合的边界、目标与不做项。  
2. 对当前 MPI 系统与 `dizhijianmo` 能力进行逐项映射。  
3. 冻结基线数据、指标口径与验收标准，避免后续漂移。

---

## 2. 融合边界定义

纳入范围：
1. 建模算法能力（分层建模、智能尖灭、回归克里金）。
2. 质量诊断能力（连续性、异常斑块、覆盖率、梯度异常）。
3. 标准产物与导出链路（VTK/VTP/STL/DXF/FLAC3D/F3GRID）。

不纳入范围：
1. Qt 桌面 UI 直接迁移。  
2. 与 MPI 主流程无关的历史实验脚本。  
3. 低复用价值、无测试覆盖的临时工具。

---

## 3. 资产盘点清单

### 3.1 旧项目（`dizhijianmo`）
1. 核心建模服务：`dizhijianmo/server/services/modeling_v2.py`。  
2. API 定义：`dizhijianmo/server/api/v2/modeling.py`。  
3. 质量诊断参考：`dizhijianmo/diagnostics/coal_continuity_report.json`。  
4. 功能说明：`dizhijianmo/docs/notes/pyqt/PYQT_FEATURES.md`。

### 3.2 当前 MPI 系统
1. 后端主入口：`backend/app/main.py`。  
2. MPI 接口：`backend/app/routes/mpi.py`。  
3. 实证与科研接口：`backend/app/routes/algorithm_validation.py`、`backend/app/routes/research.py`。  
4. 前端关键页：`frontend/src/views/Interpolation.vue`、`frontend/src/views/MpiHeatmapPro.vue`、`frontend/src/views/AlgorithmValidation.vue`、`frontend/src/views/Steps.vue`、`frontend/src/views/Report.vue`、`frontend/src/views/ResearchWorkbench.vue`。

---

## 4. 方案选择与决策

推荐方案：服务化渐进融合。
1. 在后端新增 Geomodel 服务层，封装旧项目算法。  
2. 通过标准产物协议对接 MPI/实证/科研模块。  
3. 前端分页面渐进接入，先保留原有工作流，再逐步增强。

不推荐方案：
1. 一次性整体迁移旧项目。  
2. 直接复制 Qt 逻辑到 Web 前端。  
3. 在 MPI 计算层硬编码所有地质逻辑。

---

## 5. 基线冻结项

1. 基线数据集：冻结 1 套主数据 + 1 套对照数据。  
2. 基线指标：MPI 关键指标、实证指标、性能指标。  
3. 基线阈值：
- 接口可用性阈值（成功率、错误率）
- 性能阈值（P95 延迟、任务耗时）
- 精度阈值（核心评估指标）

4. 基线文档：将口径写入计划文档并纳入回归检查。

---

## 6. 风险与前置对策

1. 依赖版本冲突（PyKrige/VTK/Scipy）
- 对策：阶段 A 建立依赖隔离与启动自检。

2. 坐标系/层序不一致
- 对策：阶段 A 增加输入合法性校验与层序规则配置。

3. 口径漂移导致对照失真
- 对策：固定基线样本与自动回归报告。

---

## 7. 阶段验收标准

1. 融合边界与不做项明确。  
2. 资产盘点与映射关系完整。  
3. 阶段 A-E 的里程碑、依赖和风险清晰。  
4. 形成可执行总方案文档并进入实施。

---

## 8. 交付物

1. `docs/plans/2026-02-10-地质建模融合MPI实施方案.md`  
2. `task_plan.md`（阶段路线与任务索引）  
3. 本文档（阶段 0 冻结与准备说明）
