# 地质建模融合 MPI 模块级执行清单

## 1. 使用方式

1. 本清单用于阶段 0~E 的模块化推进，不按天排期。  
2. 执行顺序遵循依赖关系：先基础模块，再计算模块，再前端与科研模块。  
3. 每个模块完成后必须通过对应验收项，再进入下一个模块。

---

## 2. 阶段 0：融合准备与基线冻结

### 模块 0-1：能力盘点与边界冻结
- 范围：`dizhijianmo` 算法能力、当前 MPI 路由与页面。  
- 输入：旧项目代码、当前系统代码。  
- 输出：纳入/不纳入清单。  
- 验收：边界明确且文档化，不含模糊项。

### 模块 0-2：基线样本与指标口径冻结
- 范围：基线数据、基线指标、阈值。  
- 输入：现有数据集、当前评估口径。  
- 输出：固定样本集、固定阈值表。  
- 验收：后续所有阶段可复用同一口径。

---

## 3. 阶段 A：后端基座

### 模块 A-1：Geomodel Schema 模块
- 文件：`backend/app/schemas/geomodel.py`。  
- 职责：定义请求/响应模型、参数校验、产物清单结构。  
- 输出：统一 schema 与校验错误码。  
- 验收：非法参数被准确拦截。

### 模块 A-2：Geomodel 服务内核模块
- 文件：`backend/app/services/geomodel_service.py`。  
- 职责：封装建模方法、作业执行、产物落盘、错误处理。  
- 输出：统一任务执行入口。  
- 验收：支持 `thickness`、`hybrid`、`regression_kriging`、`smart_pinchout`。

### 模块 A-3：Geomodel API 路由模块
- 文件：`backend/app/routes/geomodel.py`、`backend/app/main.py`。  
- 职责：提供建模任务创建、状态查询、产物列举、产物下载。  
- 输出：`/api/geomodel/*` 接口集。  
- 验收：任务链路可端到端跑通。

### 模块 A-4：标准产物协议模块
- 文件：服务层与产物目录规范。  
- 职责：统一输出 `summary.json`、`quality_report.json`、`layer_*.vtp`、`model.vtk`。  
- 输出：可被 MPI/前端直接消费的产物协议。  
- 验收：manifest 与实际产物一致。

### 模块 A-5：后端测试模块
- 文件：`backend/tests/test_geomodel_api.py`。  
- 职责：覆盖创建任务、异常参数、失败回退、产物读取。  
- 输出：稳定回归测试。  
- 验收：核心接口测试通过。

---

## 4. 阶段 B：MPI 计算增强

### 模块 B-1：地质特征提取模块
- 文件：`backend/app/services/geomodel_features.py`。  
- 职责：从 Geomodel 产物提取 `key_layer_span`、`layer_cv`、`pinchout_ratio`、`continuity_score`。  
- 输出：结构化特征对象。  
- 验收：缺失特征可容错并标注质量标记。

### 模块 B-2：MPI 算法扩展模块
- 文件：`backend/app/services/mpi_new_algorithm.py`。  
- 职责：引入 geology-aware 影响路径与权重机制。  
- 输出：baseline/geology-aware 双模式计算能力。  
- 验收：同输入可输出双模式对照结果。

### 模块 B-3：地质增强 API 模块
- 文件：`backend/app/routes/mpi.py`。  
- 职责：新增 `POST /api/mpi/calculate-geo`。  
- 输出：包含 `feature_trace` 与回退标记的响应。  
- 验收：无地质特征时自动回退 baseline。

### 模块 B-4：算法回归测试模块
- 文件：`backend/tests/test_mpi_geo_api.py`（建议）。  
- 职责：覆盖特征存在/缺失/异常场景。  
- 输出：口径稳定性验证。  
- 验收：无旧接口回归。

---

## 5. 阶段 C：前端接入与可视化

### 模块 C-1：Geomodel API 适配模块
- 文件：`frontend/src/api.js`。  
- 职责：新增 Geomodel 任务与产物请求封装。  
- 输出：统一前端 API 调用层。  
- 验收：页面不直接拼接后端 URL。

### 模块 C-2：作业状态管理模块
- 文件：`frontend/src/composables/useGeomodelJob.js`（建议新增）。  
- 职责：轮询状态、失败重试、状态缓存。  
- 输出：可复用任务状态 hook。  
- 验收：多页面状态行为一致。

### 模块 C-3：插值页接入模块
- 文件：`frontend/src/views/Interpolation.vue`。  
- 职责：建模任务入口、质量摘要卡、方法对比图。  
- 输出：插值与建模一体化工作流。  
- 验收：可发起任务并看到诊断结果。

### 模块 C-4：MPI 热力图 3D 联动模块
- 文件：`frontend/src/views/MpiHeatmapPro.vue`。  
- 职责：图层开关、透明度、剖切与 2D 热力图联动。  
- 输出：2D/3D 联动分析界面。  
- 验收：交互稳定且坐标映射正确。

### 模块 C-5：实证与报告增强模块
- 文件：`frontend/src/views/AlgorithmValidation.vue`、`frontend/src/views/Steps.vue`、`frontend/src/views/Report.vue`。  
- 职责：地质约束开关、对照图、步距修正建议、地质质量章节。  
- 输出：可解释结果页。  
- 验收：至少三页完成 Geomodel 接入。

---

## 6. 阶段 D：科研闭环与证据链

### 模块 D-1：实验模板扩展模块
- 文件：`backend/app/services/experiment_runner.py`。  
- 职责：新增 `geomodel_ablation`、`pinchout_effect`、`rk_vs_kriging`。  
- 输出：可复现模板化实验。  
- 验收：模板可一键运行。

### 模块 D-2：科研工作台前端模块
- 文件：`frontend/src/views/ResearchWorkbench.vue`、`frontend/src/views/ResearchPortal.vue`。  
- 职责：模板配置、运行、结果对比、证据包下载。  
- 输出：科研操作闭环。  
- 验收：端到端可视化可用。

### 模块 D-3：证据包构建模块
- 文件：研究服务相关导出逻辑。  
- 职责：输出 `manifest.json`、参数快照、统计表、图组。  
- 输出：投稿可用证据包。  
- 验收：同数据同参数可复现。

---

## 7. 阶段 E：验证、压测与上线

### 模块 E-1：后端回归验证模块
- 文件：后端测试套件与脚本。  
- 职责：核心接口回归、作业异常路径验证。  
- 输出：功能回归报告。  
- 验收：关键接口无阻断问题。

### 模块 E-2：性能压测模块
- 文件：压测脚本（建议放 `scripts/perf/`）。  
- 职责：并发压测、长稳压测、峰值冲击压测。  
- 输出：性能基线与容量边界。  
- 验收：成功率与延迟达到阈值。

### 模块 E-3：前端联调回归模块
- 文件：核心页面联调用例。  
- 职责：验证 2D/3D 联动、证据包导出、核心交互稳定性。  
- 输出：联调回归清单。  
- 验收：主流程无明显交互故障。

### 模块 E-4：上线与回滚模块
- 文件：发布说明、运维文档、监控告警配置。  
- 职责：灰度发布、开关降级、回滚演练、交接。  
- 输出：上线检查单与回滚预案。  
- 验收：可观测性和回滚能力完备。

---

## 8. 模块执行优先级

1. P0：A-1、A-2、A-3、A-4、B-1、B-2、B-3。  
2. P1：A-5、B-4、C-1、C-2、C-3、C-4。  
3. P2：C-5、D-1、D-2、D-3。  
4. P3：E-1、E-2、E-3、E-4。

---

## 9. 里程碑判定（模块化）

1. M1：A 组模块全部通过。  
2. M2：B 组模块全部通过。  
3. M3：C 组核心模块（C-1~C-4）通过。  
4. M4：D 组模块通过并生成证据包。  
5. M5：E 组模块通过并完成上线准备。
